import{b as q,dJ as E,B as J,d as K,b_ as Q,k as c,dh as Y,ac as Z}from"../../index-BdYv4pbp.js";import{u as A}from"./index-DKYRm3E7.js";import{a4 as G,d as B,e as f,B as H,M as u,N as n,W as p,a7 as d,k as s,S as o,Q as y,u as v,Y as _,F as X,a0 as ee,Z as ae,aa as te,a1 as oe,a2 as re}from"./vue-chunks-Dagx-vSq.js";import"./index-TeHk_coF.js";import{_ as se,R as le}from"./RadioButton-CKy5Sstn.js";import{S as ne,a as ie}from"./index-BddIR2yb.js";import{_ as ce}from"./index-B11WLJj_.js";import{I as ue}from"./Input-C2qOGQ_1.js";import{_ as de,F as _e}from"./index-CbmBRnKK.js";const pe=r=>(oe("data-v-d643dddd"),r=r(),re(),r),me={class:"share-form-body"},fe={class:"share-url-box",style:{width:"100",overflow:"hidden"}},ye={key:0,target:"_blank",href:"/#/user/domain"},ve={key:0,class:"form-box-bottom"},he=pe(()=>p("span",null,"复制链接",-1)),be={__name:"share-form",props:{baseUrl:{type:String,default:"/open/doc"},hideCopy:{type:Boolean,default:!1},layout:{type:String,default:"horizontal"},labelCol:{type:Object,default:()=>{}},wrapperCol:{type:Object,default:()=>{}},libraryId:{type:[Number,String],default:""},libraryKey:{type:String,default:""}},emits:["success"],setup(r,{expose:I,emit:L}){const N=L,{operate_rights:m}=E(),R=r,{toClipboard:F}=A(),U=G(),D=B(()=>U.query.library_id),h=f(""),b=f(null),a=H({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""}),g=B(()=>R.baseUrl+"/"+h.value),O=async()=>{try{const e=await Y({id:D.value});Object.assign(a,e.data)}catch(e){c.error("获取数据失败"),console.error("获取知识库信息失败:",e)}},i=f([]),V=()=>{Z().then(e=>{i.value=e.data||[],a.share_url||(i.value.length>0?a.share_url=i.value[0].url:a.share_url=window.location.origin)})},k=async()=>{a.share_url||c.error("请选择自定义域名");let e=a.share_url+g.value;try{await F(e),c.success("复制成功")}catch{c.error("复制失败")}},w=async()=>{let e={...te(a)};delete e.library_key,e.avatar_file?(e.avatar=e.avatar_file,delete e.avatar_file):(delete e.avatar,delete e.avatar_file);try{let t=await Q(e);N("success",t)}catch{}};return I({init:async e=>{try{h.value=e.doc_key,await O(),V()}catch{}}}),(e,t)=>{const C=le,j=se,S=de,P=ie,W=ne,$=ue,z=ce,x=J,M=_e,T=K;return n(),u("div",{class:"share-form",ref_key:"formWrapRef",ref:b},[p("div",me,[s(M,{model:a,layout:r.layout,"label-col":r.labelCol,"wrapper-col":r.wrapperCol,autocomplete:"off"},{default:o(()=>[s(S,{label:"访问权限"},{default:o(()=>[s(j,{value:a.access_rights,"onUpdate:value":t[0]||(t[0]=l=>a.access_rights=l),onChange:w,disabled:v(m)==2},{default:o(()=>[s(C,{value:"0"},{default:o(()=>[_("私有，仅能与应用关联，作为应用知识库")]),_:1}),s(C,{value:"1"},{default:o(()=>[_("公开，发布到互联网，所有人可访问")]),_:1})]),_:1},8,["value","disabled"])]),_:1}),a.access_rights==1?(n(),y(S,{key:0,label:"分享链接"},{default:o(()=>[p("div",fe,[s(z,{compact:""},{default:o(()=>[s(W,{style:{width:"50%"},value:a.share_url,"onUpdate:value":t[1]||(t[1]=l=>a.share_url=l),placeholder:"请选择自定义域名",getPopupContainer:()=>b.value,onChange:w,disabled:v(m)==2},{default:o(()=>[(n(!0),u(X,null,ee(i.value,l=>(n(),y(P,{value:l.url,key:l.id},{default:o(()=>[_(ae(l.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","getPopupContainer","disabled"]),s($,{disabled:!0,value:g.value,style:{width:"50%"}},null,8,["value"])]),_:1}),r.hideCopy?d("",!0):(n(),y(x,{key:0,class:"copy-btn",onClick:t[2]||(t[2]=l=>k())},{default:o(()=>[_("复制")]),_:1}))]),p("div",null,[v(m)==4?(n(),u("a",ye,"添加自定义域名")):d("",!0)])]),_:1})):d("",!0)]),_:1},8,["model","layout","label-col","wrapper-col"])]),r.hideCopy?(n(),u("div",ve,[s(x,{type:"primary",ghost:"",onClick:t[3]||(t[3]=l=>k())},{default:o(()=>[s(T,{name:"link-left",style:{"font-size":"16px",color:"#2475fc","margin-right":"4px"}}),he]),_:1})])):d("",!0)],512)}}},Re=q(be,[["__scopeId","data-v-d643dddd"]]);export{Re as S};
