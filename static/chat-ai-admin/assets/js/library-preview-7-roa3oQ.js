import{k as e,M as o,N as h,W as n,S as a,u as D,a1 as he,a2 as ge,e as u,X as de,ai as Ue,Y as q,Z as z,F as G,$ as te,Q as F,a7 as j,a0 as Oe,G as Ne,a5 as qe,b as ie,B as Be,x as bt,z as je,a4 as kt,a6 as ln,a8 as sn}from"./vue-chunks-Dpmhapcm.js";import{V as pt}from"./vue-pdf-embed-DwuMPVEJ.js";import{a as rn,_ as St,T as $t}from"./empty-BtQ55gr9.js";import{A as xt,b as le,B as wt,k as K,M as oe,L as cn,E as fe,d as un,b2 as dn,S as _n,e as pn,f as fn}from"../../index-DJqZYlN8.js";import{P as Ct}from"./PlusOutlined-CTNlEK-E.js";import{t as Qe,u as vn,v as He,w as Ot,x as qt,o as mn,b as Lt,e as hn,f as gn,s as yn,y as bn,z as ft,A as kn,B as Sn}from"./index-CQKu1YIs.js";import"./index-9XFVXge0.js";import{I as Pt}from"./Input-k3gxptQd.js";import{_ as $n}from"./index-DyP1V5nr.js";import{_ as Et,a as It}from"./index-B3bBS2VZ.js";import{_ as Ve,M as Je}from"./index-BW4jDb4d.js";import"./index-CUiqpg-W.js";import{D as Ge}from"./dropdown-CmzzPYoT.js";import{S as Ft}from"./SettingOutlined-D7RaZTOB.js";import{S as Mt}from"./SyncOutlined-CFfWYm0i.js";import{M as Rt}from"./MoreOutlined-xKX0PWgi.js";import{_ as Le}from"./index-BY-bgrX3.js";import{C as $e}from"./cu-scroll-DUDOFjFZ.js";import{U as xn,S as wn,a as Cn,D as On,E as qn}from"./edit-fragment-alert-BEytwYtp.js";import{_ as Ln}from"./TextArea-DEZsPG5C.js";import{_ as Pn,F as En}from"./index-BearFCS_.js";import{S as Dt,_ as Tt}from"./index-DT9vq-9c.js";import{R as In}from"./rename-modal-DUchpV8j.js";import{S as Pe}from"./index-2EWY1GCt.js";import{C as Fn}from"./ClockCircleFilled-CFbZYi83.js";import{B as Mn,_ as Rn}from"./index-D_fZWlYm.js";import{_ as Dn}from"./index-BATayIOZ.js";import{_ as Tn,a as An}from"./RadioButton-BdTnsnL8.js";import{L as zn}from"./LeftOutlined-BBd11KLM.js";import{D as vt}from"./DownOutlined-D5t3juQ7.js";import"./Dropdown-DicWDWIK.js";import"./Trigger-DcF6kXOl.js";import"./index-Bn-6W96d.js";import"./useRefs-CxyIWkWE.js";import"./pick-BQKw5Ek5.js";import"./CheckOutlined-D8sWUycq.js";import"./slide-B4S8cqER.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./dayjs-BAOQ3IvD.js";import"./index-DzhuYAPB.js";import"./FormItemContext-DcHP2mNJ.js";import"./index-DGofXs4a.js";import"./Search-CxIvru6q.js";import"./SearchOutlined-C4P1S4P5.js";import"./isPlainObject--mHlhHEN.js";import"./inputProps-B4Qz7YgH.js";import"./Password-DASsPHld.js";import"./statusUtils-Bnl8Rf7N.js";import"./index-NxOBHTpX.js";import"./useMaxLevel-ChHJkfrX.js";import"./collapseMotion-DmHD1G9F.js";import"./index-DaFSI5Qu.js";import"./responsiveObserve-D_TTA_LO.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./RightOutlined-CJJrtf85.js";import"./index-D7LiUNoj.js";import"./Checkbox-DQSCt5wV.js";import"./index-Dk60SqR7.js";import"./CaretDownOutlined-8hpeo-8F.js";import"./shallowequal-KOHJRfiy.js";import"./move-B1-eDBNJ.js";import"./colors-CZV0Zir8.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./model-select-BawuzGA8.js";import"./index-Cd8_BaNA.js";import"./index-Bpgeg3Jc.js";import"./QuestionCircleOutlined-D2lOE5qu.js";import"./index-Ci9XZtrG.js";import"./UpOutlined-BLzSJSuk.js";import"./index-DfSExCBV.js";import"./index-DXiWv6EO.js";import"./index-O15OSOpm.js";import"./partition-DekNjavo.js";var jn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};const Un=jn;function mt(t){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},s=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable}))),s.forEach(function(_){Nn(t,_,i[_])})}return t}function Nn(t,d,i){return d in t?Object.defineProperty(t,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[d]=i,t}var Ke=function(d,i){var s=mt({},d,i.attrs);return e(xt,mt({},s,{icon:Un}),null)};Ke.displayName="StarFilled";Ke.inheritAttrs=!1;const ve=Ke;var Bn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};const Qn=Bn;function ht(t){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},s=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable}))),s.forEach(function(_){Hn(t,_,i[_])})}return t}function Hn(t,d,i){return d in t?Object.defineProperty(t,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[d]=i,t}var We=function(d,i){var s=ht({},d,i.attrs);return e(xt,ht({},s,{icon:Qn}),null)};We.displayName="StarOutlined";We.inheritAttrs=!1;const Ze=We,Xe=t=>(he("data-v-16e77398"),t=t(),ge(),t),Vn={class:"empty-box"},Jn=Xe(()=>n("img",{src:rn,alt:""},null,-1)),Gn=Xe(()=>n("div",{class:"title"},"知识库文档为空，请添加分段",-1)),Kn=Xe(()=>n("span",null,"添加分段",-1)),Wn={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(t,{emit:d}){const i=d,s=()=>{i("openEditSubscription",{})};return(_,C)=>{const g=wt;return o(),h("div",Vn,[Jn,Gn,n("div",null,[e(g,{type:"primary",onClick:s},{icon:a(()=>[e(D(Ct))]),default:a(()=>[Kn]),_:1})])])}}},ze=le(Wn,[["__scopeId","data-v-16e77398"]]),me={a:"#F4EA2A",b:"#03B615",c:"#2475FC",d:"#F00000",e:"#F59A23"},Zn={class:"modal-box"},Xn={class:"list-box"},Yn={__name:"classification-mark-modal",emits:["ok"],setup(t,{expose:d,emit:i}){const s=u(!1),_=i,C=u([]),g=()=>{E(),s.value=!0},E=()=>{Qe().then(O=>{C.value=O.data})},w=()=>{let O=C.value.map(r=>({id:+r.id,name:r.name}));vn({data:JSON.stringify(O)}).then(r=>{K.success("保存成功"),_("ok"),s.value=!1})};return d({show:g}),(O,r)=>{const L=$n,M=Et,N=Pt,$=It,m=oe;return o(),h("div",null,[e(m,{open:s.value,"onUpdate:open":r[0]||(r[0]=y=>s.value=y),title:"设置分类标记",onOk:w,width:586},{default:a(()=>[n("div",Zn,[e(L,{"show-icon":"",message:"添加了分类标记的分段，重新分段时将会会被保留。"}),n("div",Xn,[e($,{"data-source":C.value,pagination:!1},{default:a(()=>[e(M,{key:"tags",title:"分类标记","data-index":"tags",width:200},{default:a(({record:y})=>[e(D(ve),{class:"start-icon",style:de({color:D(me)[y.type]})},null,8,["style"])]),_:1}),e(M,{key:"name",title:"分类名称","data-index":"name",width:200},{default:a(({record:y})=>[e(N,{value:y.name,"onUpdate:value":c=>y.name=c,maxLength:4,placeholder:"请设置,最多4个字"},null,8,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source"])])])]),_:1},8,["open"])])}}},At=le(Yn,[["__scopeId","data-v-8f17e550"]]),ea=t=>(he("data-v-792ab208"),t=t(),ge(),t),ta={class:"subsection-box"},na={class:"subsection-box-title"},aa=["onClick"],oa={class:"top-block"},la={class:"title"},sa={class:"title-block"},ia={class:"cfb363f"},ra={key:0},ca={class:"cfb363f"},ua={class:"right-opration"},da={class:"hover-btn-box"},_a=["onClick"],pa=ea(()=>n("div",null,"标记设置",-1)),fa={class:"hover-btn-box"},va={class:"hover-btn-box"},ma=["onClick"],ha=["onClick"],ga={key:0,class:"content-box"},ya={key:1,class:"content-box"},ba=["innerHTML"],ka={class:"fragment-img"},Sa=["src"],$a={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(t,{expose:d,emit:i}){const s=i,_=t,C=(m,y)=>{let{id:c,title:v,content:b,question:S,answer:T,images:x}=m,H=m.similar_questions||[];oe.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${y+1}】吗?`,onOk(){return new Promise((f,R)=>{He({id:c,title:v,content:b,question:S,answer:T,images:x,similar_questions:JSON.stringify(H)}).then(P=>{s("handleConvert",m),f()}).catch(()=>{f()})})},onCancel(){}})},g=m=>{s("openEditSubscription",m)},E=m=>{oe.confirm({title:"提示",icon:e(fe),content:"确认是否删除该分段?",onOk(){return new Promise((y,c)=>{Ot({id:m}).then(v=>{K.success("删除成功"),s("handleDelParagraph",m),y()}).catch(()=>{y()})})},onCancel(){}})},w=(m,y)=>{s("handleScrollTargetPage",{page_num:m.page_num,index:y})},O=u([]),r=()=>{Qe().then(m=>{O.value=m.data||[],s("getStatrList",m.data||[])})};r();const L=u(null),M=()=>{L.value.show()},N=m=>{var c;let y=(c=O.value.filter(v=>v.id==m.category_id)[0])==null?void 0:c.type;return y?me[y]:"#F4EA2A"},$=(m,y={})=>{qt({id:m.id,category_id:y.id||0}).then(c=>{K.success("设置成功"),m.category_id=y.id})};return d({handleOpenEditModal:g}),(m,y)=>{const c=Le,v=Ve,b=Je,S=Ge,T=Ue("viewer");return o(),h("div",ta,[n("div",na,[q(" 分段预览 "),n("span",null,"共"+z(_.total)+"个分段",1)]),(o(!0),h(G,null,te(_.paragraphLists,(x,H)=>(o(),h("div",{class:"list-item",key:x.id,onClick:f=>w(x,H)},[n("div",oa,[n("div",la,[q(" 分段"+z(H+1)+" ",1),n("div",sa,z(x.title),1),n("span",null,"共"+z(x.word_total)+"个字符",1),n("span",null,[q(" 嵌入状态："+z(x.status_text),1),x.status==3?(o(),F(D(cn),{key:0})):j("",!0),x.status==2&&x.errmsg?(o(),F(c,{key:1,title:x.errmsg},{default:a(()=>[n("strong",ia,[q("原因"),e(D(fe),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):j("",!0)]),t.detailsInfo.graph_switch?(o(),h("span",ra,[q(" 知识图谱状态："+z(x.graph_status_text)+" ",1),x.graph_status==3&&x.graph_err_msg?(o(),F(c,{key:0,title:x.graph_err_msg},{default:a(()=>[n("strong",ca,[q("原因"),e(D(fe),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):j("",!0)])):j("",!0)]),n("div",ua,[e(S,null,{overlay:a(()=>[e(b,null,{default:a(()=>[(o(!0),h(G,null,te(O.value,f=>(o(),F(v,{key:f.id},{default:a(()=>[n("div",{class:"start-item",onClick:R=>$(x,f)},[e(D(ve),{style:de({color:D(me)[f.type]})},null,8,["style"]),n("div",null,z(f.name||"-"),1)],8,_a)]),_:2},1024))),128)),e(v,null,{default:a(()=>[n("div",{class:"start-item",onClick:M},[e(D(Ft)),pa])]),_:1})]),_:2},1024)]),default:a(()=>[n("div",da,[x.category_id>0?(o(),F(D(ve),{key:0,onClick:f=>$(x,{}),style:de({color:N(x),"font-size":"16px"})},null,8,["onClick","style"])):(o(),F(D(Ze),{key:1,onClick:f=>$(x,O.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),e(c,null,{title:a(()=>[q("重新转换")]),default:a(()=>[n("div",fa,[e(D(Mt),{onClick:f=>C(x,H)},null,8,["onClick"])])]),_:2},1024),e(S,{placement:"bottomRight"},{overlay:a(()=>[e(b,null,{default:a(()=>[e(v,null,{default:a(()=>[n("div",{onClick:Oe(f=>g(x),["stop"])},"编辑",8,ma)]),_:2},1024),e(v,null,{default:a(()=>[n("div",{onClick:Oe(f=>E(x.id),["stop"])},"删除",8,ha)]),_:2},1024)]),_:2},1024)]),default:a(()=>[n("div",va,[e(D(Rt))])]),_:2},1024)])]),x.question?(o(),h("div",ga,"Q："+z(x.question),1)):j("",!0),x.answer?(o(),h("div",ya,"A："+z(x.answer),1)):j("",!0),n("div",{class:"content-box",innerHTML:x.content},null,8,ba),Ne((o(),h("div",ka,[(o(!0),h(G,null,te(x.images,(f,R)=>(o(),h("img",{key:R,src:f,alt:""},null,8,Sa))),128))])),[[T]])],8,aa))),128)),e(At,{onOk:r,ref_key:"classificationMarkModalRef",ref:L},null,512)])}}},gt=le($a,[["__scopeId","data-v-792ab208"]]);var U={},Ye;Object.defineProperty(U,"__esModule",{value:!0});U.controlDefaultValue=U.capitalize=U.camelize=U.cacheStringFunction=void 0;U.getDataAndAriaProps=Fa;U.isSymbol=U.isString=U.isOn=U.isObject=U.isFunction=Ye=U.isArray=U.hyphenate=void 0;U.renderHelper=Ra;U.resolvePropValue=Ia;U.toPx=Ma;U.wrapPromiseFn=Da;const zt=t=>typeof t=="function";U.isFunction=zt;U.controlDefaultValue=Symbol("controlDefaultValue");Ye=U.isArray=Array.isArray;const xa=t=>typeof t=="string";U.isString=xa;const wa=t=>typeof t=="symbol";U.isSymbol=wa;const Ca=t=>t!==null&&typeof t=="object";U.isObject=Ca;const Oa=/^on[^a-z]/,qa=t=>Oa.test(t);U.isOn=qa;const Ee=t=>{const d=Object.create(null);return i=>d[i]||(d[i]=t(i))};U.cacheStringFunction=Ee;const La=/-(\w)/g;U.camelize=Ee(t=>t.replace(La,(d,i)=>i?i.toUpperCase():""));const Pa=/\B([A-Z])/g;U.hyphenate=Ee(t=>t.replace(Pa,"-$1").toLowerCase());U.capitalize=Ee(t=>t.charAt(0).toUpperCase()+t.slice(1));const Ea=Object.prototype.hasOwnProperty,yt=(t,d)=>Ea.call(t,d);function Ia(t,d,i,s){const _=t[i];if(_!=null){const C=yt(_,"default");if(C&&s===void 0){const g=_.default;s=_.type!==Function&&zt(g)?g():g}_.type===Boolean&&(!yt(d,i)&&!C?s=!1:s===""&&(s=!0))}return s}function Fa(t){return Object.keys(t).reduce((d,i)=>((i.startsWith("data-")||i.startsWith("aria-"))&&(d[i]=t[i]),d),{})}function Ma(t){return typeof t=="number"?`${t}px`:t}function Ra(t){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return typeof t=="function"?t(d):t??i}function Da(t){let d;const i=new Promise(_=>{d=t(()=>{_(!0)})}),s=()=>{d==null||d()};return s.then=(_,C)=>i.then(_,C),s.promise=i,s}const ye=t=>(he("data-v-bad1c1b1"),t=t(),ge(),t),Ta={class:"form-box-wrapper"},Aa={class:"form-item"},za=ye(()=>n("div",{class:"form-label"},"分段标题：",-1)),ja={class:"form-content"},Ua={class:"form-item"},Na=ye(()=>n("div",{class:"form-label required"},"分段问题：",-1)),Ba={class:"form-content"},Qa={class:"form-item"},Ha=ye(()=>n("div",{class:"form-label"},"相似问法（一行一个，最多可添加100个相似问法）",-1)),Va={class:"form-content"},Ja={class:"form-item"},Ga=ye(()=>n("div",{class:"form-label required"},"分段答案：",-1)),Ka={class:"form-content"},Wa={key:0,class:"error-tip"},Za={key:1,class:"form-item"},Xa=ye(()=>n("div",{class:"form-label required"},"分段内容：",-1)),Ya={class:"form-content"},eo={key:0,class:"error-tip"},to={class:"form-item"},no=ye(()=>n("div",{class:"form-label"},"附件",-1)),ao={class:"form-content"},oo={class:"upload-box-wrapper"},lo={key:0},so={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(t,{expose:d,emit:i}){const s=qe(),_=t,C=i,g=u("1"),E=u(!1),w=u(""),O=u(""),r=u(""),L=u(""),M=u(""),N=u([]),$=u(""),m=u(!1),y=v=>{w.value=v.title||"",O.value=v.content||"",$.value=v.id||"",r.value=v.answer||"",N.value=v.images||[],L.value=v.question||"",M.value=v.similar_questions?v.similar_questions.join(`
`):"",m.value=_.detailsInfo.is_qa_doc=="1",E.value=!0},c=()=>{if(!O.value&&!m.value)return K.error("请输入分段内容");if(!L.value&&m.value)return K.error("请输入分段问题");if(!r.value&&m.value)return K.error("请输入分段答案");if(m.value&&r.value.length>1e4||!m.value&&O.value.length>1e4)return;let v={title:w.value,content:O.value,question:L.value,answer:r.value,images:N.value},b=M.value.trim();b?(b=b.split(`
`),v.similar_questions=JSON.stringify(b)):v.similar_questions="[]",$.value?v.id=$.value:v.file_id=s.query.id;let S=new FormData;for(let T in v)Ye(v[T])?v[T].forEach(x=>{S.append(T,x)}):S.append(T,v[T]);He(S).then(T=>{K.success(v.id?"修改成功":"添加成功"),E.value=!1,C("handleEdit",{...v})})};return d({showModal:y}),(v,b)=>{const S=Pt,T=Ln,x=un,H=St,f=$t,R=oe;return o(),h("div",null,[e(R,{open:E.value,"onUpdate:open":b[7]||(b[7]=P=>E.value=P),title:"编辑分段",onOk:c,width:"746px"},{default:a(()=>[n("div",Ta,[n("div",Aa,[za,n("div",ja,[e(S,{maxLength:25,value:w.value,"onUpdate:value":b[0]||(b[0]=P=>w.value=P),placeholder:"请输入分段标题"},null,8,["value"])])]),m.value?(o(),h(G,{key:0},[n("div",Ua,[Na,n("div",Ba,[e(T,{placeholder:"请输入分段问题",value:L.value,"onUpdate:value":b[1]||(b[1]=P=>L.value=P),style:{height:"100px"}},null,8,["value"])])]),n("div",Qa,[Ha,n("div",Va,[e(T,{placeholder:"请输入相似问法",value:M.value,"onUpdate:value":b[2]||(b[2]=P=>M.value=P),style:{height:"100px"}},null,8,["value"])])]),n("div",Ja,[Ga,n("div",Ka,[e(T,{placeholder:"请输入分段答案",value:r.value,"onUpdate:value":b[3]||(b[3]=P=>r.value=P),style:{height:"100px"}},null,8,["value"]),r.value.length>1e4?(o(),h("div",Wa,"分段答案最多支持10000个字符")):j("",!0)])])],64)):(o(),h("div",Za,[Xa,n("div",Ya,[e(T,{style:{height:"150px"},value:O.value,"onUpdate:value":b[4]||(b[4]=P=>O.value=P),placeholder:"请输入分段内容"},null,8,["value"]),O.value.length>1e4?(o(),h("div",eo,"分段内容最多支持10000个字符")):j("",!0)])])),n("div",to,[no,n("div",ao,[n("div",oo,[e(f,{activeKey:g.value,"onUpdate:activeKey":b[5]||(b[5]=P=>g.value=P),size:"small"},{default:a(()=>[e(H,{key:"1"},{tab:a(()=>[n("span",null,[e(x,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),q(" 图片 "),N.value.length?(o(),h("span",lo,"("+z(N.value.length)+")",1)):j("",!0)])]),_:1})]),_:1},8,["activeKey"]),e(xn,{value:N.value,"onUpdate:value":b[6]||(b[6]=P=>N.value=P)},null,8,["value"])])])])])]),_:1},8,["open"])])}}},io=le(so,[["__scopeId","data-v-bad1c1b1"]]),ro={class:"mode-box"},co=["innerHTML"],uo={class:"tag-item"},_o={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(t){const d=t,i=u(""),s=ie(()=>{const{is_table_file:_,is_qa_doc:C,is_diy_split:g,question_lable:E,answer_lable:w,separators:O,chunk_size:r,chunk_overlap:L,question_column:M,answer_column:N,qa_index_type:$,doc_type:m}=d.detailsInfo;if(_!=1&&C!=1&&g!=1)return m==3?(i.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(i.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(_!=1&&C==1)return m==3?(i.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(i.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${E}"
答案开始标识符："${w}"`,"智能分段：QA文档");if(_!=1&&C!=1&&g==1)return i.value=`分段模式：自定义分段
文档标识符：${O}
分段最大长度：${r}字符
文段重叠长度：${L}字符`,"自定义分段";if(_==1&&C!=1)return i.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(_==1&&C==1){let y=$==1?"问题与答案一起生成索引":"仅对问题生成索引";return i.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${M}"
答案所在列："${N}"
索引方式：${y}`,"智能分段：QA文档"}});return(_,C)=>{const g=Le;return o(),h("div",ro,[e(g,null,{title:a(()=>[n("div",{class:"tooltip-text-box",innerHTML:i.value},null,8,co)]),default:a(()=>[n("div",uo,z(s.value),1)]),_:1})])}}},po=le(_o,[["__scopeId","data-v-6ee0b31f"]]),fo={__name:"update-frequency",emits:["ok"],setup(t,{expose:d,emit:i}){const s=i,_=u(!1),C=u(!1),g=Be({doc_auto_renew_frequency:1,id:""}),E=O=>{let{doc_auto_renew_frequency:r,id:L}=O;g.doc_auto_renew_frequency=+r,g.id=L,_.value=!0},w=()=>{C.value=!0,mn({...g}).then(O=>{s("ok",g.doc_auto_renew_frequency),_.value=!1,K.success("设置成功")}).finally(()=>{C.value=!1})};return d({open:E}),(O,r)=>{const L=Dt,M=Tt,N=Pn,$=En,m=oe;return o(),h("div",null,[e(m,{open:_.value,"onUpdate:open":r[1]||(r[1]=y=>_.value=y),"confirm-loading":C.value,maskClosable:!1,title:"设置更新频率",onOk:w},{default:a(()=>[e($,{style:{margin:"32px 0"},layout:"vertical",model:g},{default:a(()=>[e(N,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:a(()=>[e(M,{value:g.doc_auto_renew_frequency,"onUpdate:value":r[0]||(r[0]=y=>g.doc_auto_renew_frequency=y),style:{width:"100%"}},{default:a(()=>[e(L,{value:1},{default:a(()=>[q("不自动更新")]),_:1}),e(L,{value:2},{default:a(()=>[q("每天")]),_:1}),e(L,{value:3},{default:a(()=>[q("每3天")]),_:1}),e(L,{value:4},{default:a(()=>[q("每7天")]),_:1}),e(L,{value:5},{default:a(()=>[q("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},vo={class:"loading"},mo={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(t,{expose:d,emit:i}){const s=t,_=i,C=u(null),g=u([]),E=u(0),w=u(!1),O=ie(()=>w.value?null:{"border-bottom":"2px solid #d9d9d9"}),r=u({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});bt(async()=>{const c=await pt.getDocument(s.source).promise;E.value=c.numPages,_("getTotalPage",E.value),L()});const L=(c=null)=>{const v=g.value.length;if(v>=E.value||w.value)return;w.value=!0;const b=[];for(let S=1;S<=s.pageSize&&v+S<=E.value;S++)b.push(v+S);g.value.push(...b),je(()=>{typeof c=="function"&&c()})},M=c=>{L(),_("onScrollEnd",c)},N=c=>{je(()=>{c===g.value[g.value.length-1]&&(w.value=!1,_("rendered",c,E.value))})},$=c=>{_("select",c)},m=()=>C.value,y=c=>{_("scroll",c)};return d({loadMore:L,getScrollInstance:m}),(c,v)=>{const b=Pe;return o(),F($e,{scrollbar:r.value,ref_key:"scrollRef",ref:C,onScroll:y,onOnScrollEnd:M},{default:a(()=>[(o(!0),h(G,null,te(g.value,S=>(o(),F(D(pt),{onClick:T=>$(S),key:S,source:t.source,page:S,onRendered:()=>N(S),style:de(O.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),n("div",vo,[w.value?(o(),F(b,{key:0})):j("",!0)])]),_:1},8,["scrollbar"])}}},ho=le(mo,[["__scopeId","data-v-8ffdbe19"]]),go=t=>(he("data-v-1b557b54"),t=t(),ge(),t),yo={key:0,class:"loading-wrap"},bo={class:"document-segmentation"},ko={class:"page-container"},So={class:"page-left"},$o={class:"page-right"},xo={class:"document-fragment-preview"},wo={class:"preview-header"},Co=go(()=>n("span",{class:"label-text"},"分段预览",-1)),Oo={class:"fragment-number"},qo={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}}},emits:["ok","finish","loading"],setup(t,{expose:d,emit:i}){const s=qe(),_=i,{id:C}=s.query,g=u(!0),E=u(1);let w=!1;const O=t;let r={id:C,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0};const L=u(null),M=l=>{typeof l.separators_no=="object"&&(l.separators_no=l.separators_no.join(",")),r={...r,...l},w?oe.confirm({title:"提醒",icon:e(fe),content:"文档片段已被编辑重新获取文档片段会丢失当前修改过的文档片段内容，确定要重新获取吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){w=!1,H()},onCancel(){}}):(w=!1,H())};let N=60*10,$=0;const m=u({}),y=u(0),c=()=>{g.value||(g.value=!0),Lt({id:C}).then(async l=>{const{status:Q}=l.data;if(y.value=l.data.library_type,m.value=l.data,r={...r,separators_no:l.data.separators_no||"11,12",chunk_size:+l.data.chunk_size||512,chunk_overlap:+l.data.chunk_overlap||50,is_qa_doc:y.value==2?1:0,question_lable:l.data.question_lable,answer_lable:l.data.answer_lable,question_column:l.data.question_column,answer_column:l.data.answer_column,enable_extract_image:l.data.enable_extract_image=="true",qa_index_type:+l.data.qa_index_type,chunk_type:+l.data.chunk_type,semantic_chunk_size:+l.data.semantic_chunk_size||512,semantic_chunk_overlap:+l.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+l.data.semantic_chunk_threshold||90,semantic_chunk_use_model:l.data.semantic_chunk_use_model||"",semantic_chunk_model_config_id:l.data.semantic_chunk_model_config_id>0?l.data.semantic_chunk_model_config_id:""},l.data.chunk_type==0&&(r={...r,separators_no:l.data.normal_chunk_default_separators_no,chunk_size:l.data.normal_chunk_default_chunk_size,chunk_overlap:l.data.normal_chunk_default_chunk_overlap,chunk_type:+l.data.default_chunk_type,semantic_chunk_size:+l.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+l.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+l.data.semantic_chunk_default_threshold,semantic_chunk_use_model:l.data.default_use_model||"",semantic_chunk_model_config_id:l.data.default_model_config_id>0?l.data.default_model_config_id:""}),Q==0){if($++,$>N){oe.error({title:"提醒",content:"文档解析速度慢请稍后再试"});return}setTimeout(()=>{c()},1e3)}else(Q==4||Q==2)&&(g.value=!1,E.value=parseInt(l.data.is_table_file),l.data.library_id,y.value==2?(r.question_lable||r.question_column)&&H():L.value&&L.value.reChange());l.data.is_table_file==1&&b()})};c();const v=u([]),b=()=>{hn({id:C}).then(l=>{let Q=[];for(let V in l.data)Q.push({lable:l.data[V],value:V});v.value=Q})},S=u([]),T=u(0),x=ie(()=>T.value<=0),H=()=>(_("loading",!0),gn({...r,semantic_chunk_model_config_id:r.semantic_chunk_model_config_id?+r.semantic_chunk_model_config_id:0,...O.pdfState}).then(l=>{S.value=l.data.list||[],T.value=l.data.list.length||0}).finally(()=>{L.value.reLoading=!1,_("loading",!1)})),f=u(null);let R=null;const P=({title:l,content:Q,question:V,answer:J,images:se},Se)=>{R=Se,f.value.open({title:l,content:Q,question:V,answer:J,images:se})},Y=({title:l,content:Q,question:V,answer:J,images:se})=>{(S.value[R].title!=l||S.value[R].content!=Q||S.value[R].question!=V||S.value[R].answer!=J)&&(w=!0),S.value[R].title=l,S.value[R].content=Q,S.value[R].question=V,S.value[R].answer=J,S.value[R].images=se,S.value[R].word_total=J.length+V.length+Q.length},re=l=>{oe.confirm({title:"提醒",icon:e(fe),content:"确定要删除这个片段吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){w=!0,S.value.splice(l,1)},onCancel(){}})},be=u(""),B=l=>{be.value=l},ne=u(!1),ke=()=>{let l=L.value.formState;l=JSON.parse(JSON.stringify(l)),typeof l.separators_no=="object"&&(l.separators_no=l.separators_no.join(",")),r={...r,...l}},_e=async()=>{if(ke(),be.value)return K.error(be.value);let l={...r,semantic_chunk_model_config_id:r.semantic_chunk_model_config_id?+r.semantic_chunk_model_config_id:0,is_table_file:E.value,...O.pdfState};delete l.id;let Q={id:C,word_total:T.value,split_params:JSON.stringify(l),list:JSON.stringify(S.value),...O.pdfState};l.is_qa_doc==1&&(Q.qa_index_type=l.qa_index_type),ne.value=!0,yn(Q).then(()=>{_("ok"),_("finish")}).finally(()=>{ne.value=!1}).catch(V=>{V.data&&V.data.index&&Me(V.data.index),_("finish")})},ce=u(null),Me=l=>{l=l-1;let Q=ce.value.querySelectorAll(".fragment-item");Q.length>=l&&Q[l].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return d({handleSaveLibFileSplit:_e}),(l,Q)=>{const V=Pe;return o(),h(G,null,[g.value?(o(),h("div",yo,[e(V)])):j("",!0),n("div",bo,[n("div",ko,[n("div",So,[e(wn,{excellQaLists:v.value,libFileInfo:m.value,library_type:y.value,mode:E.value,hideSave:!0,ref_key:"segmentationSettingRef",ref:L,onChange:M,onSave:_e,onValidate:B},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),n("div",$o,[n("div",xo,[n("div",wo,[Co,n("span",Oo,"共"+z(T.value)+"个分段",1)]),x.value?(o(),F(Cn,{key:0})):j("",!0),n("div",{class:"preview-box",ref_key:"previewBoxRef",ref:ce},[(o(!0),h(G,null,te(S.value,(J,se)=>(o(),h("div",{class:"fragment-item",key:J.number},[e(On,{number:J.number,title:J.title,content:J.content,total:J.word_total,question:J.question,answer:J.answer,images:J.images,onDelete:Se=>re(se),onEdit:Se=>P(J,se)},null,8,["number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),e(qn,{ref_key:"editFragmentAlertRef",ref:f,onOk:Y},null,512)])],64)}}},Lo=le(qo,[["__scopeId","data-v-1b557b54"]]),Po={class:"select-box"},Eo=["onClick"],Io={class:"title"},Fo={class:"desc"},Mo={class:"main-content-box"},Ro={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(t,{expose:d,emit:i}){const s=qe().query,_=kt(),C=t,g=u(!1),E=u(!1),w=u(""),O=i;let r={};const L=[{title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。",pdf_parse_type:2},{title:"纯文本解析",desc:"只提取Pdf中的文字内容，如果文档为扫描件可能提取不到内容。",pdf_parse_type:1}],M=Be({pdf_parse_type:2,pdf_page_num:0}),N=()=>{O("enable")},$=u(!1),m=f=>{$.value=f},y=f=>{r={...f},M.pdf_parse_type=2,M.pdf_page_num=f.pdf_page_num,f.type==1&&(w.value=`当页(${f.pdf_page_num})重新分段`),f.type==2&&(w.value="将文档重新分段"),f.type==3&&(w.value="重新学习文档"),g.value=!0},c=f=>{M.pdf_parse_type=f.pdf_parse_type},v=u(!1),b=()=>{if(r.type==3){if(M.pdf_parse_type==1){_.push("/library/document-segmentation?document_id="+s.id+"&source=preview");return}v.value=!0,bn({id:s.id,pdf_parse_type:M.pdf_parse_type}).then(f=>{K.success("重新学习成功"),M.pdf_parse_type==2&&_.push({path:"/library/details/knowledge-document",query:{id:C.detailsInfo.library_id}}),M.pdf_parse_type==1&&_.push("/library/document-segmentation?document_id="+s.id+"&source=preview"),g.value=!1}).finally(()=>{v.value=!1});return}g.value=!1,E.value=!0},S=u(null),T=()=>{v.value=!0,S.value.handleSaveLibFileSplit()},x=()=>{K.success("保存成功"),E.value=!1,O("ok",r.type)},H=()=>{v.value=!1};return d({show:y}),(f,R)=>{const P=oe;return o(),h("div",null,[e(P,{open:g.value,"onUpdate:open":R[0]||(R[0]=Y=>g.value=Y),title:w.value,onOk:b,onCancel:N,width:720,confirmLoading:v.value},{default:a(()=>[n("div",Po,[(o(),h(G,null,te(L,Y=>n("div",{class:ln(["select-list-item",{active:Y.pdf_parse_type==M.pdf_parse_type}]),onClick:re=>c(Y),key:Y.pdf_parse_type},[n("div",Io,z(Y.title),1),n("div",Fo,z(Y.desc),1)],10,Eo)),64))])]),_:1},8,["open","title","confirmLoading"]),e(P,{open:E.value,"onUpdate:open":R[1]||(R[1]=Y=>E.value=Y),onCancel:N,title:w.value,maskClosable:!1,"ok-text":$.value?"文档解析中,请稍候...":"确定",confirmLoading:v.value||$.value,onOk:T,width:1e3},{default:a(()=>[n("div",Mo,[E.value?(o(),F(Lo,{key:0,onOk:x,onFinish:H,onLoading:m,pdfState:M,ref_key:"documentSegmentationModalRef",ref:S},null,8,["pdfState"])):j("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},Do=le(Ro,[["__scopeId","data-v-40dbad21"]]),Ie=t=>(he("data-v-383e05bc"),t=t(),ge(),t),To={class:"subsection-box"},Ao={class:"qa-list-box"},zo={class:"list-item"},jo=Ie(()=>n("div",{class:"list-label"},"问题",-1)),Uo={class:"list-content"},No={key:0,class:"list-item"},Bo=Ie(()=>n("div",{class:"list-label"},"相似问法",-1)),Qo={class:"list-content"},Ho={class:"list-item"},Vo=Ie(()=>n("div",{class:"list-label"},"答案",-1)),Jo={class:"list-content"},Go={class:"fragment-img"},Ko=["src"],Wo={key:0,class:"status-tag"},Zo={key:1,class:"status-tag complete"},Xo={class:"status-tag status-error"},Yo={key:3,class:"status-tag running"},el={class:"right-opration"},tl={class:"hover-btn-box"},nl=["onClick"],al=Ie(()=>n("div",null,"标记设置",-1)),ol=["onClick"],ll={class:"hover-btn-box"},sl=["onClick"],il=["onClick"],rl={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(t,{expose:d,emit:i}){const s=i,_=t,C=($,m)=>{let{id:y,title:c,content:v,question:b,answer:S,images:T}=$,x=$.similar_questions||[];oe.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${m+1}】吗?`,onOk(){return new Promise((H,f)=>{He({id:y,title:c,content:v,question:b,answer:S,images:T,similar_questions:JSON.stringify(x)}).then(R=>{s("handleConvert",$),H()}).catch(()=>{H()})})},onCancel(){}})},g=$=>{s("openEditSubscription",$)},E=$=>{oe.confirm({title:"提示",icon:e(fe),content:"确认是否删除该分段?",onOk(){return new Promise((m,y)=>{Ot({id:$}).then(c=>{K.success("删除成功"),s("handleDelParagraph",$),m()}).catch(()=>{m()})})},onCancel(){}})},w=u([]),O=()=>{Qe().then($=>{w.value=$.data||[],s("getStatrList",$.data||[])})};O();const r=u(null),L=()=>{r.value.show()},M=$=>{var y;let m=(y=w.value.filter(c=>c.id==$.category_id)[0])==null?void 0:y.type;return m?me[m]:"#F4EA2A"},N=($,m={})=>{qt({id:$.id,category_id:m.id||0}).then(y=>{K.success("设置成功"),$.category_id=m.id})};return d({handleOpenEditModal:g}),($,m)=>{const y=Et,c=Le,v=Pe,b=Ve,S=Je,T=Ge,x=It,H=Ue("viewer");return o(),h("div",To,[e(x,{"data-source":t.paragraphLists,pagination:!1},{default:a(()=>[e(y,{key:"id","data-index":"id",width:1148},{title:a(()=>[q("问答（共"+z(_.total)+"个）",1)]),default:a(({record:f})=>[n("div",Ao,[n("div",zo,[jo,n("div",Uo,z(f.question),1)]),f.similar_questions&&f.similar_questions.length?(o(),h("div",No,[Bo,n("div",Qo,z(f.similar_questions.join("/")),1)])):j("",!0),n("div",Ho,[Vo,n("div",Jo,z(f.answer),1)]),Ne((o(),h("div",Go,[(o(!0),h(G,null,te(f.images,(R,P)=>(o(),h("img",{key:P,src:R,alt:""},null,8,Ko))),128))])),[[H]])])]),_:1}),e(y,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:a(({record:f})=>[f.status==0?(o(),h("span",Wo,[e(D(Fn)),q(" 未转换")])):j("",!0),f.status==1?(o(),h("span",Zo,[e(D(dn)),q(" 已转换")])):j("",!0),f.status==2?(o(),F(c,{key:2,placement:"top"},{title:a(()=>[n("span",null,z(f.errmsg),1)]),default:a(()=>[n("span",null,[n("span",Xo,[e(D(_n)),q(" 转换异常")])])]),_:2},1024)):j("",!0),f.status==3?(o(),h("span",Yo,[e(v,{size:"small"}),q(" 转换中")])):j("",!0)]),_:1}),e(y,{title:"操作",key:"action","data-index":"action",width:120},{default:a(({record:f,index:R})=>[n("div",el,[e(T,null,{overlay:a(()=>[e(S,null,{default:a(()=>[(o(!0),h(G,null,te(w.value,P=>(o(),F(b,{key:P.id},{default:a(()=>[n("div",{class:"start-item",onClick:Y=>N(f,P)},[e(D(ve),{style:de({color:D(me)[P.type]})},null,8,["style"]),n("div",null,z(P.name||"-"),1)],8,nl)]),_:2},1024))),128)),e(b,null,{default:a(()=>[n("div",{class:"start-item",onClick:L},[e(D(Ft)),al])]),_:1})]),_:2},1024)]),default:a(()=>[n("div",tl,[f.category_id>0?(o(),F(D(ve),{key:0,onClick:P=>N(f,{}),style:de({color:M(f),"font-size":"16px"})},null,8,["onClick","style"])):(o(),F(D(Ze),{key:1,onClick:P=>N(f,w.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),e(c,null,{title:a(()=>[q("重新转换")]),default:a(()=>[n("div",{class:"hover-btn-box",onClick:P=>C(f,R)},[e(D(Mt))],8,ol)]),_:2},1024),e(T,{placement:"bottomRight"},{overlay:a(()=>[e(S,null,{default:a(()=>[e(b,null,{default:a(()=>[n("div",{onClick:Oe(P=>g(f),["stop"])},"编辑",8,sl)]),_:2},1024),e(b,null,{default:a(()=>[n("div",{onClick:Oe(P=>E(f.id),["stop"])},"删除",8,il)]),_:2},1024)]),_:2},1024)]),default:a(()=>[n("div",ll,[e(D(Rt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),e(At,{onOk:O,ref_key:"classificationMarkModalRef",ref:r},null,512)])}}},cl=le(rl,[["__scopeId","data-v-383e05bc"]]),ul={class:"star-select-box"},dl={class:"star-item"},_l={class:"star-item"},pl={__name:"selct-star-box",props:{startLists:{type:Array,default:()=>[]}},emits:["change"],setup(t,{emit:d}){const i=d,s=t,_=u(-1),C=()=>{i("change",_.value)};return(g,E)=>{const w=St,O=$t;return o(),h("div",ul,[e(O,{activeKey:_.value,"onUpdate:activeKey":E[0]||(E[0]=r=>_.value=r),size:"small",onChange:C},{default:a(()=>[(o(),F(w,{key:-1},{tab:a(()=>[q("全部")]),_:1})),(o(),F(w,{key:0},{tab:a(()=>[n("div",dl,[e(D(Ze)),q("未标记")])]),_:1})),(o(!0),h(G,null,te(s.startLists,r=>(o(),F(w,{key:r.id},{tab:a(()=>[n("div",_l,[e(D(ve),{style:de({color:D(me)[r.type]})},null,8,["style"]),q(" "+z(r.name||"-"),1)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}},fl=le(pl,[["__scopeId","data-v-7a8d0e9e"]]),Fe=t=>(he("data-v-dfe31176"),t=t(),ge(),t),vl={class:"library-preview-page"},ml={class:"breadcrumb-block"},hl={class:"document-title-block",style:{height:"22px"}},gl={class:"title"},yl={class:"search-content-block"},bl={class:"selct-star-box"},kl=Fe(()=>n("span",null,"添加分段",-1)),Sl={key:0,class:"page-loading-box"},$l={class:"content-block"},xl={class:"content-block"},wl={key:1,class:"pdf-view-box"},Cl={class:"view-content-wrap"},Ol={key:0,class:"pdf-mode-switch"},ql={key:0},Ll={key:1,class:"segmentation-btn"},Pl=Fe(()=>n("div",null,"将当页重新分段",-1)),El=Fe(()=>n("div",null,"将文档重新分段",-1)),Il=Fe(()=>n("div",null,"重新学习文档",-1)),Fl={class:"view-content-box",style:{"padding-top":"60px"}},Ml=["onClick"],Rl={key:0,class:"content-box"},Dl={key:1,class:"content-box"},Tl=["innerHTML"],Al={class:"fragment-img"},zl=["src"],jl={class:"right-contnt-box"},Ul={class:"content-block"},Nl={__name:"library-preview",setup(t){const d=pn(),i=ie(()=>{var p;return((p=d.companyInfo)==null?void 0:p.neo4j_status)=="true"}),s=u(null),_=u(0),C=u(0),g={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},E=u([]),w=p=>{E.value=p},O=u({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),r=qe(),L=kt(),M=fn(),N=ie(()=>c.value.is_table_file=="1"),$=ie(()=>c.value.doc_type),m=ie(()=>{let p=c.value.status;return!(p=="1"||p=="2")||B.value.length==0}),y=ie(()=>c.value.is_qa_doc=="1"),c=u({}),v=Be({status:-1,graph_status:-1,category_id:-1}),b=u(1),S=ie(()=>"/manage/getLibRawFile?id="+r.query.id+"&token="+M.getToken);bt(()=>{r.query.graph_status&&(v.graph_status=r.query.graph_status,ce())});const T=()=>{L.back()},x=u(null),H=u(null);let f=-1;const R=(p,k=1)=>{let I,A;k==1?(I=".subsection-box .list-item",A=H.value):(I=".view-content-box .list-item",A=x.value);const ee=document.querySelectorAll(I)[p];ee.classList.add("flash-border"),f>=0&&document.querySelectorAll(I)[f].classList.remove("flash-border"),setTimeout(()=>{f=-1,ee.classList.remove("flash-border")},2500),f=p,A.scrollToElement({el:ee,time:1e3})},P=u(!0);(async()=>{Lt({id:r.query.id}).then(p=>{c.value={...p.data,graph_switch:p.data.graph_switch=="1"&&i.value};let k=p.data.status;k==1||k==2?Q():P.value=!1})})();const re=u({page:1,size:10}),be=u({}),B=u([]),ne=u(0),ke={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."};let _e=!0;const ce=()=>{re.value.page=1,ne.value=0,B.value=[],Q()},Me=p=>{v.category_id=p,ce()},l=(p=null)=>{re.value.page++,Q(p)},Q=(p=null)=>{_e=!0,ft({file_id:r.query.id,...re.value,...v}).then(k=>{var ae,W;P.value=!1,_e=!1;let I=k.data,A=I.list||[],ee=((ae=I.info)==null?void 0:ae.is_qa_doc)=="1"&&((W=I.info)==null?void 0:W.is_table_file)=="1";A.forEach(X=>{X.status_text=ke[X.status],X.graph_status_text=g[X.graph_status],X.isExcelQa=ee,X.similar_questions&&(X.similar_questions=JSON.parse(X.similar_questions))}),be.value=I.info,re.value.page==1&&(B.value=[]),B.value=[...B.value,...A],ne.value=I.total,typeof p=="function"&&p()})},V=()=>{_e||B.value.length>=ne.value||(l(),s.value&&s.value.loadMore())},J=()=>{et()};let se=null;function Se(){clearInterval(se),B.value.filter(k=>k.status==3).length?se=setInterval(()=>{et()},5e3):clearInterval(se)}const et=()=>{ft({file_id:r.query.id,page:1,size:B.value.length,...v}).then(p=>{var ee,ae;let k=p.data,I=k.list||[],A=((ee=k.info)==null?void 0:ee.is_qa_doc)=="1"&&((ae=k.info)==null?void 0:ae.is_table_file)=="1";I.forEach(W=>{W.status_text=ke[W.status],W.graph_status_text=g[W.graph_status],W.isExcelQa=A}),B.value=I,Se()})},jt=p=>{if(!p.id){re.value.page=1,Q();return}let k=B.value,I=k.findIndex(A=>A.id==p.id);if(I>-1){let A=k[I];A.title=p.title,A.content=p.content,A.question=p.question,A.answer=p.answer,A.answer=p.answer,A.images=p.images,A.word_total=p.question.length+p.answer.length+p.content.length,A.similar_questions=JSON.parse(p.similar_questions),k.splice(I,1,A),B.value=k}},Re=p=>{let k=B.value,I=k.findIndex(A=>A.id==p);I>-1&&(k.splice(I,1),B.value=k,ne.value=ne.value--)};u(!0);const tt=u(null),ue=p=>{tt.value.showModal(JSON.parse(JSON.stringify(p)))},nt=u(null),Ut=()=>{kn({id:r.query.id}).then(()=>K.success("操作完成"))},Nt=()=>{Sn({id:r.query.id}).then(()=>K.success("操作完成"))},at=u(null),Bt=()=>{at.value.show(c.value)},ot=()=>{L.push("/library/document-segmentation?document_id="+r.query.id+"&source=preview")},Qt=()=>{nt.value.open({id:r.query.id,doc_auto_renew_frequency:c.value.doc_auto_renew_frequency})},Ht=p=>{c.value.doc_auto_renew_frequency=p},Vt=p=>{c.value.file_name=p},Jt=p=>{const k=()=>{for(let I in B.value)if(B.value[I].page_num==p){R(I);return}};if(p>B.value[B.value.length-1].page_num){K.warning("分段数据正在加载，请稍后...");const I=()=>{p<=B.value[B.value.length-1].page_num?(K.success("加载完成"),je(()=>{k()})):l(I)};l(I)}else k()},Gt=(p,k)=>{C.value=k,_.value=p,B.value[B.value.length-1].page_num<p&&l()},Kt=p=>{var k;if(((k=c.value)==null?void 0:k.file_ext)=="pdf"&&b.value==1){const I=p.page_num-1,A=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[I],ee=()=>{const W=A();W.classList.add("flash-border"),setTimeout(()=>W.classList.remove("flash-border"),2500),s.value.getScrollInstance().scrollToElement({el:W,time:1e3})};if(A())ee();else{K.warning("PDF正在加载，请稍后...");const W=()=>{A()?(K.success("加载完成"),ee()):s.value&&s.value.loadMore()};s.value&&s.value.loadMore(W)}}else R(p.index,2)},De=u(1);let Te=null;const xe=u(0),Wt=p=>{xe.value=p},Zt=({y:p})=>{if(!Te){const I=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];Te=I&&I.clientHeight}let k=Math.floor(Math.abs(p)/Te)+1;De.value=Math.max(k,1)},Ae=u(null),Xt=p=>{let{key:k}=p;s.value&&s.value.getScrollInstance().disable(),k==1&&Ae.value.show({type:k,pdf_page_num:De.value}),k==2&&ot(),k==3&&Ae.value.show({type:k,pdf_page_num:0})},lt=()=>{s.value&&s.value.getScrollInstance().enable()},Yt=()=>{lt(),ce()};return(p,k)=>{var ct,ut,dt;const I=sn("router-link"),A=Rn,ee=Mn,ae=Dt,W=Tt,X=Ve,st=Je,we=wt,it=Ge,en=Dn,tn=Pe,Ce=Le,rt=An,nn=Tn,an=Ue("viewer");return o(),h("div",vl,[n("div",ml,[e(ee,null,{default:a(()=>[e(A,null,{default:a(()=>[e(I,{to:"/library/list"},{default:a(()=>[q(" 知识库管理 ")]),_:1})]),_:1}),e(A,null,{default:a(()=>[e(I,{to:{path:"/library/details/knowledge-document",query:{id:c.value.library_id}}},{default:a(()=>[q(z(c.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),e(A,null,{default:a(()=>[q("知识库详情")]),_:1})]),_:1})]),n("div",hl,[e(D(zn),{onClick:T}),n("span",gl,z(c.value.file_name),1),e(po,{detailsInfo:c.value},null,8,["detailsInfo"])]),n("div",yl,[n("div",bl,[e(fl,{startLists:E.value,onChange:Me},null,8,["startLists"])]),e(en,null,{default:a(()=>[e(W,{value:v.status,"onUpdate:value":k[0]||(k[0]=Z=>v.status=Z),placeholder:"请选择",style:{width:"160px"},onChange:ce},{default:a(()=>[e(ae,{value:-1},{default:a(()=>[q("全部嵌入状态")]),_:1}),(o(),h(G,null,te(ke,(Z,pe)=>e(ae,{value:pe},{default:a(()=>[q(z(Z),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),c.value.graph_switch?(o(),F(W,{key:0,value:v.graph_status,"onUpdate:value":k[1]||(k[1]=Z=>v.graph_status=Z),placeholder:"请选择",onChange:ce,style:{width:"160px"}},{default:a(()=>[e(ae,{value:-1},{default:a(()=>[q("全部知识图谱状态")]),_:1}),(o(),h(G,null,te(g,(Z,pe)=>e(ae,{value:pe},{default:a(()=>[q(z(Z),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):j("",!0),e(it,null,{overlay:a(()=>[e(st,null,{default:a(()=>[e(X,{onClick:Ut},{default:a(()=>[q("重新嵌入向量")]),_:1}),c.value.graph_switch?(o(),F(X,{key:0,onClick:Nt},{default:a(()=>[q("重新抽取知识图谱")]),_:1})):j("",!0),e(X,{onClick:Bt},{default:a(()=>[q("重命名")]),_:1}),$.value==2?(o(),F(X,{key:1,onClick:Qt},{default:a(()=>[q("设置更新频率")]),_:1})):j("",!0)]),_:1})]),default:a(()=>[e(we,null,{default:a(()=>[q("其他操作 "),e(D(vt))]),_:1})]),_:1}),$.value!=3?(o(),F(we,{key:1,onClick:ot},{default:a(()=>[q("重新分段")]),_:1})):j("",!0),e(we,{onClick:k[2]||(k[2]=Z=>ue({})),type:"primary"},{icon:a(()=>[e(D(Ct))]),default:a(()=>[kl]),_:1})]),_:1})]),P.value?(o(),h("div",Sl,[e(tn)])):(o(),h(G,{key:1},[y.value?(o(),h(G,{key:0},[m.value?(o(),F(ze,{key:0,onOpenEditSubscription:ue})):(o(),F($e,{key:1,scrollbar:{minSize:0},onOnScrollEnd:V},{default:a(()=>[n("div",$l,[e(cl,{ref:"subsectionBoxRef",total:ne.value,paragraphLists:B.value,detailsInfo:c.value,onOpenEditSubscription:ue,onHandleDelParagraph:Re,onHandleConvert:J,onGetStatrList:w},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(o(),h(G,{key:1},[N.value||$.value==3?(o(),h(G,{key:0},[m.value?(o(),F(ze,{key:0,onOpenEditSubscription:ue})):(o(),F($e,{key:1,scrollbar:{minSize:0},onOnScrollEnd:V},{default:a(()=>[n("div",xl,[e(gt,{ref:"subsectionBoxRef",total:ne.value,paragraphLists:B.value,detailsInfo:c.value,onOpenEditSubscription:ue,onHandleDelParagraph:Re,onHandleConvert:J,onGetStatrList:w},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(o(),h("div",wl,[n("div",Cl,[((ct=c.value)==null?void 0:ct.file_ext)=="pdf"?(o(),h("div",Ol,[e(nn,{value:b.value,"onUpdate:value":k[3]||(k[3]=Z=>b.value=Z)},{default:a(()=>[e(rt,{value:1},{default:a(()=>[e(Ce,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:a(()=>[q(" 原文预览 "),b.value==1&&xe.value>0?(o(),h("span",ql,"("+z(De.value)+" / "+z(xe.value)+")",1)):j("",!0)]),_:1})]),_:1}),e(rt,{value:2},{default:a(()=>[q("纯文本预览")]),_:1})]),_:1},8,["value"])])):j("",!0),((ut=c.value)==null?void 0:ut.file_ext)=="pdf"?(o(),h("div",Ll,[e(it,null,{overlay:a(()=>[e(st,{onClick:Xt},{default:a(()=>[b.value==1&&xe.value>0?(o(),F(X,{key:1},{default:a(()=>[e(Ce,{placement:"right",title:"将当前页重新解析并分段"},{default:a(()=>[Pl]),_:1})]),_:1})):j("",!0),(o(),F(X,{key:2},{default:a(()=>[e(Ce,{placement:"right",title:"将整个文档重新分段，注意，重新分段并不会重新提取文档的内容，只是将内容重新分段。"},{default:a(()=>[El]),_:1})]),_:1})),(o(),F(X,{key:3},{default:a(()=>[e(Ce,{placement:"right",title:"将整个文档重新学习，包含重新解析并提取文档内容，重新分段。"},{default:a(()=>[Il]),_:1})]),_:1}))]),_:1})]),default:a(()=>[e(we,null,{default:a(()=>[q(" 重新分段 "),e(D(vt))]),_:1})]),_:1})])):j("",!0),((dt=c.value)==null?void 0:dt.file_ext)=="pdf"&&b.value==1?(o(),F(ho,{key:2,ref_key:"pdfRef",ref:s,class:"scroll-box pdf-render-box",source:S.value,onSelect:Jt,onScroll:Zt,onRendered:Gt,onGetTotalPage:Wt},null,8,["source"])):(o(),F($e,{key:3,scrollbar:O.value,ref_key:"leftScrollRef",ref:x,class:"scroll-box",onOnScrollEnd:V},{default:a(()=>[n("div",Fl,[(o(!0),h(G,null,te(B.value,(Z,pe)=>(o(),h("div",{class:"list-item",onClick:_t=>R(pe),key:pe},[Z.question?(o(),h("div",Rl,z(Z.question),1)):j("",!0),Z.answer?(o(),h("div",Dl,z(Z.answer),1)):j("",!0),n("div",{class:"content-box",innerHTML:Z.content},null,8,Tl),Ne((o(),h("div",Al,[(o(!0),h(G,null,te(Z.images,(_t,on)=>(o(),h("img",{key:on,src:_t,alt:""},null,8,zl))),128))])),[[an]])],8,Ml))),128))])]),_:1},8,["scrollbar"]))]),n("div",jl,[m.value?(o(),F(ze,{key:0,onOpenEditSubscription:ue})):(o(),F($e,{key:1,scrollbar:O.value,ref_key:"rightScrollRef",ref:H,onOnScrollEnd:V},{default:a(()=>[n("div",Ul,[e(gt,{ref:"subsectionBoxRef",total:ne.value,detailsInfo:c.value,paragraphLists:B.value,onOpenEditSubscription:ue,onHandleDelParagraph:Re,onHandleConvert:J,onHandleScrollTargetPage:Kt,onGetStatrList:w},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),e(io,{detailsInfo:c.value,onHandleEdit:jt,ref_key:"editSubscriptionRef",ref:tt},null,8,["detailsInfo"]),e(fo,{onOk:Ht,ref_key:"updateFrequencyRef",ref:nt},null,512),e(In,{onOk:Vt,ref_key:"renameModalRef",ref:at},null,512),e(Do,{onOk:Yt,onEnable:lt,detailsInfo:c.value,ref_key:"reSegmentationPageRef",ref:Ae},null,8,["detailsInfo"])])}}},_i=le(Nl,[["__scopeId","data-v-dfe31176"]]);export{_i as default};
