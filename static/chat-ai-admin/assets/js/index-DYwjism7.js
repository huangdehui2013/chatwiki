import{C as nt}from"./cu-scroll-jRkjVxy8.js";import{a5 as tt,e as k,ai as lt,M as n,N as c,k as o,S as i,F as $,Y as v,Z as u,W as a,a7 as P,G,$ as H,u as h,Q as R,X as U,a0 as W,a1 as rt,a2 as ct,B as _t}from"./vue-chunks-DWnFCQSz.js";import{S as X,c as Y,a as ut,C as pt,b as dt,E as mt}from"./edit-subsection-CwR_YT3-.js";import{w as ht,x as vt,y as ft,z as Z,A as gt}from"./index-DIUiarE3.js";import{b as et,b3 as yt,T as kt,M as K,E as St,k as st,B as bt}from"../../index-UhR4yadr.js";import{S as Ct}from"./index-BWhNhRp3.js";import{_ as xt,M as Lt}from"./index-5i8OLAzS.js";import"./index-BJ7TpmPl.js";import{D as wt}from"./dropdown-CbxGUAy7.js";import{C as qt}from"./ClockCircleFilled-B7CU2Mch.js";import{S as Mt}from"./SettingOutlined-uwXhuIXb.js";import{S as Ot}from"./SyncOutlined-BM33Hh67.js";import{M as Et}from"./MoreOutlined-iAOeSBQN.js";import{_ as $t,a as It}from"./index-BWTLc6ay.js";import{_ as Dt}from"./index-kKxyythX.js";import{_ as Nt}from"./index-CtTKQyoO.js";import{_ as Pt}from"./index-Cd86XltT.js";import{S as Bt,_ as Ft}from"./index-9VXz7HRC.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-teqAjsuU.js";import"./Dropdown-lzT8P96r.js";import"./Trigger-DcWVD-r5.js";import"./index-DXeZ5ybK.js";import"./useRefs-CH9tJ50T.js";import"./pick-DFWac7Lu.js";import"./index-DzuDS3Yk.js";import"./isPlainObject-BeqP4IC7.js";import"./responsiveObserve-Bs6--9PQ.js";import"./collapseMotion-ByInPrfq.js";import"./QuestionCircleOutlined-CV_adx6X.js";import"./FormItemContext-BJa1evck.js";import"./CheckOutlined-B_iCQ6FL.js";import"./PlusOutlined-CeclvJCi.js";import"./slide-BR5NTmcW.js";import"./index--Qvpscnx.js";import"./Input-D7W5TJDt.js";import"./statusUtils--roYFmJe.js";import"./inputProps-CiDWLiIl.js";import"./index-DmSlXGTl.js";import"./Search-BRb_v-2B.js";import"./SearchOutlined-bV5WeZB5.js";import"./TextArea-CpTIlaWe.js";import"./Password-XreinKYD.js";import"./index-f5cCF1C6.js";import"./index-bg5oFZUg.js";import"./index-BJ4SSG33.js";import"./partition-CNXo-yhR.js";import"./index-DzhuYAPB.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./shallowequal-C0Ji8tJB.js";import"./RightOutlined-BxQrTxvt.js";import"./move-cWZng2f8.js";import"./colors-BiofrUQp.js";import"./index-CwxKp8Sp.js";import"./useMaxLevel-8lDaIAJK.js";import"./index-C0X3d23U.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-CKIj-GEZ.js";import"./DownOutlined-CvDOGKH1.js";import"./index-ChDOqBF7.js";import"./Checkbox-BSqox9oh.js";import"./index-Drb31wtU.js";import"./RadioButton-BySv4e0a.js";import"./CaretDownOutlined-DbQ_eVB2.js";import"./index-D-MVvPuZ.js";const J=f=>(rt("data-v-a02e9965"),f=f(),ct(),f),zt={class:"subsection-box"},Rt=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#F40"}},Jt={key:2,class:"qa-list-box"},Qt={class:"list-item"},Vt=J(()=>a("div",{class:"list-label"},"问题",-1)),Tt={class:"list-content"},At={key:0,class:"list-item"},jt=J(()=>a("div",{class:"list-label"},"相似问法",-1)),Gt={class:"list-content"},Ut={class:"list-item"},Wt=J(()=>a("div",{class:"list-label"},"答案",-1)),Xt={class:"list-content"},Yt={class:"fragment-img"},Zt=["src"],Kt={key:3,class:"common-list-box"},te={class:"top-block"},ee={class:"title"},se={class:"title"},oe=["innerHTML"],ae={class:"fragment-img"},ie=["src"],ne={key:0,class:"status-tag"},le={key:1,class:"status-tag complete"},re={class:"status-tag status-error"},ce={key:3,class:"status-tag running"},_e={class:"right-opration"},ue={class:"hover-btn-box"},pe=["onClick"],de=J(()=>a("div",null,"标记设置",-1)),me=["onClick"],he={class:"hover-btn-box"},ve=["onClick"],fe=["onClick"],ge={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(f,{expose:j,emit:B}){const w=B,_=f,F=tt().query,I=(l,p)=>{let{id:d,title:b,content:N,question:O,answer:y,images:C,category_id:x,library_id:L}=l,s=l.similar_questions||[];K.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${p+1}】吗?`,onOk(){return new Promise((t,r)=>{ht({id:d,library_id:L,title:b,content:N,question:O,answer:y,images:C,category_id:x,similar_questions:JSON.stringify(s)}).then(e=>{w("handleConvert",l),t()}).catch(()=>{t()})})},onCancel(){}})},q=l=>{w("openEditSubscription",l)},z=l=>{K.confirm({title:"提示",icon:o(St),content:"是否取消该标记?",onOk(){M(l,{})},onCancel(){}})},m=k([]),g=()=>{vt({library_id:F.id}).then(l=>{m.value=l.data||[],w("getStatrList",l.data||[])})};g();const D=k(null),Q=()=>{D.value.show()},V=l=>{var d;let p=(d=m.value.filter(b=>b.id==l.category_id)[0])==null?void 0:d.type;return p?Y[p]:"#F4EA2A"},M=(l,p={})=>{ft({id:l.id,category_id:p.id||0}).then(d=>{st.success("修改成功"),p.id?l.category_id=p.id:w("handleDelParagraph",l.id),g()})},T=l=>{window.open(`/#/library/preview?id=${l.file_id}`)};return j({handleOpenEditModal:q}),(l,p)=>{const d=$t,b=Dt,N=Ct,O=Nt,y=xt,C=Lt,x=wt,L=It,s=lt("viewer");return n(),c("div",zt,[o(L,{"data-source":f.paragraphLists,pagination:!1},{default:i(()=>[o(d,{key:"id","data-index":"id",width:1148},{title:i(()=>[f.isQaLibray?(n(),c($,{key:0},[v(" 问答（共"+u(_.total)+"个） ",1)],64)):(n(),c($,{key:1},[v("分段 （共"+u(_.total)+"个分段）",1)],64))]),default:i(({record:t,index:r})=>[t.file_name?(n(),c("a",{key:0,class:"file-name-text",onClick:e=>T(t)},u(t.file_name),9,Rt)):(n(),c("div",Ht,"原文档已删除")),f.isQaLibray?(n(),c("div",Jt,[a("div",Qt,[Vt,a("div",Tt,u(t.question),1)]),t.similar_questions&&t.similar_questions.length?(n(),c("div",At,[jt,a("div",Gt,u(t.similar_questions.join("/")),1)])):P("",!0),a("div",Ut,[Wt,a("div",Xt,u(t.answer),1)]),G((n(),c("div",Yt,[(n(!0),c($,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,Zt))),128))])),[[s]])])):(n(),c("div",Kt,[a("div",te,[a("div",ee,"分段"+u(r+1),1),a("div",se,u(t.title),1),a("span",null,"共"+u(t.word_total)+"个字符",1)]),a("div",{class:"content-box",innerHTML:t.content},null,8,oe),G((n(),c("div",ae,[(n(!0),c($,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,ie))),128))])),[[s]])]))]),_:1}),o(d,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:i(({record:t})=>[t.status==0?(n(),c("span",ne,[o(h(qt)),v(" 未转换")])):P("",!0),t.status==1?(n(),c("span",le,[o(h(yt)),v(" 已转换")])):P("",!0),t.status==2?(n(),R(b,{key:2,placement:"top"},{title:i(()=>[a("span",null,u(t.errmsg),1)]),default:i(()=>[a("span",null,[a("span",re,[o(h(kt)),v(" 转换异常")])])]),_:2},1024)):P("",!0),t.status==3?(n(),c("span",ce,[o(N,{size:"small"}),v(" 转换中")])):P("",!0)]),_:1}),o(d,{title:"操作",key:"action","data-index":"action",width:120},{default:i(({record:t,index:r})=>[a("div",_e,[o(x,null,{overlay:i(()=>[o(C,null,{default:i(()=>[(n(!0),c($,null,H(m.value,e=>(n(),R(y,{key:e.id},{default:i(()=>[a("div",{class:"start-item",onClick:E=>M(t,e)},[o(h(X),{style:U({color:h(Y)[e.type]})},null,8,["style"]),a("div",null,u(e.name||"-"),1)],8,pe)]),_:2},1024))),128)),o(y,null,{default:i(()=>[a("div",{class:"start-item",onClick:Q},[o(h(Mt)),de])]),_:1})]),_:2},1024)]),default:i(()=>[a("div",ue,[t.category_id>0?(n(),R(O,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>M(t,{})},{default:i(()=>[o(h(X),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(n(),R(h(ut),{key:1,onClick:e=>M(t,m.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),o(b,null,{title:i(()=>[v("重新转换")]),default:i(()=>[a("div",{class:"hover-btn-box",onClick:e=>I(t,r)},[o(h(Ot))],8,me)]),_:2},1024),o(x,{placement:"bottomRight"},{overlay:i(()=>[o(C,null,{default:i(()=>[o(y,null,{default:i(()=>[a("div",{onClick:W(e=>q(t),["stop"])},"编辑",8,ve)]),_:2},1024),o(y,null,{default:i(()=>[a("div",{onClick:W(e=>z(t),["stop"])},"删除",8,fe)]),_:2},1024)]),_:2},1024)]),default:i(()=>[a("div",he,[o(h(Et))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),o(pt,{onOk:g,ref_key:"classificationMarkModalRef",ref:D},null,512)])}}},ye=et(ge,[["__scopeId","data-v-a02e9965"]]),ke={class:"robot-page"},Se={class:"search-content-block"},be={class:"selct-star-box"},Ce={class:"scroll-box"},xe={class:"content-block"},Le={__name:"index",setup(f){const B=tt().query,w=k([]),_=k([]),S=k(0),F={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},q=k({}),z=s=>{w.value=s},m=k({page:1,size:10}),g=_t({status:-1,category_id:-1,library_id:B.id}),D=()=>{m.value.page=1,S.value=0,_.value=[],L()},Q=s=>{g.category_id=s,D()},V=()=>{gt({id:B.id}).then(()=>st.success("操作完成"))},M=k(null),T=s=>{M.value.showModal(JSON.parse(JSON.stringify(s)))},l=s=>{if(!s.id){m.value.page=1,L();return}let t=_.value,r=t.findIndex(e=>e.id==s.id);if(r>-1){let e=t[r];e.title=s.title,e.content=s.content,e.question=s.question,e.answer=s.answer,e.answer=s.answer,e.images=s.images,e.category_id=s.category_id,e.word_total=s.question.length+s.answer.length+s.content.length,e.similar_questions=JSON.parse(s.similar_questions),t.splice(r,1,e),_.value=t}},p=s=>{let t=_.value,r=t.findIndex(e=>e.id==s);r>-1&&(t.splice(r,1),_.value=t,S.value=--S.value,S.value)},d=()=>{x.value||_.value.length>=S.value||b()},b=()=>{m.value.page++,L()},N=()=>{y()};function O(){clearInterval(C),_.value.filter(t=>t.status==3).length?C=setInterval(()=>{y()},5e3):clearInterval(C)}const y=()=>{Z({page:1,size:_.value.length,...g}).then(s=>{let r=s.data.list||[];r.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),_.value=r,O()})};let C=null;const x=k(!1),L=()=>{x.value=!0,Z({...m.value,...g}).then(s=>{x.value=!1;let t=s.data,r=t.list||[];t.info&&(q.value={...t.info,is_qa_doc:t.info.type==2?1:0}),q.value={...t.info,is_qa_doc:t.info.type==2?1:0},r.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),m.value.page==1&&(_.value=[]),_.value=[..._.value,...r],S.value=t.total,O()})};return L(),(s,t)=>{const r=Bt,e=Ft,E=bt,ot=Pt,at=nt;return n(),c("div",ke,[a("div",Se,[a("div",be,[o(dt,{hideId:[0],startLists:w.value,onChange:Q},null,8,["startLists"])]),o(ot,null,{default:i(()=>[o(e,{value:g.status,"onUpdate:value":t[0]||(t[0]=A=>g.status=A),placeholder:"请选择",style:{width:"160px"},onChange:D},{default:i(()=>[o(r,{value:-1},{default:i(()=>[v("全部嵌入状态")]),_:1}),(n(),c($,null,H(I,(A,it)=>o(r,{value:it},{default:i(()=>[v(u(A),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),o(E,{onClick:V},{default:i(()=>[v("重新嵌入向量")]),_:1})]),_:1})]),a("div",Ce,[o(at,{scrollbar:{minSize:0},onOnScrollEnd:d},{default:i(()=>[a("div",xe,[o(ye,{ref:"subsectionBoxRef",isQaLibray:q.value.is_qa_doc,total:S.value,paragraphLists:_.value,onOpenEditSubscription:T,onHandleDelParagraph:p,onHandleConvert:N,onGetStatrList:z},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),o(mt,{detailsInfo:q.value,onHandleEdit:l,onHandleStatrList:z,ref_key:"editSubscriptionRef",ref:M},null,8,["detailsInfo"])])}}},Qs=et(Le,[["__scopeId","data-v-ea13d700"]]);export{Qs as default};
