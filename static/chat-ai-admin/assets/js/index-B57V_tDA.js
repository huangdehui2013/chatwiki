import{T as Ne,_ as Re,a as Pe}from"./empty-BtQ55gr9.js";import{k as e,e as f,a5 as te,w as Ae,B as ee,M as u,N as x,S as t,F as K,$ as Z,Q as B,W as l,Z as S,Y as g,u as z,G as pe,V as Ve,H as me,a7 as X,a1 as re,a2 as ie,b as Le}from"./vue-chunks-Dpmhapcm.js";import{i as Ye,j as ze,k as Be,l as je,m as Je,n as He,o as Qe,p as Ge,q as $e,r as Ke,f as We,s as Ze,t as Xe,v as et}from"./index-BJXjl86X.js";import{A as tt,b as oe,k as J,M as G,B as ve,E as fe,d as ot,f as at,cG as be,cH as nt}from"../../index-DJqZYlN8.js";import"./index-9XFVXge0.js";import{I as Oe}from"./Input-k3gxptQd.js";import{_ as he,F as se}from"./index-BearFCS_.js";import{Q as Ce}from"./QuestionCircleOutlined-D2lOE5qu.js";import{_ as ge}from"./index-BY-bgrX3.js";import{_ as Me}from"./index-Bpgeg3Jc.js";import{_ as Fe}from"./index-D7DELBhV.js";import{_ as lt}from"./index-Ci9XZtrG.js";import"./index-Dk60SqR7.js";import{R as Ie,_ as Se}from"./RadioButton-BdTnsnL8.js";import{R as st}from"./dayjs-2rkXE7pv.js";import{a as ke}from"./validate-8MtiUsxW.js";import{S as rt,_ as it}from"./index-DT9vq-9c.js";import{_ as ut}from"./index-BATayIOZ.js";import{d as dt}from"./vuedraggable.umd-yQ3gfpgp.js";import{_ as De}from"./index-DfSExCBV.js";import{u as ct}from"./database-CNr-EdTt.js";import{a as _t}from"./dayjs-BAOQ3IvD.js";import{U as pt,a as mt,b as ft}from"./index-O15OSOpm.js";import{I as vt}from"./InboxOutlined-CLEfOrAN.js";import{_ as ht}from"./index-DyP1V5nr.js";import{_ as gt}from"./index-DFTR305o.js";import{S as yt}from"./index-2EWY1GCt.js";import{_ as bt,M as kt}from"./index-BW4jDb4d.js";import"./index-CUiqpg-W.js";import{D as xt}from"./dropdown-CmzzPYoT.js";import{a as wt,_ as $t}from"./index-B3bBS2VZ.js";import{P as xe}from"./PlusOutlined-CTNlEK-E.js";import{D as Ot}from"./DownOutlined-D5t3juQ7.js";import{S as Ct}from"./SettingOutlined-D7RaZTOB.js";import"./Dropdown-DicWDWIK.js";import"./Trigger-DcF6kXOl.js";import"./index-Bn-6W96d.js";import"./useRefs-CxyIWkWE.js";import"./pick-BQKw5Ek5.js";import"./CheckOutlined-D8sWUycq.js";import"./slide-B4S8cqER.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./FormItemContext-DcHP2mNJ.js";import"./index-DGofXs4a.js";import"./Search-CxIvru6q.js";import"./SearchOutlined-C4P1S4P5.js";import"./isPlainObject--mHlhHEN.js";import"./inputProps-B4Qz7YgH.js";import"./TextArea-DEZsPG5C.js";import"./statusUtils-Bnl8Rf7N.js";import"./Password-DASsPHld.js";import"./responsiveObserve-D_TTA_LO.js";import"./collapseMotion-DmHD1G9F.js";import"./colors-CZV0Zir8.js";import"./UpOutlined-BLzSJSuk.js";import"./Checkbox-DQSCt5wV.js";import"./index-BzMAmIdx.js";import"./shallowequal-KOHJRfiy.js";import"./move-B1-eDBNJ.js";import"./partition-DekNjavo.js";import"./RightOutlined-CJJrtf85.js";import"./index-NxOBHTpX.js";import"./useMaxLevel-ChHJkfrX.js";import"./index-DaFSI5Qu.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-BBd11KLM.js";import"./index-D7LiUNoj.js";import"./CaretDownOutlined-8hpeo-8F.js";var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const Ft=Mt;function we(c){for(var O=1;O<arguments.length;O++){var T=arguments[O]!=null?Object(arguments[O]):{},R=Object.keys(T);typeof Object.getOwnPropertySymbols=="function"&&(R=R.concat(Object.getOwnPropertySymbols(T).filter(function(D){return Object.getOwnPropertyDescriptor(T,D).enumerable}))),R.forEach(function(D){It(c,D,T[D])})}return c}function It(c,O,T){return O in c?Object.defineProperty(c,O,{value:T,enumerable:!0,configurable:!0,writable:!0}):c[O]=T,c}var ye=function(O,T){var R=we({},O,T.attrs);return e(tt,we({},R,{icon:Ft}),null)};ye.displayName="MinusCircleOutlined";ye.inheritAttrs=!1;const St=ye,Dt={class:"add-data-sheet"},Ut={class:"field-name"},qt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(c,{expose:O,emit:T}){const R=f("添加数据"),E=te().query,v=T,k=c;Ae(()=>k.column,M=>{n()});const $=f([]),n=()=>{let M=[];k.column.forEach(d=>{h[d.name]="",d.rules=[],d.required=="true"&&d.rules.push({required:!0,message:`请输入${d.name}`}),d.type=="number"&&d.rules.push({type:"number",message:`${d.name}必须为数字`}),d.type=="integer"&&d.rules.push({asyncValidator:V}),d.type=="boolean"&&(h[d.name]="false"),M.push({...d}),$.value=M})},V=(M,d)=>new Promise((p,_)=>d==""||Number.isInteger(+d)?p():_("请输入整数")),L=f(!1),h=ee({form_id:E.form_id}),N=M=>{L.value=!0,C.value&&C.value.resetFields(),n(),h.id="",Object.assign(h,P(M)),h.id?R.value="修改数据":R.value="添加数据"},C=f(null),U=()=>{C.value.validate().then(M=>{Ye({...h}).then(d=>{let p=h.id?"修改成功":"添加成功";J.success(p),L.value=!1,v("ok")})})};function P(M){const d={};for(let p in M)if(M.hasOwnProperty(p)){const _=M[p];!isNaN(Number(_))&&typeof _=="string"&&_!=""?d[p]=Number(_):d[p]=_}return d}return O({show:N}),(M,d)=>{const p=ge,_=Me,A=Fe,i=lt,y=Oe,I=he,s=se,o=G;return u(),x("div",Dt,[e(o,{open:L.value,"onUpdate:open":d[0]||(d[0]=a=>L.value=a),title:R.value,onOk:U,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(s,{style:{"margin-top":"16px"},model:h,ref_key:"formRef",ref:C,layout:"vertical"},{default:t(()=>[(u(!0),x(K,null,Z($.value,a=>(u(),B(I,{name:a.name,key:a.id,rules:a.rules},{label:t(()=>[e(_,{gap:4,style:{width:"100%"}},{default:t(()=>[l("div",Ut,S(a.name),1),e(p,null,{title:t(()=>[g(S(a.description),1)]),default:t(()=>[e(z(Ce))]),_:2},1024)]),_:2},1024)]),default:t(()=>[a.type=="boolean"?(u(),B(A,{key:0,checked:h[a.name],"onUpdate:checked":r=>h[a.name]=r,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):a.type=="number"||a.type=="integer"?(u(),B(i,{key:1,style:{width:"100%"},value:h[a.name],"onUpdate:value":r=>h[a.name]=r,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(u(),B(y,{key:2,value:h[a.name],"onUpdate:value":r=>h[a.name]=r,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title","bodyStyle"])])}}},Tt=oe(qt,[["__scopeId","data-v-0de1a1fc"]]),Et={__name:"export-modal",setup(c,{expose:O}){const R=te().query,D=f("导出数据"),E=f(!1),v=ee({dates:[],type:1}),k=()=>{E.value=!0,v.type=1,v.dates=[]},$=ee({dates:[{validator:async(C,U)=>v.type==2&&!U.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),n=se.useForm,{resetFields:V,validate:L,validateInfos:h}=n(v,$),N=()=>{L().then(()=>{let C={form_id:R.form_id};v.type==2&&(C.start_date=v.dates[0],C.end_date=v.dates[1]),ze(C),E.value=!1})};return O({show:k}),(C,U)=>{const P=Ie,M=Se,d=he,p=st,_=se,A=G;return u(),x("div",null,[e(A,{open:E.value,"onUpdate:open":U[2]||(U[2]=i=>E.value=i),title:D.value,onOk:N,width:450},{default:t(()=>[e(_,{class:"mt16",layout:"vertical"},{default:t(()=>[e(d,{label:""},{default:t(()=>[e(M,{value:v.type,"onUpdate:value":U[0]||(U[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(P,{value:1},{default:t(()=>[g("全部数据")]),_:1}),e(P,{value:2},{default:t(()=>[g("自定义日期")]),_:1})]),_:1},8,["value"])]),_:1}),pe(e(d,Ve({required:"",label:"选择导出日期"},z(h).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":U[1]||(U[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[me,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Nt=oe(Et,[["__scopeId","data-v-ca624632"]]),Rt=c=>(re("data-v-81eb5a66"),c=c(),ie(),c),Pt={class:"add-data-sheet"},At=Rt(()=>l("div",{class:"form-required-item"},"筛选条件",-1)),Vt={class:"filter-list-box"},Lt={style:{"margin-left":"48px"}},Yt={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:T}){const R=f("添加分类"),E=te().query,v=T,k=c;f([]);const $=f(!1),n=ee({form_id:E.form_id,name:"",condition:[],type:"1",id:""}),V=()=>{let s=[{form_field_id:k.column[0].id,form_filed_type:k.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];n.condition=s},L=s=>{n.condition.splice(s,1)},h=(s,o)=>{s.rule=void 0,s.rule_value1="",s.rule_value2="",s.form_filed_type=k.column.filter(a=>a.id==s.form_field_id)[0].type},N=(s,o)=>o.form_field_id==s.id?!1:n.condition.map(r=>r.form_field_id).includes(s.id),C=()=>{let s=n.condition.map(a=>a.form_field_id),o=k.column.filter(a=>!s.includes(a.id));if(!o.length){J.error("字段已全部添加");return}n.condition.push({form_field_id:o[0].id,form_filed_type:o[0].type,rule:void 0,rule_value1:"",rule_value2:""})},U=s=>!s.rule||s.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(s.rule),P=s=>!s.rule||s.form_filed_type=="boolean"?!1:["between"].includes(s.rule),M=(s,o,a)=>new Promise((r,q)=>U(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?r():q("请输入数字"):r():q("请输入"):r()),d=(s,o,a)=>new Promise((r,q)=>P(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入数字"):r():q("请输入"):r()),p=()=>{$.value=!0,R.value="添加分类",V(),n.name="",n.type="1",n.id=""},_=s=>{$.value=!0,R.value="编辑分类",Be({form_id:E.form_id,id:s.id}).then(o=>{let a=o.data.conditions||"[]";a=JSON.parse(a),a=a.map(r=>({form_field_id:r.form_field_id+"",form_filed_type:k.column.filter(q=>q.id==r.form_field_id)[0].type,rule:A(r.rule),rule_value1:r.rule_value1,rule_value2:r.rule_value2})),n.condition=a,n.name=o.data.name,n.type=o.data.type,n.id=o.data.id})};function A(s){const o=["string_","integer_","number_","boolean_"];for(const a of o)if(s.startsWith(a))return s.slice(a.length);return s}const i=f(null),y=()=>{i.value.validate().then(s=>{let o=n.condition.map(m=>({form_field_id:+m.form_field_id,rule:m.form_filed_type+"_"+m.rule,rule_value1:m.rule_value1,rule_value2:m.rule_value2})),a={...n,condition:JSON.stringify(o)},r=je,q="添加成功";n.id&&(r=Je,q="编辑成功"),r(a).then(m=>{J.success(q),$.value=!1,v("ok")})}).catch(s=>{})},I=f({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return O({show:p,edit:_}),(s,o)=>{const a=Oe,r=he,q=rt,m=it,Y=ut,H=ve,Q=Ie,le=Se,de=se,ce=G;return u(),x("div",Pt,[e(ce,{open:$.value,"onUpdate:open":o[2]||(o[2]=F=>$.value=F),title:R.value,onOk:y,width:790},{default:t(()=>[e(de,{class:"form-box",style:{"margin-top":"16px"},model:n,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(r,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(a,{maxLength:64,value:n.name,"onUpdate:value":o[0]||(o[0]=F=>n.name=F),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),At,l("div",Vt,[(u(!0),x(K,null,Z(n.condition,(F,j)=>(u(),B(Y,{key:j,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[l("div",null,"条件"+S(j+1)+":",1),e(r,null,{default:t(()=>[e(m,{value:F.form_field_id,"onUpdate:value":b=>F.form_field_id=b,style:{width:"150px"},placeholder:"请选择",onChange:b=>h(F,j)},{default:t(()=>[(u(!0),x(K,null,Z(k.column,b=>(u(),B(q,{disabled:N(b,F),key:b.id,value:b.id},{default:t(()=>[g(S(b.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(r,{name:["condition",j,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(m,{value:F.rule,"onUpdate:value":b=>F.rule=b,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(u(!0),x(K,null,Z(I.value[F.form_filed_type],b=>(u(),B(q,{key:b.value,value:b.value},{default:t(()=>[g(S(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),pe(e(r,{name:["condition",j,"rule_value1"],rules:{asyncValidator:(b,ae)=>M(b,ae,F)}},{default:t(()=>[e(a,{value:F.rule_value1,"onUpdate:value":b=>F.rule_value1=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,U(F)]]),pe(e(r,{name:["condition",j,"rule_value2"],rules:{asyncValidator:(b,ae)=>d(b,ae,F),trigger:"blur"}},{default:t(()=>[e(a,{value:F.rule_value2,"onUpdate:value":b=>F.rule_value2=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,P(F)]]),n.condition.length>1?(u(),B(z(St),{key:0,onClick:b=>L(j)},null,8,["onClick"])):X("",!0)]),_:2},1024))),128)),l("div",Lt,[e(H,{onClick:C},{default:t(()=>[g("添加条件")]),_:1})])]),e(r,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:n.type,"onUpdate:value":o[1]||(o[1]=F=>n.type=F)},{default:t(()=>[e(Q,{value:"1"},{default:t(()=>[g("与（And）")]),_:1}),e(Q,{value:"2"},{default:t(()=>[g("或（Or）")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ue=oe(Yt,[["__scopeId","data-v-81eb5a66"]]),ne=c=>(re("data-v-f1db0fc5"),c=c(),ie(),c),zt={class:"custom-table"},Bt=ne(()=>l("div",{class:"t-head"},[l("div",{class:"td"},[l("div",{style:{width:"24px"}}),g(" 分类名称 ")]),l("div",{class:"td"},"类型"),l("div",{class:"td"},"启用分类"),l("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),jt={class:"t-body"},Jt={class:"t-row"},Ht=ne(()=>l("div",{class:"t-item"},[l("div",{style:{width:"24px"}}),g(" 全部 ")],-1)),Qt=ne(()=>l("div",{class:"t-item"},"系统分类",-1)),Gt={class:"t-item"},Kt=ne(()=>l("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1)),Wt={class:"t-item"},Zt={class:"drag-btn"},Xt={key:0},eo={key:1},to=ne(()=>l("div",{class:"t-item"},"自定义分类",-1)),oo={class:"t-item"},ao={class:"t-item flex-none",style:{width:"120px"}},no=["onClick"],lo=["onClick"],so={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(c,{expose:O,emit:T}){const D=te().query,E=T,v=f("管理分类"),k=f(!1),$=c,n=()=>{$e({form_id:D.form_id}).then(p=>{N.value=p.data.map(_=>({..._}))})},V=()=>{n(),E("ok"),E("change")},L=()=>{n(),k.value=!0},h=()=>{k.value=!1},N=f(),C=()=>{let p=[];N.value.reverse().forEach((_,A)=>{p.push({id:+_.id,sort:+A+1})}),He({form_id:D.form_id,filter_sort:JSON.stringify(p)}).then(_=>{J.success("排序成功"),n(),E("change")})},U=p=>{Qe({form_id:D.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(_=>{J.success("设置成功"),n(),E("change")})},P=(p,_)=>{G.confirm({title:"删除确认",icon:e(fe),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Ge({id:p.id,form_id:D.form_id}).then(A=>{J.success("删除成功"),N.value.splice(_,1),E("change")})},onCancel(){}})},M=f(null),d=p=>{M.value.edit(p)};return O({show:L}),(p,_)=>{const A=Fe,i=ot,y=ge,I=De,s=G;return u(),x("div",null,[e(s,{open:k.value,"onUpdate:open":_[1]||(_[1]=o=>k.value=o),title:v.value,onCancel:h,footer:null,width:760},{default:t(()=>[l("div",zt,[Bt,l("div",jt,[l("div",Jt,[Ht,Qt,l("div",Gt,[e(A,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),Kt]),e(z(dt),{modelValue:N.value,"onUpdate:modelValue":_[0]||(_[0]=o=>N.value=o),"item-key":"id",onEnd:C,group:"table-rows",handle:".drag-btn"},{item:t(({element:o,index:a})=>[(u(),x("div",{key:o.id,class:"t-row"},[l("div",Wt,[l("span",Zt,[e(i,{name:"drag"})]),o.name.length>10?(u(),x("span",Xt,[e(y,null,{title:t(()=>[g(S(o.name),1)]),default:t(()=>[g(" "+S(o.name.slice(0,10)+"..."),1)]),_:2},1024)])):(u(),x("span",eo,S(o.name),1))]),to,l("div",oo,[e(A,{onChange:r=>U(o),checked:o.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),l("div",ao,[l("a",{onClick:r=>d(o)},"编辑",8,no),e(I,{type:"vertical"}),l("a",{onClick:r=>P(o,a)},"删除",8,lo)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e(Ue,{onOk:V,column:$.column,ref_key:"addFilrerModalRef",ref:M},null,8,["column"])])}}},ro=oe(so,[["__scopeId","data-v-f1db0fc5"]]),ue=c=>(re("data-v-c09a8f6a"),c=c(),ie(),c),io=ue(()=>l("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1)),uo={class:"upload-box"},co={class:"ant-upload-drag-icon"},_o=ue(()=>l("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),po=ue(()=>l("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1)),mo={key:0,class:"progress-box"},fo=ue(()=>l("div",{class:"tip"},"数据导入中，请勿关闭页面",-1)),vo={key:0},ho={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:T}){const R=at(),D=T,E=te().query,v=c,k=f(!1),$=f(!1),n=ee({total:0,success:0,err_data:[]}),V=f([]),L=i=>{const y=i.file.status;if(y==="done")if(i.file.response.res==0){let I=i.file.response.data.task_id;C(I)}else return V.value=[],J.error(i.file.response.msg);else y==="error"&&(V.value=[],J.error(`${i.file.name} file upload failed.`))};function h(i){}let N=null;const C=i=>{N&&clearInterval(N),k.value=!1,p.value=!0,_.value=10,n.total=0,n.success=0,n.err_data=[],N=setInterval(()=>{Ke({task_id:i}).then(y=>{let I=y.data;_.value=(I.processed/I.total).toFixed(),I.finish&&(D("ok"),clearInterval(N),_.value=100),I.total>0&&(n.total=I.total,n.success=I.success,n.err_data=I.err_data)}).catch(()=>{clearInterval(N)})},2e3)},U=()=>{let i;i=v.column.map(y=>y.name),i="id,"+i.join(",")+`
`,be(i,[],[],"导入数据模板.csv")},P=()=>{let i={id:""};v.column.forEach(y=>{i[y.name]=""}),nt([i],"导入数据模板.json")},M=()=>{V.value=[],k.value=!0},d=()=>{},p=f(!1),_=f(10),A=()=>{let i="id,",y=["id"];for(let o in n.err_data[0])o!="id"&&o!="err_msg"&&(i+=o+",",y.push(o));i=i+`err_msg
`,y.push("err_msg");let I=n.err_data,s="失败数据_"+_t().format("YYYY/MM/DD HH:mm")+".xlsx";be(i,I,y,s)};return O({show:M}),(i,y)=>{const I=ht,s=pt,o=G,a=mt,r=ve,q=gt;return u(),x("div",null,[e(o,{open:k.value,"onUpdate:open":y[1]||(y[1]=m=>k.value=m),title:"导入数据","confirm-loading":$.value,onOk:d,footer:null,width:746},{default:t(()=>[e(I,{"show-icon":"",class:"alert-box"},{message:t(()=>[l("div",null,[g(" 支持通过Excel或者json文件导入数据。 "),l("a",{onClick:U,class:"mr8"},"excel模板"),l("a",{onClick:P},"json模板")]),io]),_:1}),l("div",uo,[e(s,{fileList:V.value,"onUpdate:fileList":y[0]||(y[0]=m=>V.value=m),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:z(R).getToken},data:{form_id:z(E).form_id},action:"/manage/uploadFormFile",onChange:L,onDrop:h},{default:t(()=>[l("p",co,[e(z(vt))]),_o,po]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(o,{open:p.value,"onUpdate:open":y[2]||(y[2]=m=>p.value=m),title:"导入数据",footer:null,width:746},{default:t(()=>[_.value<100?(u(),x("div",mo,[e(a,{type:"circle",percent:_.value},null,8,["percent"]),fo])):(u(),B(q,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[g("导入成功"+S(n.success)+"，导入失败"+S(n.total-n.success)+" ",1),n.total-n.success>0?(u(),x("span",vo," 您可以下载失败数据，修改后重新导入 ")):X("",!0)]),extra:t(()=>[n.total-n.success>0?(u(),B(r,{key:0,onClick:A,type:"primary"},{default:t(()=>[g("下载失败数据")]),_:1})):X("",!0)]),_:1}))]),_:1},8,["open"])])}}},go=oe(ho,[["__scopeId","data-v-c09a8f6a"]]),qe=c=>(re("data-v-fe0434d1"),c=c(),ie(),c),yo={key:0,class:"loading-box"},bo={key:1,class:"empty-box"},ko=qe(()=>l("img",{src:Pe,alt:""},null,-1)),xo=qe(()=>l("div",null,"暂无字段, 请先去添加字段",-1)),wo=[ko,xo],$o={key:2,class:"field-manage-page"},Oo={class:"page-title"},Co={key:0},Mo={key:1},Fo={class:"table-wrapper customize-scroll-style"},Io={key:0},So={key:1},Do={key:0},Uo={key:1},qo=["onClick"],To=["onClick"],Eo={__name:"index",setup(c){const O=ct(),T=Le(()=>O.databaseInfo.entry_count),D=te().query,E=f([]),v=f([]),k=f(!0),$=ee({form_id:D.form_id,page:1,size:10,total:0}),n=f(!1),V=m=>{$.page=m.current,$.size=m.pageSize,h()},L=()=>{$.page=1,h()},h=()=>{n.value=!0,Ze({...$,filter_id:C.value}).then(m=>{E.value=m.data.list||[],$.total=+m.data.total||0,O.getDatabaseInfo({id:D.form_id})}).finally(()=>{n.value=!1})};We({form_id:D.form_id}).then(m=>{v.value=m.data,k.value=!1,h()});const N=f([]),C=f(""),U=()=>{$e({form_id:D.form_id}).then(m=>{let Y=m.data||[];if(N.value=Y.filter(H=>H.enabled=="true"),C.value){let H=Y.filter(Q=>Q.id==C.value);(H.length&&H[0].enabled=="false"||!H.length)&&(C.value="",h())}})};U();const P=()=>{U(),h()},M=()=>{$.page=1,h()},d=f(null),p=(m,Y)=>{Y==="add"&&d.value.show()},_=m=>{G.confirm({title:"删除确认",icon:e(fe),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Xe({id:m.id}).then(Y=>{J.success("删除成功"),P()})},onCancel(){}})},A=()=>{G.confirm({title:"清空数据提示",icon:e(fe),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){et({form_id:D.form_id}).then(m=>{J.success("清空成功"),P()})},onCancel(){}})},i=f(null),y=(m={})=>{i.value.show(JSON.parse(JSON.stringify(m)))},I=f(null),s=(m={})=>{I.value.show()},o=f(null),a=()=>{o.value.show()},r=f(null),q=()=>{r.value.show()};return(m,Y)=>{const H=yt,Q=ve,le=bt,de=kt,ce=xt,F=Me,j=Re,b=ge,ae=Ne,_e=$t,Te=De,Ee=wt;return u(),x(K,null,[k.value?(u(),x("div",yo,[e(H)])):X("",!0),!k.value&&!v.value.length?(u(),x("div",bo,wo)):X("",!0),!k.value&&v.value.length?(u(),x("div",$o,[l("div",Oo,[g(" 数据管理 "),e(F,{gap:16},{default:t(()=>[e(Q,{type:"primary",onClick:Y[0]||(Y[0]=w=>y())},{icon:t(()=>[e(z(xe))]),default:t(()=>[g(" 添加数据 ")]),_:1}),e(Q,{onClick:Y[1]||(Y[1]=w=>s())},{icon:t(()=>[e(z(ft))]),default:t(()=>[g(" 导入数据 ")]),_:1}),e(ce,null,{overlay:t(()=>[e(de,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[l("div",{onClick:a},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[l("div",{onClick:A},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(Q,null,{default:t(()=>[g(" 更多操作 "),e(z(Ot))]),_:1})]),_:1})]),_:1})]),e(ae,{class:"tabs-wrapper",activeKey:C.value,"onUpdate:activeKey":Y[2]||(Y[2]=w=>C.value=w),type:"editable-card",onEdit:p,onChange:M},{addIcon:t(()=>[e(z(xe)),g(" 添加分类 ")]),rightExtra:t(()=>[l("span",{class:"setting-btn",onClick:q},[e(z(Ct)),g(" 管理分类 ")])]),default:t(()=>[e(j,{key:"",closable:!1},{tab:t(()=>[g("全部 ("+S(T.value)+")",1)]),_:1}),(u(!0),x(K,null,Z(N.value,w=>(u(),B(j,{key:w.id,closable:!1},{tab:t(()=>[w.name.length>8?(u(),x("span",Co,[e(b,null,{title:t(()=>[g(S(w.name),1)]),default:t(()=>[g(" "+S(w.name.slice(0,8)+"..."),1)]),_:2},1024)])):(u(),x("span",Mo,S(w.name),1)),g(" ("+S(w.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),l("div",Fo,[e(Ee,{sticky:"","data-source":E.value,loading:n.value,scroll:{x:1e3},pagination:{current:$.page,total:$.total,pageSize:$.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V},{default:t(()=>[e(_e,{key:"id","data-index":"id",title:"id",width:60}),(u(!0),x(K,null,Z(v.value,w=>(u(),B(_e,{key:w.name,"data-index":w.name,width:165},{title:t(()=>[w.name.length>12?(u(),x("span",Io,[e(b,null,{title:t(()=>[g(S(w.name),1)]),default:t(()=>[g(" "+S(w.name.slice(0,12)+"..."),1)]),_:2},1024)])):(u(),x("span",So,S(w.name),1)),e(b,null,{title:t(()=>[g(S(w.description),1)]),default:t(()=>[e(z(Ce),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:W})=>[W[w.name].length>10?(u(),x("span",Do,[e(b,null,{title:t(()=>[g(S(W[w.name]),1)]),default:t(()=>[g(" "+S(W[w.name].slice(0,9)+"..."),1)]),_:2},1024)])):(u(),x("span",Uo,S(W[w.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(_e,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:w})=>[l("span",null,[l("a",{onClick:W=>y(w)},"编辑",8,qo),e(Te,{type:"vertical"}),l("a",{onClick:W=>_(w)},"删除",8,To)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(Tt,{onOk:P,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e(Ue,{onOk:P,column:v.value,ref_key:"addFilrerModalRef",ref:d},null,8,["column"]),e(Nt,{ref_key:"exportModalRef",ref:o},null,512),e(ro,{onOk:h,onChange:U,column:v.value,ref_key:"filterManageModalRef",ref:r},null,8,["column"]),e(go,{onOk:L,column:v.value,ref_key:"importDataModalRef",ref:I},null,8,["column"])])):X("",!0)],64)}}},Xa=oe(Eo,[["__scopeId","data-v-fe0434d1"]]);export{Xa as default};
