import{C as nt}from"./cu-scroll-8SQNC6_m.js";import{a5 as tt,e as k,ai as lt,M as n,N as c,k as o,S as i,F as $,Y as v,Z as u,W as a,a7 as P,G,$ as H,u as h,Q as z,X as U,a0 as W,a1 as rt,a2 as ct,B as _t}from"./vue-chunks-DkYK5AuX.js";import{S as X,c as Y,a as ut,C as dt,b as pt,E as mt}from"./edit-subsection-DgLeTRa2.js";import{b as et,bd as ht,be as vt,M as Z,dd as ft,E as gt,de as yt,df as kt,k as st,dg as K,dh as bt,B as St}from"../../index-CuFzRDH0.js";import{S as Ct}from"./index-YK7vZYdC.js";import{_ as xt,M as Lt}from"./index-D2p2Kdi5.js";import"./index-DmWi8Hkf.js";import{D as qt}from"./dropdown-aM3tBgR4.js";import{C as wt}from"./ClockCircleFilled-vGTbBwA5.js";import{S as Mt}from"./SettingOutlined-BLoICRkv.js";import{S as Ot}from"./SyncOutlined-_wzD1Bbw.js";import{M as Et}from"./MoreOutlined-B6i0Yk0c.js";import{_ as $t,a as It}from"./index-CaI5udhb.js";import{_ as Dt}from"./index-DVObnatt.js";import{_ as Nt}from"./index-mQ-jomi6.js";import{_ as Pt}from"./index-CqvptPUf.js";import{S as Bt,_ as Ft}from"./index-B9b8kVtF.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-Cdh10aiJ.js";import"./Dropdown-DNhcw7uk.js";import"./Trigger-qqJEyN1K.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-CNYsll_x.js";import"./DownloadOutlined-CpROJx0R.js";import"./pick-C3qN9FSY.js";import"./index-CKa8nflF.js";import"./isPlainObject-B3m2dvNk.js";import"./responsiveObserve-nm9aPAMw.js";import"./collapseMotion-D38MKU2V.js";import"./QuestionCircleOutlined-DySDEe_b.js";import"./FormItemContext-CG4o3aCY.js";import"./CheckOutlined-Nu5wJEo2.js";import"./PlusOutlined-C1-JNsax.js";import"./slide--PTaLm6c.js";import"./index-5PrSJtCq.js";import"./Input-DlD3j6GW.js";import"./index-DpON8wvi.js";import"./inputProps-CIG3Q6HA.js";import"./Search-BjDfM7wD.js";import"./SearchOutlined-2-sBVYkv.js";import"./TextArea-DnYx9N6z.js";import"./Password-B-_rMC_p.js";import"./index-Dq04eVXF.js";import"./index-BKVIlkU8.js";import"./index-CR3o8wp3.js";import"./index-C4ag7WaN.js";import"./index-njT3lQ6A.js";import"./index-BMSQkwth.js";import"./LeftOutlined-BL6rtvtT.js";import"./index-BDEXdwqG.js";import"./UpOutlined-CmeybyPL.js";import"./DownOutlined-xHwfZhzl.js";import"./axios-Cm0UX6qg.js";import"./qs-g-qVsYXK.js";import"./crypto-js-CsNcoEfj.js";import"./dayjs-CHX5mXCJ.js";import"./shallowequal-CCVEH32S.js";import"./RightOutlined-C7Gymx4e.js";import"./move-CfeIRdjT.js";import"./colors-TmzmwKXv.js";import"./index-D0OvhCrn.js";import"./useMaxLevel-iyEeLMuD.js";import"./CaretDownFilled-P6q1_Q4R.js";import"./index-DncdWYWk.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-CvnBYLiG.js";import"./Checkbox-CHV8yuJS.js";import"./index-NJlqtEGH.js";import"./RadioButton-ouyuU7LQ.js";import"./CaretDownOutlined-BxctymRA.js";import"./index-q1RY3Bas.js";const J=f=>(rt("data-v-a02e9965"),f=f(),ct(),f),Rt={class:"subsection-box"},zt=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#F40"}},Jt={key:2,class:"qa-list-box"},Qt={class:"list-item"},Vt=J(()=>a("div",{class:"list-label"},"问题",-1)),Tt={class:"list-content"},At={key:0,class:"list-item"},jt=J(()=>a("div",{class:"list-label"},"相似问法",-1)),Gt={class:"list-content"},Ut={class:"list-item"},Wt=J(()=>a("div",{class:"list-label"},"答案",-1)),Xt={class:"list-content"},Yt={class:"fragment-img"},Zt=["src"],Kt={key:3,class:"common-list-box"},te={class:"top-block"},ee={class:"title"},se={class:"title"},oe=["innerHTML"],ae={class:"fragment-img"},ie=["src"],ne={key:0,class:"status-tag"},le={key:1,class:"status-tag complete"},re={class:"status-tag status-error"},ce={key:3,class:"status-tag running"},_e={class:"right-opration"},ue={class:"hover-btn-box"},de=["onClick"],pe=J(()=>a("div",null,"标记设置",-1)),me=["onClick"],he={class:"hover-btn-box"},ve=["onClick"],fe=["onClick"],ge={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(f,{expose:j,emit:B}){const q=B,_=f,F=tt().query,I=(l,d)=>{let{id:p,title:S,content:N,question:O,answer:y,images:C,category_id:x,library_id:L}=l,s=l.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${d+1}】吗?`,onOk(){return new Promise((t,r)=>{ft({id:p,library_id:L,title:S,content:N,question:O,answer:y,images:C,category_id:x,similar_questions:JSON.stringify(s)}).then(e=>{q("handleConvert",l),t()}).catch(()=>{t()})})},onCancel(){}})},w=l=>{q("openEditSubscription",l)},R=l=>{Z.confirm({title:"提示",icon:o(gt),content:"是否取消该标记?",onOk(){M(l,{})},onCancel(){}})},m=k([]),g=()=>{yt({library_id:F.id}).then(l=>{m.value=l.data||[],q("getStatrList",l.data||[])})};g();const D=k(null),Q=()=>{D.value.show()},V=l=>{var p;let d=(p=m.value.filter(S=>S.id==l.category_id)[0])==null?void 0:p.type;return d?Y[d]:"#F4EA2A"},M=(l,d={})=>{kt({id:l.id,category_id:d.id||0}).then(p=>{st.success("修改成功"),d.id?l.category_id=d.id:q("handleDelParagraph",l.id),g()})},T=l=>{window.open(`/#/library/preview?id=${l.file_id}`)};return j({handleOpenEditModal:w}),(l,d)=>{const p=$t,S=Dt,N=Ct,O=Nt,y=xt,C=Lt,x=qt,L=It,s=lt("viewer");return n(),c("div",Rt,[o(L,{"data-source":f.paragraphLists,pagination:!1},{default:i(()=>[o(p,{key:"id","data-index":"id",width:1148},{title:i(()=>[f.isQaLibray?(n(),c($,{key:0},[v(" 问答（共"+u(_.total)+"个） ",1)],64)):(n(),c($,{key:1},[v("分段 （共"+u(_.total)+"个分段）",1)],64))]),default:i(({record:t,index:r})=>[t.file_name?(n(),c("a",{key:0,class:"file-name-text",onClick:e=>T(t)},u(t.file_name),9,zt)):(n(),c("div",Ht,"原文档已删除")),f.isQaLibray?(n(),c("div",Jt,[a("div",Qt,[Vt,a("div",Tt,u(t.question),1)]),t.similar_questions&&t.similar_questions.length?(n(),c("div",At,[jt,a("div",Gt,u(t.similar_questions.join("/")),1)])):P("",!0),a("div",Ut,[Wt,a("div",Xt,u(t.answer),1)]),G((n(),c("div",Yt,[(n(!0),c($,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,Zt))),128))])),[[s]])])):(n(),c("div",Kt,[a("div",te,[a("div",ee,"分段"+u(r+1),1),a("div",se,u(t.title),1),a("span",null,"共"+u(t.word_total)+"个字符",1)]),a("div",{class:"content-box",innerHTML:t.content},null,8,oe),G((n(),c("div",ae,[(n(!0),c($,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,ie))),128))])),[[s]])]))]),_:1}),o(p,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:i(({record:t})=>[t.status==0?(n(),c("span",ne,[o(h(wt)),v(" 未转换")])):P("",!0),t.status==1?(n(),c("span",le,[o(h(ht)),v(" 已转换")])):P("",!0),t.status==2?(n(),z(S,{key:2,placement:"top"},{title:i(()=>[a("span",null,u(t.errmsg),1)]),default:i(()=>[a("span",null,[a("span",re,[o(h(vt)),v(" 转换异常")])])]),_:2},1024)):P("",!0),t.status==3?(n(),c("span",ce,[o(N,{size:"small"}),v(" 转换中")])):P("",!0)]),_:1}),o(p,{title:"操作",key:"action","data-index":"action",width:120},{default:i(({record:t,index:r})=>[a("div",_e,[o(x,null,{overlay:i(()=>[o(C,null,{default:i(()=>[(n(!0),c($,null,H(m.value,e=>(n(),z(y,{key:e.id},{default:i(()=>[a("div",{class:"start-item",onClick:E=>M(t,e)},[o(h(X),{style:U({color:h(Y)[e.type]})},null,8,["style"]),a("div",null,u(e.name||"-"),1)],8,de)]),_:2},1024))),128)),o(y,null,{default:i(()=>[a("div",{class:"start-item",onClick:Q},[o(h(Mt)),pe])]),_:1})]),_:2},1024)]),default:i(()=>[a("div",ue,[t.category_id>0?(n(),z(O,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>M(t,{})},{default:i(()=>[o(h(X),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(n(),z(h(ut),{key:1,onClick:e=>M(t,m.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),o(S,null,{title:i(()=>[v("重新转换")]),default:i(()=>[a("div",{class:"hover-btn-box",onClick:e=>I(t,r)},[o(h(Ot))],8,me)]),_:2},1024),o(x,{placement:"bottomRight"},{overlay:i(()=>[o(C,null,{default:i(()=>[o(y,null,{default:i(()=>[a("div",{onClick:W(e=>w(t),["stop"])},"编辑",8,ve)]),_:2},1024),o(y,null,{default:i(()=>[a("div",{onClick:W(e=>R(t),["stop"])},"删除",8,fe)]),_:2},1024)]),_:2},1024)]),default:i(()=>[a("div",he,[o(h(Et))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),o(dt,{onOk:g,ref_key:"classificationMarkModalRef",ref:D},null,512)])}}},ye=et(ge,[["__scopeId","data-v-a02e9965"]]),ke={class:"robot-page"},be={class:"search-content-block"},Se={class:"selct-star-box"},Ce={class:"scroll-box"},xe={class:"content-block"},Le={__name:"index",setup(f){const B=tt().query,q=k([]),_=k([]),b=k(0),F={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},w=k({}),R=s=>{q.value=s},m=k({page:1,size:10}),g=_t({status:-1,category_id:-1,library_id:B.id}),D=()=>{m.value.page=1,b.value=0,_.value=[],L()},Q=s=>{g.category_id=s,D()},V=()=>{bt({id:B.id}).then(()=>st.success("操作完成"))},M=k(null),T=s=>{M.value.showModal(JSON.parse(JSON.stringify(s)))},l=s=>{if(!s.id){m.value.page=1,L();return}let t=_.value,r=t.findIndex(e=>e.id==s.id);if(r>-1){let e=t[r];e.title=s.title,e.content=s.content,e.question=s.question,e.answer=s.answer,e.answer=s.answer,e.images=s.images,e.category_id=s.category_id,e.word_total=s.question.length+s.answer.length+s.content.length,e.similar_questions=JSON.parse(s.similar_questions),t.splice(r,1,e),_.value=t}},d=s=>{let t=_.value,r=t.findIndex(e=>e.id==s);r>-1&&(t.splice(r,1),_.value=t,b.value=--b.value,b.value)},p=()=>{x.value||_.value.length>=b.value||S()},S=()=>{m.value.page++,L()},N=()=>{y()};function O(){clearInterval(C),_.value.filter(t=>t.status==3).length?C=setInterval(()=>{y()},5e3):clearInterval(C)}const y=()=>{K({page:1,size:_.value.length,...g}).then(s=>{let r=s.data.list||[];r.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),_.value=r,O()})};let C=null;const x=k(!1),L=()=>{x.value=!0,K({...m.value,...g}).then(s=>{x.value=!1;let t=s.data,r=t.list||[];t.info&&(w.value={...t.info,is_qa_doc:t.info.type==2?1:0}),w.value={...t.info,is_qa_doc:t.info.type==2?1:0},r.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),m.value.page==1&&(_.value=[]),_.value=[..._.value,...r],b.value=t.total,O()})};return L(),(s,t)=>{const r=Bt,e=Ft,E=St,ot=Pt,at=nt;return n(),c("div",ke,[a("div",be,[a("div",Se,[o(pt,{hideId:[0],startLists:q.value,onChange:Q},null,8,["startLists"])]),o(ot,null,{default:i(()=>[o(e,{value:g.status,"onUpdate:value":t[0]||(t[0]=A=>g.status=A),placeholder:"请选择",style:{width:"160px"},onChange:D},{default:i(()=>[o(r,{value:-1},{default:i(()=>[v("全部嵌入状态")]),_:1}),(n(),c($,null,H(I,(A,it)=>o(r,{value:it},{default:i(()=>[v(u(A),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),o(E,{onClick:V},{default:i(()=>[v("重新嵌入向量")]),_:1})]),_:1})]),a("div",Ce,[o(at,{scrollbar:{minSize:0},onOnScrollEnd:p},{default:i(()=>[a("div",xe,[o(ye,{ref:"subsectionBoxRef",isQaLibray:w.value.is_qa_doc,total:b.value,paragraphLists:_.value,onOpenEditSubscription:T,onHandleDelParagraph:d,onHandleConvert:N,onGetStatrList:R},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),o(mt,{detailsInfo:w.value,onHandleEdit:l,onHandleStatrList:R,ref_key:"editSubscriptionRef",ref:M},null,8,["detailsInfo"])])}}},As=et(Le,[["__scopeId","data-v-ea13d700"]]);export{As as default};
