import{C as se}from"./cu-scroll-8SQNC6_m.js";import{b as ce,e as me,bp as pe,da as he,bv as fe,k as G,bK as ke,d as ge,M as ve,bd as ye}from"../../index-CuFzRDH0.js";import{b as be,a5 as we,a4 as xe,B as R,e as s,M as c,Q as B,S as l,W as r,k as n,V as I,u as v,a7 as m,G as Q,H as j,N as b,a6 as L,Y as d,F as w,z as Ce,a1 as ze,a2 as Be,l as Ie}from"./vue-chunks-DkYK5AuX.js";import{A as Le}from"./avatar-input-r3v6vmqb.js";import{M as P}from"./model-select-CidLVLk0.js";import{O as Ne}from"./open-grapg-modal-BRd59mAh.js";import{C as Me}from"./index-C4ag7WaN.js";import{F as Y,_ as Se}from"./index-CKa8nflF.js";import"./index-5PrSJtCq.js";import{I as Ae}from"./Input-DlD3j6GW.js";import{Q as H}from"./QuestionCircleOutlined-DySDEe_b.js";import{_ as Ue}from"./TextArea-DnYx9N6z.js";import{_ as De}from"./index-D2ta3gNn.js";import{_ as Ve}from"./index-B9b8kVtF.js";import{_ as qe}from"./index-BDEXdwqG.js";import{_ as Te}from"./index-B3CceHui.js";import{_ as Ee}from"./index-DVObnatt.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs-g-qVsYXK.js";import"./crypto-js-CsNcoEfj.js";import"./dayjs-CHX5mXCJ.js";import"./PlusOutlined-C1-JNsax.js";import"./index-CR3o8wp3.js";import"./Trigger-qqJEyN1K.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-B-_rMC_p.js";import"./inputProps-CIG3Q6HA.js";import"./DownloadOutlined-CpROJx0R.js";import"./CheckOutlined-Nu5wJEo2.js";import"./collapseMotion-D38MKU2V.js";import"./FormItemContext-CG4o3aCY.js";import"./index-njT3lQ6A.js";import"./isPlainObject-B3m2dvNk.js";import"./responsiveObserve-nm9aPAMw.js";import"./index-DpON8wvi.js";import"./Search-BjDfM7wD.js";import"./SearchOutlined-2-sBVYkv.js";import"./index-CNYsll_x.js";import"./slide--PTaLm6c.js";import"./DownOutlined-xHwfZhzl.js";import"./move-CfeIRdjT.js";import"./UpOutlined-CmeybyPL.js";import"./colors-TmzmwKXv.js";const k=y=>(ze("data-v-ae832678"),y=y(),Be(),y),Oe={class:"add-library-page"},$e={class:"form-box"},Fe=k(()=>r("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const Ge=k(()=>r("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1)),Re=k(()=>r("div",{class:"form-alert-tip"},"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段",-1)),Qe={class:"select-card-box"},je={class:"card-title"},Pe=k(()=>r("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),Ye={class:"card-title"},He=k(()=>r("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),Ke={class:"card-title"},We=k(()=>r("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),N="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Xe={__name:"knowledge-config",setup(y){const K=me(),M=be(()=>{var a;return((a=K.companyInfo)==null?void 0:a.neo4j_status)=="true"}),S=we(),W=xe(),A=S.query,U=fe,e=R({library_name:"",library_intro:"",use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",avatar:U,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:N}),D=s(""),X=s(0),V=s({}),Z=a=>{e.use_model=oe.includes(a.rawData.model_define)&&a.rawData.deployment_name?a.rawData.deployment_name:a.rawData.name,e.use_model_icon=a.icon,e.use_model_name=a.use_model_name,e.model_config_id=a.rawData.id,D.value=a.rawData.model_define,i()},q=s([]);pe().then(a=>{q.value=a.data.map(o=>({label:o.name,value:o.no}))});const T=s(!0);(()=>{he({id:A.id}).then(a=>{V.value=a.data,X.value=V.value.is_offline?2:1,e.library_name=a.data.library_name,e.library_intro=a.data.library_intro,e.use_model=a.data.use_model,e.is_offline=a.data.is_offline,e.model_config_id=a.data.model_config_id,e.avatar=a.data.avatar?a.data.avatar:U,e.avatar_file=a.data.avatar_file?a.data.avatar_file:"",e.graph_switch=a.data.graph_switch!="0",e.graph_model_config_id=a.data.graph_model_config_id>0?a.data.graph_model_config_id:void 0,e.graph_use_model=a.data.graph_use_model,e.chunk_type=+a.data.chunk_type,e.normal_chunk_default_separators_no=a.data.normal_chunk_default_separators_no?a.data.normal_chunk_default_separators_no.split(",").map(o=>+o):[],e.normal_chunk_default_chunk_size=a.data.normal_chunk_default_chunk_size,e.normal_chunk_default_chunk_overlap=a.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=a.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=a.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=a.data.semantic_chunk_default_threshold,e.ai_chunk_size=a.data.ai_chunk_size||5e3,e.ai_chunk_model=a.data.ai_chunk_model,e.ai_chunk_model_config_id=a.data.ai_chunk_model_config_id,e.ai_chunk_prumpt=a.data.ai_chunk_prumpt||N,T.value=a.data.type==2})})();const Je=s([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),J=Y.useForm,ee=R({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:x}=J(e,ee),ae=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file,i()},ea=()=>!1,oe=["azure","ollama","xinference","openaiAgent"],ne=["azure"],E=()=>{i()},p=s([]),C=a=>{p.value=a,Ce(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&te()})},te=()=>{if(p.value.length>0){let a=null,o=null;for(let u of p.value)if(u.model_define==="tongyi"){a=u;for(let _ of a.children)if(_.name==="qwen-max"){o=_;break}break}a||(a=p.value[0],o=a.children[0]),a&&o&&(e.ai_chunk_model=o.name,e.ai_chunk_model_config_id=o.model_config_id)}},O=s(null),le=a=>{if(a){e.graph_switch=!1;let o={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&p.value.length>0){let u=p.value[0];if(u){let _=u.children[0];o.graph_use_model=_.name,o.graph_model_config_id=_.model_config_id}}O.value.show(o)}else e.graph_switch=!1,i()},z=a=>{e.chunk_type=a,i()},_e=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model,i(()=>{ve.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:Ie(ye,{style:{color:"#52c41a"}}),onOk:()=>W.push({path:"/library/details/knowledge-document",query:{id:A.id}})})}))},i=(a=null)=>{if(!e.library_name)return G.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:e.normal_chunk_default_separators_no.join(","),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,ai_chunk_size:e.ai_chunk_size,ai_chunk_model:e.ai_chunk_model,ai_chunk_model_config_id:e.ai_chunk_model_config_id,ai_chunk_prumpt:e.ai_chunk_prumpt,id:S.query.id};ne.indexOf(D.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),ke(o).then(u=>{typeof a=="function"?a():G.success("修改成功")})};return(a,o)=>{const u=Ae,_=Se,$=Ue,h=ge,ie=De,re=Ve,f=qe,g=Te,F=Ee,de=Y,ue=se;return c(),B(ue,null,{default:l(()=>[r("div",Oe,[r("div",$e,[n(de,{"label-col":{span:5}},{default:l(()=>[n(_,I({ref:"name",label:"知识库名称"},v(x).library_name),{default:l(()=>[n(u,{onBlur:i,value:e.library_name,"onUpdate:value":o[0]||(o[0]=t=>e.library_name=t),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(_,{label:"知识库简介"},{default:l(()=>[n($,{onBlur:i,value:e.library_intro,"onUpdate:value":o[1]||(o[1]=t=>e.library_intro=t),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(_,I({ref:"name",label:"知识库封面"},v(x).avatar),{default:l(()=>[n(Le,{value:e.avatar,"onUpdate:value":o[2]||(o[2]=t=>e.avatar=t),onChange:ae},null,8,["value"]),Fe]),_:1},16),n(_,I({label:"嵌入模型"},v(x).use_model),{default:l(()=>[m("",!0),n(Me,{modelValue:e.use_model,"onUpdate:modelValue":o[3]||(o[3]=t=>e.use_model=t),"label-key":"use_model_name","value-key":"value",modelType:"TEXT EMBEDDING","model-config-id":e.model_config_id,onChange:Z,onLoaded:C},null,8,["modelValue","model-config-id"])]),_:1},16),Q(n(_,{label:"生成知识图谱"},{default:l(()=>[n(ie,{onChange:le,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),Ge]),_:1},512),[[j,M.value]]),Q(n(_,{label:"知识图谱模型"},{default:l(()=>[n(P,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":o[4]||(o[4]=t=>e.graph_use_model=t),modeId:e.graph_model_config_id,"onUpdate:modeId":o[5]||(o[5]=t=>e.graph_model_config_id=t),style:{width:"300px"},onChange:E,onLoaded:C},null,8,["modeName","modeId"])]),_:1},512),[[j,e.graph_switch&&M.value]]),T.value?m("",!0):(c(),b(w,{key:0},[n(_,{label:"分段方式",required:""},{default:l(()=>[Re,r("div",Qe,[r("div",{class:L(["select-card-item",{active:e.chunk_type==1}]),onClick:o[6]||(o[6]=t=>z(1))},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),r("div",je,[n(h,{name:"ordinary-segmentation",class:"title-icon"}),d(" 普通分段 ")]),Pe],2),r("div",{class:L(["select-card-item",{active:e.chunk_type==2}]),onClick:o[7]||(o[7]=t=>z(2))},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),r("div",Ye,[n(h,{name:"semantic-segmentation",class:"title-icon"}),d(" 语义分段 ")]),He],2),r("div",{class:L(["select-card-item",{active:e.chunk_type==3}]),onClick:o[8]||(o[8]=t=>z(3))},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),r("div",Ke,[n(h,{name:"semantic-segmentation",class:"title-icon"}),d(" AI分段 ")]),We],2)])]),_:1}),e.chunk_type==1?(c(),b(w,{key:0},[n(_,{label:"分段标识符",required:""},{default:l(()=>[n(re,{onChange:i,value:e.normal_chunk_default_separators_no,"onUpdate:value":o[9]||(o[9]=t=>e.normal_chunk_default_separators_no=t),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:q.value},null,8,["value","options"])]),_:1}),n(_,{label:"分段最大长度",required:""},{default:l(()=>[n(g,{gap:8,align:"center"},{default:l(()=>[n(f,{onBlur:i,value:e.normal_chunk_default_chunk_size,"onUpdate:value":o[10]||(o[10]=t=>e.normal_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),d(" 字符 ")]),_:1})]),_:1}),n(_,{label:"分段重叠长度"},{default:l(()=>[n(g,{gap:8,align:"center"},{default:l(()=>[n(f,{onBlur:i,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":o[11]||(o[11]=t=>e.normal_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),d(" 字符 ")]),_:1})]),_:1})],64)):m("",!0),e.chunk_type==2?(c(),b(w,{key:1},[e.chunk_type==2?(c(),B(_,{key:0,required:""},{label:l(()=>[d(" 分段阈值 "),n(F,null,{title:l(()=>[d("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:l(()=>[n(v(H),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[n(f,{onBlur:i,value:e.semantic_chunk_default_threshold,"onUpdate:value":o[12]||(o[12]=t=>e.semantic_chunk_default_threshold=t),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):m("",!0),n(_,{label:"分段最大长度",required:""},{default:l(()=>[n(g,{gap:8,align:"center"},{default:l(()=>[n(f,{onBlur:i,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":o[13]||(o[13]=t=>e.semantic_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),d(" 字符 ")]),_:1})]),_:1}),n(_,{label:"分段重叠长度"},{default:l(()=>[n(g,{gap:8,align:"center"},{default:l(()=>[n(f,{onBlur:i,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":o[14]||(o[14]=t=>e.semantic_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),d(" 字符 ")]),_:1})]),_:1})],64)):m("",!0),e.chunk_type==3?(c(),b(w,{key:2},[e.chunk_type==3?(c(),B(_,{key:0,required:""},{label:l(()=>[d(" AI大模型 ")]),default:l(()=>[n(P,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":o[15]||(o[15]=t=>e.ai_chunk_model=t),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":o[16]||(o[16]=t=>e.ai_chunk_model_config_id=t),style:{width:"300px"},onChange:E,onLoaded:C},null,8,["modeName","modeId"])]),_:1})):m("",!0),n(_,{label:"提示词设置",required:""},{default:l(()=>[n(g,{gap:8,align:"center"},{default:l(()=>[n($,{onBlur:i,maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":o[17]||(o[17]=t=>e.ai_chunk_prumpt=t),placeholder:N},null,8,["value"])]),_:1})]),_:1}),n(_,null,{label:l(()=>[d(" 单次最大字符数 "),n(F,null,{title:l(()=>[d("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:l(()=>[n(v(H),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[n(f,{onBlur:i,class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":o[18]||(o[18]=t=>e.ai_chunk_size=t),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:t=>parseInt(t),parser:t=>parseInt(t)},null,8,["value","formatter","parser"]),d(" 字符 ")]),_:1})],64)):m("",!0)],64))]),_:1})]),n(Ne,{onOk:_e,ref_key:"openGrapgModalRef",ref:O},null,512)])]),_:1})}}},Ka=ce(Xe,[["__scopeId","data-v-ae832678"]]);export{Ka as default};
