import{b as ce,cL as ge,d as me,cM as Le,cK as ie,k as te,cN as pe,M as De,E as xe,cO as we,cP as He,bh as Re}from"../../index-UhR4yadr.js";import{c as Q,M as H,N as R,F as fe,$ as Ve,u as J,a6 as re,k as u,W as _,Z as de,a7 as z,e as E,S as C,Y as oe,Q as Me,a0 as A,a1 as Ee,a2 as $e,a4 as Fe,a5 as Be,b as le,B as Se,w as _e,x as Ae,a8 as Ie,z as se}from"./vue-chunks-DWnFCQSz.js";import{i as Ke}from"./index-DIUiarE3.js";import{_ as je,M as Oe}from"./index-5i8OLAzS.js";import"./index-BJ7TpmPl.js";import{D as Te}from"./dropdown-CbxGUAy7.js";import{_ as Ze}from"./index-CwxKp8Sp.js";import{P as ye}from"./PlusOutlined-CeclvJCi.js";import{C as Ue}from"./CaretDownOutlined-DbQ_eVB2.js";import{M as Pe}from"./MoreOutlined-iAOeSBQN.js";import{_ as qe}from"./index-kKxyythX.js";import{S as ze}from"./share-modal-CrdWm1Dw.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-DzhuYAPB.js";import"./shallowequal-C0Ji8tJB.js";import"./Trigger-DcWVD-r5.js";import"./collapseMotion-ByInPrfq.js";import"./slide-BR5NTmcW.js";import"./index-DXeZ5ybK.js";import"./Dropdown-lzT8P96r.js";import"./RightOutlined-BxQrTxvt.js";import"./move-cWZng2f8.js";import"./colors-BiofrUQp.js";import"./useMaxLevel-8lDaIAJK.js";import"./index-9VXz7HRC.js";import"./statusUtils--roYFmJe.js";import"./CheckOutlined-B_iCQ6FL.js";import"./DownOutlined-CvDOGKH1.js";import"./SearchOutlined-bV5WeZB5.js";import"./FormItemContext-BJa1evck.js";import"./index-C0X3d23U.js";import"./responsiveObserve-Bs6--9PQ.js";import"./share-form-BxxIogKe.js";import"./index-BpanVZOL.js";import"./index-Drb31wtU.js";import"./RadioButton-BySv4e0a.js";import"./Checkbox-BSqox9oh.js";import"./index--Qvpscnx.js";import"./Input-D7W5TJDt.js";import"./inputProps-CiDWLiIl.js";import"./index-DmSlXGTl.js";import"./Search-BRb_v-2B.js";import"./isPlainObject-BeqP4IC7.js";import"./TextArea-CpTIlaWe.js";import"./Password-XreinKYD.js";import"./index-DzuDS3Yk.js";import"./QuestionCircleOutlined-CV_adx6X.js";const We="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.9993%2015.3363C14.4596%2015.3363%2014.8327%2014.9632%2014.8327%2014.503C14.8327%2014.0428%2014.4596%2013.6697%2013.9993%2013.6697C13.5391%2013.6697%2013.166%2014.0428%2013.166%2014.503C13.166%2014.9632%2013.5391%2015.3363%2013.9993%2015.3363Z'%20fill='%23BFBFBF'%20stroke='%23BFBFBF'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%207V12.3333Z'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14%207V12.3333'%20stroke='%23BFBFBF'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M30.328%204.576H31.672V6.382H36.362V7.67H31.672V9.84H37.104V11.128H32.778C33.702%2012.766%2035.256%2014.236%2037.426%2015.538L36.488%2016.742C34.234%2015.062%2032.652%2013.2%2031.728%2011.128H31.672V17.4H30.328V11.128H30.272C29.278%2013.396%2027.64%2015.272%2025.372%2016.756L24.602%2015.51C26.702%2014.362%2028.242%2012.892%2029.222%2011.128H24.896V9.84H30.328V7.67H25.736V6.382H30.328V4.576ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='white'/%3e%3c/svg%3e",Ge="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23CCDFFF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='%232475FC'/%3e%3cpath%20d='M11.334%2011L13.334%2013L17.334%209'%20stroke='white'%20stroke-width='1.33'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M35.816%2011.058H27.136V14.908C27.136%2015.44%2027.402%2015.706%2027.934%2015.706H34.92C35.172%2015.706%2035.41%2015.622%2035.606%2015.454C35.83%2015.244%2035.97%2014.404%2036.054%2012.934L37.356%2013.354C37.188%2015.118%2036.95%2016.168%2036.656%2016.49C36.32%2016.798%2035.872%2016.966%2035.298%2016.994H27.57C26.38%2016.994%2025.792%2016.378%2025.792%2015.146V7.866H27.136V9.784H34.458V6.452H25.218V5.178H35.816V11.058ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='%232475FC'/%3e%3c/svg%3e";var he={exports:{}};(function(g,$){(function(L,h){h()})(Q,function(){function L(o,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function h(o,l,s){var r=new XMLHttpRequest;r.open("GET",o),r.responseType="blob",r.onload=function(){c(r.response,l,s)},r.onerror=function(){console.error("could not download file")},r.send()}function D(o){var l=new XMLHttpRequest;l.open("HEAD",o,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function p(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(l)}}var f=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Q=="object"&&Q.global===Q?Q:void 0,x=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=f.saveAs||(typeof window!="object"||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!x?function(o,l,s){var r=f.URL||f.webkitURL,y=document.createElement("a");l=l||o.name||"download",y.download=l,y.rel="noopener",typeof o=="string"?(y.href=o,y.origin===location.origin?p(y):D(y.href)?h(o,l,s):p(y,y.target="_blank")):(y.href=r.createObjectURL(o),setTimeout(function(){r.revokeObjectURL(y.href)},4e4),setTimeout(function(){p(y)},0))}:"msSaveOrOpenBlob"in navigator?function(o,l,s){if(l=l||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(L(o,s),l);else if(D(o))h(o,l,s);else{var r=document.createElement("a");r.href=o,r.target="_blank",setTimeout(function(){p(r)})}}:function(o,l,s,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof o=="string")return h(o,l,s);var y=o.type==="application/octet-stream",I=/constructor/i.test(f.HTMLElement)||f.safari,U=/CriOS\/[\d]+/.test(navigator.userAgent);if((U||y&&I||x)&&typeof FileReader<"u"){var K=new FileReader;K.onloadend=function(){var M=K.result;M=U?M:M.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=M:location=M,r=null},K.readAsDataURL(o)}else{var F=f.URL||f.webkitURL,j=F.createObjectURL(o);r?r.location=j:location.href=j,r=null,setTimeout(function(){F.revokeObjectURL(j)},4e4)}});f.saveAs=c.saveAs=c,g.exports=c})})(he);var Xe=he.exports;const Ye={class:"side-meuns"},Qe=["onClick"],Je={class:"menu-name"},Ne={__name:"side-menus",props:{menus:{type:Array,default:()=>[]},active:{type:String,default:""}},emits:["menuClick"],setup(g,{emit:$}){const L=$,h=g,{checkPermission:D}=ge(),p=f=>{L("menuClick",f)};return(f,x)=>{const c=me;return H(),R("div",Ye,[(H(!0),R(fe,null,Ve(h.menus,o=>(H(),R(fe,{key:o.key},[J(D)(o.permissions)?(H(),R("div",{key:0,class:re(["side-meun-item",{active:o.key===h.active}]),onClick:l=>p(o)},[u(c,{class:"menu-icon",name:o.icon},null,8,["name"]),_("span",Je,de(o.name),1)],10,Qe)):z("",!0)],64))),128))])}}},et=ce(Ne,[["__scopeId","data-v-24011595"]]),tt={__name:"upload-doc",emits:["file-loaded"],setup(g,{expose:$,emit:L}){const h=L,D=E(null);let p={};const f=c=>{p=c||{},D.value.click()},x=c=>{const o=c.target.files[0];if(!o)return;if(!o.name.endsWith(".md")){alert("请选择.md文件");return}const l=new FileReader;l.onload=s=>{h("file-loaded",{content:s.target.result,title:o.name,file:o,...p})},l.readAsText(o),c.target.value=null};return $({triggerUpload:f}),(c,o)=>(H(),R("input",{type:"file",style:{opacity:"0",position:"fixed",bottom:"-9999px",left:"-9999px"},ref_key:"fileInput",ref:D,onChange:x,accept:".md"},null,544))}},Z=g=>(Ee("data-v-ab74343b"),g=g(),$e(),g),ot={class:"side-directory"},nt={class:"directory-header"},at=Z(()=>_("div",{class:"label-text"},"文档目录",-1)),it={class:"action-box"},lt={class:"action-btn"},st={class:"directory-body"},rt={class:"directory-content"},ct={style:{"margin-right":"4px"}},dt={class:"action-btn toggle-btn"},ut=["data-level"],pt={class:"doc-title"},ft={class:"doc-action-box"},_t=Z(()=>_("span",{class:"menu-name"},"添加文档",-1)),yt=Z(()=>_("span",{class:"menu-name"},"导入文档",-1)),mt=Z(()=>_("span",{class:"menu-name"},null,-1)),ht=Z(()=>_("span",{class:"menu-name"},"复制文档",-1)),vt=Z(()=>_("span",{class:"menu-name"},"导出文档",-1)),Ct=Z(()=>_("span",{class:"menu-name"},"删除文档",-1)),kt={__name:"side-directory",props:{list:{type:Array,default:()=>[]},loadData:{type:Function,default:()=>{}},selectedKeys:{type:Array,default:()=>[]}},emits:["addDoc","importDoc","copyLink","copyDoc","deleteDoc","exportDoc","dragenter","drop","select"],setup(g,{expose:$,emit:L}){const h=L,D=g,p=E([]),f=E([]),x=d=>{f.value.includes(d)||f.value.push(d)},c=(d,v)=>{const V=p.value.indexOf(d);typeof v=="boolean"?V>-1&&v===!1?p.value.splice(V,1):p.value.push(d):V>-1?p.value.splice(V,1):p.value.push(d)},o=d=>{d===!0?D.list.forEach(v=>{!v.isLeaf&&!p.value.includes(v.key)&&p.value.push(v.key)}):p.value=[]},l=E(null),s=d=>{h("addDoc",d)};let r=null;const y=d=>{r=d,l.value.triggerUpload()},I=d=>{h("importDoc",r,d)},U=d=>{h("copyLink",d)},K=d=>{h("copyDoc",d)},F=d=>{h("exportDoc",d)},j=d=>{h("deleteDoc",d)},M=d=>{h("dragenter",d)},N=d=>{h("drop",d)},ne=(d,v)=>{h("select",v.node.dataRef)};return $({toggleExpand:c,addLoadedKey:x}),(d,v)=>{const V=me,w=je,W=Oe,G=Te,ae=qe,O=Ze;return H(),R("div",ot,[_("div",nt,[u(V,{name:"doc-directory",style:{"font-size":"16px",color:"#595959"}}),at,_("div",it,[u(G,null,{overlay:C(()=>[u(W,null,{default:C(()=>[u(w,{key:"addDoc",onClick:v[0]||(v[0]=k=>s())},{default:C(()=>[oe(" 添加文档 ")]),_:1}),u(w,{key:"importDoc",onClick:v[1]||(v[1]=k=>y())},{default:C(()=>[oe(" 导入文档 ")]),_:1})]),_:1})]),default:C(()=>[_("span",lt,[u(J(ye),{style:{color:"#595959"}})])]),_:1}),u(ae,null,{title:C(()=>[oe("收起全部文档")]),default:C(()=>[_("span",{class:"action-btn",onClick:v[2]||(v[2]=k=>o(!1))},[u(V,{name:"menu-expand",style:{"font-size":"16px",color:"#595959"}})])]),_:1})])]),_("div",st,[_("div",rt,[u(O,{class:"directory-tree",expandedKeys:p.value,"onUpdate:expandedKeys":v[5]||(v[5]=k=>p.value=k),"selected-keys":g.selectedKeys,loadedKeys:f.value,"block-node":"","tree-data":D.list,"load-data":g.loadData,"field-names":{key:"id",title:"title",children:"children"},draggable:"",onDragenter:M,onDrop:N,onSelect:ne},{switcherIcon:C(({switcherCls:k})=>[_("div",ct,[_("span",dt,[u(J(Ue),{style:{"font-size":"12px"},class:re(k)},null,8,["class"])])])]),title:C(k=>[_("div",{class:re(["doc-item",{"is-leaf":k.dataRef.isLeaf}]),"data-level":k.level},[u(V,{class:"doc-icon",name:"doc-file"}),_("div",pt,de(k.dataRef.title),1),_("div",ft,[k.level<2?(H(),Me(G,{key:0},{overlay:C(()=>[u(W,null,{default:C(()=>[u(w,{key:"addDoc",onClick:A(T=>s(k),["stop","prevent"])},{default:C(()=>[_t]),_:2},1032,["onClick"]),u(w,{key:"importDoc",onClick:A(T=>y(k),["stop","prevent"])},{default:C(()=>[yt]),_:2},1032,["onClick"])]),_:2},1024)]),default:C(()=>[_("span",{class:"action-btn",onClick:v[3]||(v[3]=A(()=>{},["stop"]))},[u(J(ye))])]),_:2},1024)):z("",!0),u(G,null,{overlay:C(()=>[u(W,null,{default:C(()=>[u(w,{key:"copyLink",onClick:A(T=>U(k),["stop","prevent"])},{default:C(()=>[oe(" 复制链接"),mt]),_:2},1032,["onClick"]),u(w,{key:"copyDoc",onClick:A(T=>K(k),["stop","prevent"])},{default:C(()=>[ht]),_:2},1032,["onClick"]),u(w,{key:"exportDoc",onClick:A(T=>F(k),["stop","prevent"])},{default:C(()=>[vt]),_:2},1032,["onClick"]),u(w,{key:"deleteDoc",onClick:A(T=>j(k),["stop","prevent"])},{default:C(()=>[Ct]),_:2},1032,["onClick"])]),_:2},1024)]),default:C(()=>[_("span",{class:"action-btn",onClick:v[4]||(v[4]=A(()=>{},["stop"]))},[u(J(Pe))])]),_:2},1024)])],10,ut)]),_:1},8,["expandedKeys","selected-keys","loadedKeys","tree-data","load-data"])])]),u(tt,{ref_key:"uploadDocRef",ref:l,onFileLoaded:I},null,512)])}}},bt=ce(kt,[["__scopeId","data-v-ab74343b"]]),gt={class:"public-library-layout"},Lt={class:"layout-left"},Dt={class:"library-title"},xt=["src"],wt={class:"library-name"},Ht={key:1,class:"publish-status"},Rt={key:0,class:"icon",src:We,alt:""},Vt={key:1,class:"icon",src:Ge,alt:""},Mt={class:"side-directory-wrapper"},Et={class:"layout-body"},$t={__name:"index",setup(g){const $=(e,t)=>{const a=new Blob([e],{type:"text/markdown;charset=utf-8"});Xe.saveAs(a,t)},L=(e,t)=>{{for(let a=0;a<e.length;a++){const n=e[a];if(n.id==t)return n;if(n.children){const i=L(n.children,t);if(i)return i}}return null}},h=(e,t,a=null)=>{for(let n=0;n<e.length;n++){const i=e[n];if(i.id==t)return a;if(i.children){const b=h(i.children,t,i);if(b)return b}}return null};function D(e="无标题文档",t=[]){const a=new Set(t.map(b=>b.title));let n=1,i=`${e}(${n})`;for(;a.has(i);)n++,i=`${e}(${n})`;return i}const p=Fe(),f=Be(),x=le(()=>f.query.library_id),c=Se({type:1,library_intro:"",library_name:"",library_key:"",avatar:""}),o=le(()=>f.query.doc_id),l=E(null),s=E([]),r=E([]),y=E(null),I=le(()=>f.meta.activeMenu||""),U=[{name:"知识库配置",key:"config",icon:"jichupeizhi",path:"/public-library/config",permissions:["4"]},{name:"首页",key:"home",icon:"ai",path:"/public-library/home",permissions:["*"]}],K=e=>{p.push({path:e.path,query:{library_id:f.query.library_id,library_key:c.library_key}})};_e(()=>f.path,e=>{e!=="/public-library/editor"&&(M(),y.value=null)}),o.value&&(r.value=[Number(o.value)]),_e(o,e=>{e&&(r.value=[Number(o.value)])});const F=e=>{let t={library_key:c.library_key,pid:e?e.id:0};return Le(t).then(a=>{let n=a.data||[];n.forEach(i=>{i.id=i.id*1,i.pid=i.pid*1,i.key=i.id,i.level=e?e.level+1:0,i.sort=i.sort*1,i.children_num=i.children_num*1,i.children=[],i.hasLoaded=!1,i.isLeaf=i.children_num==0}),e?(e.hasLoaded=!0,e.children=n,s.value=[...s.value]):s.value=n})},j=e=>new Promise(t=>{if(e.dataRef.hasLoaded){t();return}F(e.dataRef).then(()=>{t()})}),M=()=>{r.value=[]},N=E(null),ne=e=>{N.value.show({doc_key:e.doc_key})},d=(e,t)=>{let a=t.title;a.endsWith(".md")&&(a=a.replace(/\.md$/i,""));let n={library_key:c.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:"0",title:a,content:t.content,sort:0};ie(n).then(i=>{te.success("导入成功"),n.id=i.data.doc_id,n.sort=i.data.sort;let b=e?e.dataRef:null;w(b,n)})},v=e=>{let t="无标题文档";e?t=D("无标题文档",e.dataRef.children):t=D("无标题文档",s.value);let a={library_key:c.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:0,title:t,content:"# 无标题文档",sort:0};ie(a).then(n=>{te.success("添加成功"),a.id=n.data.doc_id,a.sort=n.data.sort;let i=e?e.dataRef:null;w(i,a)})},V=e=>{pe({library_key:c.library_key,doc_id:e.dataRef.id}).then(t=>{let a={library_key:c.library_key,doc_id:"",doc_type:"4",pid:t.data.pid*1,title:t.data.title+"(副本)",content:t.data.content,sort:0};ie(a).then(n=>{te.success("复制成功"),a.id=n.data.doc_id,a.sort=n.data.sort;let i=L(s.value,a.pid);w(i,a)})})},w=(e,t)=>{t.children_num=0,t.children=[],t.hasLoaded=!1,t.key=t.id,t.isLeaf=!0,t.level=0,e?(t.level=e.level+1,e.children_num++,e.isLeaf=!1,e.hasLoaded?(e.children.unshift(t),se(()=>{l.value.toggleExpand(e.id,!0)})):(e.hasLoaded=!1,se(()=>{l.value.toggleExpand(e.id,!0)}))):(t.level=0,s.value.unshift(t)),O(t)},W=e=>{De.confirm({title:"删除文档",icon:u(xe),content:`确定删除文档 ${e.dataRef.title} 吗？`,onOk(){G(e)},onCancel(){}})},G=e=>{we({library_key:c.library_key,doc_id:e.dataRef.id}).then(()=>{te.success("删除成功");let t=L(s.value,e.dataRef.pid);if(t){let a=t.children.findIndex(n=>n.id==e.dataRef.id);if(t.children_num--,t.isLeaf=t.children_num==0,t.children.splice(a,1),I.value!="doc")return;t.children.length>0?O(t.children[0]):s.value.length>0?O(s.value[0]):(y.value=null,p.replace({path:"/public-library/home",query:{library_id:x.value,library_key:c.library_key}}))}else{let a=s.value.findIndex(n=>n.id==e.dataRef.id);if(s.value.splice(a,1),I.value!="doc")return;s.value.length>0?O(s.value[0]):(y.value=null,p.replace({path:"/public-library/home",query:{library_id:x.value,library_key:c.library_key}}))}})},ae=e=>{pe({library_key:c.library_key,doc_id:e.dataRef.id}).then(t=>{let{content:a,title:n}=t.data;n.endsWith(".md")||(n+=".md"),$(a,n)})},O=e=>{y.value=e,r.value=[e.id],f.path=="/public-library/editor"?p.replace({path:"/public-library/editor",query:{library_id:x.value,library_key:c.library_key,doc_id:e.id}}):p.push({path:"/public-library/editor",query:{library_id:x.value,library_key:c.library_key,doc_id:e.id}})},k=()=>{},T=e=>{const t=[...s.value],a=e.node,n=e.dragNode,i=a.key,b=n.key,P=a.pos.split("-"),ue=e.dropPosition-Number(P[P.length-1]),X=(m,B,ee=0,q)=>{for(let S=0;S<m.length;S++){if(m[S].key===B){q(m[S],S,ee,m);break}m[S].children&&X(m[S].children,B,ee+1,q)}};let Y;if(X(t,b,0,(m,B,ee,q)=>{Y={...m},q.splice(B,1)}),n.parent&&n.parent.node.children_num>0&&(n.parent.node.children_num--,n.parent.node.isLeaf=n.parent.node.children_num==0),!e.dropToGap)X(t,i,0,m=>{m.children=m.children||[],m.children_num++,m.isLeaf=!1,m.children.unshift(Y)});else if((e.node.children||[]).length>0&&e.node.expanded&&ue===1)X(t,i,0,m=>{m.children=m.children||[],m.children_num++,m.isLeaf=!1,m.children.unshift(Y)});else{let m=[],B=0;X(t,i,0,(ee,q,S,be)=>{m=be,B=q}),ue===-1?m.splice(B,0,Y):m.splice(B+1,0,Y)}s.value=t,ve(n,a)},ve=(e,t)=>{let a=h(s.value,e.dataRef.id);e.dataRef.pid=a?a.id:0;let n={library_key:c.library_key,doc_id:e.dataRef.id,pid:e.dataRef.pid,level:a?a.level+1:0,sort:0},i=a?a.children:s.value,b=-1;i.length>1&&(b=i.findIndex(P=>P.id==e.dataRef.id),b===0?(n.top=1,n.sort=i[b+1].sort):n.sort=i[b-1].sort),He(n).then(P=>{e.dataRef.sort=P.data.sort,t.pid!=n.pid&&(t.dataRef.children.length>=t.dataRef.children_num?(t.dataRef.hasLoaded=!0,l.value.addLoadedKey(t.id),l.value.toggleExpand(t.id,!0)):F(t.dataRef).then(()=>{i[b]=e.dataRef,se(()=>{t.dataRef.hasLoaded=!0,l.value.toggleExpand(t.id,!0)})}))})},Ce=e=>{let t=L(s.value,e.id);t.title=e.title,t.is_draft=e.is_draft,y.value=t},ke=async()=>{try{const e=await Ke({id:x.value});e.data.avatar||(e.data.avatar=Re),Object.assign(c,e.data)}catch(e){}};return Ae(()=>{ke().then(()=>{F()})}),(e,t)=>{const a=Ie("router-view");return H(),R("div",gt,[_("div",Lt,[_("div",Dt,[c.avatar?(H(),R("img",{key:0,class:"library-logo",src:c.avatar,alt:""},null,8,xt)):z("",!0),_("span",wt,de(c.library_name),1),y.value?(H(),R("span",Ht,[y.value.is_draft==1?(H(),R("img",Rt)):z("",!0),y.value.is_draft==0?(H(),R("img",Vt)):z("",!0)])):z("",!0)]),u(et,{menus:U,active:I.value,onMenuClick:K},null,8,["active"]),_("div",Mt,[u(bt,{ref_key:"docTreeRef",ref:l,list:s.value,"load-data":j,selectedKeys:r.value,onImportDoc:d,onAddDoc:v,onDeleteDoc:W,onCopyDoc:V,onCopyLink:ne,onExportDoc:ae,onDragenter:k,onDrop:T,onSelect:O},null,8,["list","selectedKeys"])])]),_("div",Et,[u(a,{onChangeDoc:Ce})]),u(ze,{ref_key:"shareModalRef",ref:N},null,512)])}}},V2=ce($t,[["__scopeId","data-v-58153212"]]);export{V2 as default};
