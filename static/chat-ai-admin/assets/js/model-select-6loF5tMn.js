import{b as w,$ as A,a0 as C}from"../../index-UhR4yadr.js";import{c as V}from"./index-cS6xwXeR.js";import{e as S,w as I,x as G,M as _,Q as y,S as c,N as M,F as T,$ as x,k as q,W as E,Z as L,Y as F}from"./vue-chunks-DWnFCQSz.js";import{_ as J}from"./index-DrSPxL4Q.js";import{S as X,a as b,_ as z}from"./index-9VXz7HRC.js";const K=["src"],Q={__name:"model-select",props:{modelType:{type:String,validator:f=>["TEXT EMBEDDING","RERAN","LLM"].includes(f),required:!0},isOffline:{type:Boolean,default:!1},modeName:{type:[String,Number],default:""},modeId:{type:[String,Number],default:""},placeholder:{type:String,default:"请选择嵌入模型"}},emits:["change","update:modeName","update:modeId","loaded"],setup(f,{emit:O}){function B(t,n,a){const l=new Set(t.map(d=>d.model_define));return n.filter(d=>{let m=d[a];l.has(m)&&t.filter(e=>{if(e.model_define==m)return e.children=C(e.children,d.children),!1})}),t}const p=O,o=f,s=S();I([()=>o.modeId,()=>o.modeName],([t,n])=>{!t||!n||(s.value=t+"-"+n)});const h=S([]),D=["azure","ollama","xinference","openaiAgent"],R=(t,n)=>{p("update:modeName",n.modelName),p("update:modeId",n.modelId),p("change",t,n)},v=()=>{V({model_type:o.modelType,is_offline:o.isOffline}).then(t=>{let a=(t.data||[]).map(l=>{let{model_define:d,deployment_name:m,id:e}=l.model_config,i=`${d}-${m||""}-${e}`,r=[],N=[];o.modelType=="TEXT EMBEDDING"?r=l.model_info.vector_model_list:o.modelType=="RERANK"?r=l.model_info.rerank_model_list:o.modelType=="LLM"&&(r=l.model_info.llm_model_list);for(let g=0;g<r.length;g++){let u=r[g],k=u,$=e+"-"+u;D.indexOf(l.model_config.model_define)>-1&&l.model_config.deployment_name&&(k=l.model_config.deployment_name),N.push({key:e+"_"+u,label:k,name:u,deployment_name:m,model_config_id:e,model_define:d,value:$})}return{key:i,model_define:d,children:N,model_config_id:e,deployment_name:m,name:l.model_info.model_name,icon:l.model_info.model_icon_url}});a=B(A(a,"model_define"),a,"model_define"),a.length===0&&(s.value="无可用模型"),h.value=[...a],p("loaded",JSON.parse(JSON.stringify(a)))})};return I(()=>o.isOffline,()=>{v()}),G(()=>{v(),o.modeId&&o.modeName&&(s.value=o.modeId+"-"+o.modeName)}),(t,n)=>{const a=J,l=X,d=b,m=z;return _(),y(m,{value:s.value,"onUpdate:value":n[0]||(n[0]=e=>s.value=e),placeholder:f.placeholder,onChange:R,style:{width:"100%"}},{default:c(()=>[(_(!0),M(T,null,x(h.value,e=>(_(),y(d,{key:e.key},{label:c(()=>[q(a,{align:"center",gap:6},{default:c(()=>[E("img",{class:"model-icon",src:e.icon,alt:""},null,8,K),E("span",null,L(e.name),1)]),_:2},1024)]),default:c(()=>[(_(!0),M(T,null,x(e.children,i=>(_(),y(l,{value:i.value,modelId:i.model_config_id,modelName:i.name,key:i.key},{default:c(()=>[F(L(i.label),1)]),_:2},1032,["value","modelId","modelName"]))),128))]),_:2},1024))),128))]),_:1},8,["value","placeholder"])}}},P=w(Q,[["__scopeId","data-v-5c6a8e90"]]);export{P as M};
