import{a as de,_ as ue,T as me}from"./empty-BtQ55gr9.js";import{b as G,k as L,d as ne,B as pe,cA as ve,M as fe}from"../../index-DJqZYlN8.js";import{M as i,N as _,a1 as ae,a2 as le,W as t,b as he,w as ie,B as W,e as S,a7 as F,F as C,k as n,S as l,$ as B,Q,Y as g,Z as w,a6 as M,G as re,H as ge,u as A,aa as ce,ai as ke,a0 as be,V as Y}from"./vue-chunks-Dpmhapcm.js";import{a as ye}from"./index-CQKu1YIs.js";import{M as xe}from"./model-select-BawuzGA8.js";import{F as Z,_ as we}from"./index-BearFCS_.js";import"./index-9XFVXge0.js";import{I as ee}from"./Input-k3gxptQd.js";import{Q as qe}from"./QuestionCircleOutlined-D2lOE5qu.js";import{S as $e,_ as Pe}from"./index-DT9vq-9c.js";import{_ as Ie}from"./index-Ci9XZtrG.js";import{_ as Ce}from"./index-Bpgeg3Jc.js";import{_ as Se}from"./index-BY-bgrX3.js";import{_ as Ue}from"./index-DfSExCBV.js";import{u as se}from"./index-DXiWv6EO.js";import{E as Fe}from"./Password-DASsPHld.js";import{D as je,U as De}from"./index-O15OSOpm.js";import{_ as ze}from"./TextArea-DEZsPG5C.js";const Ne={},te=k=>(ae("data-v-5569d09d"),k=k(),le(),k),Le={class:"empty-box"},Me=te(()=>t("img",{src:de,alt:""},null,-1)),Oe=te(()=>t("div",{class:"title"},"暂无分段",-1)),Ee=te(()=>t("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)),Te=[Me,Oe,Ee];function Qe(k,j){return i(),_("div",Le,Te)}const to=G(Ne,[["render",Qe],["__scopeId","data-v-5569d09d"]]),r=k=>(ae("data-v-82705abc"),k=k(),le(),k),Be={class:"segmentation-setting"},Ae={class:"setting-items"},Ve={class:"setting-item intelligent-setting active"},Re={class:"setting-item-body"},Je=r(()=>t("div",{class:"sub-setting-item-name"},"文件切分",-1)),Ge={key:0,class:"custom-setting-form excel-qa-form"},Ke={class:"form-item"},He={class:"form-item-box"},We=r(()=>t("div",{class:"form-item-label"},"问题所在列：",-1)),Xe={class:"form-item-body"},Ye={class:"form-item-box"},Ze=r(()=>t("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),et={class:"form-item-body"},tt={class:"form-item-box"},st=r(()=>t("div",{class:"form-item-label"},"答案所在列：",-1)),ot={class:"form-item-body"},nt=r(()=>t("div",{class:"sub-setting-item-name"},"索引方式",-1)),at={class:"indexing-methods-box"},lt={class:"list-title-block"},it=r(()=>t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),rt={class:"list-title-block"},ct=r(()=>t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),_t=r(()=>t("div",{class:"btn-box-block"},null,-1)),dt={class:"btn-box-block"},ut={key:1,class:"custom-setting-form excel-qa-form"},mt={class:"form-item"},pt={class:"form-item-box"},vt=r(()=>t("div",{class:"form-item-label"},"问题开始标识符：",-1)),ft={class:"form-item-body"},ht={class:"form-item-box"},gt=r(()=>t("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),kt={class:"form-item-body"},bt={class:"form-item-box"},yt=r(()=>t("div",{class:"form-item-label"},"答案开始标识符：",-1)),xt={class:"form-item-body"},wt=r(()=>t("div",{class:"sub-setting-item-name"},"索引方式",-1)),qt={class:"indexing-methods-box"},$t={class:"list-title-block"},Pt=r(()=>t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),It={class:"list-title-block"},Ct=r(()=>t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),St=r(()=>t("div",{class:"btn-box-block"},null,-1)),Ut={class:"btn-box-block"},Ft={key:0,class:"custom-setting-form subsection-form"},jt={class:"form-item"},Dt=r(()=>t("div",{class:"form-item-label"},"分段方式：",-1)),zt={class:"form-item-body"},Nt=r(()=>t("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),Lt={class:"select-card-box"},Mt={class:"card-title"},Ot=r(()=>t("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),Et={class:"card-title"},Tt=r(()=>t("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),Qt={class:"form-item",style:{"margin-bottom":"18px"}},Bt=r(()=>t("div",{class:"form-item-label"},"分段标识符：",-1)),At={class:"form-item-body"},Vt={class:"form-item"},Rt=r(()=>t("div",{class:"form-item-label"},"分段最大长度：",-1)),Jt={class:"form-item-body"},Gt=r(()=>t("span",{class:"unit-text"},"字符",-1)),Kt={class:"form-item"},Ht=r(()=>t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),Wt={class:"form-item-body"},Xt=r(()=>t("span",{class:"unit-text"},"字符",-1)),Yt={class:"form-item",style:{"margin-bottom":"16px"}},Zt=r(()=>t("div",{class:"form-item-label"},"嵌入模型：",-1)),es={class:"form-item-body"},ts={class:"form-item",style:{"margin-bottom":"16px"}},ss={class:"form-item-label"},os={class:"form-item-body"},ns={class:"form-item"},as=r(()=>t("div",{class:"form-item-label"},"分段最大长度：",-1)),ls={class:"form-item-body"},is=r(()=>t("span",{class:"unit-text"},"字符",-1)),rs={class:"form-item"},cs=r(()=>t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),_s={class:"form-item-body"},ds=r(()=>t("span",{class:"unit-text"},"字符",-1)),us={class:"btn-box-block"},ms={class:"btn-box-block"},ps={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1}},emits:["change","validate","save"],setup(k,{expose:j,emit:U}){const v=Z.useForm,m=U,d=k;he(()=>d.libFileInfo.doc_type=="1"&&(d.libFileInfo.file_ext=="docx"||d.libFileInfo.file_ext=="html")),ie(d,p=>{let e=p.libFileInfo,I=e.separators_no?e.separators_no.split(","):[11,12];s.separators_no=I.map(y=>+y),s.chunk_size=+e.chunk_size||512,s.chunk_overlap=+e.chunk_overlap||50,s.question_lable=e.question_lable,s.similar_label=e.similar_label,s.answer_lable=e.answer_lable,s.question_column=e.question_column||void 0,s.answer_column=e.answer_column||void 0,s.similar_column=e.similar_column||void 0,s.qa_index_type=+e.qa_index_type,s.enable_extract_image=e.enable_extract_image=="true",s.chunk_type=+e.chunk_type,s.semantic_chunk_size=+e.semantic_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(I=e.normal_chunk_default_separators_no?e.normal_chunk_default_separators_no.split(","):[11,12],s.separators_no=I.map(y=>+y),s.chunk_size=+e.normal_chunk_default_chunk_size||512,s.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,s.chunk_type=+e.default_chunk_type,s.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=e.default_use_model,s.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),s.is_qa_doc=d.library_type==2?1:0});const s=W({separators_no:[],chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:""});let c={};setTimeout(()=>{c=JSON.parse(JSON.stringify(s))},500);const z=S([]),O=p=>{z.value=p},q=()=>{Object.assign(s,c)},$=()=>{m("save")},P=W({question_lable:[{message:"请输入问题开始标识符",validator:async(p,e)=>s.is_qa_doc==1&&d.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(p,e)=>s.is_qa_doc==0&&s.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(p,e)=>s.is_qa_doc==1&&d.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(p,e)=>d.mode!=1&&s.is_qa_doc==0&&e.length==0&&s.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(p,e)=>{if(d.mode!=1&&s.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],chunk_overlap:[{validator:async(p,e)=>d.mode!=1&&s.chunk_type==1&&e>parseInt(s.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(p,e)=>d.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(p,e)=>d.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:K,validate:V,validateInfos:D}=v(s,P),a=S(!1),b=()=>{a.value=!0,f()},f=(p=!0)=>{let e=ce(s);V().then(()=>{m("change",{...e}),m("validate","")}).catch(I=>{const{errorFields:y}=I;if(y.length>0){p&&y[0].name,L.error(y[0].errors[0]),m("validate",y[0].errors[0]),a.value=!1;return}m("validate",""),m("change",{...e})})};let h=null;const u=()=>{h&&(clearTimeout(h),h=null),h=setTimeout(()=>{f()},500)},N=S([]);(()=>{ye().then(p=>{N.value=p.data||[]})})();const E=p=>{p!=s.qa_index_type&&(s.qa_index_type=p,f())};return j({formState:s,reLoading:a,reChange:b}),(p,e)=>{const I=$e,y=Pe,x=ne,R=pe,X=ee,J=Ie,T=Ce,_e=Se;return i(),_("div",Be,[t("div",Ae,[t("div",Ve,[t("div",Re,[F("",!0),s.is_qa_doc==1?(i(),_(C,{key:1},[Je,d.mode==1?(i(),_("div",Ge,[t("div",Ke,[t("div",He,[We,t("div",Xe,[n(y,{value:s.question_column,"onUpdate:value":e[2]||(e[2]=o=>s.question_column=o),onChange:u,placeholder:"请选择列名",style:{width:"100%"}},{default:l(()=>[(i(!0),_(C,null,B(d.excellQaLists,o=>(i(),Q(I,{value:o.value,key:o.value},{default:l(()=>[g(w(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",Ye,[Ze,t("div",et,[n(y,{allowClear:"",value:s.similar_column,"onUpdate:value":e[3]||(e[3]=o=>s.similar_column=o),onChange:u,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:l(()=>[(i(!0),_(C,null,B(d.excellQaLists,o=>(i(),Q(I,{value:o.value,key:o.value},{default:l(()=>[g(w(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",tt,[st,t("div",ot,[n(y,{value:s.answer_column,"onUpdate:value":e[4]||(e[4]=o=>s.answer_column=o),onChange:u,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:l(()=>[(i(!0),_(C,null,B(d.excellQaLists,o=>(i(),Q(I,{value:o.value,key:o.value},{default:l(()=>[g(w(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),nt,t("div",at,[t("div",{class:M(["list-item",{active:s.qa_index_type==1}]),onClick:e[5]||(e[5]=o=>E(1))},[n(x,{class:"check-icon",name:"check-arrow-filled"}),t("div",lt,[n(x,{name:"file-search"}),g(" 问题与答案一起生成索引 ")]),it],2),t("div",{class:M(["list-item",{active:s.qa_index_type==2}]),onClick:e[6]||(e[6]=o=>E(2))},[n(x,{class:"check-icon",name:"check-arrow-filled"}),t("div",rt,[n(x,{name:"comment-search"}),g(" 仅对问题生成索引 ")]),ct],2),_t,t("div",dt,[n(R,{type:"primary",block:"",onClick:$},{default:l(()=>[g("保存")]),_:1})])])])):(i(),_("div",ut,[t("div",mt,[t("div",pt,[vt,t("div",ft,[n(X,{placeholder:"请输入标识符",value:s.question_lable,"onUpdate:value":e[7]||(e[7]=o=>s.question_lable=o),onChange:u},null,8,["value"])])]),t("div",ht,[gt,t("div",kt,[n(X,{placeholder:"请输入标识符",value:s.similar_label,"onUpdate:value":e[8]||(e[8]=o=>s.similar_label=o),onChange:u},null,8,["value"])])]),t("div",bt,[yt,t("div",xt,[n(X,{placeholder:"请输入标识符",value:s.answer_lable,"onUpdate:value":e[9]||(e[9]=o=>s.answer_lable=o),onChange:u},null,8,["value"])])])]),wt,t("div",qt,[t("div",{class:M(["list-item",{active:s.qa_index_type==1}]),onClick:e[10]||(e[10]=o=>E(1))},[n(x,{class:"check-icon",name:"check-arrow-filled"}),t("div",$t,[n(x,{name:"file-search"}),g(" 问题与答案一起生成索引 ")]),Pt],2),t("div",{class:M(["list-item",{active:s.qa_index_type==2}]),onClick:e[11]||(e[11]=o=>E(2))},[n(x,{class:"check-icon",name:"check-arrow-filled"}),t("div",It,[n(x,{name:"comment-search"}),g(" 仅对问题生成索引 ")]),Ct],2),St,t("div",Ut,[n(R,{type:"primary",block:"",onClick:$},{default:l(()=>[g("保存")]),_:1})])])]))],64)):(i(),_(C,{key:2},[d.mode!=1?(i(),_("div",Ft,[t("div",jt,[Dt,t("div",zt,[Nt,t("div",Lt,[t("div",{class:M(["select-card-item",{active:s.chunk_type==1}]),onClick:e[12]||(e[12]=o=>s.chunk_type=1)},[n(x,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Mt,[n(x,{name:"ordinary-segmentation",class:"title-icon"}),g(" 普通分段 ")]),Ot],2),t("div",{class:M(["select-card-item",{active:s.chunk_type==2}]),onClick:e[13]||(e[13]=o=>s.chunk_type=2)},[n(x,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Et,[n(x,{name:"semantic-segmentation",class:"title-icon"}),g(" 语义分段 ")]),Tt],2)])])]),s.chunk_type==1?(i(),_(C,{key:0},[t("div",Qt,[Bt,t("div",At,[n(y,{placeholder:"请选择",style:{width:"100%"},mode:"multiple",value:s.separators_no,"onUpdate:value":e[14]||(e[14]=o=>s.separators_no=o)},{default:l(()=>[(i(!0),_(C,null,B(N.value,o=>(i(),Q(I,{value:o.no,key:o.no},{default:l(()=>[g(w(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),n(T,{gap:16},{default:l(()=>[t("div",Vt,[Rt,t("div",Jt,[n(T,{align:"center",gap:8},{default:l(()=>[n(J,{style:{flex:"1"},value:s.chunk_size,"onUpdate:value":e[15]||(e[15]=o=>s.chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Gt]),_:1})])]),t("div",Kt,[Ht,t("div",Wt,[n(T,{align:"center",gap:8},{default:l(()=>[n(J,{style:{flex:"1"},value:s.chunk_overlap,"onUpdate:value":e[16]||(e[16]=o=>s.chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Xt]),_:1})])])]),_:1})],64)):F("",!0),re(t("div",null,[t("div",Yt,[Zt,t("div",es,[n(xe,{modelType:"TEXT EMBEDDING",modeName:s.semantic_chunk_use_model,"onUpdate:modeName":e[17]||(e[17]=o=>s.semantic_chunk_use_model=o),modeId:s.semantic_chunk_model_config_id,"onUpdate:modeId":e[18]||(e[18]=o=>s.semantic_chunk_model_config_id=o),style:{width:"100%"},onLoaded:O},null,8,["modeName","modeId"])])]),t("div",ts,[t("div",ss,[g(" 分段阈值 "),n(_e,null,{title:l(()=>[g("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:l(()=>[n(A(qe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),g("： ")]),t("div",os,[n(J,{style:{width:"100%"},value:s.semantic_chunk_threshold,"onUpdate:value":e[19]||(e[19]=o=>s.semantic_chunk_threshold=o),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),n(T,{gap:16},{default:l(()=>[t("div",ns,[as,t("div",ls,[n(T,{align:"center",gap:8},{default:l(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_size,"onUpdate:value":e[20]||(e[20]=o=>s.semantic_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),is]),_:1})])]),t("div",rs,[cs,t("div",_s,[n(T,{align:"center",gap:8},{default:l(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_overlap,"onUpdate:value":e[21]||(e[21]=o=>s.semantic_chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),ds]),_:1})])])]),_:1})],512),[[ge,s.chunk_type==2]]),t("div",us,[n(R,{onClick:q,style:{flex:"1"}},{default:l(()=>[g("重置")]),_:1}),n(R,{onClick:b,loading:a.value,style:{flex:"1"},type:"primary",ghost:""},{default:l(()=>[g("生成分段预览")]),_:1},8,["loading"])]),t("div",ms,[d.hideSave?F("",!0):(i(),Q(R,{key:0,type:"primary",block:"",onClick:$},{default:l(()=>[g("保存")]),_:1}))])])):F("",!0)],64))])])])])}}},so=G(ps,[["__scopeId","data-v-82705abc"]]),vs={class:"document-fragment"},fs={class:"fragment-header"},hs={class:"fragment-info"},gs={class:"fragment-number"},ks={key:0,class:"fragment-title"},bs={class:"fragment-content-lenght"},ys={class:"fragment-action"},xs={class:"fragment-content"},ws={key:0,class:"fragment-content"},qs={key:1,class:"fragment-content"},$s={key:2,class:"fragment-content"},Ps={class:"fragment-img"},Is=["src"],Cs={__name:"document-fragment",props:{number:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]}},emits:["edit","delete"],setup(k,{emit:j}){const U=j,v=k,m=()=>{U("edit")},d=()=>{U("delete")};return(s,c)=>{const z=Ue,O=ke("viewer");return i(),_("div",vs,[t("div",fs,[t("div",hs,[t("span",gs,"#"+w(v.number),1),v.title?(i(),_("span",ks,w(v.title),1)):F("",!0),t("span",bs,"共"+w(v.total)+"个字符",1)]),t("div",ys,[t("a",{onClick:m},"编辑"),n(z,{type:"vertical"}),t("a",{onClick:d},"删除")])]),t("div",xs,w(v.content),1),v.question?(i(),_("div",ws,"Q："+w(v.question),1)):F("",!0),v.similar_question_list&&v.similar_question_list.join("")?(i(),_("div",qs," 相似问法："+w(v.similar_question_list.join("/")),1)):F("",!0),v.answer?(i(),_("div",$s,"A："+w(v.answer),1)):F("",!0),re((i(),_("div",Ps,[(i(!0),_(C,null,B(v.images,(q,$)=>(i(),_("img",{key:$,src:q,alt:""},null,8,Is))),128))])),[[O]])])}}},oo=G(Cs,[["__scopeId","data-v-f1b27d1d"]]),Ss={class:"upload-box"},Us={class:"mask-box"},Fs=["src"],oe=3,js={__name:"index",props:{value:{type:[String,Array],default:""}},emits:["update:value"],setup(k,{emit:j}){const U=j,v=S([]),m=S([]),d=S(""),s=k;ie(()=>s.value,a=>{m.value=a},{immediate:!0});const c=a=>{if(!(a.type==="image/jpeg"||a.type==="image/png"))return L.error("只支持JPG、PNG格式的图片"),!1;const f=a.size/1024<1024*2;return m.value.length>=oe?L.error("最多上传三张图片"):f?(se({category:"library_image",file:a}).then(h=>{m.value.push(h.data.link),U("update:value",m.value)}),!1):(L.error("图片大小不能超过2M"),!1)},z=a=>{ve({images:[a]})},O=a=>{m.value.splice(a,1)};let q=!1;const $=async a=>{if(m.value.length>=oe)return L.error("最多上传三张图片");if(!(a.clipboardData&&a.clipboardData.items)){L.error("当前浏览器不支持粘贴上传操作！");return}if(!q)try{if(a.clipboardData||a.originalEvent||window.clipboardData){var b=a.clipboardData||a.originalEvent.clipboardData||window.clipboardData,f=b.items;let h=null;for(let u=0;u<f.length;u++)if(f[u].type.indexOf("image")!==-1){h=f[u].getAsFile();break}d.value="",h?(a.preventDefault(),q=!0,se({category:"library_image",file:h}).then(u=>{q=!1,m.value.push(u.data.link),U("update:value",m.value)})):(error("请粘贴正确图片"),q=!1,d.value="")}}catch{q=!1,L.error("上传失败")}},P=S(null),K=()=>{P.value.focus()},V=()=>{P.value.blur()};function D(a){}return(a,b)=>{const f=ee,h=De;return i(),_("div",Ss,[n(f,{class:"hidden-input",ref_key:"inputRef",ref:P,onPaste:$},null,512),t("div",{onMouseenter:K,onMouseleave:V},[n(h,{fileList:v.value,"onUpdate:fileList":b[1]||(b[1]=u=>v.value=u),name:"file",multiple:!1,"list-type":"picture","show-upload-list":!1,accept:".jpg,.png,.jpeg","before-upload":c,onDrop:D},{default:l(()=>[t("div",{class:"img-list-box",onClick:b[0]||(b[0]=be(()=>{},["stop"]))},[(i(!0),_(C,null,B(m.value,(u,N)=>(i(),_("div",{class:"img-item",key:N},[t("div",Us,[n(A(Fe),{onClick:H=>z(u)},null,8,["onClick"]),n(A(je),{onClick:H=>O(N)},null,8,["onClick"])]),t("img",{src:u,alt:""},null,8,Fs)]))),128))]),t("p",{class:M(["upload-text",{"center-content":m.value.length==0}])}," 支持点击空白处、拖拽、粘贴图片，上传图片不得超过2M，仅支持png、jpg、jpeg格式 ",2)]),_:1},8,["fileList"])],32)])}}},Ds=G(js,[["__scopeId","data-v-0416e0a3"]]),zs={class:"upload-box-wrapper"},Ns={key:0},Ls={__name:"edit-fragment-alert",emits:["ok"],setup(k,{expose:j,emit:U}){const v=U,m=S("1"),d=Z.useForm,s=S(!1),c=W({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),z=W({content:[{message:"请输入分段内容",validator:async(D,a)=>P.value||a?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(D,a)=>P.value?a?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(D,a)=>P.value?a?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:O,validate:q,validateInfos:$}=d(c,z),P=S(!1),K=({title:D,content:a,question:b,answer:f,images:h,similar_question_list:u})=>{c.title=D,c.content=a,c.question=b,c.answer=f,c.images=h||[],c.similar_question_list=u?u.join(`
`):"",P.value=b!="",s.value=!0},V=()=>{q().then(()=>{s.value=!1,v("ok",ce(c))})};return j({open:K}),(D,a)=>{const b=ee,f=we,h=ze,u=ne,N=ue,H=me,E=Z,p=fe;return i(),_("div",null,[n(p,{open:s.value,"onUpdate:open":a[7]||(a[7]=e=>s.value=e),title:"编辑分段",onOk:V,width:"746px"},{default:l(()=>[n(E,{layout:"vertical"},{default:l(()=>[n(f,{label:"分段标题："},{default:l(()=>[n(b,{type:"text",placeholder:"请输入分段标题",value:c.title,"onUpdate:value":a[0]||(a[0]=e=>c.title=e)},null,8,["value"])]),_:1}),P.value?(i(),_(C,{key:0},[n(f,Y({label:"分段问题："},A($).question),{default:l(()=>[n(h,{placeholder:"请输入分段问题",value:c.question,"onUpdate:value":a[1]||(a[1]=e=>c.question=e),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(f,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:l(()=>[n(h,{placeholder:"请输入相似问法",value:c.similar_question_list,"onUpdate:value":a[2]||(a[2]=e=>c.similar_question_list=e),style:{height:"100px"}},null,8,["value"])]),_:1}),n(f,Y({label:"分段答案："},A($).answer),{default:l(()=>[n(h,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":a[3]||(a[3]=e=>c.answer=e),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(i(),Q(f,Y({key:1,label:"分段内容："},A($).content),{default:l(()=>[n(h,{placeholder:"请输入分段内容",value:c.content,"onUpdate:value":a[4]||(a[4]=e=>c.content=e),style:{height:"150px"}},null,8,["value"])]),_:1},16)),n(f,{label:"附件"},{default:l(()=>[t("div",zs,[n(H,{activeKey:m.value,"onUpdate:activeKey":a[5]||(a[5]=e=>m.value=e),size:"small"},{default:l(()=>[n(N,{key:"1"},{tab:l(()=>[t("span",null,[n(u,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),g(" 图片 "),c.images.length?(i(),_("span",Ns,"("+w(c.images.length)+")",1)):F("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Ds,{value:c.images,"onUpdate:value":a[6]||(a[6]=e=>c.images=e)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},no=G(Ls,[["__scopeId","data-v-24be9e8e"]]);export{oo as D,no as E,so as S,Ds as U,to as a};
