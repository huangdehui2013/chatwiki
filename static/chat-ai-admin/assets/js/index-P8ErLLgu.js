import{M as t,N as o,W as e,a6 as V,a7 as f,F as w,$ as R,Z as g,b as ue,e as T,ai as _e,k as a,S as _,Q as z,u as k,Y as x,G as W,H as Te,z as se,aa as te,a1 as Z,a2 as X,w as de,B as Me,a4 as Ie,a5 as ce,a9 as Le,x as Ee,D as Re,a8 as Be}from"./vue-chunks-DWnFCQSz.js";import{u as Ae}from"./useEventBus-92uAASzv.js";import{u as pe}from"./chat-BWktAoWf.js";import{b as H,L as Oe,ba as De,d as oe,b5 as me,f as He,bb as Pe,k as Fe,B as Ne}from"../../index-DQXF0oEW.js";import{_ as re}from"./useIM-C3Fa2W2Z.js";import{S as ge}from"./index-BmqzJuQZ.js";import{Q as O}from"./QuestionCircleOutlined-DN9kmFuV.js";import{_ as ve}from"./index-CUGUQ2OU.js";import{C as je}from"./cu-scroll-BZhESYtD.js";import{_ as Ue}from"./TextArea-Cc6YC843.js";import{_ as he}from"./index-DrtEENos.js";import{a as ze}from"./index-BSnC5LVi.js";import{o as Qe}from"./index-CchQf1sK.js";import{u as Ke}from"./robot-DpRojvB8.js";import{B as Ve,_ as Ge}from"./index-BP0CV08b.js";import{P as Ye}from"./PlusOutlined-CP-yUfey.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-QNUrbcgK.js";import"./Trigger-CC5n-pw8.js";import"./colors-CunZT9q_.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./FormItemContext-D4f_Sq6G.js";import"./statusUtils-B7nMMwz3.js";import"./index-DwY9A703.js";import"./inputProps-Bb0ocHOp.js";import"./index-J-L5YNWa.js";import"./index-DzhuYAPB.js";import"./dropdown-yjtk7CCy.js";import"./Dropdown-Cb2ylcsA.js";import"./RightOutlined-Ctvc7W-t.js";import"./move-DQ5ZIRU6.js";import"./slide-DBTiAtg1.js";import"./index-dYCqajUf.js";import"./shallowequal-C0Ji8tJB.js";import"./collapseMotion-ByInPrfq.js";import"./DownOutlined-Bq0bLGm4.js";const Je={class:"guess-you-want"},We={class:"message-tabs"},Ze={key:1,class:"v-line"},Xe={key:0,class:"message-menus"},et=["onClick"],tt={key:1,class:"message-menus"},st=["onClick"],ot={__name:"guess-you-want",props:{item:{type:Object,default:()=>{}},common_question_list:{type:Object,default:()=>[]},enable_common_question:{type:Boolean,default:!1}},emits:["clickMeun"],setup(u,{emit:M}){const y=M,s=u,v=(b,c)=>{b.question_tabkey=c},$=b=>{y("clickMeun",b)};return(b,c)=>(t(),o("div",Je,[e("div",We,[s.item.guess_you_want?(t(),o("div",{key:0,onClick:c[0]||(c[0]=i=>v(s.item,1)),class:V(["tab-item",{active:s.item.question_tabkey==1}])}," 猜你想问 ",2)):f("",!0),s.item.guess_you_want&&s.common_question_list&&s.enable_common_question?(t(),o("div",Ze)):f("",!0),s.common_question_list&&s.enable_common_question?(t(),o("div",{key:2,onClick:c[1]||(c[1]=i=>v(s.item,2)),class:V(["tab-item",{active:s.item.question_tabkey==2}])}," 常见问题 ",2)):f("",!0)]),s.item.question_tabkey==1?(t(),o("div",Xe,[(t(!0),o(w,null,R(s.item.guess_you_want,(i,n)=>(t(),o("div",{onClick:r=>$(i),class:"menu-item",key:n},g(i),9,et))),128))])):(t(),o("div",tt,[(t(!0),o(w,null,R(u.common_question_list,(i,n)=>(t(),o("div",{onClick:r=>$(i),class:"menu-item",key:n},g(i),9,st))),128))]))]))}},nt=H(ot,[["__scopeId","data-v-9c22a890"]]),fe=u=>(Z("data-v-9e67229e"),u=u(),X(),u),lt={class:"message-list-wrapper"},at={class:"message-list"},it=["id"],ct={class:"itme-left"},rt=["src"],ut={class:"itme-right"},_t={class:"item-body"},dt={class:"message-content"},pt=["id"],mt={class:"itme-left"},gt=["src"],vt={class:"itme-right"},ht=["onClick"],ft={class:"label-text"},yt={class:"item-body"},bt={key:0,class:"thinking-content"},kt={class:"message-content"},$t={class:"message-menus"},wt=["onClick"],qt=["innerHTML"],St={class:"message-menus"},Ct=["onClick"],xt={key:3,class:"message-content"},Tt=["src"],Mt={key:4,class:"message-action-wrap"},It={class:"message-action"},Lt={key:0,class:"action-btn"},Et=fe(()=>e("span",null,"答案来源 ",-1)),Rt=fe(()=>e("span",null,"您可以修改相应文档并重新上传，以调整机器人的回答效果。答案来源仅后台测试时可见。",-1)),Bt={key:1,class:"action-btn"},At=["onClick"],Ot={key:0,class:"file-items"},Dt=["onClick"],Ht={class:"file-name"},Pt={__name:"message-list",props:{messages:{type:Array,default:()=>[]},robotInfo:{type:Object,default:()=>{}}},emits:["clickMsgMeun","scroll","scrollStart","scrollEnd","openPromptLog","openLibrary"],setup(u,{expose:M,emit:y}){const s=y,v=u,$=d=>{d.show_reasoning=!d.show_reasoning},b=ue(()=>v.robotInfo.common_question_list.length?JSON.parse(v.robotInfo.common_question_list):[]),c=d=>{s("clickMsgMeun",d)},i=T(null),n={scrollTop:0,scrollHeight:0,clientHeight:0,scrollStartDiff:60,scrollEndDiff:60,scrollDirection:""};let r=null,m=!1;function B(d){m||(r&&(clearTimeout(r),r=null),r=setTimeout(()=>{n.scrollTop-d.target.scrollTop>0&&(n.scrollDirection="up"),n.scrollTop-d.target.scrollTop<0&&(n.scrollDirection="down"),n.scrollTop=d.target.scrollTop,n.scrollHeight=d.target.scrollHeight,n.clientHeight=d.target.clientHeight,s("scroll",{...n}),Math.abs(n.scrollTop)<=n.scrollStartDiff&&n.scrollDirection==="up"&&F(),Math.abs(n.scrollHeight-n.scrollTop-n.clientHeight)<=n.scrollEndDiff&&n.scrollDirection==="down"&&N()},50))}function F(){v.messages.length!=0&&s("scrollStart",{msg:v.messages[0]})}function N(){v.messages.length!=0&&s("scrollEnd",{msg:v.messages[v.messages.length-1]})}const S=()=>{i.value&&se(()=>{m=!0,i.value.scrollTop=i.value.scrollHeight+1,setTimeout(()=>{n.scrollTop=i.value.scrollTop,m=!1},50)})};function I(d,q){se(()=>{m=!0,q||(q="top");let L=i.value,E=document.querySelector("#msg-"+d);q=="top"?L.scrollTop=E.offsetTop:L.scrollTop=E.offsetTop-L.clientHeight+E.clientHeight,setTimeout(()=>{n.scrollTop=i.value.scrollTop,m=!1},50)})}function G(){n.scrollTop=0,n.scrollDirection=""}function Q(d){return!!(d.quote_file&&d.quote_file.length>0||d.debug&&d.debug.length>0)}function D(d){s("openPromptLog",te(d))}function h(d,q,L){let E=te(d);E.forEach(j=>{j.message_id=L}),s("openLibrary",E,te(q))}return M({scrollToBottom:S,scrollToMessage:I,resetScroll:G}),(d,q)=>{const L=ge,E=oe,j=ve,Y=_e("viewer");return t(),o("div",lt,[e("div",{class:"scroll-box",ref_key:"scrollBoxRef",ref:i,onScroll:B},[e("div",at,[(t(!0),o(w,null,R(v.messages,l=>(t(),o(w,{key:l.uid},[l.is_customer==1?(t(),o("div",{key:0,class:"message-item user-message",id:"msg-"+l.uid},[e("div",ct,[e("img",{class:"user-avatar",src:l.avatar},null,8,rt)]),e("div",ut,[e("div",_t,[e("div",dt,g(l.content),1)])])],8,it)):(t(),o("div",{key:1,class:"message-item robot-message",id:"msg-"+l.uid},[e("div",mt,[a(L,{size:"small",spinning:l.loading},{default:_(()=>[e("img",{class:"robot-avatar",src:l.robot_avatar},null,8,gt)]),_:2},1032,["spinning"])]),e("div",vt,[l.reasoning_content?(t(),o("div",{key:0,class:V(["thinking-label-wrapper",{reasoning_open:l.show_reasoning}])},[e("div",{class:"thinking-label",onClick:C=>$(l)},[l.reasoning_status?(t(),z(k(Oe),{key:0,class:"loading"})):(t(),z(E,{key:1,class:"think-icon",name:"think"})),e("span",ft,g(l.reasoning_status?"深度思考中...":"已完成深度思考"),1),l.reasoning_status?f("",!0):(t(),z(E,{key:2,name:"arrow-down",class:"arrow-down"}))],8,ht),a(j,null,{title:_(()=>[x("在应用设置中关闭推理过程开关，将不再显示推理过程")]),default:_(()=>[a(k(De),{class:"tip"})]),_:1})],2)):f("",!0),e("div",yt,[l.show_reasoning?(t(),o("div",bt,[a(re,{content:l.reasoning_content},null,8,["content"])])):f("",!0),l.msg_type==1?(t(),o(w,{key:1},[W((t(),o("div",kt,[a(re,{content:l.content},null,8,["content"])])),[[Y]]),e("div",$t,[(t(!0),o(w,null,R(l.question,(C,U)=>(t(),o("div",{class:"menu-item",onClick:J=>c(C),key:U},g(C),9,wt))),128))])],64)):f("",!0),l.msg_type==2?(t(),o(w,{key:2},[e("div",{class:"message-content",innerHTML:l.menu_json.content},null,8,qt),e("div",St,[(t(!0),o(w,null,R(l.menu_json.question,(C,U)=>(t(),o("div",{class:"menu-item",onClick:J=>c(C),key:U},g(C),9,Ct))),128))])],64)):f("",!0),l.msg_type==3?(t(),o("div",xt,[W(e("img",{class:"msg-img",src:l.content,alt:""},null,8,Tt),[[Y]])])):f("",!0),Q(l)?W((t(),o("div",Mt,[e("div",It,[l.quote_file&&l.quote_file.length>0?(t(),o("div",Lt,[Et,a(j,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:_(()=>[Rt]),default:_(()=>[a(k(O))]),_:1})])):f("",!0),l.debug&&l.debug.length>0?(t(),o("div",Bt,[e("span",null,[e("a",{onClick:C=>D(l)},"Prompt 日志",8,At)])])):f("",!0)]),l.quote_file&&l.quote_file.length>0?(t(),o("div",Ot,[(t(!0),o(w,null,R(l.quote_file,C=>(t(),o("div",{class:"file-item",key:C.id,onClick:U=>h(l.quote_file,C,l.id)},[e("a",Ht,g(C.file_name),1)],8,Dt))),128))])):f("",!0)],512)),[[Te,!l.question]]):f("",!0)]),(l.guess_you_want&&l.guess_you_want.length||b.value.length&&v.robotInfo.enable_common_question=="true")&&l.question_tabkey>0?(t(),z(nt,{key:1,item:l,enable_common_question:v.robotInfo.enable_common_question=="true",common_question_list:b.value,onClickMeun:c},null,8,["item","enable_common_question","common_question_list"])):f("",!0)])],8,pt))],64))),128))])],544)])}}},Ft=H(Pt,[["__scopeId","data-v-9e67229e"]]),Nt={class:"chat-list-box"},jt=["onClick"],Ut={class:"chat-item-title"},zt={__name:"chat-list",props:{list:{type:Array,default:()=>[]},active:{type:[String,Number],default:""}},emits:["openChat","onScrollEnd"],setup(u,{emit:M}){const y=M,s=u,v=T(null),$=c=>{y("openChat",c)},b=()=>{y("onScrollEnd")};return de(()=>s.list,()=>{se(()=>{v.value.refresh()})}),(c,i)=>{const n=oe;return t(),o("div",Nt,[a(je,{ref_key:"scroller",ref:v,onOnScrollEnd:b},{default:_(()=>[e("div",null,[(t(!0),o(w,null,R(s.list,r=>(t(),o("div",{class:V(["chat-list-item",{active:r.id==s.active}]),onClick:m=>$(r),key:r.id},[a(n,{class:"chat-item-icon",name:"message"}),e("span",Ut,g(r.subject||r.last_chat_message),1)],10,jt))),128))])]),_:1},512)])}}},Qt=H(zt,[["__scopeId","data-v-8a5dd127"]]),Kt=u=>(Z("data-v-47f207c0"),u=u(),X(),u),Vt={class:"message-input-wrapper"},Gt={class:"message-action"},Yt={class:"loading-action"},Jt=["disabled"],Wt=Kt(()=>e("span",null,"发送",-1)),Zt=[Wt],Xt={__name:"message-input",props:{value:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["send","update:value"],setup(u,{emit:M}){const y=M,s=u,v=ue(()=>s.loading||s.value.trim().length===0),$=i=>{y("update:value",i.target.value.trim())},b=i=>{if(i.key==="Enter"&&!i.shiftKey){if(!i.target.value.trim())return;i.preventDefault(),c()}else i.key==="Enter"&&i.shiftKey&&(i.preventDefault(),y("update:value",s.value+`
`))},c=()=>{y("send",s.value.trim())};return(i,n)=>{const r=Ue,m=ge;return t(),o("div",Vt,[a(r,{value:u.value,"auto-size":{minRows:5,maxRows:5},placeholder:"在此输入您想了解的内容，Shift+Enter换行",onChange:$,onKeydown:b},null,8,["value"]),e("div",Gt,[e("span",Yt,[a(m,{spinning:u.loading},null,8,["spinning"])]),u.loading?f("",!0):(t(),o("button",{key:0,class:"send-msg-btn",disabled:v.value,onClick:c},Zt,8,Jt))])])}}},es=H(Xt,[["__scopeId","data-v-47f207c0"]]),P=u=>(Z("data-v-c821359c"),u=u(),X(),u),ts={class:"prompt-log-content"},ss={class:"prompt-log-items"},os={class:"prompt-log-label"},ns=P(()=>e("span",null,"SYSTEM ",-1)),ls={class:"prompt-log-item"},as={class:"prompt-log-items"},is={class:"prompt-log-label"},cs=P(()=>e("span",null,"上下文 ",-1)),rs={class:"prompt-log-items"},us={class:"prompt-log-label"},_s=P(()=>e("span",null,"USER ",-1)),ds={class:"prompt-log-item"},ps={class:"prompt-log-items"},ms={class:"prompt-log-label"},gs=P(()=>e("span",null,"ASSISTANT ",-1)),vs={class:"prompt-log-item"},hs={key:0,class:"prompt-log-items"},fs={class:"prompt-log-label"},ys=P(()=>e("span",null,"Recall time ",-1)),bs={class:"prompt-log-item"},ks={key:1,class:"prompt-log-items"},$s={class:"prompt-log-label"},ws=P(()=>e("span",null,"Request time ",-1)),qs={class:"prompt-log-item"},Ss={class:"prompt-log-items"},Cs={class:"prompt-log-label"},xs=P(()=>e("span",null,"Error ",-1)),Ts={class:"prompt-log-item"},Ms={__name:"prompt-log-alert",setup(u,{expose:M}){const y=T(!1),s=Me({prompt:"",library:[],context_qa:[],cur_question:"",cur_answer:"",error:""}),v=()=>{y.value=!1},$=()=>{s.prompt="",s.library=[],s.context_qa=[],s.cur_question="",s.cur_answer="",s.error="",s.recall_time="",s.request_time=""};return M({open:c=>{$(),s.error=c.error,s.recall_time=c.recall_time?(c.recall_time/1e3).toFixed(2):"",s.request_time=c.request_time?(c.request_time/1e3).toFixed(2):"";let i=c.debug||[];for(let n=0;n<i.length;n++){let r=i[n];r.type=="library"?s.library.push(r.content):r.type=="context_qa"?s.context_qa.push(r):s[r.type]=r.content}y.value=!0}}),(c,i)=>{const n=ve,r=he;return t(),z(r,{class:"prompt-log-alert",open:y.value,"onUpdate:open":i[0]||(i[0]=m=>y.value=m),title:"Prompt 日志",placement:"right",width:"746px",closable:!1},{extra:_(()=>[e("span",{class:"close-btn",onClick:v},[a(k(me))])]),default:_(()=>[e("div",ts,[e("div",ss,[e("div",os,[ns,a(n,null,{title:_(()=>[x("系统提示词和文档分段。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",ls,[e("p",null,g(s.prompt),1)]),(t(!0),o(w,null,R(s.library,(m,B)=>(t(),o("div",{class:"prompt-log-item",key:B},[e("p",null,g(m),1)]))),128))]),e("div",as,[e("div",is,[cs,a(n,null,{title:_(()=>[x("传递的历史提问消息")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),(t(!0),o(w,null,R(s.context_qa,(m,B)=>(t(),o("div",{class:"prompt-log-item",key:B},[e("p",null,"Q："+g(m.question),1),e("p",null,"A："+g(m.answer),1)]))),128))]),e("div",rs,[e("div",us,[_s,a(n,null,{title:_(()=>[x("本次用户的提问")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",ds,[e("p",null,g(s.cur_question),1)])]),e("div",ps,[e("div",ms,[gs,a(n,null,{title:_(()=>[x("语言模型输出的答案")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",vs,[e("p",null,g(s.cur_answer),1)])]),s.recall_time>0?(t(),o("div",hs,[e("div",fs,[ys,a(n,null,{title:_(()=>[x("从知识库中检索到有效分段所需要的时间，包括对分段进行排序时间。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",bs,[e("p",null,g(s.recall_time)+"s",1)])])):f("",!0),s.request_time>0?(t(),o("div",ks,[e("div",$s,[ws,a(n,null,{title:_(()=>[x("从发送问题和上下文信息给大模型到大模型开始返回答案的时间。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",qs,[e("p",null,g(s.request_time)+"s",1)])])):f("",!0),e("div",Ss,[e("div",Cs,[xs,a(n,null,{title:_(()=>[x("报错信息，调用聊天接口报错时会显示。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",Ts,[e("p",null,g(s.error),1)])])])]),_:1},8,["open"])}}},Is=H(Ms,[["__scopeId","data-v-c821359c"]]),Ls={class:"library-info-content"},Es={class:"file-list"},Rs=["onClick"],Bs={class:"document-items"},As={class:"document-item-header"},Os={class:"left-box"},Ds={class:"document-title"},Hs={key:0,class:"document-title"},Ps={class:"document-size"},Fs={class:"document-item-body"},Ns={class:"document-similarity"},js={key:0,class:"document-content"},Us={key:1,class:"document-content"},zs={class:"document-content"},Qs={class:"fragment-img"},Ks=["src"],Vs={__name:"library-info-alert",setup(u,{expose:M}){const y=pe(),{robot:s}=y,v=Ie(),$=T(!1),b=T([]),c=T(null),i=()=>{b.value=[],c.value=null},n=(S,I)=>{i(),b.value=S,c.value=I.id,$.value=!0,B(I)},r=S=>{S.id!=c.value&&(c.value=S.id,B(S))},m=T([]),B=S=>{ze({message_id:S.message_id,file_id:S.id,robot_key:s.robot_key,openid:s.openid}).then(I=>{m.value=I.data||[]})},F=()=>{v.push("/library/preview?id="+c.value)},N=()=>{$.value=!1};return M({open:n}),(S,I)=>{const G=oe,Q=he,D=_e("viewer");return t(),z(Q,{class:"library-info-alert",open:$.value,"onUpdate:open":I[0]||(I[0]=h=>$.value=h),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:_(()=>[e("span",{class:"close-btn",onClick:N},[a(k(me))])]),default:_(()=>[e("div",Ls,[e("div",Es,[(t(!0),o(w,null,R(b.value,h=>(t(),o("div",{class:V(["file-item",{active:c.value==h.id}]),key:h.id,onClick:d=>r(h)},g(h.file_name),11,Rs))),128))]),e("div",Bs,[(t(!0),o(w,null,R(m.value,h=>(t(),o("div",{class:"document-item",key:h.id},[e("div",As,[e("div",Os,[e("span",Ds,"id："+g(h.id),1),h.title?(t(),o("span",Hs,g(h.title),1)):f("",!0),e("span",Ps," 共"+g(h.word_total)+"个字符 ",1)]),e("div",{class:"right-box"},[e("a",{onClick:F},"查看源文档>")])]),e("div",Fs,[e("div",Ns,[x(" 相似度： "),a(G,{name:"similarity",style:{"font-size":"16px"}}),x(g(h.similarity),1)]),h.question?(t(),o("div",js,"Q："+g(h.question),1)):f("",!0),h.answer?(t(),o("div",Us,"A："+g(h.answer),1)):f("",!0),e("div",zs,g(h.content),1),W((t(),o("div",Qs,[(t(!0),o(w,null,R(h.images,(d,q)=>(t(),o("img",{key:q,src:d,alt:""},null,8,Ks))),128))])),[[D]])])]))),128))])])]),_:1},8,["open"])}}},Gs=H(Vs,[["__scopeId","data-v-5d3de97b"]]),Ys=u=>(Z("data-v-7257bb7b"),u=u(),X(),u),Js={class:"chat-page-wrapper"},Ws={class:"chat-page-header"},Zs={class:"breadcrumb-box"},Xs={class:"chat-page"},eo={class:"page-left"},to={class:"page-left-top"},so={class:"page-left-body"},oo=Ys(()=>e("div",{class:"page-left-footer"},null,-1)),no={class:"page-body"},lo={class:"chat-box-body"},ao={style:{"margin-top":"30px"},class:"chat-box-footer"},io={__name:"index",setup(u){const y=ce().query,s=Ke(),{getRobot:v,robotInfo:$}=s,b=Ae(),c=pe(),i=He();let n=!0;const r=T(""),m=T(null),{createChat:B,sendMessage:F,getMyChatList:N,openChat:S,onGetChatMessage:I,changeRobotPrompt:G,$reset:Q}=c,{messageList:D,sendLock:h,myChatList:d,robot:q,dialogue_id:L}=Le(c),E=ce(),j=T(!1),Y=async()=>{if(!r.value)return Pe("请输入消息内容");let p=await Qe({robot_key:q.value.robot_key,openid:q.value.openid,question:r.value,form_ids:q.value.form_ids,dialogue_id:L.value});if(p.data&&p.data.words)return Fe.error(`提交的内容包含敏感词：[${p.data.words.join(";")}] 请修改后再提交`);n=!0,F({message:r.value,global:JSON.stringify(y)}),r.value=""},l=async()=>{n=!0,r.value="";let p=E.query||{},A=i.user_id,K={robot_key:p.robot_key,avatar:p.avatar,name:p.name,nickname:p.nickname,is_background:1,openid:A,dialogue_id:0};le(),await B(K)},C=async p=>{if(L.value==p.dialogue_id)return;n=!0;let K={robot_key:(E.query||{}).robot_key,avatar:p.avatar,name:p.name,nickname:p.nickname,is_background:p.is_background,openid:p.openid,dialogue_id:p.id};le(),await S(K),await I()&&ne()},U=p=>{n=!0,F({message:p})};T(!1);const J=()=>{ne()},ye=async()=>{n=!1;let p=D.value[0].uid;await I()&&ke(p)},be=()=>{},ne=()=>{m.value&&n&&m.value.scrollToBottom()},ke=p=>{m.value&&m.value.scrollToMessage(p)},le=()=>{m.value&&m.value.resetScroll()},$e=()=>{N()},ae=T(null),we=p=>{ae.value.open(p)},ie=T(null),qe=(p,A)=>{ie.value.open(p,A)};return de(()=>D.value,()=>{}),Ee(async()=>{l(),N(),await v(y.id),j.value=!0,b.on("updateAiMessage",J)}),Re(()=>{Q(),b.off("updateAiMessage",J)}),(p,A)=>{const K=Be("router-link"),ee=Ge,Se=Ve,Ce=Ne;return t(),o("div",Js,[e("div",Ws,[e("div",Zs,[a(Se,null,{default:_(()=>[a(ee,null,{default:_(()=>[a(K,{to:"/robot/list"},{default:_(()=>[x("机器人管理")]),_:1})]),_:1}),a(ee,null,{default:_(()=>[x(g(k(q).robot_name),1)]),_:1})]),_:1})])]),e("div",Xs,[e("div",eo,[e("div",to,[a(Ce,{type:"primary",block:"",ghost:"",onClick:l},{default:_(()=>[a(k(Ye)),x(" 新建对话")]),_:1})]),e("div",so,[a(Qt,{list:k(d),active:k(L),onOpenChat:C,onOnScrollEnd:$e},null,8,["list","active"])]),oo]),e("div",no,[e("div",lo,[a(Ft,{ref_key:"messageListRef",ref:m,messages:k(D),robotInfo:k($),onClickMsgMeun:U,onScrollStart:ye,onScrollEnd:be,onOpenPromptLog:we,onOpenLibrary:qe},null,8,["messages","robotInfo"])]),e("div",ao,[a(es,{value:r.value,"onUpdate:value":A[0]||(A[0]=xe=>r.value=xe),onSend:Y,loading:k(h)},null,8,["value","loading"])])]),e("div",null,[f("",!0)])]),a(Is,{ref_key:"promptLogAlertRef",ref:ae},null,512),a(Gs,{ref_key:"libraryInfoAlertRef",ref:ie},null,512)])}}},Yo=H(io,[["__scopeId","data-v-7257bb7b"]]);export{Yo as default};
