import{A as K,b as D,k as T,B as X,d as E}from"../../index-DJqZYlN8.js";import{C as ee}from"./cu-scroll-DUDOFjFZ.js";import{_ as te}from"./empty-DkpCLaix.js";import{k as i,a5 as F,e as k,B as oe,b as se,M as n,N as c,W as e,S as u,Y as f,Q as x,u as L,F as S,$ as R,a6 as ne,a7 as y,Z as v,a1 as Q,a2 as H,a4 as ie}from"./vue-chunks-Dpmhapcm.js";import{n as le}from"./index-CQKu1YIs.js";import{_ as ae}from"./recommendation-AQ4_FPQ9.js";import{c as re}from"./index-Cd8_BaNA.js";import{D as ce}from"./DownOutlined-D5t3juQ7.js";import{U as _e}from"./UpOutlined-BLzSJSuk.js";import{Q as A}from"./QuestionCircleOutlined-D2lOE5qu.js";import{_ as de}from"./TextArea-DEZsPG5C.js";import{_ as ue}from"./index-BY-bgrX3.js";import{_ as me}from"./index-C-z5t1I8.js";import{_ as pe}from"./index-Ci9XZtrG.js";import{_ as ve}from"./index-D7DELBhV.js";import{S as fe,a as he,_ as ke}from"./index-DT9vq-9c.js";import{S as ye}from"./index-2EWY1GCt.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./dayjs-BAOQ3IvD.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-DzhuYAPB.js";import"./FormItemContext-DcHP2mNJ.js";import"./statusUtils-Bnl8Rf7N.js";import"./index-Bn-6W96d.js";import"./Trigger-DcF6kXOl.js";import"./inputProps-B4Qz7YgH.js";import"./index-DGofXs4a.js";import"./colors-CZV0Zir8.js";import"./slide-B4S8cqER.js";import"./CheckOutlined-D8sWUycq.js";import"./SearchOutlined-C4P1S4P5.js";import"./move-B1-eDBNJ.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const be=ge;function j(l){for(var _=1;_<arguments.length;_++){var a=arguments[_]!=null?Object(arguments[_]):{},d=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(a).filter(function(m){return Object.getOwnPropertyDescriptor(a,m).enumerable}))),d.forEach(function(m){xe(l,m,a[m])})}return l}function xe(l,_,a){return _ in l?Object.defineProperty(l,_,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[_]=a,l}var U=function(_,a){var d=j({},_,a.attrs);return i(K,j({},d,{icon:be}),null)};U.displayName="LinkOutlined";U.inheritAttrs=!1;const $e=U,C=l=>(Q("data-v-5c23dca3"),l=l(),H(),l),Le={class:"recall-settings-box"},Oe=C(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),we={class:"form-box"},Se={class:"form-item"},Re={class:"form-item-body"},Ce={class:"form-item"},ze={class:"form-item"},Ne={class:"form-item-label"},qe={class:"form-item-body"},Me={class:"retrieval-mode-items"},Te=["onClick"],Ue={class:"retrieval-mode-title"},Be={class:"title-text"},Ie={key:0,style:{width:"32px"},src:ae,alt:""},Pe={class:"retrieval-mode-desc"},Ve={class:"form-item"},Ae={class:"form-item-label"},je=C(()=>e("span",null,"Top K ",-1)),De={class:"form-item-body"},Ee={class:"number-box"},Fe={class:"number-slider-box"},Qe={class:"number-input-box"},He={key:0,class:"form-item"},Ge={class:"form-item-label"},We=C(()=>e("span",null,"相似度阈值 ",-1)),Ye={class:"form-item-body"},Ze={class:"number-box"},Je={class:"number-slider-box"},Ke={class:"number-input-box"},Xe={class:"form-item"},et={class:"form-item-label"},tt=C(()=>e("span",null,"Rerank模型",-1)),ot={class:"form-item-body"},st=["src"],nt={__name:"recall-testing-form",emits:["save","load"],setup(l,{expose:_,emit:a}){const d=F(),m=k(!1),$=a,g=k(!0),h=k([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=oe({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:d.query.id}),O=se(()=>g.value?h.value.filter(p=>p.value==t.search_type):h.value),N=(p,s)=>{t.rerank_model_config_id=s.rerank_model_config_id},q=p=>{t.search_type=p},r=()=>{if(!t.similarity)return T.error("请输入相似度");if(!t.size)return T.error("请输入分段数");if(!t.question)return T.error("请输入测试问题");let p={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(p.rerank_model_config_id=t.rerank_model_config_id),m.value=!0,$("load"),le(p).then(s=>{$("save",s.data)}).catch(()=>{$("save",[])}).finally(()=>{m.value=!1})},M=k([]);return(()=>{re({model_type:"RERANK"}).then(p=>{let s=p.data||[];M.value=s.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})})(),_({open}),(p,s)=>{const b=de,G=X,B=E,I=ue,P=me,V=pe,W=ve,Y=fe,Z=he,J=ke;return n(),c("div",Le,[Oe,e("div",we,[e("div",Se,[e("div",Re,[i(b,{style:{height:"76px"},value:t.question,"onUpdate:value":s[0]||(s[0]=o=>t.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Ce,[i(G,{loading:m.value,onClick:r,type:"primary",block:""},{default:u(()=>[f("测试")]),_:1},8,["loading"])]),e("div",ze,[e("div",Ne,[e("div",{class:"hover-label",onClick:s[1]||(s[1]=o=>g.value=!g.value)},[f(" 检索模式 "),g.value?(n(),x(L(ce),{key:0})):(n(),x(L(_e),{key:1}))])]),e("div",qe,[e("div",Me,[(n(!0),c(S,null,R(O.value,o=>(n(),c("div",{class:ne(["retrieval-mode-item",{active:t.search_type==o.value}]),key:o.value,onClick:w=>q(o.value)},[t.search_type==o.value?(n(),x(B,{key:0,class:"check-arrow",name:"check-arrow-filled"})):y("",!0),e("div",Ue,[i(B,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",Be,v(o.title),1),o.isRecommendation?(n(),c("img",Ie)):y("",!0)]),e("div",Pe,v(o.desc),1)],10,Te))),128))])])]),e("div",Ve,[e("div",Ae,[je,i(I,null,{title:u(()=>[f("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[i(L(A),{class:"question-icon"})]),_:1})]),e("div",De,[e("div",Ee,[e("div",Fe,[i(P,{class:"custom-slider",value:t.size,"onUpdate:value":s[2]||(s[2]=o=>t.size=o),min:1,max:10},null,8,["value"])]),e("div",Qe,[i(V,{value:t.size,"onUpdate:value":s[3]||(s[3]=o=>t.size=o),min:1,max:10},null,8,["value"])])])])]),t.search_type<=2?(n(),c("div",He,[e("div",Ge,[We,i(I,null,{title:u(()=>[f("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:u(()=>[i(L(A),{class:"question-icon"})]),_:1})]),e("div",Ye,[e("div",Ze,[e("div",Je,[i(P,{class:"custom-slider",value:t.similarity,"onUpdate:value":s[4]||(s[4]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ke,[i(V,{value:t.similarity,"onUpdate:value":s[5]||(s[5]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):y("",!0),e("div",Xe,[e("div",et,[tt,f("   "),i(W,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":s[6]||(s[6]=o=>t.rerank_status=o)},null,8,["checked"])]),e("div",ot,[i(J,{value:t.rerank_use_model,"onUpdate:value":s[7]||(s[7]=o=>t.rerank_use_model=o),placeholder:"请选择Rerank模型",onChange:N,style:{width:"320px"}},{default:u(()=>[(n(!0),c(S,null,R(M.value,o=>(n(),x(Z,{key:o.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:o.icon,alt:""},null,8,st)])]),default:u(()=>[(n(!0),c(S,null,R(o.children,w=>(n(),x(Y,{value:w,rerank_model_config_id:o.id,key:w},{default:u(()=>[e("span",null,v(w),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},it=D(nt,[["__scopeId","data-v-5c23dca3"]]),z=l=>(Q("data-v-d967d2c3"),l=l(),H(),l),lt={class:"recall-testing-box"},at={class:"recall-from-box"},rt={class:"content-list-box"},ct={key:0,class:"empty-box"},_t=z(()=>e("img",{src:te,alt:""},null,-1)),dt=z(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),ut=[_t,dt],mt={class:"top-block"},pt={class:"title"},vt={key:0,class:"ml4"},ft={class:"info-block"},ht=z(()=>e("span",{class:"gray-text"},"来自：",-1)),kt=["onClick"],yt=z(()=>e("span",{class:"v-line"},null,-1)),gt={class:"gray-text"},bt={key:0,class:"content-box"},xt={key:1,class:"content-box"},$t=["innerHTML"],Lt={key:2,class:"loading-box"},Ot={__name:"recall-testing",setup(l){F(),ie();const _=k(!1),a=k(!1),d=k([]),m=h=>{a.value=!1,d.value=h||[]},$=()=>{a.value=!0},g=h=>{window.open(`/#/library/preview?id=${h.file_id}`)};return(h,t)=>{const O=ee,N=E,q=ye;return n(),c("div",lt,[e("div",at,[i(O,null,{default:u(()=>[i(it,{onLoad:$,onSave:m})]),_:1})]),e("div",rt,[_.value||d.value.length===0?(n(),c("div",ct,ut)):(n(),x(O,{key:1},{default:u(()=>[(n(!0),c(S,null,R(d.value,r=>(n(),c("div",{class:"list-item",key:r.id},[e("div",mt,[e("div",pt,[f(" id："+v(r.id)+" ",1),r.title?(n(),c("div",vt,v(r.title),1)):y("",!0),e("span",null,"共"+v(r.word_total)+"个字符",1)])]),e("div",ft,[ht,e("div",{class:"link-text",onClick:M=>g(r)},[i(L($e)),f(" "+v(r.file_name),1)],8,kt),yt,e("span",gt,[f("相似度： "),i(N,{name:"similarity",style:{"font-size":"16px"}}),f(" "+v(r.similarity),1)])]),r.question?(n(),c("div",bt,"Q："+v(r.question),1)):y("",!0),r.answer?(n(),c("div",xt,"A："+v(r.answer),1)):y("",!0),e("div",{class:"content-box",innerHTML:r.content},null,8,$t)]))),128))]),_:1})),a.value?(n(),c("div",Lt,[i(q)])):y("",!0)])])}}},ro=D(Ot,[["__scopeId","data-v-d967d2c3"]]);export{ro as default};
