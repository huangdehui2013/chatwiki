import{M as n,N as v,W as e,k as t,Y as I,Z as C,U as _e,a7 as V,Q as z,S as i,X as st,a6 as Se,e as $,d as G,B,G as ie,H as ae,u as k,aa as W,a1 as Q,a2 as F,a5 as nt,F as P,$ as J,w as de,l as it,x as ke,o as at,j as Ee,ad as fe,af as be,D as lt,b as ye,a0 as ct,z as rt,ac as _t,V as dt,a9 as ut,p as pt}from"./vue-chunks-DkYK5AuX.js";import{b as T,d as le,B as oe,a7 as mt,Z as je,k as X,M as ee,a0 as ve,a8 as vt,a9 as ht,w as ze,e as ft,aa as bt,ab as we,E as yt}from"../../index-CuFzRDH0.js";import{_ as qe}from"./index-B3CceHui.js";import{C as kt}from"./cu-upload-CPwo_2_E.js";import"./index-5PrSJtCq.js";import{I as ue}from"./Input-DlD3j6GW.js";import{_ as Ce}from"./TextArea-DnYx9N6z.js";import{C as Pe}from"./cu-scroll-8SQNC6_m.js";import{e as gt,f as $t}from"./index-aParrWES.js";import{S as Re}from"./index-YK7vZYdC.js";import{_ as xt}from"./index-_b6N6Mhe.js";import{I as wt}from"./index-OoH2nkLj.js";import{D as St}from"./DownloadOutlined-CpROJx0R.js";import{_ as Te,T as Be}from"./index-Cdh10aiJ.js";import{P as Oe}from"./PlusOutlined-C1-JNsax.js";import{D as qt}from"./DownOutlined-xHwfZhzl.js";import{U as Ct}from"./UpOutlined-CmeybyPL.js";import{_ as te}from"./index-D2ta3gNn.js";import{c as Qe}from"./index-njT3lQ6A.js";import{C as It}from"./index-C4ag7WaN.js";import{_ as Fe}from"./index-D3KKcNwj.js";import{_ as Ie}from"./index-BDEXdwqG.js";import{Q as Y}from"./QuestionCircleOutlined-DySDEe_b.js";import{_ as Lt,a as Ut}from"./index-EZhDLtIU.js";import{_ as ce}from"./index-DVObnatt.js";import{S as Et}from"./SearchOutlined-2-sBVYkv.js";import{S as Rt}from"./SyncOutlined-_wzD1Bbw.js";import{C as Je,_ as Ke}from"./index-CvnBYLiG.js";import{_ as Ge}from"./index-B58k5Ecy.js";import{_ as Ot}from"./recommendation-AQ4_FPQ9.js";import{S as At,a as Mt,_ as Dt}from"./index-B9b8kVtF.js";import{R as Vt}from"./RightOutlined-C7Gymx4e.js";import{g as He}from"./index-D3yZBXyo.js";import{_ as jt}from"./empty-CzGZrENG.js";import{d as Ae}from"./vuedraggable.umd-CHQkFABt.js";import"./index-NJlqtEGH.js";import{R as Nt,_ as zt}from"./RadioButton-ouyuU7LQ.js";import{F as Ne,_ as Pt}from"./index-CKa8nflF.js";import{E as Tt}from"./EditOutlined-C_areslC.js";import{_ as Bt}from"./index-DYBz5Hw_.js";import{u as Qt}from"./robot-Cmbvv6Dq.js";import"./axios-Cm0UX6qg.js";import"./qs-g-qVsYXK.js";import"./crypto-js-CsNcoEfj.js";import"./dayjs-CHX5mXCJ.js";import"./FormItemContext-CG4o3aCY.js";import"./index-DpON8wvi.js";import"./Search-BjDfM7wD.js";import"./isPlainObject-B3m2dvNk.js";import"./inputProps-CIG3Q6HA.js";import"./Password-B-_rMC_p.js";import"./index-CNYsll_x.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-TmzmwKXv.js";import"./index-D2p2Kdi5.js";import"./shallowequal-CCVEH32S.js";import"./Trigger-qqJEyN1K.js";import"./collapseMotion-D38MKU2V.js";import"./slide--PTaLm6c.js";import"./Dropdown-DNhcw7uk.js";import"./pick-C3qN9FSY.js";import"./CheckOutlined-Nu5wJEo2.js";import"./Checkbox-CHV8yuJS.js";import"./index-DncdWYWk.js";import"./move-CfeIRdjT.js";import"./responsiveObserve-nm9aPAMw.js";const Ft={class:"edit-box-header"},Jt={class:"left-box"},Kt={class:"edit-box-title"},Gt={key:0},Ht={key:0,class:"title-tip"},Wt={class:"right-box"},Zt={class:"extra-box"},Yt={class:"actions-box"},Xt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(_,{emit:l}){const g=l,m=_,r=s=>{g("edit"),g("update:isEdit",s)},a=()=>{g("save")};return(s,q)=>{const o=le,x=oe,c=qe;return n(),v("div",{class:Se(["edit-box",{"is-edit":_.isEdit}])},[e("div",Ft,[e("div",Jt,[t(o,{class:"edit-box-icon",name:m.iconName},null,8,["name"]),e("span",Kt,[I(C(m.title)+" ",1),s.$slots.icon?(n(),v("span",Gt,[_e(s.$slots,"icon",{},void 0,!0)])):V("",!0)]),s.$slots.tip?(n(),v("span",Ht,[_e(s.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Wt,[e("div",Zt,[_e(s.$slots,"extra",{},()=>[e("div",Yt,[m.isEdit?(n(),z(c,{key:0,gap:8},{default:i(()=>[t(x,{onClick:a,size:"small",type:"primary"},{default:i(()=>[I("保存")]),_:1}),t(x,{onClick:q[0]||(q[0]=w=>r(!1)),size:"small"},{default:i(()=>[I("取消")]),_:1})]),_:1})):(n(),z(x,{key:1,onClick:q[1]||(q[1]=w=>r(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:st({..._.bodyStyle})},[_e(s.$slots,"default",{},void 0,!0)],4)],2)}}},Z=T(Xt,[["__scopeId","data-v-dbe09743"]]),We=_=>(Q("data-v-899bcb03"),_=_(),F(),_),eo={class:"robot-form-box"},to={class:"form-item"},oo=We(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),so={class:"form-item-body robot-name-item"},no={class:"robot-avetar-upload"},io=["src"],ao={class:"robot-name-box"},lo={class:"form-item"},co=We(()=>e("div",{class:"form-item-label"},"简介",-1)),ro={class:"form-item-body"},_o={class:"robot-info-box"},uo={class:"robot-name-box"},po=["src"],mo={class:"robot-name"},vo={class:"robot-intro"},ho={__name:"basic-config",setup(_){const l=$(!1),{robotInfo:g,updateRobotInfo:m}=G("robotInfo"),r=B({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),a=()=>{m({...W(r)}),l.value=!1},s=o=>{let x=o[0];return r.robot_avatar=x,mt(x).then(c=>{r.robot_avatar_url=c}),!1},q=()=>{r.robot_name=g.robot_name,r.robot_intro=g.robot_intro,r.robot_avatar=g.robot_avatar,r.robot_avatar_url=g.robot_avatar_url};return(o,x)=>{const c=ue,w=Ce;return n(),z(Z,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:l.value,"onUpdate:isEdit":x[2]||(x[2]=p=>l.value=p),onSave:a,onEdit:q},{default:i(()=>[ie(e("div",eo,[e("div",to,[oo,e("div",so,[t(kt,{accept:"image/*",onChange:s},{default:i(()=>[e("div",no,[r.robot_avatar_url?(n(),v("img",{key:0,class:"robot-avetar",src:r.robot_avatar_url},null,8,io)):V("",!0)])]),_:1}),e("div",ao,[t(c,{value:r.robot_name,"onUpdate:value":x[0]||(x[0]=p=>r.robot_name=p),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",lo,[co,e("div",ro,[t(w,{rows:3,value:r.robot_intro,"onUpdate:value":x[1]||(x[1]=p=>r.robot_intro=p),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ae,l.value]]),ie(e("div",_o,[e("div",uo,[e("img",{class:"robot-avatar",src:k(g).robot_avatar_url,alt:""},null,8,po),e("span",mo,C(k(g).robot_name),1)]),e("div",vo,C(k(g).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ae,!l.value]])]),_:1},8,["isEdit"])}}},fo=T(ho,[["__scopeId","data-v-899bcb03"]]),Ze=_=>(Q("data-v-896a48d0"),_=_(),F(),_),bo={class:"ai-create-box"},yo={class:"input-box"},ko=Ze(()=>e("span",null,"生成",-1)),go={class:"quick-tags-box"},$o=Ze(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),xo={class:"ai-list-box"},wo={key:0,class:"loading-box"},So={key:0,class:"prompt-list-box"},qo={class:"prompt-list"},Co={class:"prompt-header"},Io={class:"prompt-title"},Lo={class:"prompt-content"},Uo={class:"prompt-list"},Eo={class:"prompt-header"},Ro={class:"prompt-title"},Oo={class:"prompt-content"},Ao={class:"prompt-list"},Mo={class:"prompt-header"},Do={class:"prompt-title"},Vo={class:"prompt-content"},jo={class:"prompt-list"},No={class:"prompt-header"},zo={class:"prompt-title"},Po={class:"prompt-content"},To={class:"prompt-list"},Bo={class:"prompt-header"},Qo={class:"prompt-title"},Fo={class:"prompt-content"},Jo={class:"prompt-header"},Ko={class:"prompt-title"},Go={class:"prompt-content"},Ho={key:1,class:"empty-box"},Wo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(_,{expose:l,emit:g}){const m=je.PRESENTED_IMAGE_SIMPLE,r=$(!1),a=$(!1),s=nt().query,q=g,o=$(""),x=$(!1),c=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],w=$("在上方输入框输入要求，点击生成提示词"),p=()=>{d.value=!1,L.promptStruct=S,o.value="",w.value="在上方输入框输入要求，点击生成提示词",r.value=!0},d=$(!1),S={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},L=B({promptStruct:S}),E=y=>{o.value=y},h=()=>{if(!o.value)return X.error("请输入AI 生成提示词");if(x.value)return X.error("正在生成中...");x.value=!0,gt({id:s.id,demand:o.value}).then(y=>{L.promptStruct=JSON.parse(y.data.promptStruct),d.value=!0}).finally(()=>{x.value=!1}).catch(y=>{d.value=!1,w.value=y.msg})},M=()=>{if(!d.value)return X.error("请先生成提示词");q("handleAiSave",L.promptStruct),r.value=!1};return l({show:p}),(y,u)=>{const j=oe,R=ue,A=le,U=xt,N=Re,H=je,D=Pe,K=ee;return n(),v("div",null,[t(K,{open:r.value,"onUpdate:open":u[1]||(u[1]=b=>r.value=b),title:"AI 生成提示词",width:746},{footer:i(()=>[t(j,{type:"primary",loading:a.value,onClick:M},{default:i(()=>[I("使用该提示")]),_:1},8,["loading"])]),default:i(()=>[e("div",bo,[e("div",yo,[t(R,{style:{width:"100%"},value:o.value,"onUpdate:value":u[0]||(u[0]=b=>o.value=b),size:"large",onPressEnter:h,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:h},[t(A,{name:"ai-mark"}),ko])]),e("div",go,[$o,(n(),v(P,null,J(c,b=>t(U,{key:b.title,onClick:f=>E(b.title),color:"blue"},{default:i(()=>[I(C(b.title),1)]),_:2},1032,["onClick"])),64))]),e("div",xo,[t(D,{style:{height:"100%"}},{default:i(()=>[x.value?(n(),v("div",wo,[t(N,{tip:"正在生成中..."})])):(n(),v(P,{key:1},[d.value?(n(),v("div",So,[e("div",qo,[e("div",Co,[e("div",Io,C(L.promptStruct.role.subject),1)]),e("div",Lo,C(L.promptStruct.role.describe),1)]),e("div",Uo,[e("div",Eo,[e("div",Ro,C(L.promptStruct.task.subject),1)]),e("div",Oo,C(L.promptStruct.task.describe),1)]),e("div",Ao,[e("div",Mo,[e("div",Do,C(L.promptStruct.constraints.subject),1)]),e("div",Vo,C(L.promptStruct.constraints.describe),1)]),e("div",jo,[e("div",No,[e("div",zo,C(L.promptStruct.output.subject),1)]),e("div",Po,C(L.promptStruct.output.describe),1)]),e("div",To,[e("div",Bo,[e("div",Qo,C(L.promptStruct.tone.subject),1)]),e("div",Fo,C(L.promptStruct.tone.describe),1)]),(n(!0),v(P,null,J(L.promptStruct.custom,(b,f)=>(n(),v("div",{class:"prompt-list",key:f+b.key?b.key:""},[e("div",Jo,[e("div",Ko,C(b.subject),1)]),e("div",Go,C(b.describe),1)]))),128))])):(n(),v("div",Ho,[t(H,{image:k(m),description:w.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Zo=T(Wo,[["__scopeId","data-v-896a48d0"]]),Yo={class:"prompt-box"},Xo={class:"tab-header"},es={key:0,class:"opt-block"},ts={key:1,class:"opt-block"},os={class:"tip-text"},ss={key:0,class:"prompt-list-box"},ns={class:"prompt-list"},is={class:"prompt-header"},as={class:"prompt-title"},ls={key:0,class:"btn-wrapper-box"},cs={class:"prompt-content"},rs={class:"prompt-list"},_s={class:"prompt-header"},ds={class:"prompt-title"},us={key:0,class:"btn-wrapper-box"},ps={class:"prompt-content"},ms={class:"prompt-list"},vs={class:"prompt-header"},hs={class:"prompt-title"},fs={key:0,class:"btn-wrapper-box"},bs={class:"prompt-content"},ys={class:"prompt-list"},ks={class:"prompt-header"},gs={class:"prompt-title"},$s={key:0,class:"btn-wrapper-box"},xs={class:"swich-item"},ws={class:"swich-item"},Ss={class:"prompt-content"},qs={class:"prompt-list"},Cs={class:"prompt-header"},Is={class:"prompt-title"},Ls={key:0,class:"btn-wrapper-box"},Us={class:"prompt-content"},Es={class:"prompt-header"},Rs={class:"prompt-title",style:{flex:"1"}},Os={key:0,class:"btn-wrapper-box"},As=["onClick"],Ms={class:"prompt-content"},Ds={key:0,class:"add-theme-block"},Vs={class:"show-more-block"},js={key:1,class:"diy-prompt-box"},Ns={key:0,class:"diy-switch-box"},zs={class:"swich-item"},Ps={class:"swich-item"},se="- 请使用markdown格式回答问题。",ne="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Ts={__name:"system-prompt-words",setup(_){const l=$(!1),{robotInfo:g,updateRobotInfo:m}=G("robotInfo");let r={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const a=$({}),s=$(!1),q=$(!1),o=$(!1),x=$(!1),c=B({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),w=$(localStorage.getItem("system_prompt_words_ishide")=="1"),p=()=>{w.value=!w.value,localStorage.setItem("system_prompt_words_ishide",w.value?1:0)},d=(b,f)=>b.includes(f),S=$(g.prompt_type);de(()=>g,()=>{c.prompt=g.prompt,c.prompt_struct=g.prompt_struct,a.value=g.prompt_struct_default},{immediate:!0,deep:!0}),de(()=>c.prompt_struct.output.describe,b=>{s.value=d(b,se),q.value=d(b,ne)},{immediate:!0,deep:!0}),de(()=>c.prompt,b=>{o.value=d(b,se),x.value=d(b,ne)},{immediate:!0,deep:!0});const L=(b,f)=>{b?(f=="outSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+se:c.prompt_struct.output.describe+=se),f=="imgSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+ne:c.prompt_struct.output.describe+=ne)):(f=="outSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(se,"g"),"")),f=="imgSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(ne,"g"),"")),c.prompt_struct.output.describe=c.prompt_struct.output.describe.trim())},E=(b,f)=>{b?(f=="outDiySwitch"&&(c.prompt?c.prompt+=`
`+se:c.prompt+=se),f=="imgDiySwitch"&&(c.prompt?c.prompt+=`
`+ne:c.prompt+=ne)):(f=="outDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(se,"g"),"")),f=="imgDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(ne,"g"),"")),c.prompt=c.prompt.trim())},h=b=>{c.prompt_struct[b].describe=a.value[b].describe},M=()=>{c.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),S.value=1},y=b=>{c.prompt_struct.custom.splice(b,1)},u=()=>{m({...W(c),prompt_type:S.value}),l.value=!1},j=b=>{S.value=1,m({prompt_type:S.value,prompt:c.prompt,prompt_struct:b}),l.value=!1},R=()=>{l.value=!0},A=()=>{l.value=!1},U=$(null),N=()=>{U.value.show()},H=$(null),D=()=>{H.value.show()},K=b=>{b.prompt_type==1?(S.value=1,c.prompt_struct=b.prompt_struct):(S.value=0,c.prompt=b.prompt),u()};return(b,f)=>{const me=Te,Ue=Be,et=le,ge=oe,tt=qe,re=Ce,$e=te,ot=ue;return n(),v("div",Yo,[e("div",Xo,[t(Ue,{activeKey:S.value,"onUpdate:activeKey":f[0]||(f[0]=O=>S.value=O)},{default:i(()=>[(n(),z(me,{key:1,tab:"结构化提示词"})),(n(),z(me,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),l.value?(n(),v("div",es,[e("div",{class:"hover-btn-box",onClick:D},[t(k(St)),I("导入")]),e("div",{class:"ai-mark-box hover-btn-box",onClick:N},[t(et,{name:"ai-mark"}),I(" AI自动生成 ")]),t(tt,{gap:8},{default:i(()=>[t(ge,{size:"small",type:"primary",onClick:u},{default:i(()=>[I("保存")]),_:1}),t(ge,{size:"small",onClick:A},{default:i(()=>[I("取消")]),_:1})]),_:1})])):(n(),v("div",ts,[e("span",os,"当前类型："+C(S.value==1?"结构化提示词":"自定义提示词"),1),t(ge,{size:"small",onClick:R},{default:i(()=>[I("修改")]),_:1})]))]),S.value==1?(n(),v("div",ss,[e("div",ns,[e("div",is,[e("div",as,C(c.prompt_struct.role.subject),1),l.value?(n(),v("div",ls,[e("a",{onClick:f[1]||(f[1]=O=>h("role"))},"恢复默认")])):V("",!0)]),e("div",cs,[t(re,{bordered:!1,disabled:!l.value,value:c.prompt_struct.role.describe,"onUpdate:value":f[2]||(f[2]=O=>c.prompt_struct.role.describe=O),placeholder:k(r).role},null,8,["disabled","value","placeholder"])])]),e("div",rs,[e("div",_s,[e("div",ds,C(c.prompt_struct.task.subject),1),l.value?(n(),v("div",us,[e("a",{onClick:f[3]||(f[3]=O=>h("task"))},"恢复默认")])):V("",!0)]),e("div",ps,[t(re,{bordered:!1,disabled:!l.value,value:c.prompt_struct.task.describe,"onUpdate:value":f[4]||(f[4]=O=>c.prompt_struct.task.describe=O),placeholder:k(r).task},null,8,["disabled","value","placeholder"])])]),w.value?(n(),v(P,{key:0},[e("div",ms,[e("div",vs,[e("div",hs,C(c.prompt_struct.constraints.subject),1),l.value?(n(),v("div",fs,[e("a",{onClick:f[5]||(f[5]=O=>h("constraints"))},"恢复默认")])):V("",!0)]),e("div",bs,[t(re,{bordered:!1,disabled:!l.value,value:c.prompt_struct.constraints.describe,"onUpdate:value":f[6]||(f[6]=O=>c.prompt_struct.constraints.describe=O),placeholder:k(r).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",ys,[e("div",ks,[e("div",gs,C(c.prompt_struct.output.subject),1),l.value?(n(),v("div",$s,[e("div",xs,[I(" 输出markdown： "),t($e,{onChange:f[7]||(f[7]=O=>L(O,"outSwitch")),checked:s.value,"onUpdate:checked":f[8]||(f[8]=O=>s.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ws,[I(" 回复图片： "),t($e,{onChange:f[9]||(f[9]=O=>L(O,"imgSwitch")),checked:q.value,"onUpdate:checked":f[10]||(f[10]=O=>q.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:f[11]||(f[11]=O=>h("output"))},"恢复默认")])):V("",!0)]),e("div",Ss,[t(re,{bordered:!1,disabled:!l.value,value:c.prompt_struct.output.describe,"onUpdate:value":f[12]||(f[12]=O=>c.prompt_struct.output.describe=O),placeholder:k(r).output},null,8,["disabled","value","placeholder"])])]),e("div",qs,[e("div",Cs,[e("div",Is,C(c.prompt_struct.tone.subject),1),l.value?(n(),v("div",Ls,[e("a",{onClick:f[13]||(f[13]=O=>h("tone"))},"恢复默认")])):V("",!0)]),e("div",Us,[t(re,{bordered:!1,disabled:!l.value,value:c.prompt_struct.tone.describe,"onUpdate:value":f[14]||(f[14]=O=>c.prompt_struct.tone.describe=O),placeholder:k(r).tone},null,8,["disabled","value","placeholder"])])]),(n(!0),v(P,null,J(c.prompt_struct.custom,(O,Ve)=>(n(),v("div",{class:"prompt-list",key:Ve+O.key?O.key:""},[e("div",Es,[e("div",Rs,[t(ot,{bordered:!1,disabled:!l.value,style:{width:"100%"},value:O.subject,"onUpdate:value":xe=>O.subject=xe,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),l.value?(n(),v("div",Os,[e("div",{class:"hover-btn-box",onClick:xe=>y(Ve)},[t(k(ve))],8,As)])):V("",!0)]),e("div",Ms,[t(re,{bordered:!1,disabled:!l.value,value:O.describe,"onUpdate:value":xe=>O.describe=xe,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),l.value?(n(),v("div",Ds,[t(ge,{onClick:M,block:"",icon:it(k(Oe))},{default:i(()=>[I("添加主题")]),_:1},8,["icon"])])):V("",!0)],64)):V("",!0),e("div",Vs,[e("div",{class:"btn-item",onClick:p},[w.value?(n(),v(P,{key:1},[I("收起"),t(k(Ct))],64)):(n(),v(P,{key:0},[I("展开"),t(k(qt))],64))])])])):(n(),v("div",js,[l.value?(n(),v("div",Ns,[e("div",zs,[I(" 输出markdown： "),t($e,{size:"small",onChange:f[15]||(f[15]=O=>E(O,"outDiySwitch")),checked:o.value,"onUpdate:checked":f[16]||(f[16]=O=>o.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ps,[I(" 回复图片： "),t($e,{size:"small",onChange:f[17]||(f[17]=O=>E(O,"imgDiySwitch")),checked:x.value,"onUpdate:checked":f[18]||(f[18]=O=>x.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):V("",!0),t(re,{bordered:l.value,value:c.prompt,"onUpdate:value":f[19]||(f[19]=O=>c.prompt=O),disabled:!l.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(Zo,{onHandleAiSave:j,ref_key:"aiCreatePromptRef",ref:U},null,512),t(wt,{onOk:K,ref_key:"importPromptRef",ref:H},null,512)])}}},Bs=T(Ts,[["__scopeId","data-v-7ca2be53"]]),he=_=>(Q("data-v-5d8fbdb0"),_=_(),F(),_),Qs={class:"actions-box"},Fs={class:"setting-info-block"},Js={class:"set-item w-100"},Ks={key:0,class:"set-item-content"},Gs=["src"],Hs={key:1},Ws={class:"set-item"},Zs={class:"set-item"},Ys={class:"set-item"},Xs={class:"set-item"},en={class:"form-box"},tn={class:"form-item"},on=he(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),sn={class:"form-item-body"},nn={class:"form-item"},an={class:"form-item-label"},ln=he(()=>e("span",null,"温度 ",-1)),cn={class:"form-item-body"},rn={class:"number-box"},_n={class:"number-slider-box"},dn={class:"number-input-box"},un={class:"form-item"},pn={class:"form-item-label"},mn=he(()=>e("span",null,"最大token ",-1)),vn={class:"form-item-body"},hn={class:"number-box"},fn={class:"number-slider-box"},bn={class:"number-input-box"},yn={class:"form-item"},kn={class:"form-item-label"},gn=he(()=>e("span",null,"上下文数量 ",-1)),$n={class:"form-item-body"},xn={class:"number-box"},wn={class:"number-slider-box"},Sn={class:"number-input-box"},qn={class:"form-item justify-between"},Cn={class:"form-item-label"},In=he(()=>e("span",null,"显示推理过程 ",-1)),Ln=he(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),Un={__name:"model-settings",setup(_){const l=["azure","ollama","xinference","openaiAgent"],g=["azure"],m=B({sm:24,md:24,lg:12,xl:24,xxl:24}),r=$([]),a=$(!1),{robotInfo:s,updateRobotInfo:q}=G("robotInfo"),o=B({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),x=$(""),c=$(""),w=$(""),p=y=>{o.use_model=l.includes(y.rawData.model_define)&&y.rawData.deployment_name?y.rawData.deployment_name:y.rawData.name,o.use_model_icon=y.icon,o.use_model_name=y.use_model_name,o.model_config_id=y.rawData.id,x.value=y.rawData.model_define},d=$(!1),S=y=>{y.target.closest(".custom-select")||(d.value=!1)};ke(()=>{l.indexOf(x.value)>-1?o.use_model=w.value:o.use_model=s.use_model,document.addEventListener("click",S)}),at(()=>{document.removeEventListener("click",S)});const L=()=>{w.value=o.use_model;let y={...W(o)};g.indexOf(x.value)>-1&&(y.use_model="默认"),q(y),a.value=!1},E=y=>{y||(x.value=c.value),l.indexOf(x.value)>-1?o.use_model=w.value:o.use_model=s.use_model,o.model_config_id=s.model_config_id,o.temperature=s.temperature,o.max_token=s.max_token,o.context_pair=s.context_pair,o.think_switch=Number(s.think_switch),a.value=y};Ee(()=>{o.model_config_id=s.model_config_id,o.temperature=s.temperature,o.max_token=s.max_token,o.context_pair=s.context_pair,o.think_switch=Number(s.think_switch)});function h(y,u,j){const R=new Set(y.map(A=>A.model_define));return u.filter(A=>{let U=A[j];R.has(U)&&y.filter(N=>{if(N.model_define==U)return N.children=ht(N.children,A.children),!1})}),y}return(()=>{Qe({model_type:"LLM"}).then(y=>{w.value=s.use_model;let u=y.data||[],j=[];r.value=u.map(R=>{j=[];for(let A=0;A<R.model_info.llm_model_list.length;A++){const U=R.model_info.llm_model_list[A];l.indexOf(R.model_info.model_define)>-1&&s.model_config_id==R.model_config.id&&(w.value=R.model_config.deployment_name,x.value=R.model_info.model_define,c.value=R.model_info.model_define),j.push({name:U,deployment_name:R.model_config.deployment_name,id:R.model_config.id,model_define:R.model_info.model_define,icon:R.model_info.model_icon_url,use_model_name:R.model_info.model_name})}return{id:R.model_config.id,name:R.model_info.model_name,model_define:R.model_info.model_define,icon:R.model_info.model_icon_url,children:j,deployment_name:R.model_config.deployment_name}}),r.value=h(vt(r.value,"model_define"),r.value,"model_define"),s.use_model&&s.model_config_id&&r.value.some(R=>R.children.some(A=>{const U=l.includes(A.model_define)&&A.deployment_name?A.deployment_name:A.name;if(l.includes(A.model_define)&&A.deployment_name&&A.id===s.model_config_id)return o.use_model_icon=A.icon,o.use_model_name=A.use_model_name,o.use_model=A.deployment_name,!0;if(U===s.use_model&&A.id===s.model_config_id)return o.use_model_icon=A.icon,o.use_model_name=A.use_model_name,!0}))})})(),(y,u)=>{const j=oe,R=Lt,A=ce,U=Fe,N=Ie,H=te,D=Ut,K=ee;return n(),z(Z,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:a.value,"onUpdate:isEdit":u[10]||(u[10]=b=>a.value=b)},{extra:i(()=>[e("div",Qs,[t(j,{onClick:u[0]||(u[0]=b=>E(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",Fs,[e("div",Js,[I(" LLM模型： "),o.use_model_icon&&o.use_model_name?(n(),v("span",Ks,[e("img",{src:o.use_model_icon,class:"model-icon"},null,8,Gs),I(C(o.use_model_name)+" "+C(o.use_model),1)])):(n(),v("span",Hs,C(o.use_model),1))]),e("div",Ws,[I(" 温度： "),e("span",null,C(o.temperature),1)]),e("div",Zs,[I(" 最大token： "),e("span",null,C(o.max_token),1)]),e("div",Ys,[I(" 上下文数量： "),e("span",null,C(o.context_pair),1)]),e("div",Xs,[I(" 显示推理过程： "),e("span",null,C(o.think_switch==1?"开":"关"),1)])]),t(K,{open:a.value,"onUpdate:open":u[9]||(u[9]=b=>a.value=b),width:672,title:"模型设置",onOk:L},{default:i(()=>[e("div",en,[t(D,{gutter:[32,24]},{default:i(()=>[t(R,fe(be(m)),{default:i(()=>[e("div",tn,[on,e("div",sn,[t(It,{modelValue:o.use_model,"onUpdate:modelValue":u[1]||(u[1]=b=>o.use_model=b),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":o.model_config_id,onChange:p},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(R,fe(be(m)),{default:i(()=>[e("div",nn,[e("div",an,[ln,t(A,null,{title:i(()=>[I("温度越低，回答越严谨。温度越高，回答越发散。")]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),e("div",cn,[e("div",rn,[e("div",_n,[t(U,{class:"custom-slider",value:o.temperature,"onUpdate:value":u[2]||(u[2]=b=>o.temperature=b),min:0,max:2,step:.1},null,8,["value"])]),e("div",dn,[t(N,{value:o.temperature,"onUpdate:value":u[3]||(u[3]=b=>o.temperature=b),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(R,fe(be(m)),{default:i(()=>[e("div",un,[e("div",pn,[mn,t(A,null,{title:i(()=>[I("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),e("div",vn,[e("div",hn,[e("div",fn,[t(U,{class:"custom-slider",value:o.max_token,"onUpdate:value":u[4]||(u[4]=b=>o.max_token=b),min:0,max:100*1024},null,8,["value"])]),e("div",bn,[t(N,{value:o.max_token,"onUpdate:value":u[5]||(u[5]=b=>o.max_token=b),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(R,fe(be(m)),{default:i(()=>[e("div",yn,[e("div",kn,[gn,t(A,null,{title:i(()=>[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),e("div",$n,[e("div",xn,[e("div",wn,[t(U,{class:"custom-slider",value:o.context_pair,"onUpdate:value":u[6]||(u[6]=b=>o.context_pair=b),min:0,max:10},null,8,["value"])]),e("div",Sn,[t(N,{value:o.context_pair,"onUpdate:value":u[7]||(u[7]=b=>o.context_pair=b),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(R,fe(be(m)),{default:i(()=>[e("div",qn,[e("div",Cn,[In,t(A,null,{title:i(()=>[Ln]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),t(H,{checked:o.think_switch,"onUpdate:checked":u[8]||(u[8]=b=>o.think_switch=b),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},En=T(Un,[["__scopeId","data-v-5d8fbdb0"]]),Rn={class:"library-checkbox-box"},On={class:"list-tools"},An={class:"list-box",ref:"scrollContainer"},Mn={class:"library-name"},Dn={class:"library-desc"},Vn={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:g}){const m=g,r=B({indeterminate:!1,checkAll:!1,checkedList:[]}),a=$(!1),s=E=>{p(),r.checkedList=E,a.value=!0},q=()=>{a.value=!1,w()},o=$(""),x=()=>{p()},c=$([]),w=()=>{m("change",[...r.checkedList])},p=async()=>{const E=await ze({library_name:o.value,type:"",show_open_docs:1});if(E){let h=E.data||[];c.value=h}},d=$(!1),S=async()=>{d.value=!0,await p(),d.value=!1,X.success("刷新完成")},L=()=>{window.open("/#/library/list")};return l({open:s}),(E,h)=>{const M=Ge,y=ue,u=oe,j=Je,R=Ke,A=Re,U=ee;return n(),z(U,{width:"746px",open:a.value,"onUpdate:open":h[2]||(h[2]=N=>a.value=N),title:"关联知识库",onOk:q},{default:i(()=>[e("div",Rn,[t(M,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",On,[e("div",null,[t(y,{style:{width:"282px"},value:o.value,"onUpdate:value":h[0]||(h[0]=N=>o.value=N),placeholder:"请输入知识库名称搜索",onChange:x},{suffix:i(()=>[t(k(Et),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(u,{style:{"margin-right":"8px"},onClick:S},{default:i(()=>[t(k(Rt)),I(" 刷新 ")]),_:1}),t(u,{type:"primary",ghost:"",onClick:L},{default:i(()=>[I("新建知识库")]),_:1})])]),t(A,{spinning:d.value,delay:100},{default:i(()=>[t(R,{value:r.checkedList,"onUpdate:value":h[1]||(h[1]=N=>r.checkedList=N),style:{width:"100%"}},{default:i(()=>[e("div",An,[(n(!0),v(P,null,J(c.value,N=>(n(),v("div",{class:"list-item-wraapper",key:N.id},[t(j,{class:"list-item",value:N.id},{default:i(()=>[e("div",Mn,C(N.library_name),1),e("div",Dn,C(N.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},jn=T(Vn,[["__scopeId","data-v-917767e7"]]),Le=_=>(Q("data-v-a2abcb20"),_=_(),F(),_),Nn={class:"recall-settings-box"},zn={class:"form-box"},Pn={class:"form-item is-required"},Tn=Le(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Bn={class:"form-item-body"},Qn={class:"retrieval-mode-items"},Fn=["onClick"],Jn={class:"retrieval-mode-title"},Kn={class:"title-text"},Gn={key:0,style:{width:"32px"},src:Ot,alt:""},Hn={class:"retrieval-mode-desc"},Wn={class:"form-item"},Zn={class:"form-item-label"},Yn=Le(()=>e("span",null,"Top K ",-1)),Xn={class:"form-item-body"},ei={class:"number-box"},ti={class:"number-slider-box"},oi={class:"number-input-box"},si={key:0,class:"form-item"},ni={class:"form-item-label"},ii=Le(()=>e("span",null,"相似度阈值 ",-1)),ai={class:"form-item-body"},li={class:"number-box"},ci={class:"number-slider-box"},ri={class:"number-input-box"},_i={class:"form-item"},di={class:"form-item-label"},ui=Le(()=>e("span",null,"Rerank模型",-1)),pi={key:0,class:"form-item-body"},mi=["src"],vi={__name:"recall-settings-alert",emits:["change"],setup(_,{expose:l,emit:g}){const m=g,r=$([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),a=B({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=$(!1),q=E=>{L(),a.rerank_status=E.rerank_status||0,a.rerank_use_model=E.rerank_use_model||void 0,a.rerank_model_config_id=E.rerank_model_config_id>0?E.rerank_model_config_id:"",a.top_k=E.top_k,a.similarity=E.similarity,a.search_type=E.search_type,s.value=!0},o=(E,h)=>{if(!E||!h){a.rerank_model_config_id="";return}a.rerank_model_config_id=h.rerank_model_config_id},x=E=>{E==0&&(a.rerank_model_config_id="",a.rerank_use_model="")},c=E=>{a.search_type=E},w=()=>a.rerank_status==1&&!a.rerank_model_config_id,p=()=>{if(w())return X.error("请选择Rerank模型");s.value=!1,d()},d=()=>{m("change",W(a))},S=$([]),L=()=>{Qe({model_type:"RERANK"}).then(E=>{let h=E.data||[];S.value=h.map(M=>({id:M.model_config.id,name:M.model_info.model_name,icon:M.model_info.model_icon_url,children:M.model_info.rerank_model_list}))})};return l({open:q}),(E,h)=>{const M=le,y=ce,u=Fe,j=Ie,R=te,A=At,U=Mt,N=Dt,H=ee;return n(),z(H,{width:"746px",open:s.value,"onUpdate:open":h[6]||(h[6]=D=>s.value=D),title:"召回设置",onOk:p},{default:i(()=>[e("div",Nn,[e("div",zn,[e("div",Pn,[Tn,e("div",Bn,[e("div",Qn,[(n(!0),v(P,null,J(r.value,D=>(n(),v("div",{class:Se(["retrieval-mode-item",{active:a.search_type==D.value}]),key:D.value,onClick:K=>c(D.value)},[a.search_type==D.value?(n(),z(M,{key:0,class:"check-arrow",name:"check-arrow-filled"})):V("",!0),e("div",Jn,[t(M,{name:D.iconName,class:"title-icon"},null,8,["name"]),e("span",Kn,C(D.title),1),D.isRecommendation?(n(),v("img",Gn)):V("",!0)]),e("div",Hn,C(D.desc),1)],10,Fn))),128))])])]),e("div",Wn,[e("div",Zn,[Yn,t(y,null,{title:i(()=>[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),e("div",Xn,[e("div",ei,[e("div",ti,[t(u,{class:"custom-slider",value:a.top_k,"onUpdate:value":h[0]||(h[0]=D=>a.top_k=D),min:1,max:10},null,8,["value"])]),e("div",oi,[t(j,{value:a.top_k,"onUpdate:value":h[1]||(h[1]=D=>a.top_k=D),min:1,max:10},null,8,["value"])])])])]),a.search_type<=2?(n(),v("div",si,[e("div",ni,[ii,t(y,null,{title:i(()=>[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:i(()=>[t(k(Y),{class:"question-icon"})]),_:1})]),e("div",ai,[e("div",li,[e("div",ci,[t(u,{class:"custom-slider",value:a.similarity,"onUpdate:value":h[2]||(h[2]=D=>a.similarity=D),min:0,max:1,step:.01},null,8,["value"])]),e("div",ri,[t(j,{value:a.similarity,"onUpdate:value":h[3]||(h[3]=D=>a.similarity=D),min:0,max:1,step:.01},null,8,["value"])])])])])):V("",!0),e("div",_i,[e("div",di,[ui,I("   "),t(R,{checkedValue:1,unCheckedValue:0,checked:a.rerank_status,"onUpdate:checked":h[4]||(h[4]=D=>a.rerank_status=D),onChange:x},null,8,["checked"])]),a.rerank_status==1?(n(),v("div",pi,[t(N,{allowClear:"",value:a.rerank_use_model,"onUpdate:value":h[5]||(h[5]=D=>a.rerank_use_model=D),placeholder:"请选择Rerank模型",onChange:o,style:{width:"60%"}},{default:i(()=>[(n(!0),v(P,null,J(S.value,D=>(n(),z(U,{key:D.id},{label:i(()=>[e("span",null,[e("img",{class:"model-icon",src:D.icon,alt:""},null,8,mi)])]),default:i(()=>[(n(!0),v(P,null,J(D.children,K=>(n(),z(A,{value:K,rerank_model_config_id:D.id,key:K},{default:i(()=>[e("span",null,C(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):V("",!0)])])])]),_:1},8,["open"])}}},hi=T(vi,[["__scopeId","data-v-a2abcb20"]]),fi=_=>(Q("data-v-a87bd0fa"),_=_(),F(),_),bi={class:"list-box"},yi=["onClick"],ki={class:"avater-box"},gi=["src"],$i={class:"content-box"},xi={class:"title-block"},wi=fi(()=>e("div",{class:"tag-icon"},"Graph",-1)),Si={class:"title-text"},qi={class:"desc-box"},Ci={class:"right-icon"},Ii={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(_,{expose:l,emit:g}){const m=g,r=_,a=$(!1);de(()=>r.list,()=>{r.list.length==0&&(a.value=!1)},{});const s=()=>{a.value=!0},q=()=>{document.visibilityState==="visible"&&m("refreshList")};ke(()=>{document.addEventListener("visibilitychange",q)}),lt(()=>{document.removeEventListener("visibilitychange",q)});const o=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return l({show:s}),(x,c)=>{const w=Ge,p=Pe,d=ee;return n(),v("div",null,[t(d,{open:a.value,"onUpdate:open":c[0]||(c[0]=S=>a.value=S),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[t(w,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(p,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",bi,[(n(!0),v(P,null,J(r.list,S=>(n(),v("div",{class:"list-item",onClick:L=>o(S),key:S.id},[e("div",ki,[e("img",{src:S.avatar,alt:""},null,8,gi)]),e("div",$i,[e("div",xi,[wi,e("div",Si,C(S.library_name),1)]),e("div",qi,C(S.library_intro),1)]),e("div",Ci,[t(k(Vt))])],8,yi))),128))])]),_:1})]),_:1},8,["open"])])}}},Li=T(Ii,[["__scopeId","data-v-a87bd0fa"]]),Ui={class:"actions-box"},Ei={key:0,class:"library-list"},Ri=["onClick"],Oi=["onClick"],Ai={class:"library-name"},Mi={class:"library-name-text"},Di={class:"library-intro"},Vi={class:"setting-info-block"},ji={class:"set-item"},Ni={key:0},zi={key:1},Pi={key:2},Ti={key:3},Bi={class:"set-item"},Qi={key:0,class:"set-item"},Fi={class:"set-item"},Ji={key:0},Ki={key:1},Gi={__name:"index",setup(_){const{getStorage:l,removeStorage:g}=bt("localStorage"),m=ft(),r=ye(()=>{var U;return((U=m.companyInfo)==null?void 0:U.neo4j_status)=="true"}),a=$(!1),{robotInfo:s,updateRobotInfo:q}=G("robotInfo"),o=B({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),x=$([]),c=$(null),w=ye(()=>x.value.filter(U=>o.library_ids.includes(U.id))),p=ye(()=>w.value.filter(U=>U.graph_switch==0)),d=U=>{let N=o.library_ids.indexOf(U.id);o.library_ids.splice(N,1),u()},S=U=>{o.library_ids=[...U],u()},L=()=>{c.value.open([...o.library_ids])},E=$(null),h=()=>{E.value.open(W(o))},M=$(null),y=U=>{o.rerank_status=U.rerank_status,o.rerank_use_model=U.rerank_use_model,o.rerank_model_config_id=U.rerank_model_config_id,o.top_k=U.top_k,o.similarity=U.similarity,o.search_type=U.search_type,(U.search_type==1||U.search_type==4)&&p.value.length>0&&M.value.show(),u()},u=()=>{let U={...W(o)};U.library_ids=U.library_ids.join(","),q({...U})},j=async()=>{const U=await ze({type:"",show_open_docs:1});U&&(x.value=U.data||[])},R=()=>{ee.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){L()}})};o.rerank_use_model=s.rerank_use_model||void 0,Ee(()=>{o.library_ids=s.library_ids.split(","),o.rerank_status=s.rerank_status||0,o.rerank_use_model=s.rerank_use_model||void 0,o.rerank_model_config_id=s.rerank_model_config_id||"",o.top_k=s.top_k,o.similarity=s.similarity,o.search_type=s.search_type});const A=U=>{window.open(`#/library/details/knowledge-document?id=${U.id}`)};return ke(()=>{j(),l("showNoLibraryTip")&&(R(),g("showNoLibraryTip"))}),(U,N)=>{const H=oe,D=qe,K=ce;return n(),z(Z,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:a.value,"onUpdate:isEdit":N[0]||(N[0]=b=>a.value=b),bodyStyle:{padding:0}},{extra:i(()=>[e("div",Ui,[t(D,{gap:8},{default:i(()=>[t(H,{size:"small",onClick:h},{default:i(()=>[I("召回设置")]),_:1}),t(H,{size:"small",onClick:L},{default:i(()=>[I("关联知识库")]),_:1})]),_:1})])]),default:i(()=>[w.value.length>0?(n(),v("div",Ei,[(n(!0),v(P,null,J(w.value,b=>(n(),v("div",{class:"library-item",key:b.id,onClick:f=>A(b)},[e("span",{class:"close-btn",onClick:ct(f=>d(b),["stop"])},[t(k(ve))],8,Oi),e("div",Ai,[r.value?(n(),z(K,{key:0},{title:i(()=>[I(C(b.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:Se(["graph-tag",{active:b.graph_switch==1}])},"Graph",2)]),_:2},1024)):V("",!0),e("div",Mi,C(b.library_name),1)]),e("div",Di,C(b.library_intro),1)],8,Ri))),128))])):V("",!0),e("div",Vi,[e("div",ji,[I(" 检索模式： "),o.search_type==1?(n(),v("span",Ni,"混合检索")):V("",!0),o.search_type==2?(n(),v("span",zi,"向量检索")):V("",!0),o.search_type==3?(n(),v("span",Pi,"全文检索")):V("",!0),o.search_type==4?(n(),v("span",Ti,"知识图谱检索")):V("",!0)]),e("div",Bi,[I(" Top K： "),e("span",null,C(o.top_k),1)]),o.search_type<=2?(n(),v("div",Qi,[I(" 相似度阈值： "),e("span",null,C(o.similarity),1)])):V("",!0),e("div",Fi,[I(" Rerank模型： "),o.rerank_status==0?(n(),v("span",Ji,"关")):(n(),v("span",Ki,C(o.rerank_use_model),1))])]),t(jn,{ref_key:"librarySelectAlertRef",ref:c,onChange:S},null,512),t(hi,{ref_key:"recallSettingsAlertRef",ref:E,onChange:y},null,512),t(Li,{list:p.value,onRefreshList:j,ref_key:"noOpenGraphModalRef",ref:M},null,8,["list"])]),_:1},8,["isEdit"])}}},Hi=T(Gi,[["__scopeId","data-v-ede78f9f"]]),Wi=_=>(Q("data-v-b559dd08"),_=_(),F(),_),Zi={class:"library-checkbox-box"},Yi={class:"list-box",ref:"scrollContainer"},Xi={class:"library-name"},ea={class:"library-desc"},ta={key:0,class:"empty-box"},oa=Wi(()=>e("img",{src:jt,alt:""},null,-1)),sa={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:g}){const m=g,r=B({indeterminate:!1,checkAll:!1,checkedList:[]}),a=$(!1),s=d=>{c(),r.checkedList=d,a.value=!0},q=()=>{a.value=!1,x()};$("");const o=$([]),x=()=>{m("change",[...r.checkedList])},c=async()=>{const d=await He();if(d){let S=d.data||[];o.value=S}},w=$(!1),p=()=>{window.open("/#/database/list")};return l({open:s}),(d,S)=>{const L=Je,E=Ke,h=Re,M=ee;return n(),z(M,{width:"746px",open:a.value,"onUpdate:open":S[1]||(S[1]=y=>a.value=y),title:"关联数据表",onOk:q},{default:i(()=>[e("div",Zi,[t(h,{spinning:w.value,delay:100},{default:i(()=>[t(E,{value:r.checkedList,"onUpdate:value":S[0]||(S[0]=y=>r.checkedList=y),style:{width:"100%"}},{default:i(()=>[e("div",Yi,[(n(!0),v(P,null,J(o.value,y=>(n(),v("div",{class:"list-item-wraapper",key:y.id},[t(L,{class:"list-item",value:y.id},{default:i(()=>[e("div",Xi,C(y.name),1),e("div",ea,C(y.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!w.value&&!o.value.length?(n(),v("div",ta,[oa,e("div",null,[I(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:p}," 去添加")])])):V("",!0)])]),_:1},8,["open"])}}},na=T(sa,[["__scopeId","data-v-b559dd08"]]),ia=_=>(Q("data-v-c40914ca"),_=_(),F(),_),aa=ia(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),la={class:"actions-box"},ca={key:0,class:"library-list"},ra=["onClick"],_a={class:"library-name"},da={class:"library-intro"},ua={__name:"index",setup(_){const l=$(!1),{robotInfo:g,updateRobotInfo:m}=G("robotInfo"),r=B({form_ids:[]}),a=$([]),s=$(null),q=ye(()=>a.value.filter(d=>r.form_ids.includes(d.id))),o=d=>{let S=r.form_ids.indexOf(d.id);r.form_ids.splice(S,1),w()},x=d=>{r.form_ids=[...d],w()},c=()=>{s.value.open([...r.form_ids])},w=()=>{let d={...W(r)};d.form_ids=d.form_ids.join(","),m({...d})};return(async()=>{const d=await He();d&&(a.value=d.data||[])})(),Ee(()=>{r.form_ids=g.form_ids.split(",")}),(d,S)=>{const L=ce,E=oe,h=qe;return n(),z(Z,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":S[0]||(S[0]=M=>l.value=M),bodyStyle:{padding:0}},{tip:i(()=>[t(L,{placement:"top"},{title:i(()=>[aa]),default:i(()=>[t(k(Y))]),_:1})]),extra:i(()=>[e("div",la,[t(h,{gap:8},{default:i(()=>[t(E,{size:"small",onClick:c},{default:i(()=>[I("关联数据表")]),_:1})]),_:1})])]),default:i(()=>[q.value.length>0?(n(),v("div",ca,[(n(!0),v(P,null,J(q.value,M=>(n(),v("div",{class:"library-item",key:M.id},[e("span",{class:"close-btn",onClick:y=>o(M)},[t(k(ve))],8,ra),e("div",_a,C(M.name),1),e("div",da,C(M.description),1)]))),128))])):V("",!0),t(na,{ref_key:"librarySelectAlertRef",ref:s,onChange:x},null,512)]),_:1},8,["isEdit"])}}},pa=T(ua,[["__scopeId","data-v-c40914ca"]]),ma={class:"form-box"},va={class:"question-title"},ha={class:"question-options"},fa={class:"question-option"},ba={class:"drag-btn"},ya={class:"action-box"},ka={class:"robot-info-box"},ga={class:"robot-welcome-content"},$a={class:"robot-welcome-question"},xa={__name:"welcome-words",setup(_){const l=$(!1),g=$(!1),{robotInfo:m,updateRobotInfo:r,scrollBoxToBottom:a}=G("robotInfo"),s=B({welcomes:{content:"",question:[]}}),q=()=>{let p=!1;if(s.welcomes.question.length>0){for(let d=0;d<s.welcomes.question.length;d++)if(!s.welcomes.question[d].content){p=d+1;break}}return p},o=()=>{s.welcomes.question.push({content:"",id:we(8)})},x=p=>{s.welcomes.question.splice(p,1)},c=()=>{if(!s.welcomes.content)return X.error("请输入欢迎语");if(q())return X.error("引导问题内容不能为空");r({...W(s)}),l.value=!1},w=()=>{let p={...m.welcomes},d=[];p.question.forEach(({content:S,id:L})=>{let E={id:L,content:S};E.id||(E.id=we(6)),d.push(E)}),s.welcomes.content=p.content,s.welcomes.question=d};return(p,d)=>{const S=Ce,L=le,E=ue;return n(),z(Z,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:l.value,"onUpdate:isEdit":d[4]||(d[4]=h=>l.value=h),onSave:c,onEdit:w},{default:i(()=>[ie(e("div",ma,[e("div",va,[t(S,{value:s.welcomes.content,"onUpdate:value":d[0]||(d[0]=h=>s.welcomes.content=h),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",ha,[t(k(Ae),{modelValue:s.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=h=>s.welcomes.question=h),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=h=>g.value=!0),onEnd:d[3]||(d[3]=h=>g.value=!1)},{item:i(({element:h,index:M})=>[e("div",fa,[e("span",ba,[t(L,{name:"drag"})]),t(E,{class:"question-option-content",value:h.content,"onUpdate:value":y=>h.content=y,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ya,[t(k(ve),{class:"del-btn",onClick:y=>x(M)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:o},[t(k(Oe),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[ae,l.value]]),ie(e("div",ka,[e("div",ga,C(k(m).welcomes.content),1),e("div",$a,[(n(!0),v(P,null,J(k(m).welcomes.question,(h,M)=>(n(),v("div",{class:"question-item",key:M},C(h.content),1))),128))])],512),[[ae,!l.value]])]),_:1},8,["isEdit"])}}},wa=T(xa,[["__scopeId","data-v-ea227a87"]]),Sa=_=>(Q("data-v-bc797bf6"),_=_(),F(),_),qa=Sa(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Ca={class:"form-box"},Ia={class:"question-title"},La={class:"question-options"},Ua={class:"question-option"},Ea={class:"drag-btn"},Ra={class:"action-box"},Oa={class:"robot-info-box"},Aa={class:"robot-unknown-content"},Ma={class:"robot-unknown-question"},Da={__name:"unknown-problem-prompt",setup(_){const l=$(!1),g=$(!1),{robotInfo:m,updateRobotInfo:r,scrollBoxToBottom:a}=G("robotInfo"),s=B({unknown_question_prompt:{content:"",question:[]}}),q=()=>{s.unknown_question_prompt.question.push({content:"",id:we(8)}),rt(()=>{a()})},o=w=>{s.unknown_question_prompt.question.splice(w,1)},x=()=>{r({...W(s)}),l.value=!1},c=()=>{let w={...m.unknown_question_prompt},p=[];w.question&&w.question.forEach(({content:d,id:S})=>{let L={id:S,content:d};L.id||(L.id=we(6)),p.push(L)}),w.content&&(s.unknown_question_prompt.content=w.content),p&&(s.unknown_question_prompt.question=p)};return ke(()=>{}),(w,p)=>{const d=ce,S=Ce,L=le,E=ue;return n(),z(Z,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:l.value,"onUpdate:isEdit":p[4]||(p[4]=h=>l.value=h),onSave:x,onEdit:c},{tip:i(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[qa]),default:i(()=>[t(k(Y))]),_:1})]),default:i(()=>[ie(e("div",Ca,[e("div",Ia,[t(S,{value:s.unknown_question_prompt.content,"onUpdate:value":p[0]||(p[0]=h=>s.unknown_question_prompt.content=h),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",La,[t(k(Ae),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":p[1]||(p[1]=h=>s.unknown_question_prompt.question=h),"item-key":"id",handle:".drag-btn",onStart:p[2]||(p[2]=h=>g.value=!0),onEnd:p[3]||(p[3]=h=>g.value=!1)},{item:i(({element:h,index:M})=>[e("div",Ua,[e("span",Ea,[t(L,{name:"drag"})]),t(E,{class:"question-option-content",value:h.content,"onUpdate:value":y=>h.content=y,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ra,[t(k(ve),{class:"del-btn",onClick:y=>o(M)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:q},[t(k(Oe),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[ae,l.value]]),ie(e("div",Oa,[e("div",Aa,C(k(m).unknown_question_prompt.content),1),e("div",Ma,[(n(!0),v(P,null,J(k(m).unknown_question_prompt.question,(h,M)=>(n(),v("div",{class:"question-item",key:M},C(h.content),1))),128))])],512),[[ae,!l.value]])]),_:1},8,["isEdit"])}}},Va=T(Da,[["__scopeId","data-v-bc797bf6"]]),Ye=_=>(Q("data-v-c60b8d8e"),_=_(),F(),_),ja=Ye(()=>e("span",null,null,-1)),Na=Ye(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),za={__name:"problem-optimization",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:g}=G("robotInfo");B({prompt:""});const m=r=>{g({})};return(r,a)=>{const s=te;return n(),z(Z,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>[ja]),default:i(()=>[Na,t(s,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_question_optimize,"onUpdate:checked":a[0]||(a[0]=q=>k(l).enable_question_optimize=q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Pa=T(za,[["__scopeId","data-v-c60b8d8e"]]),Ta=_=>(Q("data-v-f6a291d4"),_=_(),F(),_),Ba=Ta(()=>e("span",null,null,-1)),Qa={class:"robot-info-box"},Fa={class:"robot-prompt"},Ja={__name:"suggested-issues",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:g}=G("robotInfo"),m=r=>{g({})};return(r,a)=>{const s=Ie,q=te;return n(),z(Z,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>[Ba]),default:i(()=>[e("div",Qa,[e("div",Fa,[I(" 开启后，机器人回答问题后，自动根据对话内容提供 "),t(s,{value:k(l).question_guide_num,"onUpdate:value":a[0]||(a[0]=o=>k(l).question_guide_num=o),style:{width:"80px"},precision:0,min:1,max:10,onBlur:m},null,8,["value"]),I(" 条用户提问建议，最大不超过10条。 ")])]),t(q,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_question_guide,"onUpdate:checked":a[1]||(a[1]=o=>k(l).enable_question_guide=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ka=T(Ja,[["__scopeId","data-v-f6a291d4"]]),Ga=_=>(Q("data-v-56c388e6"),_=_(),F(),_),Ha=Ga(()=>e("span",null,null,-1)),Wa={__name:"sensitive-words",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:g}=G("robotInfo");B({prompt:""});const m=()=>{window.open("/#/user/sensitive-words")},r=a=>{g({})};return(a,s)=>{const q=te;return n(),z(Z,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>[Ha]),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:m,style:{cursor:"pointer"}},"设置敏词 >")])]),t(q,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(l).sensitive_words_switch,"onUpdate:checked":s[0]||(s[0]=o=>k(l).sensitive_words_switch=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Za=T(Wa,[["__scopeId","data-v-56c388e6"]]),Me=_=>(Q("data-v-a0ec9e93"),_=_(),F(),_),Ya={class:"direct-title"},Xa={class:"direct-desc"},el={class:"qa"},tl={class:"prompt-form-item-label"},ol=Me(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),sl={class:"direct-switch"},nl={class:"similarity"},il=Me(()=>e("span",null,"相似度超过",-1)),al={class:"number-input-box"},ll=Me(()=>e("span",null,"时直接回复答案",-1)),cl={__name:"chat-edit-alert",emits:["save"],setup(_,{expose:l,emit:g}){const m=g,r=$(1),a=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],s=B(a()),q=$(!1),o=B({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{o.chat_type=r.value.toString(),s.forEach(p=>{p.chat_type==r.value&&(o.chat_type=="3"?(o.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch==1?"true":"false",o.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score.toString()):o.chat_type=="1"&&(o.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch==1?"true":"false",o.library_qa_direct_reply_score=p.library_qa_direct_reply_score.toString()))}),c(),Object.assign(s,a()),q.value=!1},c=()=>{m("save",W(o))};ke(()=>{});const w=p=>{r.value=parseInt(p.chat_type),o.chat_type=p.chat_type,o.library_qa_direct_reply_score=p.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch,s.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=p.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch=="true"?1:0)}),q.value=!0};return de(()=>q.value,p=>{p===!1&&Object.assign(s,a())},{immediate:!0}),l({open:w}),(p,d)=>{const S=ce,L=te,E=Ie,h=Nt,M=zt,y=ee;return n(),z(y,{width:"746px",open:q.value,"onUpdate:open":d[1]||(d[1]=u=>q.value=u),title:"聊天模式设置",onOk:x},{default:i(()=>[t(M,{class:"direct-box",value:r.value,"onUpdate:value":d[0]||(d[0]=u=>r.value=u)},{default:i(()=>[(n(!0),v(P,null,J(s,u=>(n(),z(h,{class:Se(["direct-item",{active:r.value==u.direct_id}]),value:u.direct_id,key:u.direct_id},{default:i(()=>[e("div",Ya,C(u.direct_title),1),e("div",Xa,C(u.direct_desc),1),ie(e("div",el,[e("div",tl,[ol,t(S,null,_t({default:i(()=>[t(k(Y),{class:"question-icon"})]),_:2},[u.chat_type=="1"?{name:"title",fn:i(()=>[I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:u.chat_type=="3"?{name:"title",fn:i(()=>[I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",sl,[u.chat_type=="1"?(n(),z(L,{key:0,checkedValue:1,unCheckedValue:0,checked:u.library_qa_direct_reply_switch,"onUpdate:checked":j=>u.library_qa_direct_reply_switch=j},null,8,["checked","onUpdate:checked"])):u.chat_type=="3"?(n(),z(L,{key:1,checkedValue:1,unCheckedValue:0,checked:u.mixture_qa_direct_reply_switch,"onUpdate:checked":j=>u.mixture_qa_direct_reply_switch=j},null,8,["checked","onUpdate:checked"])):V("",!0)])])],512),[[ae,u.isQaDirectReply&&r.value==u.direct_id]]),ie(e("div",nl,[il,e("div",al,[u.chat_type=="1"?(n(),z(E,{key:0,value:u.library_qa_direct_reply_score,"onUpdate:value":j=>u.library_qa_direct_reply_score=j,disabled:!u.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):u.chat_type=="3"?(n(),z(E,{key:1,value:u.mixture_qa_direct_reply_score,"onUpdate:value":j=>u.mixture_qa_direct_reply_score=j,disabled:!u.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):V("",!0)]),ll],512),[[ae,u.isQaDirectReply&&r.value==u.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},rl=T(cl,[["__scopeId","data-v-a0ec9e93"]]),De=_=>(Q("data-v-5b59ec9b"),_=_(),F(),_),_l=De(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),dl=De(()=>e("br",null,null,-1)),ul=De(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),pl={class:"actions-box"},ml={class:"setting-info-block"},vl={class:"set-item"},hl={key:0},fl={key:1},bl={key:2},yl={class:"set-item"},kl={key:0,class:"set-item"},gl={class:"set-item"},$l={key:0,class:"set-item"},xl={class:"form-box"},wl={__name:"index",setup(_){const l=$(!1),g=$(null),{robotInfo:m,updateRobotInfo:r}=G("robotInfo"),a=B({chat_type:m.chat_type,library_qa_direct_reply_score:m.library_qa_direct_reply_score,library_qa_direct_reply_switch:m.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:m.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:m.mixture_qa_direct_reply_switch}),s=x=>{a.chat_type=x.chat_type,a.library_qa_direct_reply_score=x.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,q()},q=()=>{r({...W(a)}),l.value=!1},o=()=>{g.value.open(W(a)),l.value=!0};return(x,c)=>{const w=ce,p=oe;return n(),z(Z,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:l.value,"onUpdate:isEdit":c[1]||(c[1]=d=>l.value=d),bodyStyle:{padding:0}},{tip:i(()=>[t(w,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[_l,dl,ul]),default:i(()=>[t(k(Y))]),_:1})]),extra:i(()=>[e("div",pl,[t(p,{size:"small",onClick:c[0]||(c[0]=d=>o(!0))},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",ml,[e("div",vl,[I(" 聊天模式： "),k(m).chat_type=="1"?(n(),v("span",hl,"仅知识库")):V("",!0),k(m).chat_type=="2"?(n(),v("span",fl,"直连模式")):V("",!0),k(m).chat_type=="3"?(n(),v("span",bl,"混合模式")):V("",!0)]),k(m).chat_type=="1"?(n(),v(P,{key:0},[e("div",yl,[I(" QA文档直接回复答案： "),e("span",null,C(k(m).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(m).library_qa_direct_reply_switch=="true"?(n(),v("div",kl,[I(" 相似度值： "),e("span",null,C(k(m).library_qa_direct_reply_score),1)])):V("",!0)],64)):V("",!0),k(m).chat_type=="3"?(n(),v(P,{key:1},[e("div",gl,[I(" QA文档直接回复答案： "),e("span",null,C(k(m).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(m).mixture_qa_direct_reply_switch=="true"?(n(),v("div",$l,[I(" 相似度值： "),e("span",null,C(k(m).mixture_qa_direct_reply_score),1)])):V("",!0)],64)):V("",!0)]),e("div",xl,[t(rl,{ref_key:"ChatEditAlertRef",ref:g,onSave:s},null,512)])]),_:1},8,["isEdit"])}}},Sl=T(wl,[["__scopeId","data-v-5b59ec9b"]]),ql=_=>(Q("data-v-8d185d5f"),_=_(),F(),_),Cl={class:"switch-box"},Il={class:"switch-box-body"},Ll={class:"switch-box-header"},Ul={class:"left-box"},El={class:"switch-box-title"},Rl={key:0,class:"title-tip"},Ol={class:"right-box"},Al={class:"extra-box"},Ml=ql(()=>e("div",{class:"extra-box"},null,-1)),Dl={class:"switch-desc"},Vl={class:"switch-box-right"},jl={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(_,{emit:l}){const g=l,m=_,r=$(m.value),a=s=>{g("update:value",s),g("change",s)};return(s,q)=>{const o=le,x=te;return n(),v("div",Cl,[e("div",Il,[e("div",Ll,[e("div",Ul,[t(o,{class:"switch-box-icon",name:m.iconName},null,8,["name"]),e("span",El,C(m.title),1),s.$slots.tip?(n(),v("span",Rl,[_e(s.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Ol,[e("div",Al,[_e(s.$slots,"extra",{},()=>[Ml],!0)])])]),e("div",Dl,[_e(s.$slots,"default",{},void 0,!0)])]),e("div",Vl,[t(x,{checked:r.value,"onUpdate:checked":q[0]||(q[0]=c=>r.value=c),onChange:a,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Nl=T(jl,[["__scopeId","data-v-8d185d5f"]]),zl="/assets/img/empty-Bx9z1cwf.png",Pl="/assets/img/phone-head-CDwwPhYa.png",Tl="/assets/img/phone-body-CbEf8GZP.png",Bl="/assets/img/phone-footer-ClQtNpln.png",pe=_=>(Q("data-v-5125783f"),_=_(),F(),_),Ql={class:"common-problem-box"},Fl={class:"left-content-box"},Jl={key:0,class:"empty-box"},Kl=pe(()=>e("img",{src:zl,alt:""},null,-1)),Gl=pe(()=>e("div",{class:"title"},"暂无数据",-1)),Hl=pe(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Wl={key:1,class:"lists-box"},Zl={class:"drag-btn"},Yl={class:"title"},Xl={class:"opration-box"},ec={class:"preview-box"},tc=pe(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Pl,alt:""})],-1)),oc={class:"phone-body"},sc=pe(()=>e("div",null,[e("img",{class:"body-img",src:Tl,alt:""})],-1)),nc={key:0,class:"question-box"},ic=pe(()=>e("div",{class:"name"},"常见问题",-1)),ac=pe(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Bl,alt:""})],-1)),lc={__name:"common-problem",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:g}=G("robotInfo"),m=ye(()=>l.common_question_list?JSON.parse(l.common_question_list):[]),r=$([]);r.value=m.value,de(m,()=>{r.value=m.value});const a=Ne.useForm,s=$(!1),q=$("添加问题"),o=B({question:"",index:-1}),x=B({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:c,validate:w,validateInfos:p}=a(o,x),d=()=>{if(m.value.length>=10)return X.error("最多设置10条常用问题");s.value=!0,c(),o.question="",o.index=-1},S=(y,u)=>{s.value=!0,c(),o.question=y,o.index=u},L=y=>{let u=[];u=m.value.filter((j,R)=>y!=R),ee.confirm({title:"提醒",icon:t(yt),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){g({common_question_list:JSON.stringify(u)})},onCancel(){}})},E=()=>{w().then(()=>{let y=[];o.index>=0?y=m.value.map((u,j)=>j===o.index?o.question:u):y=[o.question,...m.value],g({common_question_list:JSON.stringify(y)}),s.value=!1})},h=y=>{g({})},M=y=>{g({common_question_list:JSON.stringify(r.value)})};return(y,u)=>{const j=ce,R=te,A=Bt,U=oe,N=le,H=ue,D=Pt,K=Ne,b=ee;return n(),v("div",Ql,[e("div",Fl,[t(Z,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[t(j,null,{title:i(()=>[I("最多10条。开启后，常见问题会显示在每条问答后面")]),default:i(()=>[t(k(Y),{class:"quess-icon"})]),_:1})]),extra:i(()=>[t(R,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_common_question,"onUpdate:checked":u[0]||(u[0]=f=>k(l).enable_common_question=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(A,{type:"vertical"}),t(U,{type:"primary",size:"small",onClick:d},{default:i(()=>[I("添加")]),_:1})]),default:i(()=>[m.value.length==0?(n(),v("div",Jl,[Kl,Gl,Hl,t(U,{onClick:d,type:"primary"},{default:i(()=>[I("立即添加")]),_:1})])):(n(),v("div",Wl,[t(k(Ae),{modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=f=>r.value=f),handle:".drag-btn","item-key":"index",onEnd:M},{item:i(({element:f,index:me})=>[(n(),v("div",{class:"list-item",key:me},[e("span",Zl,[t(N,{name:"drag"})]),e("div",Yl,C(f),1),e("div",Xl,[t(k(Tt),{onClick:Ue=>S(f,me)},null,8,["onClick"]),t(k(ve),{onClick:Ue=>L(me)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",ec,[tc,e("div",oc,[sc,m.value.length&&k(l).enable_common_question=="true"?(n(),v("div",nc,[ic,(n(!0),v(P,null,J(m.value,f=>(n(),v("div",{class:"list-item",key:f},C(f),1))),128))])):V("",!0)]),ac]),t(b,{open:s.value,"onUpdate:open":u[3]||(u[3]=f=>s.value=f),title:q.value,onOk:E,width:"476px"},{default:i(()=>[t(K,{class:"form-box",layout:"vertical"},{default:i(()=>[t(D,dt({label:"问题名称"},k(p).question),{default:i(()=>[t(H,{maxLength:100,value:o.question,"onUpdate:value":u[2]||(u[2]=f=>o.question=f),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},cc=T(lc,[["__scopeId","data-v-5125783f"]]),rc=e("span",null,null,-1),_c=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),dc={__name:"display-aitations",setup(_){const{robotInfo:l,updateRobotInfo:g}=G("robotInfo"),m=$(!1);de(()=>l.answer_source_switch,a=>{m.value=a=="true"},{immediate:!0});const r=()=>{g({answer_source_switch:m.value?"true":"false"})};return(a,s)=>(n(),z(Nl,{title:"显示引文","icon-name":"jibenpeizhi",value:m.value,"onUpdate:value":s[0]||(s[0]=q=>m.value=q),onChange:r},{extra:i(()=>[rc]),default:i(()=>[_c]),_:1},8,["value"]))}},Xe=_=>(Q("data-v-4948feb9"),_=_(),F(),_),uc=Xe(()=>e("span",null,null,-1)),pc=Xe(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),mc={__name:"show-like",setup(_){const{robotInfo:l,updateRobotInfo:g}=G("robotInfo"),m=r=>{g({})};return(r,a)=>{const s=te;return n(),z(Z,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>[uc]),default:i(()=>[pc,t(s,{onChange:m,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(l).feedback_switch,"onUpdate:checked":a[0]||(a[0]=q=>k(l).feedback_switch=q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},vc=T(mc,[["__scopeId","data-v-4948feb9"]]),hc={key:0,class:"robot-config-page"},fc={class:"setting-box"},bc={class:"setting-box"},yc={class:"setting-box"},kc={class:"setting-box"},gc={class:"setting-box"},$c={class:"setting-box"},xc={class:"setting-box"},wc={class:"setting-box"},Sc={class:"setting-box"},qc={class:"setting-box"},Cc={class:"setting-box"},Ic={class:"setting-box"},Lc={class:"setting-box"},Uc={key:1,class:"robot-config-page"},Ec={__name:"index",setup(_){const l=Qt(),g=$(null),{robotInfo:m}=ut(l),{getRobot:r}=l,a=()=>{g.value.scrollTop=g.value.scrollHeight},s=$(1),q=$(!1),o=B(m.value);pt("robotInfo",{robotInfo:o,updateRobotInfo:w=>{let p=JSON.parse(JSON.stringify(w));w.robot_avatar&&(p.robot_avatar=new File([w.robot_avatar],w.robot_avatar.name)),Object.assign(o,p),c()},scrollBoxToBottom:a});const c=()=>{let w;o.robot_avatar&&(w=new File([o.robot_avatar],o.robot_avatar.name));let p=JSON.parse(JSON.stringify(W(o)));w&&(p.robot_avatar=w);let d=p.welcomes;d.question=d.question.map(L=>L.content),p.welcomes=JSON.stringify(d),p.prompt_struct=JSON.stringify(p.prompt_struct);let S=p.unknown_question_prompt;S.question=S.question.map(L=>L.content),p.unknown_question_prompt=JSON.stringify(S),delete p.robot_avatar_url,q.value=!0,$t(p).then(L=>{if(L.res!=0)return X.error(L.msg);q.value=!1,X.success("保存成功"),r(o.id)}).catch(()=>{q.value=!1})};return(w,p)=>{const d=Te,S=Be;return n(),v(P,null,[t(S,{class:"tab-wrapper",activeKey:s.value,"onUpdate:activeKey":p[0]||(p[0]=L=>s.value=L)},{default:i(()=>[(n(),z(d,{key:1,tab:"基础配置"})),(n(),z(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),s.value==1?(n(),v("div",hc,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:g},[e("div",fc,[t(fo)]),e("div",bc,[t(Hi)]),e("div",yc,[t(En)]),e("div",kc,[t(Sl)]),e("div",gc,[t(Bs)]),e("div",$c,[t(pa)]),e("div",xc,[t(wa)]),e("div",wc,[t(Va)]),e("div",Sc,[t(Za)]),e("div",qc,[t(Pa)]),e("div",Cc,[t(Ka)]),e("div",Ic,[t(dc)]),e("div",Lc,[t(vc)])],512)])):(n(),v("div",Uc,[t(cc)]))],64)}}},Jr=T(Ec,[["__scopeId","data-v-387189e7"]]);export{Jr as default};
