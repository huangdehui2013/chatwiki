import{k as t,b as re,M as h,N as L,F as H,$ as Me,W as o,Z as q,a7 as S,Q as R,S as n,Y as p,a6 as W,a0 as B,e as x,u as k,a1 as _e,a2 as de,a4 as ge,B as me,x as Se,V as le,G as Q,H as J,z as Ae}from"./vue-chunks-DWnFCQSz.js";import{a as Fe,c as ze,g as Ue,d as Be}from"./index-DIUiarE3.js";import{A as Ne,b as ee,e as ye,d as ke,M as ce,k as ie,be as X,bf as K,l as Te,bg as qe,E as Re,B as De}from"../../index-UhR4yadr.js";import{_ as be,M as Ce}from"./index-5i8OLAzS.js";import"./index-BJ7TpmPl.js";import{D as we}from"./dropdown-CbxGUAy7.js";import{_ as xe}from"./index-kKxyythX.js";import{R as fe}from"./RightOutlined-BxQrTxvt.js";import{A as Pe}from"./avatar-input-BYUxlGNo.js";import{t as Ve}from"./validate-8MtiUsxW.js";import{M as ne}from"./model-select-6loF5tMn.js";import{O as Ee}from"./open-grapg-modal-CP0saIUH.js";import{F as he,_ as He}from"./index-DzuDS3Yk.js";import{C as Ge}from"./CaretDownOutlined-DbQ_eVB2.js";import"./index--Qvpscnx.js";import{I as je}from"./Input-D7W5TJDt.js";import{Q as Y}from"./QuestionCircleOutlined-CV_adx6X.js";import{_ as Ze}from"./TextArea-CpTIlaWe.js";import{_ as Qe}from"./index-9VXz7HRC.js";import{_ as Je}from"./index-BnhNOVTI.js";import{_ as Ye}from"./index-DrSPxL4Q.js";import{_ as We}from"./index-CovtKLUB.js";import{P as Xe}from"./page-tabs-C372lWrl.js";import{_ as Ke}from"./page-alert-D2HQP2uX.js";import{L as et}from"./list-tabs-DDocff8L.js";import{P as tt}from"./PlusOutlined-CeclvJCi.js";import"./index-DzhuYAPB.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./shallowequal-C0Ji8tJB.js";import"./Trigger-DcWVD-r5.js";import"./collapseMotion-ByInPrfq.js";import"./slide-BR5NTmcW.js";import"./index-DXeZ5ybK.js";import"./Dropdown-lzT8P96r.js";import"./move-cWZng2f8.js";import"./colors-BiofrUQp.js";import"./index-BJ4SSG33.js";import"./partition-CNXo-yhR.js";import"./Password-XreinKYD.js";import"./inputProps-CiDWLiIl.js";import"./CheckOutlined-B_iCQ6FL.js";import"./useRefs-CH9tJ50T.js";import"./FormItemContext-BJa1evck.js";import"./index-cS6xwXeR.js";import"./isPlainObject-BeqP4IC7.js";import"./responsiveObserve-Bs6--9PQ.js";import"./index-DmSlXGTl.js";import"./Search-BRb_v-2B.js";import"./SearchOutlined-bV5WeZB5.js";import"./statusUtils--roYFmJe.js";import"./DownOutlined-CvDOGKH1.js";import"./UpOutlined-BkQ7BaZ8.js";var at={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};const ot=at;function ve(i){for(var m=1;m<arguments.length;m++){var f=arguments[m]!=null?Object(arguments[m]):{},y=Object.keys(f);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(f).filter(function(d){return Object.getOwnPropertyDescriptor(f,d).enumerable}))),y.forEach(function(d){lt(i,d,f[d])})}return i}function lt(i,m,f){return m in i?Object.defineProperty(i,m,{value:f,enumerable:!0,configurable:!0,writable:!0}):i[m]=f,i}var ue=function(m,f){var y=ve({},m,f.attrs);return t(Ne,ve({},y,{icon:ot}),null)};ue.displayName="CaretRightOutlined";ue.inheritAttrs=!1;const nt=ue,st={class:"list-box"},it=["onClick"],rt={class:"library-info"},_t=["src"],dt={class:"library-info-content"},ct={class:"library-title"},ut={class:"library-type"},pt={key:0,class:"type-tag"},mt={key:1,class:"type-tag"},ft={key:2,class:"type-tag"},ht={class:"item-body"},vt={class:"library-desc"},gt={class:"item-footer"},yt={class:"library-size"},kt={class:"text-item"},bt={class:"text-item"},Ct={class:"text-item"},wt=["onClick"],xt={__name:"index",props:{list:{type:Array,default:()=>[]}},emits:["add","edit","delete"],setup(i,{emit:m}){const f=m,y=ye(),d=re(()=>{var v;return((v=y.companyInfo)==null?void 0:v.neo4j_status)=="true"}),z=i,b=v=>{f("edit",v)},A=v=>{f("delete",v)};return(v,e)=>{const C=xe,I=ke,w=be,P=Ce,F=we;return h(),L("div",st,[(h(!0),L(H,null,Me(z.list,c=>(h(),L("div",{class:"list-item-wrapper",key:c.id},[o("div",{class:"list-item",onClick:B(O=>b(c),["stop"])},[o("div",rt,[o("img",{class:"library-icon",src:c.avatar,alt:""},null,8,_t),o("div",dt,[o("div",ct,q(c.library_name),1),o("div",ut,[c.type==0?(h(),L("span",pt,"普通知识库")):S("",!0),c.type==1?(h(),L("span",mt,"对外知识库")):S("",!0),c.type==2?(h(),L("span",ft,"问答知识库")):S("",!0),d.value?(h(),R(C,{key:3},{title:n(()=>[p(q(c.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:n(()=>[o("span",{class:W(["type-tag graph-tag",{"gray-tag":c.graph_switch==0}])},"Graph",2)]),_:2},1024)):S("",!0)])])]),o("div",ht,[o("div",vt,q(c.library_intro),1)]),o("div",gt,[o("div",yt,[o("span",kt,"文档："+q(c.file_total),1),o("span",bt,"大小："+q(c.file_size_str),1),o("span",Ct,"关联应用："+q(c.robot_nums||0),1)]),o("div",{class:"action-box",onClick:e[1]||(e[1]=B(()=>{},["stop"]))},[t(F,null,{overlay:n(()=>[t(P,null,{default:n(()=>[t(w,null,{default:n(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:B(O=>A(c),["stop"])},"删 除",8,wt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[o("div",{class:"action-item",onClick:e[0]||(e[0]=B(()=>{},["stop"]))},[t(I,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,it)]))),128))])}}},$t=ee(xt,[["__scopeId","data-v-56595f2f"]]),Lt="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.8066%2055.3034C14.0866%2051.3489%2011.0624%2045.5975%2015.5685%2027.6849C20.074%209.77234%2025.4347%206.23271%2041.1546%2010.1872C56.8746%2014.1417%2059.8378%2019.7747%2055.3323%2037.6873C50.8267%2055.5999%2045.5265%2059.2579%2029.8059%2055.3034H29.8066Z'%20fill='%232475FC'/%3e%3cpath%20d='M27.6401%2056.8699C9.97054%2056.8699%205.24487%2051.5938%205.24487%2031.46C5.24487%2011.3261%209.97054%206.15887%2027.6401%206.15887C45.3096%206.15887%2049.9398%2011.3261%2049.9398%2031.46C49.9398%2051.5938%2045.3096%2056.8699%2027.6401%2056.8699Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M38.7639%2045.5143H36.8936C36.3373%2045.5143%2035.8577%2045.4677%2035.4549%2045.3743C35.052%2045.281%2034.7067%2045.1363%2034.419%2044.9403C34.1313%2044.7443%2033.8867%2044.497%2033.6853%2044.1983C33.4838%2043.8997%2033.2968%2043.5543%2033.1242%2043.1623C32.8364%2042.453%2032.5727%2041.809%2032.3329%2041.2303C32.0931%2040.6517%2031.8869%2040.1477%2031.7142%2039.7183C31.5032%2039.233%2031.3114%2038.785%2031.1388%2038.3743H23.974C23.8397%2038.8037%2023.6767%2039.2703%2023.4849%2039.7743C23.3314%2040.2037%2023.13%2040.7217%2022.8806%2041.3283C22.6312%2041.935%2022.3435%2042.593%2022.0174%2043.3023C21.6337%2044.1423%2021.1925%2044.721%2020.6938%2045.0383C20.195%2045.3557%2019.6291%2045.5143%2018.9961%2045.5143H17.0107C16.1667%2045.5143%2015.596%2045.3323%2015.2986%2044.9683C15.0013%2044.6043%2015.0253%2043.9837%2015.3706%2043.1063C15.7159%2042.2663%2016.1187%2041.277%2016.5791%2040.1383C17.0395%2038.9997%2017.5286%2037.791%2018.0466%2036.5123C18.5645%2035.2337%2019.1016%2033.9223%2019.6579%2032.5783C20.2142%2031.2343%2020.7513%2029.9183%2021.2693%2028.6303C22.497%2025.625%2023.7822%2022.4983%2025.125%2019.2503C25.2593%2018.933%2025.4319%2018.6437%2025.6429%2018.3823C25.8347%2018.177%2026.0889%2017.981%2026.4054%2017.7943C26.7219%2017.6077%2027.12%2017.5143%2027.5996%2017.5143C28.0983%2017.5143%2028.5059%2017.6123%2028.8224%2017.8083C29.139%2018.0043%2029.4027%2018.2237%2029.6137%2018.4663C29.8439%2018.7463%2030.0262%2019.0543%2030.1604%2019.3903C31.5224%2022.6757%2032.8172%2025.821%2034.0449%2028.8263C34.5629%2030.1143%2035.1%2031.4257%2035.6563%2032.7603C36.2126%2034.095%2036.7449%2035.3923%2037.2532%2036.6523C37.7616%2037.9123%2038.2412%2039.093%2038.6919%2040.1943C39.1427%2041.2957%2039.5312%2042.2477%2039.8573%2043.0503C40.1259%2043.685%2040.1642%2044.2543%2039.9724%2044.7583C39.7806%2045.2623%2039.3777%2045.5143%2038.7639%2045.5143ZM30.4194%2034.8743L27.6859%2025.3823H27.6571L24.607%2034.8743H30.4194Z'%20fill='white'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2062%2062'%20class='design-iconfont'%3e%3cpath%20d='M0%2014.5882C0%206.53137%206.53137%200%2014.5882%200H47.4118C55.4686%200%2062%206.53137%2062%2014.5882V47.4118C62%2055.4686%2055.4686%2062%2047.4118%2062H14.5882C6.53137%2062%200%2055.4686%200%2047.4118V14.5882Z'%20fill='%234876FF'/%3e%3cg%20filter='url(%23kd70btl3k__filter0_d_7802_38768)'%3e%3cpath%20d='M42.8433%2015.6719H27.4866C24.6533%2015.6719%2022.33%2017.9952%2022.33%2020.8852V32.6152C22.33%2035.5052%2024.6533%2037.8285%2027.4866%2037.8285H37.861L41.4876%2041.1719C42.5076%2042.1352%2044.2643%2041.4552%2044.2643%2040.0385V37.7719C47.041%2037.7719%2048%2035.4485%2048%2032.6152V20.8852C48%2017.9952%2045.6766%2015.6719%2042.8433%2015.6719Z'%20fill='%23D6E0FF'/%3e%3cpath%20d='M36.9952%2017.1719H19.7806C16.6044%2017.1719%2014%2019.7763%2014%2023.016V36.1652C14%2039.3413%2016.5409%2041.9458%2019.6535%2042.0093V44.5502C19.6535%2046.1383%2021.6227%2046.9005%2022.7661%2045.8206L26.8316%2042.0728H36.9952C40.1714%2042.0728%2042.7758%2039.4684%2042.7758%2036.2287V23.016C42.7758%2019.7763%2040.1714%2017.1719%2036.9952%2017.1719Z'%20fill='%23EBF0FF'/%3e%3cpath%20d='M35.8572%2028.9015C35.8572%2026.5396%2035.2018%2024.6658%2033.8911%2023.2801C32.5804%2021.8944%2030.8072%2021.1995%2028.5715%2021.1953C26.342%2021.1953%2024.5709%2021.8881%2023.2581%2023.2738C21.9453%2024.6595%2021.2878%2026.5259%2021.2858%2028.8732C21.2858%2031.1973%2021.9401%2033.0564%2023.2487%2034.4505C24.5574%2035.8446%2026.2974%2036.5427%2028.4688%2036.5447C29.0683%2036.5626%2029.6676%2036.5012%2030.2514%2036.3621C30.3074%2036.4093%2030.9638%2037.4265%2031.7726%2037.8863C32.3384%2038.2078%2033.0977%2038.2247%2033.6736%2038.1731C34.1554%2038.1299%2034.4572%2037.6737%2034.3836%2037.1957C34.3104%2036.7211%2033.8837%2036.3943%2033.42%2036.2696C33.3237%2036.2437%2033.2286%2036.2126%2033.1352%2036.1763C32.8819%2036.0309%2032.6781%2035.8113%2032.5503%2035.5464C34.757%2034.1965%2035.8593%2031.9815%2035.8572%2028.9015ZM31.278%2032.8475L31.1286%2033.0396C31.0602%2033.131%2030.6433%2032.1641%2029.6292%2031.8492C29.0996%2031.7142%2028.5513%2031.6807%2028.0124%2031.7487C27.6975%2031.7884%2027.4827%2032.0714%2027.4827%2032.3888C27.4827%2032.7549%2027.771%2033.0497%2028.1222%2033.153C28.3685%2033.2254%2028.6053%2033.33%2028.8266%2033.4648C29.2341%2033.7797%2029.5919%2034.186%2029.4176%2034.2332C29.113%2034.3135%2028.7992%2034.3527%2028.4844%2034.3497C27.9396%2034.3544%2027.403%2034.2154%2026.9274%2033.9465C26.4518%2033.6776%2026.0535%2033.288%2025.7717%2032.816C25.0935%2031.7873%2024.7534%2030.4394%2024.7513%2028.7724C24.7492%2027.1054%2025.0894%2025.7565%2025.7717%2024.7256C26.0684%2024.2609%2026.4754%2023.8788%2026.9555%2023.6142C27.4356%2023.3497%2027.9735%2023.2111%2028.5201%2023.2111C29.0668%2023.2111%2029.6047%2023.3497%2030.0848%2023.6142C30.5649%2023.8788%2030.9719%2024.2609%2031.2686%2024.7256C31.9592%2025.7313%2032.3046%2027.0739%2032.3046%2028.7535C32.3046%2030.4772%2031.9624%2031.8419%2031.278%2032.8475Z'%20fill='%234876FF'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='kd70btl3k__filter0_d_7802_38768'%20x='9.875'%20y='15.6719'%20width='42.25'%20height='38.9023'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='4.125'/%3e%3cfeGaussianBlur%20stdDeviation='2.0625'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20values='0%200%200%200%200.413084%200%200%200%200%200.250874%200%200%200%200%200.0886636%200%200%200%200.14%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20result='effect1_dropShadow_7802_38768'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect1_dropShadow_7802_38768'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",G=i=>(_e("data-v-107545a2"),i=i(),de(),i),Ot={class:"add-libray-popup",ref:"modal"},Mt={class:"add-libray-popup-body"},St=G(()=>o("div",{class:"popup-title"},"新建知识库",-1)),At={class:"libray-type-list"},Ft=G(()=>o("div",{class:"libray-item-header"},[o("img",{class:"libray-icon",src:Lt,alt:""}),o("div",{class:"libray-type-name"},"普通知识库")],-1)),zt=G(()=>o("div",{class:"libray-desc"}," 导入文档或网页创建知识库，知识库可以与聊天机器人或工作流关联。用户和机器人聊天时，机器人可以引用知识库内知识回复用户 ",-1)),Ut={class:"libray-action"},Bt=G(()=>o("div",{class:"libray-item-header"},[o("img",{class:"libray-icon",src:It,alt:""}),o("div",{class:"libray-type-name"},"问答知识库")],-1)),Nt=G(()=>o("div",{class:"libray-desc"}," 通过excel或者word导入FAQ问答对构建知识库，适合客服场景或者需要用FAQ问答数据精确回答的场景。用户提问时，如果系统检索到与用户问题匹配度很高的问答对，会直接回复对应的答案。 ",-1)),Tt={class:"libray-action"},qt={__name:"add-libray-popup",emits:["ok"],setup(i,{expose:m,emit:f}){const y=f,d=x(!1),z=()=>{d.value=!0},b=()=>{d.value=!1},A=e=>{d.value=!1,y("ok",e)},v=e=>{A(e)};return m({show:z,close:b}),(e,C)=>{const I=ce;return h(),L("div",Ot,[t(I,{footer:null,getContainer:()=>e.$refs.modal,open:d.value,"onUpdate:open":C[2]||(C[2]=w=>d.value=w),title:"",width:520,onOk:A},{default:n(()=>[o("div",Mt,[St,o("div",At,[o("div",{class:"libray-item",onClick:C[0]||(C[0]=w=>v(0))},[Ft,zt,o("div",Ut,[t(k(fe))])]),o("div",{class:"libray-item",onClick:C[1]||(C[1]=w=>v(2))},[Bt,Nt,o("div",Tt,[t(k(fe))])])])])]),_:1},8,["getContainer","open"])],512)}}},Rt=ee(qt,[["__scopeId","data-v-107545a2"]]),D=i=>(_e("data-v-68a9a7d5"),i=i(),de(),i),Dt={class:"form-box"},Pt=D(()=>o("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1)),Vt=D(()=>o("span",{style:{color:"#8c8c8c"}},"适用于高级用户",-1)),Et=D(()=>o("div",{class:"form-alert-tip"},"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段",-1)),Ht={class:"select-card-box"},Gt={class:"card-title"},jt=D(()=>o("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),Zt={class:"card-title"},Qt=D(()=>o("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),Jt={class:"card-title"},Yt=D(()=>o("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),Wt={class:"graph-switch-box"},Xt={class:"lable-text"},se="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Kt={__name:"add-library-model",setup(i,{expose:m}){const f=ye(),y=re(()=>{var a;return((a=f.companyInfo)==null?void 0:a.neo4j_status)=="true"});ie.config({duration:2});const d=x(!0),z=ge(),b=x(!1),A=he.useForm,v=x(!1),e=me({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:se}),C=me({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:I,validateInfos:w}=A(e,C),P=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},F=x([]);Fe().then(a=>{F.value=a.data.map(l=>({label:l.name,value:l.no}))});const c=a=>{e.chunk_type=a},O=x([]),j=a=>{O.value=a,Ae(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&te()})},te=()=>{if(O.value.length>0){let a=null,l=null;for(let M of O.value)if(M.model_define==="tongyi"){a=M;for(let r of a.children)if(r.name==="qwen-max"){l=r;break}break}a||(a=O.value[0],l=a.children[0]),a&&l&&(e.ai_chunk_model=l.name,e.ai_chunk_model_config_id=l.model_config_id)}},u=a=>{a.length&&(e.use_model=a[0].children[0].name,e.model_config_id=a[0].model_config_id)},_=x(null),$=a=>{if(a){let l={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&O.value.length>0){let M=O.value[0];if(M){let r=M.children[0];l.graph_use_model=r.name,l.graph_model_config_id=r.model_config_id}}_.value.show(l)}else e.graph_switch=!1},g=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model)},ae=()=>{b.value=!1},oe=()=>{I().then(()=>{V()}).catch(a=>{})},V=()=>{let a=new FormData,l=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",l.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(Ve(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),a.append("chunk_type",e.chunk_type),a.append("normal_chunk_default_separators_no",e.normal_chunk_default_separators_no.join(",")),a.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),a.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),a.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),a.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),a.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),a.append("graph_switch",e.graph_switch?1:0),a.append("graph_model_config_id",e.graph_model_config_id),a.append("graph_use_model",e.graph_use_model),a.append("ai_chunk_size",e.ai_chunk_size),a.append("ai_chunk_model",e.ai_chunk_model),a.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),a.append("ai_chunk_prumpt",e.ai_chunk_prumpt),v.value=!0,ze(a).then(M=>{ie.success("创建成功"),b.value=!1;let r="/library/details/knowledge-document",E={id:M.data.id};e.doc_type==3&&(r="/library/preview",E={id:M.data.file_ids[0]}),z.push({path:r,query:E}),v.value=!1,b.value=!1}).catch(()=>{v.value=!1})};return m({show:({type:a})=>{e.type=a,a==0?(e.avatar=X,e.avatar_file=X):(e.avatar=K,e.avatar_file=K),e.library_name="",e.library_intro="",e.chunk_type=1,e.normal_chunk_default_separators_no=[10,12],e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=se,b.value=!0}}),Se(()=>{}),(a,l)=>{const M=je,r=He,E=Ze,Z=xe,N=ke,$e=Qe,T=Je,U=Ye,Le=We,Ie=he,Oe=ce;return h(),L(H,null,[t(Oe,{open:b.value,"onUpdate:open":l[21]||(l[21]=s=>b.value=s),title:"添加知识库",onOk:oe,confirmLoading:v.value,wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onCancel:ae,width:"620px"},{default:n(()=>[o("div",Dt,[t(Ie,{layout:"vertical"},{default:n(()=>[t(r,le({ref:"name",label:"知识库名称"},k(w).library_name),{default:n(()=>[t(M,{value:e.library_name,"onUpdate:value":l[0]||(l[0]=s=>e.library_name=s),placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),t(r,le({label:"知识库简介"},k(w).library_intro),{default:n(()=>[t(E,{maxlength:1e3,value:e.library_intro,"onUpdate:value":l[1]||(l[1]=s=>e.library_intro=s),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1},16),t(r,le({ref:"name",label:"知识库封面"},k(w).avatar),{default:n(()=>[t(Pe,{value:e.avatar,"onUpdate:value":l[2]||(l[2]=s=>e.avatar=s),onChange:P},null,8,["value"]),Pt]),_:1},16),o("div",{class:"hight-set-text",onClick:l[3]||(l[3]=s=>d.value=!d.value)},[d.value?(h(),R(k(nt),{key:0})):(h(),R(k(Ge),{key:1})),p(" 高级设置 "),Vt]),Q(t(r,null,{label:n(()=>[p("文档解析向量模型 "),t(Z,null,{title:n(()=>[p("向量模型可以将分段数据转化为向量形式，存储到向量数据库中，便于后续根据用户问题查询匹配。")]),default:n(()=>[t(k(Y),{class:"ml4"})]),_:1})]),default:n(()=>[t(ne,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":l[4]||(l[4]=s=>e.use_model=s),modeId:e.model_config_id,"onUpdate:modeId":l[5]||(l[5]=s=>e.model_config_id=s),onLoaded:u,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[J,!d.value]]),Q(o("div",null,[t(r,{label:"分段方式",required:""},{default:n(()=>[Et,o("div",Ht,[o("div",{class:W(["select-card-item",{active:e.chunk_type==1}]),onClick:l[6]||(l[6]=s=>c(1))},[t(N,{class:"check-arrow",name:"check-arrow-filled"}),o("div",Gt,[t(N,{name:"ordinary-segmentation",class:"title-icon"}),p(" 普通分段 ")]),jt],2),o("div",{class:W(["select-card-item",{active:e.chunk_type==2}]),onClick:l[7]||(l[7]=s=>c(2))},[t(N,{class:"check-arrow",name:"check-arrow-filled"}),o("div",Zt,[t(N,{name:"semantic-segmentation",class:"title-icon"}),p(" 语义分段 ")]),Qt],2),o("div",{class:W(["select-card-item",{active:e.chunk_type==3}]),onClick:l[8]||(l[8]=s=>c(3))},[t(N,{class:"check-arrow",name:"check-arrow-filled"}),o("div",Jt,[t(N,{name:"semantic-segmentation",class:"title-icon"}),p(" AI分段 ")]),Yt],2)])]),_:1}),e.chunk_type==1?(h(),L(H,{key:0},[t(r,{label:"分段标识符",required:""},{default:n(()=>[t($e,{value:e.normal_chunk_default_separators_no,"onUpdate:value":l[9]||(l[9]=s=>e.normal_chunk_default_separators_no=s),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:F.value},null,8,["value","options"])]),_:1}),t(U,null,{default:n(()=>[t(r,{label:"分段最大长度",required:""},{default:n(()=>[t(U,{gap:8,align:"center"},{default:n(()=>[t(T,{value:e.normal_chunk_default_chunk_size,"onUpdate:value":l[10]||(l[10]=s=>e.normal_chunk_default_chunk_size=s),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),p(" 字符 ")]),_:1})]),_:1}),t(r,{label:"分段重叠长度"},{default:n(()=>[t(U,{gap:8,align:"center"},{default:n(()=>[t(T,{value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":l[11]||(l[11]=s=>e.normal_chunk_default_chunk_overlap=s),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),p(" 字符 ")]),_:1})]),_:1})]),_:1})],64)):S("",!0),e.chunk_type==2?(h(),L(H,{key:1},[e.chunk_type==2?(h(),R(r,{key:0,required:""},{label:n(()=>[p(" 分段阈值 "),t(Z,null,{title:n(()=>[p("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:n(()=>[t(k(Y),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:n(()=>[t(T,{value:e.semantic_chunk_default_threshold,"onUpdate:value":l[12]||(l[12]=s=>e.semantic_chunk_default_threshold=s),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):S("",!0),t(U,null,{default:n(()=>[t(r,{label:"分段最大长度",required:""},{default:n(()=>[t(U,{gap:8,align:"center"},{default:n(()=>[t(T,{value:e.semantic_chunk_default_chunk_size,"onUpdate:value":l[13]||(l[13]=s=>e.semantic_chunk_default_chunk_size=s),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),p(" 字符 ")]),_:1})]),_:1}),t(r,{label:"分段重叠长度"},{default:n(()=>[t(U,{gap:8,align:"center"},{default:n(()=>[t(T,{value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":l[14]||(l[14]=s=>e.semantic_chunk_default_chunk_overlap=s),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),p(" 字符 ")]),_:1})]),_:1})]),_:1})],64)):S("",!0),e.chunk_type==3?(h(),L(H,{key:2},[e.chunk_type==3?(h(),R(r,{key:0,required:""},{label:n(()=>[p(" AI大模型 ")]),default:n(()=>[t(ne,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":l[15]||(l[15]=s=>e.ai_chunk_model=s),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":l[16]||(l[16]=s=>e.ai_chunk_model_config_id=s),style:{width:"100%"},onLoaded:j},null,8,["modeName","modeId"])]),_:1})):S("",!0),t(r,{label:"提示词设置",required:""},{default:n(()=>[t(U,{gap:8,align:"center"},{default:n(()=>[t(E,{maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":l[17]||(l[17]=s=>e.ai_chunk_prumpt=s),placeholder:se},null,8,["value"])]),_:1})]),_:1}),t(r,null,{label:n(()=>[p(" 单次最大字符数 "),t(Z,null,{title:n(()=>[p("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:n(()=>[t(k(Y),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:n(()=>[t(T,{class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":l[18]||(l[18]=s=>e.ai_chunk_size=s),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:s=>parseInt(s),parser:s=>parseInt(s)},null,8,["value","formatter","parser"]),p(" 字符 ")]),_:1})],64)):S("",!0),Q(o("div",Wt,[o("div",Xt,[p(" 生成知识图谱 "),t(Z,null,{title:n(()=>[p("文件分块后，所有块将用于生成知识图谱，提高复杂问题推理能力。")]),default:n(()=>[t(k(Y),{class:"ml4"})]),_:1})]),t(Le,{onChange:$,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])],512),[[J,y.value]]),Q(t(r,{label:"知识图谱模型"},{default:n(()=>[t(ne,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":l[19]||(l[19]=s=>e.graph_use_model=s),modeId:e.graph_model_config_id,"onUpdate:modeId":l[20]||(l[20]=s=>e.graph_model_config_id=s),style:{width:"300px"},onLoaded:j},null,8,["modeName","modeId"])]),_:1},512),[[J,e.graph_switch&&y.value]])],512),[[J,!d.value&&e.type==0]])]),_:1})])]),_:1},8,["open","confirmLoading"]),t(Ee,{onOk:g,ref_key:"openGrapgModalRef",ref:_},null,512)],64)}}},e2=ee(Kt,[["__scopeId","data-v-68a9a7d5"]]),pe=i=>(_e("data-v-f9af125c"),i=i(),de(),i),t2={"bg-color":"#f5f9ff",class:"library-page"},a2=pe(()=>o("div",null,[o("p",null," 1、知识库可以关联到聊天机器人中使用，创建机器人之前请先创建知识库，然后去机器人设置中关联。 "),o("p",null,"2、知识库支持普通知识库和问答知识库。普通知识库适用于非结构化数据，支持text/doc/pdf/md/html等格式文件，上传后系统会自动分段处理，也支持自定义分段。问答知识库适用于一问一答形式结构化数据，支持通过excel/word批量上传或自定义添加问题和答案。")],-1)),o2={class:"library-page-body"},l2={class:"list-toolbar"},n2={class:"toolbar-box"},s2={class:"toolbar-box"},i2={class:"create-action"},r2=["src"],_2=pe(()=>o("span",null,"普通知识库",-1)),d2={class:"create-action"},c2=["src"],u2=pe(()=>o("span",null,"问答知识库",-1)),p2={__name:"library-list",setup(i){const m=ge(),f=x([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"}]),y=x([{title:"全部 (0)",value:"all"},{title:"普通知识库 (0)",value:"0"},{title:"问答知识库 (0)",value:"2"}]),d=Te();let{role_permission:z}=d;const b=re(()=>z.includes("LibraryCreate")),A=x(null),v=x(null),e=u=>{C(u)},C=u=>{A.value.show({type:u})},I=x("all"),w=x([]),P=()=>{let u=0,_=0,$=0;w.value.forEach(g=>{g.type==0&&(_+=1),g.type==2&&($+=1),u+=1}),y.value=[{title:"全部 ("+u+")",value:"all"},{title:"普通知识库 ("+_+")",value:"0"},{title:"问答知识库 ("+$+")",value:"2"}]},F=()=>{let u=I.value==="all"?"":I.value;Ue({type:u}).then(_=>{let $=_.data||[];$.forEach(g=>{g.file_size_str=qe(g.file_size),g.avatar||(g.avatar=g.type==0?X:K)}),w.value=$,I.value==="all"&&P()})};F();const c=()=>{F()},O=u=>{u.type=="1"?m.push({path:"/public-library/config",query:{library_id:u.id}}):m.push({name:"libraryDetails",query:{id:u.id}})},j=u=>{let _=3,$=ce.confirm({title:`删除${u.library_name}`,icon:t(Re),content:"您确定要删除此知识库吗？",okText:_+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){te(u)},onCancel(){}}),g=setInterval(()=>{_==1?($.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(g),g=void 0):(_-=1,$.update({okText:_+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},te=({id:u})=>{Be({id:u}).then(()=>{ie.success("删除成功"),F()})};return(u,_)=>{const $=De,g=be,ae=Ce,oe=we;return h(),L("div",t2,[t(Xe,{class:"mb-16",tabs:f.value,active:"/library/list"},null,8,["tabs"]),t(Ke,{class:"mb-16",title:"使用说明"},{default:n(()=>[a2]),_:1}),o("div",o2,[o("div",l2,[o("div",n2,[t(et,{tabs:y.value,value:I.value,"onUpdate:value":_[0]||(_[0]=V=>I.value=V),onChange:c},null,8,["tabs","value"])]),o("div",s2,[b.value?(h(),R(oe,{key:0},{overlay:n(()=>[t(ae,null,{default:n(()=>[t(g,{onClick:_[2]||(_[2]=B(V=>e(0),["prevent"]))},{default:n(()=>[o("span",i2,[o("img",{class:"icon",src:k(X),alt:""},null,8,r2),_2])]),_:1}),t(g,{onClick:_[3]||(_[3]=B(V=>e(2),["prevent"]))},{default:n(()=>[o("span",d2,[o("img",{class:"icon",src:k(K),alt:""},null,8,c2),u2])]),_:1})]),_:1})]),default:n(()=>[t($,{type:"primary",onClick:_[1]||(_[1]=B(()=>{},["prevent"]))},{icon:n(()=>[t(k(tt))]),default:n(()=>[p(" 新建知识库 ")]),_:1})]),_:1})):S("",!0)])]),o("div",null,[t($t,{"show-create":b.value,list:w.value,onEdit:O,onDelete:j},null,8,["show-create","list"])])]),t(Rt,{ref_key:"addLibrayPopup",ref:v,onOk:C},null,512),t(e2,{ref_key:"addLibraryModelRef",ref:A},null,512)])}}},ha=ee(p2,[["__scopeId","data-v-f9af125c"]]);export{ha as default};
