import{I as K,b as E,B as X,d as F,k as T,de as ee}from"../../index-G9f-mAi5.js";import{_ as te}from"./cu-scroll-D0dESsq_.js";import{_ as se}from"./empty-DkpCLaix.js";import{k as i,a4 as Q,e as k,B as oe,d as ne,M as r,N as n,W as e,a7 as y,S as u,Y as h,Q as x,u as w,F as S,a0 as R,a6 as ie,Z as m,a1 as A,a2 as H,a3 as ae}from"./vue-chunks-DKljrDvA.js";import{_ as le}from"./recommendation-AQ4_FPQ9.js";import{c as re}from"./index-BMQPDzC_.js";import{D as ce}from"./DownOutlined-Bpohg83O.js";import{U as _e}from"./UpOutlined-Bj0fisFD.js";import{Q as j}from"./QuestionCircleOutlined-nxul5uCX.js";import{i as de,a as ue,S as me}from"./index-zZJepEpM.js";import{_ as pe}from"./TextArea-DCKr3Wuq.js";import{_ as ve}from"./index-iB9ppu1z.js";import{_ as fe}from"./index-CayWCPQK.js";import{_ as he}from"./index-KiILa72G.js";import{_ as ye}from"./index-CsKJU3Dz.js";import{S as ke}from"./index-BCVTZqK2.js";import"./axios-BZ84_VUH.js";import"./qs-DB0tj3pA.js";import"./crypto-js-fJpLWOEv.js";import"./dayjs-BpZi_McX.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./Trigger-BW7irFFi.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-LTvy7D4z.js";import"./slide-WaU3Tqer.js";import"./index-BGI9PV4t.js";import"./CheckOutlined-DfAqcv9I.js";import"./SearchOutlined-IapCazbA.js";import"./FormItemContext-BeRgkpjf.js";import"./move-ChuBBc75.js";import"./inputProps-BSdok6V2.js";import"./colors-6QtHC0k-.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function D(a){for(var _=1;_<arguments.length;_++){var c=arguments[_]!=null?Object(arguments[_]):{},d=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(p){return Object.getOwnPropertyDescriptor(c,p).enumerable}))),d.forEach(function(p){ge(a,p,c[p])})}return a}function ge(a,_,c){return _ in a?Object.defineProperty(a,_,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[_]=c,a}var U=function(_,c){var d=D({},_,c.attrs);return i(K,D({},d,{icon:be}),null)};U.displayName="LinkOutlined";U.inheritAttrs=!1;const C=a=>(A("data-v-bfd71793"),a=a(),H(),a),xe={class:"recall-settings-box"},$e=C(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),we={class:"form-box"},Le={class:"form-item"},Oe={class:"form-item-body"},Se={class:"form-item"},Re={class:"form-item"},Ce={class:"form-item-label"},ze={class:"form-item-body"},Ne={class:"retrieval-mode-items"},qe=["onClick"],Me={class:"retrieval-mode-title"},Te={class:"title-text"},Ue={key:0,style:{width:"32px"},src:le,alt:""},Be={class:"retrieval-mode-desc"},Ie={class:"form-item"},Pe={class:"form-item-label"},Ve=C(()=>e("span",null,"Top K ",-1)),je={class:"form-item-body"},De={class:"number-box"},Ee={class:"number-slider-box"},Fe={class:"number-input-box"},Qe={key:0,class:"form-item"},Ae={class:"form-item-label"},He=C(()=>e("span",null,"相似度阈值 ",-1)),Ge={class:"form-item-body"},We={class:"number-box"},Ye={class:"number-slider-box"},Ze={class:"number-input-box"},Je={class:"form-item"},Ke={class:"form-item-label"},Xe=C(()=>e("span",null,"Rerank模型",-1)),et={class:"form-item-body"},tt=["src"],st={__name:"recall-testing-form",emits:["save","load"],setup(a,{expose:_,emit:c}){const d=Q(),p=k(!1),$=c,b=k(!0),f=k([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=oe({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:d.query.id}),L=ne(()=>b.value?f.value.filter(v=>v.value==t.search_type):f.value),N=(v,o)=>{t.rerank_model_config_id=o.rerank_model_config_id},q=v=>{t.search_type=v},l=()=>{if(!t.similarity)return T.error("请输入相似度");if(!t.size)return T.error("请输入分段数");if(!t.question)return T.error("请输入测试问题");let v={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(v.rerank_model_config_id=t.rerank_model_config_id),p.value=!0,$("load"),ee(v).then(o=>{$("save",o.data)}).catch(()=>{$("save",[])}).finally(()=>{p.value=!1})},M=k([]);return(()=>{re({model_type:"RERANK"}).then(v=>{let o=v.data||[];M.value=o.map(g=>({id:g.model_config.id,name:g.model_info.model_name,icon:g.model_info.model_icon_url,children:g.model_info.rerank_model_list}))})})(),_({open}),(v,o)=>{const g=pe,G=X,B=F,I=ve,P=fe,V=he,W=ye,Y=ue,Z=de,J=me;return n(),r("div",xe,[$e,e("div",we,[e("div",Le,[e("div",Oe,[i(g,{style:{height:"76px"},value:t.question,"onUpdate:value":o[0]||(o[0]=s=>t.question=s),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Se,[i(G,{loading:p.value,onClick:l,type:"primary",block:""},{default:u(()=>[h("测试")]),_:1},8,["loading"])]),e("div",Re,[e("div",Ce,[e("div",{class:"hover-label",onClick:o[1]||(o[1]=s=>b.value=!b.value)},[h(" 检索模式 "),b.value?(n(),x(w(ce),{key:0})):(n(),x(w(_e),{key:1}))])]),e("div",ze,[e("div",Ne,[(n(!0),r(S,null,R(L.value,s=>(n(),r("div",{class:ie(["retrieval-mode-item",{active:t.search_type==s.value}]),key:s.value,onClick:O=>q(s.value)},[t.search_type==s.value?(n(),x(B,{key:0,class:"check-arrow",name:"check-arrow-filled"})):y("",!0),e("div",Me,[i(B,{name:s.iconName,class:"title-icon"},null,8,["name"]),e("span",Te,m(s.title),1),s.isRecommendation?(n(),r("img",Ue)):y("",!0)]),e("div",Be,m(s.desc),1)],10,qe))),128))])])]),e("div",Ie,[e("div",Pe,[Ve,i(I,null,{title:u(()=>[h("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[i(w(j),{class:"question-icon"})]),_:1})]),e("div",je,[e("div",De,[e("div",Ee,[i(P,{class:"custom-slider",value:t.size,"onUpdate:value":o[2]||(o[2]=s=>t.size=s),min:1,max:10},null,8,["value"])]),e("div",Fe,[i(V,{value:t.size,"onUpdate:value":o[3]||(o[3]=s=>t.size=s),min:1,max:10},null,8,["value"])])])])]),t.search_type<=2?(n(),r("div",Qe,[e("div",Ae,[He,i(I,null,{title:u(()=>[h("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:u(()=>[i(w(j),{class:"question-icon"})]),_:1})]),e("div",Ge,[e("div",We,[e("div",Ye,[i(P,{class:"custom-slider",value:t.similarity,"onUpdate:value":o[4]||(o[4]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ze,[i(V,{value:t.similarity,"onUpdate:value":o[5]||(o[5]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])])])])])):y("",!0),e("div",Je,[e("div",Ke,[Xe,h("   "),i(W,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":o[6]||(o[6]=s=>t.rerank_status=s)},null,8,["checked"])]),e("div",et,[i(J,{value:t.rerank_use_model,"onUpdate:value":o[7]||(o[7]=s=>t.rerank_use_model=s),placeholder:"请选择Rerank模型",onChange:N,style:{width:"320px"}},{default:u(()=>[(n(!0),r(S,null,R(M.value,s=>(n(),x(Z,{key:s.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:s.icon,alt:""},null,8,tt)])]),default:u(()=>[(n(!0),r(S,null,R(s.children,O=>(n(),x(Y,{value:O,rerank_model_config_id:s.id,key:O},{default:u(()=>[e("span",null,m(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},ot=E(st,[["__scopeId","data-v-bfd71793"]]),z=a=>(A("data-v-be7f9c8e"),a=a(),H(),a),nt={class:"recall-testing-box"},it={class:"recall-from-box"},at={class:"content-list-box"},lt={key:0,class:"empty-box"},rt=z(()=>e("img",{src:se,alt:""},null,-1)),ct=z(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),_t=[rt,ct],dt={class:"top-block"},ut={class:"title"},mt={key:0,class:"ml4"},pt={class:"info-block"},vt=z(()=>e("span",{class:"gray-text"},"来自：",-1)),ft=["onClick"],ht={key:0},yt=z(()=>e("span",{class:"v-line"},null,-1)),kt={class:"gray-text"},bt={key:0,class:"content-box"},gt={key:1,class:"content-box"},xt=["innerHTML"],$t={key:2,class:"loading-box"},wt={__name:"recall-testing",setup(a){Q(),ae();const _=k(!1),c=k(!1),d=k([]),p=f=>{c.value=!1,d.value=f||[]},$=()=>{c.value=!0},b=f=>{if(!f.file_name){window.open(`/#/library/details/categary-manage?id=${f.library_id}`);return}window.open(`/#/library/preview?id=${f.file_id}`)};return(f,t)=>{const L=te,N=F,q=ke;return n(),r("div",nt,[e("div",it,[i(L,null,{default:u(()=>[i(ot,{onLoad:$,onSave:p})]),_:1})]),e("div",at,[_.value||d.value.length===0?(n(),r("div",lt,_t)):(n(),x(L,{key:1},{default:u(()=>[(n(!0),r(S,null,R(d.value,l=>(n(),r("div",{class:"list-item",key:l.id},[e("div",dt,[e("div",ut,[h(" id："+m(l.id)+" ",1),l.title?(n(),r("div",mt,m(l.title),1)):y("",!0),e("span",null,"共"+m(l.word_total)+"个字符",1)])]),e("div",pt,[vt,e("div",{class:"link-text",onClick:M=>b(l)},[i(w(U)),h(" "+m(l.file_name)+" ",1),l.file_name?y("",!0):(n(),r("span",ht,m(l.library_name)+"-精选",1))],8,ft),yt,e("span",kt,[h("相似度： "),i(N,{name:"similarity",style:{"font-size":"16px"}}),h(" "+m(l.similarity),1)])]),l.question?(n(),r("div",bt,"Q："+m(l.question),1)):y("",!0),l.answer?(n(),r("div",gt,"A："+m(l.answer),1)):y("",!0),e("div",{class:"content-box",innerHTML:l.content},null,8,xt)]))),128))]),_:1})),c.value?(n(),r("div",$t,[i(q)])):y("",!0)])])}}},is=E(wt,[["__scopeId","data-v-be7f9c8e"]]);export{is as default};
