import{e as _,d as K,w as q,x as z,o as F,M as s,N as i,W as g,G as J,F as T,a7 as h,Y as x,Z as y,H as X,a0 as V,$ as w}from"./vue-chunks-DKljrDvA.js";import{b as Y,az as U,aA as Z}from"../../index-G9f-mAi5.js";import{c as Q}from"./index-BMQPDzC_.js";const j={class:"selected-item"},ee=["src"],le={key:0},oe={key:1,class:"placeholder"},ne={key:0,class:"option-group"},te=["src"],ae=["onClick"],se={__name:"index",props:{modelValue:[String,Number],modelType:{type:String,validator:a=>["TEXT EMBEDDING","RERAN","LLM"].includes(a),required:!0},isOffline:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择模型"},groupLabelKey:{type:String,default:"groupLabel"},groupIconKey:{type:String,default:"groupIcon"},iconKey:{type:String,default:"icon"},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},showValue:{type:Boolean,default:!0},modelConfigId:{type:String,default:""}},emits:["update:modelValue","change","loaded"],setup(a,{emit:B}){const r=a,k=B,f=_(!1),M=_(r.placeholder),I=_([]),S=["azure","ollama","xinference","openaiAgent"],b=K(()=>I.value.map(e=>({groupLabel:e.name,groupIcon:e.icon,children:e.children.map(n=>({icon:n.icon,use_model_name:n.use_model_name,value:S.includes(n.model_define)&&n.deployment_name?n.deployment_name:n.name,rawData:n}))}))),u=K(()=>{const{modelConfigId:e,modelValue:n}=r;let l={};if(!(!e&&!n))return C.value.find(o=>{const{rawData:t}=o;S.includes(t.model_define)&&t.deployment_name?(t.deployment_name===n||t.id===e)&&(l=o):t.name===n&&t.id===e&&(l=o)}),l}),C=K(()=>b.value.reduce((e,n)=>e.concat(n.children||[]),[]));function R(e,n,l){const o=new Set(e.map(t=>t.model_define));return n.filter(t=>{let d=t[l];o.has(d)&&e.filter(c=>{if(c.model_define==d)return c.children=Z(c.children,t.children),!1})}),e}const m=_(0),A=_(!1),$=e=>{const n=e.currentTarget,l=e.deltaY,o=n.scrollHeight-n.clientHeight,t=m.value+l<=0,d=m.value+l>=o;e.stopPropagation(),!t&&!d?(n.scrollTop+=l,e.preventDefault()):m.value===0&&l<0||m.value===o&&l>0?A.value=!1:(n.scrollTop=Math.max(0,Math.min(o,m.value+l)),e.preventDefault()),m.value=n.scrollTop},H=()=>{f.value=!f.value},G=e=>{k("update:modelValue",e[r.valueKey]),k("change",e),f.value=!1},D=e=>{e.target.closest(".custom-select")||(f.value=!1)},E=()=>{Q({model_type:r.modelType,is_offline:r.isOffline}).then(e=>{let l=(e.data||[]).map(o=>{let{model_define:t,deployment_name:d,id:c}=o.model_config,P=`${t}-${d||""}-${c}`,p=[],N=[];r.modelType=="TEXT EMBEDDING"?p=o.model_info.vector_model_list:r.modelType=="RERANK"?p=o.model_info.rerank_model_list:r.modelType=="LLM"&&(p=o.model_info.llm_model_list);for(let L=0;L<p.length;L++){let v=p[L],O=v,W=c+"-"+v;S.indexOf(o.model_config.model_define)>-1&&o.model_config.deployment_name&&(O=o.model_config.deployment_name),N.push({key:c+"_"+v,label:O,name:v,deployment_name:d,model_config_id:c,model_define:t,value:W,id:o.model_config.id,icon:o.model_info.model_icon_url,use_model_name:o.model_info.model_name})}return{key:P,model_define:t,children:N,model_config_id:c,deployment_name:d,name:o.model_info.model_name,icon:o.model_info.model_icon_url}});l=R(U(l,"model_define"),l,"model_define"),l.length===0&&(M.value="无可用模型"),I.value=[...l],k("loaded",JSON.parse(JSON.stringify(l)))})};return q(()=>r.isOffline,()=>{E()}),z(()=>{E(),document.addEventListener("click",D)}),F(()=>{document.removeEventListener("click",D)}),(e,n)=>(i(),s("div",{class:"custom-select",onClick:w(H,["stop"])},[g("div",j,[u.value?(i(),s(T,{key:0},[u.value[a.iconKey]?(i(),s("img",{key:0,src:u.value[a.iconKey],class:"model-icon"},null,8,ee)):h("",!0),g("span",null,[x(y(u.value[a.labelKey])+" ",1),a.showValue&&u.value[a.valueKey]?(i(),s("span",le,y(u.value[a.valueKey]),1)):h("",!0)])],64)):(i(),s("span",oe,y(M.value),1))]),J(g("div",{class:"custom-options",onWheel:w($,["prevent"])},[(i(!0),s(T,null,V(b.value,(l,o)=>(i(),s("div",{key:o},[l.groupLabel?(i(),s("div",ne,[l[a.groupIconKey]?(i(),s("img",{key:0,src:l[a.groupIconKey],class:"model-icon"},null,8,te)):h("",!0),x(" "+y(l[a.groupLabelKey]),1)])):h("",!0),(i(!0),s(T,null,V(l.children,(t,d)=>(i(),s("div",{key:d,class:"option-item",onClick:w(c=>G(t),["stop"])},[g("span",null,y(t[a.valueKey]),1)],8,ae))),128))]))),128))],544),[[X,f.value]])]))}},re=Y(se,[["__scopeId","data-v-cd5b2712"]]);export{re as C};
