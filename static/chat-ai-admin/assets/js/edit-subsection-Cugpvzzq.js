import{I as fe,b as ne,M as he,dk as ge,dq as $e,k as A,d as Ue,B as Ve,dr as Be,dm as Ee,ds as Ne}from"../../index-G9f-mAi5.js";import{_ as ye,T as be}from"./index-D98e3X20.js";import{k as r,e as _,M as g,N as p,S as v,Q as V,a7 as C,Y as k,W as t,u as j,F as ae,a0 as Te,X as se,Z as D,B as ue,w as Re,a4 as Ge,G as de,H as _e,a6 as He,a1 as Ke,a2 as Qe,z as We}from"./vue-chunks-DKljrDvA.js";import"./index-CaL7BI1t.js";import{I as xe}from"./Input-Ji63igco.js";import{a as Je,_ as Ze}from"./index-BoPg9EUy.js";import{U as Xe}from"./index-2GYwggv0.js";import{C as Ye}from"./index-Dp8MfakO.js";import{M as et}from"./index-BMSQkwth.js";import{L as tt}from"./LeftOutlined-BJ11q0mR.js";import{_ as at}from"./index-CbT2goaU.js";import{_ as nt}from"./TextArea-DCKr3Wuq.js";import{_ as st}from"./index-KiILa72G.js";var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};function me(e){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(l){return Object.getOwnPropertyDescriptor(o,l).enumerable}))),i.forEach(function(l){lt(e,l,o[l])})}return e}function lt(e,s,o){return s in e?Object.defineProperty(e,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[s]=o,e}var T=function(s,o){var i=me({},s,o.attrs);return r(fe,me({},i,{icon:ot}),null)};T.displayName="StarFilled";T.inheritAttrs=!1;var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function pe(e){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(l){return Object.getOwnPropertyDescriptor(o,l).enumerable}))),i.forEach(function(l){rt(e,l,o[l])})}return e}function rt(e,s,o){return s in e?Object.defineProperty(e,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[s]=o,e}var W=function(s,o){var i=pe({},s,o.attrs);return r(fe,pe({},i,{icon:it}),null)};W.displayName="StarOutlined";W.inheritAttrs=!1;const oe={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},ct={class:"star-select-box"},ut={class:"star-item"},dt={class:"star-item"},_t={key:0},mt={__name:"selct-star-box",props:{startLists:{type:Array,default:()=>[]},hideId:{type:[Number,String,Array],default:()=>[]}},emits:["change"],setup(e,{emit:s}){const o=s,i=e,l=_(-1),y=()=>{o("change",l.value)};return(x,w)=>{const d=ye,P=be;return p(),g("div",ct,[r(P,{activeKey:l.value,"onUpdate:activeKey":w[0]||(w[0]=f=>l.value=f),size:"small",onChange:y},{default:v(()=>[(p(),V(d,{key:-1},{tab:v(()=>[k("全部")]),_:1})),e.hideId.includes(0)?C("",!0):(p(),V(d,{key:0},{tab:v(()=>[t("div",ut,[r(j(W)),k("未精选")])]),_:1})),(p(!0),g(ae,null,Te(i.startLists,f=>(p(),V(d,{key:f.id},{tab:v(()=>[t("div",dt,[r(j(T),{style:se({color:j(oe)[f.type]})},null,8,["style"]),k(" "+D(f.name||"-")+" ",1),f.data_count>0?(p(),g("span",_t,"("+D(f.data_count)+")",1)):C("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}},Ya=ne(mt,[["__scopeId","data-v-e555fc42"]]),pt={class:"modal-box"},vt={class:"list-box"},ft={__name:"classification-mark-modal",emits:["ok"],setup(e,{expose:s,emit:o}){const i=_(!1),l=o,y=_([]),x=()=>{w(),i.value=!0},w=()=>{ge().then(P=>{y.value=P.data})},d=()=>{let P=y.value.map(f=>({id:+f.id,name:f.name}));$e({data:JSON.stringify(P)}).then(f=>{A.success("保存成功"),l("ok"),i.value=!1})};return s({show:x}),(P,f)=>{const M=Ze,z=xe,Z=Je,B=he;return p(),g("div",null,[r(B,{open:i.value,"onUpdate:open":f[0]||(f[0]=S=>i.value=S),title:"精选设置",onOk:d,width:586},{default:v(()=>[t("div",pt,[t("div",vt,[r(Z,{"data-source":y.value,pagination:!1},{default:v(()=>[r(M,{key:"tags",title:"图标","data-index":"tags",width:200},{default:v(({record:S})=>[r(j(T),{class:"start-icon",style:se({color:j(oe)[S.type]})},null,8,["style"])]),_:1}),r(M,{key:"name",title:"备注","data-index":"name",width:200},{default:v(({record:S})=>[r(z,{value:S.name,"onUpdate:value":E=>S.name=E,maxLength:4,placeholder:"请设置,最多4个字"},null,8,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source"])])])]),_:1},8,["open"])])}}},en=ne(ft,[["__scopeId","data-v-52814820"]]);var u={},le;Object.defineProperty(u,"__esModule",{value:!0});u.controlDefaultValue=u.capitalize=u.camelize=u.cacheStringFunction=void 0;u.getDataAndAriaProps=Lt;u.isSymbol=u.isString=u.isOn=u.isObject=u.isFunction=le=u.isArray=u.hyphenate=void 0;u.renderHelper=Pt;u.resolvePropValue=Ot;u.toPx=Ct;u.wrapPromiseFn=Mt;const we=e=>typeof e=="function";u.isFunction=we;u.controlDefaultValue=Symbol("controlDefaultValue");le=u.isArray=Array.isArray;const ht=e=>typeof e=="string";u.isString=ht;const gt=e=>typeof e=="symbol";u.isSymbol=gt;const yt=e=>e!==null&&typeof e=="object";u.isObject=yt;const bt=/^on[^a-z]/,xt=e=>bt.test(e);u.isOn=xt;const J=e=>{const s=Object.create(null);return o=>s[o]||(s[o]=e(o))};u.cacheStringFunction=J;const wt=/-(\w)/g;u.camelize=J(e=>e.replace(wt,(s,o)=>o?o.toUpperCase():""));const kt=/\B([A-Z])/g;u.hyphenate=J(e=>e.replace(kt,"-$1").toLowerCase());u.capitalize=J(e=>e.charAt(0).toUpperCase()+e.slice(1));const St=Object.prototype.hasOwnProperty,ve=(e,s)=>St.call(e,s);function Ot(e,s,o,i){const l=e[o];if(l!=null){const y=ve(l,"default");if(y&&i===void 0){const x=l.default;i=l.type!==Function&&we(x)?x():x}l.type===Boolean&&(!ve(s,o)&&!y?i=!1:i===""&&(i=!0))}return i}function Lt(e){return Object.keys(e).reduce((s,o)=>((o.startsWith("data-")||o.startsWith("aria-"))&&(s[o]=e[o]),s),{})}function Ct(e){return typeof e=="number"?`${e}px`:e}function Pt(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return typeof e=="function"?e(s):e??o}function Mt(e){let s;const o=new Promise(l=>{s=e(()=>{l(!0)})}),i=()=>{s==null||s()};return i.then=(l,y)=>o.then(l,y),i.promise=o,i}const h=e=>(Ke("data-v-da2dc230"),e=e(),Qe(),e),At={class:"custom-modal-header"},Dt={class:"form-box-wrapper"},jt={class:"form-item"},qt=h(()=>t("div",{class:"form-label"},"分段标题：",-1)),Ft={class:"form-content"},It={class:"form-item"},zt=h(()=>t("div",{class:"form-label"},"分段分类标记",-1)),$t={class:"form-content"},Ut={class:"star-item-box"},Vt={key:2},Bt={class:"form-item"},Et=h(()=>t("div",{class:"form-label required"},"分段问题：",-1)),Nt={class:"form-content"},Tt={class:"form-item"},Rt={class:"form-label-box"},Gt=h(()=>t("div",{class:"form-label required"},"相似问法",-1)),Ht=h(()=>t("div",{class:"ai-generate-text"},"AI自动生成",-1)),Kt={class:"form-content"},Qt=h(()=>t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1)),Wt={class:"form-item"},Jt=h(()=>t("div",{class:"form-label required"},"分段答案：",-1)),Zt={class:"form-content"},Xt={key:0,class:"error-tip"},Yt={key:1,class:"form-item"},ea=h(()=>t("div",{class:"form-label required"},"分段内容：",-1)),ta={class:"form-content"},aa={key:0,class:"error-tip"},na={class:"form-item"},sa=h(()=>t("div",{class:"form-label"},"附件",-1)),oa={class:"form-content"},la={class:"upload-box-wrapper"},ia={key:0},ra={class:"ai-generate-wrapper"},ca={class:"form-box-wrapper ai-generate-wrapper-box"},ua={class:"ai-generate-wrapper-left"},da={class:"form-box-wrapper-options"},_a={class:"form-item flex1"},ma=h(()=>t("div",{class:"form-label required"},"相似问法模型：",-1)),pa={class:"form-content"},va={class:"form-item flex1"},fa={class:"form-content dual-inputs"},ha={class:"input-group"},ga=h(()=>t("div",{class:"form-label required"},"问题个数：",-1)),ya={class:"form-label-input-box"},ba={class:"form-box-wrapper-content"},xa={class:"problem-box"},wa=h(()=>t("div",{class:"problem"},"问题",-1)),ka={class:"problem-content"},Sa={class:"problem-box"},Oa=h(()=>t("div",{class:"problem"},"答案",-1)),La={class:"problem-content"},Ca={class:"form-item generate-btn-box"},Pa={class:"result-nav"},Ma={key:0,class:"tip"},Aa={key:1,class:"result-nav-text"},Da={key:0,class:"container"},ja=h(()=>t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1)),qa=h(()=>t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1)),Fa=h(()=>t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)),Ia=[ja,qa,Fa],za={class:"result-container"},$a=["innerHTML"],Ua={class:"result-footer"},Va={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(e,{expose:s,emit:o}){const i=_(!1),l=_(!1),y=_(!1),x=_(!1),w=_(!1),d=ue({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),P=new et({html:!0,linkify:!0,typographer:!0}),f=_(""),M=ue({finish:"",content:""});Re(()=>M.content,()=>{f.value=P.render(M.content)});const z=Ge(),Z=z.query,B=z.name,S=e,E=o,ke=_(""),Se=["azure","ollama","xinference","openaiAgent"],ie=_("1"),$=_(!1),R=_(""),q=_(""),O=_(""),F=_(""),L=_(""),U=_([]),N=_(0),X=_(""),I=_(!1),Oe=n=>{l.value=!1,y.value=!1,w.value=!1,R.value=n.title||"",q.value=n.content||"",X.value=n.id||"",O.value=n.answer||"",U.value=n.images||[],F.value=n.question||"",L.value=n.similar_questions?n.similar_questions.join(`
`):"",I.value=S.detailsInfo.is_qa_doc=="1",N.value=n.category_id||0,ee(),$.value=!0},Y=_([]),ee=()=>{ge({file_id:Z.id}).then(n=>{let a=n.data||[];a=a.map(m=>({value:m.id,payload:{...m,color:oe[m.type]}})),B=="categaryManages"?Y.value=[...a]:Y.value=[{value:0,payload:{id:0,name:"未标记"}},...a],E("handleStatrList",n.data||[])})},re=()=>{if(ce(),!q.value&&!I.value)return A.error("请输入分段内容");if(!F.value&&I.value)return A.error("请输入分段问题");if(!O.value&&I.value)return A.error("请输入分段答案");if(I.value&&O.value.length>1e4||!I.value&&q.value.length>1e4)return;if(B=="categaryManages"&&N.value<=0)return A.error("请选择分类标记");let n={title:R.value,content:q.value,question:F.value,answer:O.value,images:U.value,category_id:N.value},a=L.value.trim();a?(a=a.split(`
`),n.similar_questions=JSON.stringify(a)):n.similar_questions="[]",X.value?n.id=X.value:n.file_id=z.query.id;let m=new FormData;for(let b in n)le(n[b])?n[b].forEach(te=>{m.append(b,te)}):m.append(b,n[b]);B=="categaryManages"?(m.delete("file_id"),m.append("library_id",z.query.id),Ee(m).then(b=>{A.success(n.id?"修改成功":"添加成功"),$.value=!1,E("handleEdit",{...n}),ee()})):Ne(m).then(b=>{A.success(n.id?"修改成功":"添加成功"),$.value=!1,E("handleEdit",{...n}),ee()})},Le=()=>{l.value=!0},G=_(""),Ce=async()=>{M.content="",G.value="",x.value=!0,w.value=!0;try{let n={library_id:S.detailsInfo.library_id,model_config_id:d.model_config_id,use_model:d.use_model,num:d.count,question:F.value,answer:O.value};const a=await Be(n);G.value=a.data.map(m=>m).join(`
`),M.content=a.data.map((m,b)=>`<div class="dialog-message">${b+1}. ${m}</div>`).join(""),y.value=!0}finally{x.value=!1}},Pe=()=>{L.value?L.value+=`
${G.value}`:L.value+=G.value,A.success("保存成功"),y.value=!1,l.value=!1,w.value=!1},Me=n=>{d.use_model=Se.includes(n.rawData.model_define)&&n.rawData.deployment_name?n.rawData.deployment_name:n.rawData.name,d.use_model_icon=n.icon,d.use_model_name=n.use_model_name,d.model_config_id=n.rawData.id,ke.value=n.rawData.model_define},H=_([]),Ae=n=>{H.value=n,We(()=>{(!d.ai_chunk_model||!Number(d.ai_chunk_model_config_id))&&De()})},De=()=>{if(H.value.length>0){let n=null,a=null;for(let m of H.value)if(m.model_define==="tongyi"){n=m;for(let b of n.children)if(b.name==="qwen-max"){a=b;break}break}n||(n=H.value[0],a=n.children[0]),n&&a&&(d.use_model=a.name,d.model_config_id=a.model_config_id,d.ai_chunk_model=a.name,d.ai_chunk_model_config_id=a.model_config_id)}};function je(n){return n.split(`
`).map(a=>a.trim()).filter(a=>a).join(`
`)}const ce=()=>{L.value=je(L.value)};return s({showModal:Oe}),(n,a)=>{const m=Ve,b=xe,te=at,K=nt,Q=Ue,qe=ye,Fe=be,Ie=st,ze=he;return p(),g("div",null,[r(ze,{open:$.value,"onUpdate:open":a[12]||(a[12]=c=>$.value=c),onOk:re,width:l.value?w.value?"944px":"472px":"746px","ok-button-props":{style:{display:l.value?"none":"block"}}},{title:v(()=>[t("div",At,[l.value?(p(),V(m,{key:0,type:"text",class:"back-button",onClick:a[0]||(a[0]=c=>l.value=!1)},{icon:v(()=>[r(j(tt),{style:{"font-size":"12px"}})]),_:1})):C("",!0),t("span",null,D(l.value?"AI生成相似问法":"编辑分段"),1)])]),footer:v(()=>[l.value?C("",!0):(p(),g(ae,{key:0},[r(m,{onClick:a[11]||(a[11]=c=>$.value=!1)},{default:v(()=>[k("取消")]),_:1}),r(m,{type:"primary",onClick:re},{default:v(()=>[k("确定")]),_:1})],64))]),default:v(()=>[de(t("div",Dt,[t("div",jt,[qt,t("div",Ft,[r(b,{maxLength:25,value:R.value,"onUpdate:value":a[1]||(a[1]=c=>R.value=c),placeholder:"请输入分段标题"},null,8,["value"])])]),t("div",It,[zt,t("div",$t,[r(te,{value:N.value,"onUpdate:value":a[2]||(a[2]=c=>N.value=c),options:Y.value},{label:v(({payload:c})=>[t("div",Ut,[c.id>0?(p(),V(j(T),{key:0,style:se({color:c.color})},null,8,["style"])):(p(),V(j(W),{key:1})),t("div",null,D(c.name||"-"),1),k(),c.data_count>0?(p(),g("span",Vt,"("+D(c.data_count)+")",1)):C("",!0)])]),_:1},8,["value","options"])])]),I.value?(p(),g(ae,{key:0},[t("div",Bt,[Et,t("div",Nt,[r(K,{placeholder:"请输入分段问题",value:F.value,"onUpdate:value":a[3]||(a[3]=c=>F.value=c),style:{height:"100px"}},null,8,["value"])])]),t("div",Tt,[t("div",Rt,[Gt,t("div",{class:"ai-generate",onClick:Le},[r(Q,{name:"ai-generate",style:{"font-size":"14px"}}),Ht])]),t("div",Kt,[r(K,{placeholder:"请输入相似问法",value:L.value,"onUpdate:value":a[4]||(a[4]=c=>L.value=c),style:{height:"100px"},onBlur:ce},null,8,["value"]),Qt])]),t("div",Wt,[Jt,t("div",Zt,[r(K,{placeholder:"请输入分段答案",value:O.value,"onUpdate:value":a[5]||(a[5]=c=>O.value=c),style:{height:"100px"}},null,8,["value"]),O.value.length>1e4?(p(),g("div",Xt,"分段答案最多支持10000个字符")):C("",!0)])])],64)):(p(),g("div",Yt,[ea,t("div",ta,[r(K,{style:{height:"150px"},value:q.value,"onUpdate:value":a[6]||(a[6]=c=>q.value=c),placeholder:"请输入分段内容"},null,8,["value"]),q.value.length>1e4?(p(),g("div",aa,"分段内容最多支持10000个字符")):C("",!0)])])),t("div",na,[sa,t("div",oa,[t("div",la,[r(Fe,{activeKey:ie.value,"onUpdate:activeKey":a[7]||(a[7]=c=>ie.value=c),size:"small"},{default:v(()=>[r(qe,{key:"1"},{tab:v(()=>[t("span",null,[r(Q,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),k(" 图片 "),U.value.length?(p(),g("span",ia,"("+D(U.value.length)+")",1)):C("",!0)])]),_:1})]),_:1},8,["activeKey"]),r(Xe,{value:U.value,"onUpdate:value":a[8]||(a[8]=c=>U.value=c)},null,8,["value"])])])])],512),[[_e,!l.value]]),de(t("div",ra,[t("div",ca,[t("div",ua,[t("div",da,[t("div",_a,[ma,t("div",pa,[r(Ye,{modelValue:d.use_model,"onUpdate:modelValue":a[9]||(a[9]=c=>d.use_model=c),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":d.model_config_id,onChange:Me,onLoaded:Ae},null,8,["modelValue","model-config-id"])])]),t("div",va,[t("div",fa,[t("div",ha,[ga,t("div",ya,[r(Ie,{value:d.count,"onUpdate:value":a[10]||(a[10]=c=>d.count=c),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),k("个 ")])])])])]),t("div",ba,[t("div",xa,[wa,t("div",ka,D(F.value),1)]),t("div",Sa,[Oa,t("div",La,D(O.value),1)])]),t("div",Ca,[r(m,{onClick:Ce,loading:x.value,class:"generate-btn"},{default:v(()=>[r(Q,{name:"ai-generate-white",style:{"font-size":"16px"}}),k(" 开始生成 ")]),_:1},8,["loading"])])]),t("div",{class:He(["ai-generate-wrapper-right",{"show-result":w.value}])},[t("div",Pa,[r(Q,{name:"generate-icon",style:{"font-size":"14px"}}),x.value?(p(),g("span",Ma,"相似问法生成中...")):(p(),g("div",Aa,"相似问法生成完毕"))]),!M.content&&x.value&&!i.value?(p(),g("div",Da,Ia)):C("",!0),t("div",za,[t("div",{class:"dialog-content",innerHTML:f.value},null,8,$a)]),t("div",Ua,[r(m,{class:"result-footer-btn",type:"primary",onClick:Pe},{default:v(()=>[k("保存相似问法")]),_:1})])],2)])],512),[[_e,l.value]])]),_:1},8,["open","width","ok-button-props"])])}}},tn=ne(Va,[["__scopeId","data-v-da2dc230"]]);export{en as C,tn as E,T as S,W as a,Ya as b,oe as c};
