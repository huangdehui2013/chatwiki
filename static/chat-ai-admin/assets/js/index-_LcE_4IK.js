import{k as t,M as m,N as s,W as e,a7 as R,Y as q,Z as C,U as pe,Q as z,S as n,X as Ct,a6 as Oe,e as k,b as X,B as Q,G as re,H as _e,u as y,a1 as J,a2 as G,aa as Z,a4 as tt,F as T,a0 as H,w as me,l as ot,x as ye,o as Lt,j as Ae,ad as we,ah as Se,D as It,d as be,$ as Rt,z as st,ac as Ut,V as Et,a9 as Ot,p as At}from"./vue-chunks-Dagx-vSq.js";import{I as jt,b as B,d as de,B as se,az as Mt,ap as Ye,M as Y,k as W,an as zt,as as Dt,ar as ve,aA as Pt,aB as Nt,a0 as nt,e as Tt,aC as Vt,aD as Ee,E as Te,ay as Bt}from"../../index-BdYv4pbp.js";import{_ as qe}from"./index-B6ctIxYh.js";import{C as Qt}from"./cu-upload-BTNaeQtC.js";import"./index-B11WLJj_.js";import{I as ue}from"./Input-C2qOGQ_1.js";import{_ as Ce}from"./TextArea-DRJIYohD.js";import{_ as Be}from"./cu-scroll-BvD9XPVC.js";import{e as Ft,g as it,f as Jt,h as Gt}from"./index-CwlGBMSn.js";import{T as Ht}from"./index-BlBB-sRM.js";import{S as je}from"./index-BITuwxer.js";import{I as Kt}from"./index-CD2pIf7Q.js";import{F as Ve,_ as at}from"./index-CbmBRnKK.js";import{S as lt,a as ct,i as Wt}from"./index-BddIR2yb.js";import{_ as rt,T as _t}from"./index-DgTptGPI.js";import{D as Zt}from"./DownloadOutlined-B8UItTFz.js";import{P as Me}from"./PlusOutlined-BEhntgqt.js";import{D as dt}from"./DownOutlined-bF62ZcFO.js";import{U as Yt}from"./UpOutlined-DlgZFWNa.js";import{_ as ne}from"./index-CCsePsqL.js";import{_ as ie}from"./index-DdBHG-A3.js";import{c as ut}from"./index-DulBynFY.js";import{C as Xt}from"./index-DrvGOKxR.js";import{Q as oe}from"./QuestionCircleOutlined-BY31qbwb.js";import{_ as pt}from"./index-D3GNTuSP.js";import{_ as ze}from"./index-BMih6iRe.js";import{_ as eo,a as to}from"./index-CnEKerRj.js";import{S as oo}from"./SearchOutlined-C-SKizIr.js";import{S as so}from"./SyncOutlined-wUPVjOdF.js";import{_ as Qe,C as Fe}from"./index-Dzb8yElx.js";import{_ as mt}from"./index-dUAdswB6.js";import{_ as no}from"./recommendation-AQ4_FPQ9.js";import{R as io}from"./RightOutlined-Dc3RESo2.js";import{g as vt}from"./index-BOf_F41n.js";import{_ as ht}from"./empty-CzGZrENG.js";import{d as Je}from"./vuedraggable.umd-TY7LT6W9.js";import{M as ao}from"./model-select-C7NXQtts.js";import"./index-TeHk_coF.js";import{_ as ft,R as bt}from"./RadioButton-CKy5Sstn.js";import{E as yt}from"./EditOutlined-CAMBbdOo.js";import{_ as lo}from"./index-3na9OQqB.js";import{u as co}from"./robot-y1S6KbLD.js";import{i as ro,e as _o,f as uo}from"./index-DQctwWcD.js";import{A as po}from"./add-collaborator-D2jMEhkd.js";import{A as mo}from"./index-Nuz6o6dK.js";import{U as Xe}from"./UserOutlined-BscmVZKR.js";import{C as Ne}from"./CheckOutlined-Zj7x0G_2.js";import{E as vo}from"./Password-D2_IM1Jy.js";import{_ as ho}from"./index-7XEwOeX1.js";import{a as fo}from"./index-p8d_9U1-.js";import"./axios-BZ84_VUH.js";import"./qs-CSiAN3u4.js";import"./crypto-js-DN0vhd75.js";import"./dayjs-CZ5VaChI.js";import"./FormItemContext-Cdyd-mYe.js";import"./index-ffqjZvit.js";import"./Search-B65y9BZx.js";import"./isPlainObject-BUQ58MPT.js";import"./inputProps-BIa77Hqy.js";import"./index-p3MxSJUT.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./colors-CJx9DhIW.js";import"./Trigger-DWEODdVI.js";import"./responsiveObserve-YIOA4WXQ.js";import"./collapseMotion-D5mGic4t.js";import"./slide-4EGAbcnD.js";import"./move-Du4Gi3iM.js";import"./index-CJ0orYu6.js";import"./shallowequal-CI97GdPH.js";import"./dropdown-BiE8xfl_.js";import"./pick-RXfaHpPL.js";import"./Checkbox-B2wqz-LK.js";import"./index-_xQpb7Ga.js";import"./index-DNsujCXu.js";import"./useMaxLevel-B54cygJO.js";import"./CaretDownFilled-7_Xowb8a.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-DfhC6gKx.js";import"./index-Dq7HAFaD.js";import"./CaretDownOutlined-Ch0ng0P7.js";var bo={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function et(d){for(var r=1;r<arguments.length;r++){var h=arguments[r]!=null?Object(arguments[r]):{},u=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(h).filter(function(p){return Object.getOwnPropertyDescriptor(h,p).enumerable}))),u.forEach(function(p){yo(d,p,h[p])})}return d}function yo(d,r,h){return r in d?Object.defineProperty(d,r,{value:h,enumerable:!0,configurable:!0,writable:!0}):d[r]=h,d}var Ge=function(r,h){var u=et({},r,h.attrs);return t(jt,et({},u,{icon:bo}),null)};Ge.displayName="ToTopOutlined";Ge.inheritAttrs=!1;const ko={class:"edit-box-header"},go={class:"left-box"},$o={class:"edit-box-title"},xo={key:0},wo={key:0,class:"title-tip"},So={class:"right-box"},qo={class:"extra-box"},Co={class:"actions-box"},Lo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(d,{emit:r}){const h=r,u=d,p=l=>{h("edit"),h("update:isEdit",l)},i=()=>{h("save")};return(l,S)=>{const o=de,x=se,I=qe;return s(),m("div",{class:Oe(["edit-box",{"is-edit":d.isEdit}])},[e("div",ko,[e("div",go,[t(o,{class:"edit-box-icon",name:u.iconName},null,8,["name"]),e("span",$o,[q(C(u.title)+" ",1),l.$slots.icon?(s(),m("span",xo,[pe(l.$slots,"icon",{},void 0,!0)])):R("",!0)]),l.$slots.tip?(s(),m("span",wo,[pe(l.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",So,[e("div",qo,[pe(l.$slots,"extra",{},()=>[e("div",Co,[u.isEdit?(s(),z(I,{key:0,gap:8},{default:n(()=>[t(x,{onClick:i,size:"small",type:"primary"},{default:n(()=>[q("保存")]),_:1}),t(x,{onClick:S[0]||(S[0]=a=>p(!1)),size:"small"},{default:n(()=>[q("取消")]),_:1})]),_:1})):(s(),z(x,{key:1,onClick:S[1]||(S[1]=a=>p(!0)),size:"small"},{default:n(()=>[q("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:Ct({...d.bodyStyle})},[pe(l.$slots,"default",{},void 0,!0)],4)],2)}}},te=B(Lo,[["__scopeId","data-v-dbe09743"]]),kt=d=>(J("data-v-899bcb03"),d=d(),G(),d),Io={class:"robot-form-box"},Ro={class:"form-item"},Uo=kt(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Eo={class:"form-item-body robot-name-item"},Oo={class:"robot-avetar-upload"},Ao=["src"],jo={class:"robot-name-box"},Mo={class:"form-item"},zo=kt(()=>e("div",{class:"form-item-label"},"简介",-1)),Do={class:"form-item-body"},Po={class:"robot-info-box"},No={class:"robot-name-box"},To=["src"],Vo={class:"robot-name"},Bo={class:"robot-intro"},Qo={__name:"basic-config",setup(d){const r=k(!1),{robotInfo:h,updateRobotInfo:u}=X("robotInfo"),p=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),i=()=>{u({...Z(p)}),r.value=!1},l=o=>{let x=o[0];return p.robot_avatar=x,Mt(x).then(I=>{p.robot_avatar_url=I}),!1},S=()=>{p.robot_name=h.robot_name,p.robot_intro=h.robot_intro,p.robot_avatar=h.robot_avatar,p.robot_avatar_url=h.robot_avatar_url};return(o,x)=>{const I=ue,a=Ce;return s(),z(te,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:r.value,"onUpdate:isEdit":x[2]||(x[2]=_=>r.value=_),onSave:i,onEdit:S},{default:n(()=>[re(e("div",Io,[e("div",Ro,[Uo,e("div",Eo,[t(Qt,{accept:"image/*",onChange:l},{default:n(()=>[e("div",Oo,[p.robot_avatar_url?(s(),m("img",{key:0,class:"robot-avetar",src:p.robot_avatar_url},null,8,Ao)):R("",!0)])]),_:1}),e("div",jo,[t(I,{value:p.robot_name,"onUpdate:value":x[0]||(x[0]=_=>p.robot_name=_),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Mo,[zo,e("div",Do,[t(a,{rows:3,value:p.robot_intro,"onUpdate:value":x[1]||(x[1]=_=>p.robot_intro=_),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[_e,r.value]]),re(e("div",Po,[e("div",No,[e("img",{class:"robot-avatar",src:y(h).robot_avatar_url,alt:""},null,8,To),e("span",Vo,C(y(h).robot_name),1)]),e("div",Bo,C(y(h).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[_e,!r.value]])]),_:1},8,["isEdit"])}}},Fo=B(Qo,[["__scopeId","data-v-899bcb03"]]),gt=d=>(J("data-v-896a48d0"),d=d(),G(),d),Jo={class:"ai-create-box"},Go={class:"input-box"},Ho=gt(()=>e("span",null,"生成",-1)),Ko={class:"quick-tags-box"},Wo=gt(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),Zo={class:"ai-list-box"},Yo={key:0,class:"loading-box"},Xo={key:0,class:"prompt-list-box"},es={class:"prompt-list"},ts={class:"prompt-header"},os={class:"prompt-title"},ss={class:"prompt-content"},ns={class:"prompt-list"},is={class:"prompt-header"},as={class:"prompt-title"},ls={class:"prompt-content"},cs={class:"prompt-list"},rs={class:"prompt-header"},_s={class:"prompt-title"},ds={class:"prompt-content"},us={class:"prompt-list"},ps={class:"prompt-header"},ms={class:"prompt-title"},vs={class:"prompt-content"},hs={class:"prompt-list"},fs={class:"prompt-header"},bs={class:"prompt-title"},ys={class:"prompt-content"},ks={class:"prompt-header"},gs={class:"prompt-title"},$s={class:"prompt-content"},xs={key:1,class:"empty-box"},ws={__name:"ai-create-prompt",emits:["handleAiSave"],setup(d,{expose:r,emit:h}){const u=Ye.PRESENTED_IMAGE_SIMPLE,p=k(!1),i=k(!1),l=tt().query,S=h,o=k(""),x=k(!1),I=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],a=k("在上方输入框输入要求，点击生成提示词"),_=()=>{c.value=!1,$.promptStruct=g,o.value="",a.value="在上方输入框输入要求，点击生成提示词",p.value=!0},c=k(!1),g={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},$=Q({promptStruct:g}),L=b=>{o.value=b},f=()=>{if(!o.value)return W.error("请输入AI 生成提示词");if(x.value)return W.error("正在生成中...");x.value=!0,Ft({id:l.id,demand:o.value}).then(b=>{$.promptStruct=JSON.parse(b.data.promptStruct),c.value=!0}).finally(()=>{x.value=!1}).catch(b=>{c.value=!1,a.value=b.msg})},w=()=>{if(!c.value)return W.error("请先生成提示词");S("handleAiSave",$.promptStruct),p.value=!1};return r({show:_}),(b,v)=>{const P=se,j=ue,M=de,E=Ht,N=je,ee=Ye,D=Be,K=Y;return s(),m("div",null,[t(K,{open:p.value,"onUpdate:open":v[1]||(v[1]=O=>p.value=O),title:"AI 生成提示词",width:746},{footer:n(()=>[t(P,{type:"primary",loading:i.value,onClick:w},{default:n(()=>[q("使用该提示")]),_:1},8,["loading"])]),default:n(()=>[e("div",Jo,[e("div",Go,[t(j,{style:{width:"100%"},value:o.value,"onUpdate:value":v[0]||(v[0]=O=>o.value=O),size:"large",onPressEnter:f,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:f},[t(M,{name:"ai-mark"}),Ho])]),e("div",Ko,[Wo,(s(),m(T,null,H(I,O=>t(E,{key:O.title,onClick:F=>L(O.title),color:"blue"},{default:n(()=>[q(C(O.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Zo,[t(D,{style:{height:"100%"}},{default:n(()=>[x.value?(s(),m("div",Yo,[t(N,{tip:"正在生成中..."})])):(s(),m(T,{key:1},[c.value?(s(),m("div",Xo,[e("div",es,[e("div",ts,[e("div",os,C($.promptStruct.role.subject),1)]),e("div",ss,C($.promptStruct.role.describe),1)]),e("div",ns,[e("div",is,[e("div",as,C($.promptStruct.task.subject),1)]),e("div",ls,C($.promptStruct.task.describe),1)]),e("div",cs,[e("div",rs,[e("div",_s,C($.promptStruct.constraints.subject),1)]),e("div",ds,C($.promptStruct.constraints.describe),1)]),e("div",us,[e("div",ps,[e("div",ms,C($.promptStruct.output.subject),1)]),e("div",vs,C($.promptStruct.output.describe),1)]),e("div",hs,[e("div",fs,[e("div",bs,C($.promptStruct.tone.subject),1)]),e("div",ys,C($.promptStruct.tone.describe),1)]),(s(!0),m(T,null,H($.promptStruct.custom,(O,F)=>(s(),m("div",{class:"prompt-list",key:F+O.key?O.key:""},[e("div",ks,[e("div",gs,C(O.subject),1)]),e("div",$s,C(O.describe),1)]))),128))])):(s(),m("div",xs,[t(ee,{image:y(u),description:a.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Ss=B(ws,[["__scopeId","data-v-896a48d0"]]),qs={__name:"upload-prompt",setup(d,{expose:r}){const h=k(!1),u=Q({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),p=k(null),i=I=>{if(I.prompt_type==0&&!I.prompt)return W.error("自定义提示为空,无法上传");p.value&&p.value.resetFields();let a={...I};u.title="",u.group_id=0,u.prompt="",u.prompt_struct={},u.prompt_type=a.prompt_type,a.prompt_type==0?u.prompt=a.prompt:u.prompt_struct=JSON.stringify(a.prompt_struct),h.value=!0},l=k([]);(()=>{zt().then(I=>{l.value=[{id:0,group_name:"默认分组"},...I.data]})})();const o=k(!1),x=()=>{p.value.validate().then(()=>{let I={...u};o.value=!0,Dt({...I}).then(()=>{W.success("保存成功"),h.value=!1}).finally(()=>{o.value=!1})})};return r({show:i}),(I,a)=>{const _=ue,c=at,g=ct,$=lt,L=Ve,f=Y;return s(),m("div",null,[t(f,{open:h.value,"onUpdate:open":a[2]||(a[2]=w=>h.value=w),title:"保存到提示词库",width:580,onOk:x,confirmLoading:o.value},{default:n(()=>[t(L,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:p,model:u},{default:n(()=>[t(c,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:n(()=>[t(_,{value:u.title,"onUpdate:value":a[0]||(a[0]=w=>u.title=w),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(c,{name:"group_id",label:"分组"},{default:n(()=>[t($,{value:u.group_id,"onUpdate:value":a[1]||(a[1]=w=>u.group_id=w),style:{width:"100%"}},{default:n(()=>[(s(!0),m(T,null,H(l.value,w=>(s(),z(g,{value:w.id},{default:n(()=>[q(C(w.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},Cs={class:"prompt-box"},Ls={class:"tab-header"},Is={key:0,class:"opt-block"},Rs={key:1,class:"opt-block"},Us={class:"tip-text"},Es={key:0,class:"prompt-list-box"},Os={class:"prompt-list"},As={class:"prompt-header"},js={class:"prompt-title"},Ms={key:0,class:"btn-wrapper-box"},zs={class:"prompt-content"},Ds={class:"prompt-list"},Ps={class:"prompt-header"},Ns={class:"prompt-title"},Ts={key:0,class:"btn-wrapper-box"},Vs={class:"prompt-content"},Bs={class:"prompt-list"},Qs={class:"prompt-header"},Fs={class:"prompt-title"},Js={key:0,class:"btn-wrapper-box"},Gs={class:"prompt-content"},Hs={class:"prompt-list"},Ks={class:"prompt-header"},Ws={class:"prompt-title"},Zs={key:0,class:"btn-wrapper-box"},Ys={class:"prompt-content"},Xs={class:"prompt-list"},en={class:"prompt-header"},tn={class:"prompt-title"},on={key:0,class:"btn-wrapper-box"},sn={class:"swich-item"},nn={class:"swich-item"},an={class:"prompt-content"},ln={class:"prompt-list"},cn={class:"prompt-header"},rn={class:"prompt-title"},_n={key:0,class:"btn-wrapper-box"},dn={class:"prompt-content"},un={class:"prompt-header"},pn={class:"prompt-title",style:{flex:"1"}},mn={key:0,class:"btn-wrapper-box"},vn=["onClick"],hn={class:"prompt-content"},fn={key:0,class:"add-theme-block"},bn={class:"show-more-block"},yn={key:1,class:"diy-prompt-box"},kn={key:0,class:"diy-switch-box"},gn={class:"swich-item"},$n={class:"swich-item"},le="- 请使用markdown格式回答问题。",ce="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",xn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(d){const r=k(!1),{robotInfo:h,updateRobotInfo:u}=X("robotInfo"),p=d;let i={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const l=k({}),S=k(!1),o=k(!1),x=k(!1),I=k(!1),a=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),_=k(localStorage.getItem("system_prompt_words_ishide")=="1"),c=()=>{_.value=!_.value,localStorage.setItem("system_prompt_words_ishide",_.value?1:0)},g=(V,U)=>V.includes(U),$=k(h.prompt_type);me(()=>h,()=>{a.prompt=h.prompt,a.prompt_struct=h.prompt_struct,l.value=h.prompt_struct_default},{immediate:!0,deep:!0}),me(()=>a.prompt_struct.output.describe,V=>{S.value=g(V,le),o.value=g(V,ce)},{immediate:!0,deep:!0}),me(()=>a.prompt,V=>{x.value=g(V,le),I.value=g(V,ce)},{immediate:!0,deep:!0});const L=(V,U)=>{V?(U=="outSwitch"&&(a.prompt_struct.output.describe?a.prompt_struct.output.describe+=`
`+le:a.prompt_struct.output.describe+=le),U=="imgSwitch"&&(a.prompt_struct.output.describe?a.prompt_struct.output.describe+=`
`+ce:a.prompt_struct.output.describe+=ce)):(U=="outSwitch"&&(a.prompt_struct.output.describe=a.prompt_struct.output.describe.replace(new RegExp(le,"g"),"")),U=="imgSwitch"&&(a.prompt_struct.output.describe=a.prompt_struct.output.describe.replace(new RegExp(ce,"g"),"")),a.prompt_struct.output.describe=a.prompt_struct.output.describe.trim())},f=(V,U)=>{V?(U=="outDiySwitch"&&(a.prompt?a.prompt+=`
`+le:a.prompt+=le),U=="imgDiySwitch"&&(a.prompt?a.prompt+=`
`+ce:a.prompt+=ce)):(U=="outDiySwitch"&&(a.prompt=a.prompt.replace(new RegExp(le,"g"),"")),U=="imgDiySwitch"&&(a.prompt=a.prompt.replace(new RegExp(ce,"g"),"")),a.prompt=a.prompt.trim())},w=V=>{a.prompt_struct[V].describe=l.value[V].describe},b=()=>{let V=h.work_flow_ids.split(","),U=p.robotList.filter(fe=>V.includes(fe.id)),xe=[];xe=U.map(fe=>`- ${fe.robot_name} ${fe.robot_intro}`).join(`
`),a.prompt_struct.skill.describe=xe},v=()=>{a.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),$.value=1},P=V=>{a.prompt_struct.custom.splice(V,1)},j=()=>{u({...Z(a),prompt_type:$.value}),r.value=!1},M=V=>{$.value=1,u({prompt_type:$.value,prompt:a.prompt,prompt_struct:V}),r.value=!1},E=()=>{r.value=!0},N=()=>{r.value=!1},ee=k(null),D=()=>{ee.value.show()},K=k(null),O=()=>{K.value.show()},F=k(null),$e=()=>{F.value.show({...a,prompt_type:$.value})},Pe=V=>{V.prompt_type==1?($.value=1,a.prompt_struct=V.prompt_struct):($.value=0,a.prompt=V.prompt),j()};return(V,U)=>{const xe=rt,fe=_t,We=ne,wt=de,Ie=se,St=qe,ae=Ce,Re=ie,qt=ue;return s(),m("div",Cs,[e("div",Ls,[t(fe,{activeKey:$.value,"onUpdate:activeKey":U[0]||(U[0]=A=>$.value=A)},{default:n(()=>[(s(),z(xe,{key:1,tab:"结构化提示词"})),(s(),z(xe,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),r.value?(s(),m("div",Is,[t(We,null,{title:n(()=>[q("将当前编辑的提示词保存到提示词库中")]),default:n(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:$e},[t(y(Ge)),q("上传 ")])]),_:1}),t(We,null,{title:n(()=>[q("从提示词库导入提示词")]),default:n(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:O},[t(y(Zt)),q("导入 ")])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:D},[t(wt,{name:"ai-mark"}),q(" AI自动生成 ")]),t(St,{gap:8},{default:n(()=>[t(Ie,{size:"small",type:"primary",onClick:j},{default:n(()=>[q("保存")]),_:1}),t(Ie,{size:"small",onClick:N},{default:n(()=>[q("取消")]),_:1})]),_:1})])):(s(),m("div",Rs,[e("span",Us,"当前类型："+C($.value==1?"结构化提示词":"自定义提示词"),1),t(Ie,{size:"small",onClick:E},{default:n(()=>[q("修改")]),_:1})]))]),$.value==1?(s(),m("div",Es,[e("div",Os,[e("div",As,[e("div",js,C(a.prompt_struct.role.subject),1),r.value?(s(),m("div",Ms,[e("a",{onClick:U[1]||(U[1]=A=>w("role"))},"恢复默认")])):R("",!0)]),e("div",zs,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.role.describe,"onUpdate:value":U[2]||(U[2]=A=>a.prompt_struct.role.describe=A),placeholder:y(i).role},null,8,["disabled","value","placeholder"])])]),e("div",Ds,[e("div",Ps,[e("div",Ns,C(a.prompt_struct.task.subject),1),r.value?(s(),m("div",Ts,[e("a",{onClick:U[3]||(U[3]=A=>w("task"))},"恢复默认")])):R("",!0)]),e("div",Vs,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.task.describe,"onUpdate:value":U[4]||(U[4]=A=>a.prompt_struct.task.describe=A),placeholder:y(i).task},null,8,["disabled","value","placeholder"])])]),_.value?(s(),m(T,{key:0},[e("div",Bs,[e("div",Qs,[e("div",Fs,C(a.prompt_struct.constraints.subject),1),r.value?(s(),m("div",Js,[e("a",{onClick:U[5]||(U[5]=A=>w("constraints"))},"恢复默认")])):R("",!0)]),e("div",Gs,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.constraints.describe,"onUpdate:value":U[6]||(U[6]=A=>a.prompt_struct.constraints.describe=A),placeholder:y(i).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Hs,[e("div",Ks,[e("div",Ws,C(a.prompt_struct.skill.subject),1),r.value?(s(),m("div",Zs,[e("a",{onClick:U[7]||(U[7]=A=>b())},"自动导入技能")])):R("",!0)]),e("div",Ys,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.skill.describe,"onUpdate:value":U[8]||(U[8]=A=>a.prompt_struct.skill.describe=A),placeholder:y(i).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",Xs,[e("div",en,[e("div",tn,C(a.prompt_struct.output.subject),1),r.value?(s(),m("div",on,[e("div",sn,[q(" 输出markdown： "),t(Re,{onChange:U[9]||(U[9]=A=>L(A,"outSwitch")),checked:S.value,"onUpdate:checked":U[10]||(U[10]=A=>S.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",nn,[q(" 回复图片： "),t(Re,{onChange:U[11]||(U[11]=A=>L(A,"imgSwitch")),checked:o.value,"onUpdate:checked":U[12]||(U[12]=A=>o.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:U[13]||(U[13]=A=>w("output"))},"恢复默认")])):R("",!0)]),e("div",an,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.output.describe,"onUpdate:value":U[14]||(U[14]=A=>a.prompt_struct.output.describe=A),placeholder:y(i).output},null,8,["disabled","value","placeholder"])])]),e("div",ln,[e("div",cn,[e("div",rn,C(a.prompt_struct.tone.subject),1),r.value?(s(),m("div",_n,[e("a",{onClick:U[15]||(U[15]=A=>w("tone"))},"恢复默认")])):R("",!0)]),e("div",dn,[t(ae,{bordered:!1,disabled:!r.value,value:a.prompt_struct.tone.describe,"onUpdate:value":U[16]||(U[16]=A=>a.prompt_struct.tone.describe=A),placeholder:y(i).tone},null,8,["disabled","value","placeholder"])])]),(s(!0),m(T,null,H(a.prompt_struct.custom,(A,Ze)=>(s(),m("div",{class:"prompt-list",key:Ze+A.key?A.key:""},[e("div",un,[e("div",pn,[t(qt,{bordered:!1,disabled:!r.value,style:{width:"100%"},value:A.subject,"onUpdate:value":Ue=>A.subject=Ue,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),r.value?(s(),m("div",mn,[e("div",{class:"hover-btn-box",onClick:Ue=>P(Ze)},[t(y(ve))],8,vn)])):R("",!0)]),e("div",hn,[t(ae,{bordered:!1,disabled:!r.value,value:A.describe,"onUpdate:value":Ue=>A.describe=Ue,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),r.value?(s(),m("div",fn,[t(Ie,{onClick:v,block:"",icon:ot(y(Me))},{default:n(()=>[q("添加主题")]),_:1},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",bn,[e("div",{class:"btn-item",onClick:c},[_.value?(s(),m(T,{key:1},[q("收起"),t(y(Yt))],64)):(s(),m(T,{key:0},[q("展开"),t(y(dt))],64))])])])):(s(),m("div",yn,[r.value?(s(),m("div",kn,[e("div",gn,[q(" 输出markdown： "),t(Re,{size:"small",onChange:U[17]||(U[17]=A=>f(A,"outDiySwitch")),checked:x.value,"onUpdate:checked":U[18]||(U[18]=A=>x.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",$n,[q(" 回复图片： "),t(Re,{size:"small",onChange:U[19]||(U[19]=A=>f(A,"imgDiySwitch")),checked:I.value,"onUpdate:checked":U[20]||(U[20]=A=>I.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):R("",!0),t(ae,{bordered:r.value,value:a.prompt,"onUpdate:value":U[21]||(U[21]=A=>a.prompt=A),disabled:!r.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(Ss,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:ee},null,512),t(Kt,{onOk:Pe,ref_key:"importPromptRef",ref:K},null,512),t(qs,{ref_key:"uploadPromptRef",ref:F},null,512)])}}},wn=B(xn,[["__scopeId","data-v-c1235ef1"]]),ke=d=>(J("data-v-5d8fbdb0"),d=d(),G(),d),Sn={class:"actions-box"},qn={class:"setting-info-block"},Cn={class:"set-item w-100"},Ln={key:0,class:"set-item-content"},In=["src"],Rn={key:1},Un={class:"set-item"},En={class:"set-item"},On={class:"set-item"},An={class:"set-item"},jn={class:"form-box"},Mn={class:"form-item"},zn=ke(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),Dn={class:"form-item-body"},Pn={class:"form-item"},Nn={class:"form-item-label"},Tn=ke(()=>e("span",null,"温度 ",-1)),Vn={class:"form-item-body"},Bn={class:"number-box"},Qn={class:"number-slider-box"},Fn={class:"number-input-box"},Jn={class:"form-item"},Gn={class:"form-item-label"},Hn=ke(()=>e("span",null,"最大token ",-1)),Kn={class:"form-item-body"},Wn={class:"number-box"},Zn={class:"number-slider-box"},Yn={class:"number-input-box"},Xn={class:"form-item"},ei={class:"form-item-label"},ti=ke(()=>e("span",null,"上下文数量 ",-1)),oi={class:"form-item-body"},si={class:"number-box"},ni={class:"number-slider-box"},ii={class:"number-input-box"},ai={class:"form-item justify-between"},li={class:"form-item-label"},ci=ke(()=>e("span",null,"显示推理过程 ",-1)),ri=ke(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),_i={__name:"model-settings",setup(d){const r=["azure","ollama","xinference","openaiAgent"],h=["azure"],u=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),p=k([]),i=k(!1),{robotInfo:l,updateRobotInfo:S}=X("robotInfo"),o=Q({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),x=k(""),I=k(""),a=k(""),_=b=>{o.use_model=r.includes(b.rawData.model_define)&&b.rawData.deployment_name?b.rawData.deployment_name:b.rawData.name,o.use_model_icon=b.icon,o.use_model_name=b.use_model_name,o.model_config_id=b.rawData.id,x.value=b.rawData.model_define},c=k(!1),g=b=>{b.target.closest(".custom-select")||(c.value=!1)};ye(()=>{r.indexOf(x.value)>-1?o.use_model=a.value:o.use_model=l.use_model,document.addEventListener("click",g)}),Lt(()=>{document.removeEventListener("click",g)});const $=()=>{a.value=o.use_model;let b={...Z(o)};h.indexOf(x.value)>-1&&(b.use_model="默认"),S(b),i.value=!1},L=b=>{r.indexOf(x.value)>-1?o.use_model=a.value:o.use_model=l.use_model,o.model_config_id=l.model_config_id,o.temperature=l.temperature,o.max_token=l.max_token,o.context_pair=l.context_pair,o.think_switch=Number(l.think_switch),i.value=b};Ae(()=>{o.model_config_id=l.model_config_id,o.temperature=l.temperature,o.max_token=l.max_token,o.context_pair=l.context_pair,o.think_switch=Number(l.think_switch)});function f(b,v,P){const j=new Set(b.map(M=>M.model_define));return v.filter(M=>{let E=M[P];j.has(E)&&b.filter(N=>{if(N.model_define==E)return N.children=Nt(N.children,M.children),!1})}),b}return(()=>{ut({model_type:"LLM"}).then(b=>{a.value=l.use_model;let v=b.data||[],P=[];p.value=v.map(j=>{P=[];for(let M=0;M<j.model_info.llm_model_list.length;M++){const E=j.model_info.llm_model_list[M];r.indexOf(j.model_info.model_define)>-1&&l.model_config_id==j.model_config.id&&(a.value=j.model_config.deployment_name,x.value=j.model_info.model_define,I.value=j.model_info.model_define),P.push({name:E,deployment_name:j.model_config.deployment_name,id:j.model_config.id,model_define:j.model_info.model_define,icon:j.model_info.model_icon_url,use_model_name:j.model_info.model_name})}return{id:j.model_config.id,name:j.model_info.model_name,model_define:j.model_info.model_define,icon:j.model_info.model_icon_url,children:P,deployment_name:j.model_config.deployment_name}}),p.value=f(Pt(p.value,"model_define"),p.value,"model_define"),l.use_model&&l.model_config_id&&p.value.some(j=>j.children.some(M=>{const E=r.includes(M.model_define)&&M.deployment_name?M.deployment_name:M.name;if(r.includes(M.model_define)&&M.deployment_name&&M.id===l.model_config_id)return o.use_model_icon=M.icon,o.use_model_name=M.use_model_name,o.use_model=M.deployment_name,!0;if(E===l.use_model&&M.id===l.model_config_id)return o.use_model_icon=M.icon,o.use_model_name=M.use_model_name,!0}))})})(),(b,v)=>{const P=se,j=to,M=ne,E=pt,N=ze,ee=ie,D=eo,K=Y;return s(),z(te,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:i.value,"onUpdate:isEdit":v[10]||(v[10]=O=>i.value=O)},{extra:n(()=>[e("div",Sn,[t(P,{onClick:v[0]||(v[0]=O=>L(!0)),size:"small"},{default:n(()=>[q("修改")]),_:1})])]),default:n(()=>[e("div",qn,[e("div",Cn,[q(" LLM模型： "),o.use_model_icon&&o.use_model_name?(s(),m("span",Ln,[e("img",{src:o.use_model_icon,class:"model-icon"},null,8,In),q(C(o.use_model_name)+" "+C(o.use_model),1)])):(s(),m("span",Rn,C(o.use_model),1))]),e("div",Un,[q(" 温度： "),e("span",null,C(o.temperature),1)]),e("div",En,[q(" 最大token： "),e("span",null,C(o.max_token),1)]),e("div",On,[q(" 上下文数量： "),e("span",null,C(o.context_pair),1)]),e("div",An,[q(" 显示推理过程： "),e("span",null,C(o.think_switch==1?"开":"关"),1)])]),t(K,{open:i.value,"onUpdate:open":v[9]||(v[9]=O=>i.value=O),width:672,title:"模型设置",onOk:$},{default:n(()=>[e("div",jn,[t(D,{gutter:[32,24]},{default:n(()=>[t(j,we(Se(u)),{default:n(()=>[e("div",Mn,[zn,e("div",Dn,[t(Xt,{modelValue:o.use_model,"onUpdate:modelValue":v[1]||(v[1]=O=>o.use_model=O),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":o.model_config_id,onChange:_},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(j,we(Se(u)),{default:n(()=>[e("div",Pn,[e("div",Nn,[Tn,t(M,null,{title:n(()=>[q("温度越低，回答越严谨。温度越高，回答越发散。")]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),e("div",Vn,[e("div",Bn,[e("div",Qn,[t(E,{class:"custom-slider",value:o.temperature,"onUpdate:value":v[2]||(v[2]=O=>o.temperature=O),min:0,max:2,step:.1},null,8,["value"])]),e("div",Fn,[t(N,{value:o.temperature,"onUpdate:value":v[3]||(v[3]=O=>o.temperature=O),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(u)),{default:n(()=>[e("div",Jn,[e("div",Gn,[Hn,t(M,null,{title:n(()=>[q("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),e("div",Kn,[e("div",Wn,[e("div",Zn,[t(E,{class:"custom-slider",value:o.max_token,"onUpdate:value":v[4]||(v[4]=O=>o.max_token=O),min:0,max:100*1024},null,8,["value"])]),e("div",Yn,[t(N,{value:o.max_token,"onUpdate:value":v[5]||(v[5]=O=>o.max_token=O),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(u)),{default:n(()=>[e("div",Xn,[e("div",ei,[ti,t(M,null,{title:n(()=>[q("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),e("div",oi,[e("div",si,[e("div",ni,[t(E,{class:"custom-slider",value:o.context_pair,"onUpdate:value":v[6]||(v[6]=O=>o.context_pair=O),min:0,max:10},null,8,["value"])]),e("div",ii,[t(N,{value:o.context_pair,"onUpdate:value":v[7]||(v[7]=O=>o.context_pair=O),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(u)),{default:n(()=>[e("div",ai,[e("div",li,[ci,t(M,null,{title:n(()=>[ri]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),t(ee,{checked:o.think_switch,"onUpdate:checked":v[8]||(v[8]=O=>o.think_switch=O),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},di=B(_i,[["__scopeId","data-v-5d8fbdb0"]]),ui={class:"library-checkbox-box"},pi={class:"list-tools"},mi={class:"list-box",ref:"scrollContainer"},vi={class:"library-name"},hi={class:"library-desc"},fi={__name:"library-select-alert",emits:["change"],setup(d,{expose:r,emit:h}){const u=h,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),i=k(!1),l=L=>{_(),p.checkedList=L,i.value=!0},S=()=>{i.value=!1,a()},o=k(""),x=()=>{_()},I=k([]),a=()=>{u("change",[...p.checkedList])},_=async()=>{const L=await nt({library_name:o.value,type:"",show_open_docs:1});if(L){let f=L.data||[];I.value=f}},c=k(!1),g=async()=>{c.value=!0,await _(),c.value=!1,W.success("刷新完成")},$=()=>{window.open("/#/library/list")};return r({open:l}),(L,f)=>{const w=mt,b=ue,v=se,P=Fe,j=Qe,M=je,E=Y;return s(),z(E,{width:"746px",open:i.value,"onUpdate:open":f[2]||(f[2]=N=>i.value=N),title:"关联知识库",onOk:S},{default:n(()=>[e("div",ui,[t(w,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",pi,[e("div",null,[t(b,{style:{width:"282px"},value:o.value,"onUpdate:value":f[0]||(f[0]=N=>o.value=N),placeholder:"请输入知识库名称搜索",onChange:x},{suffix:n(()=>[t(y(oo),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(v,{style:{"margin-right":"8px"},onClick:g},{default:n(()=>[t(y(so)),q(" 刷新 ")]),_:1}),t(v,{type:"primary",ghost:"",onClick:$},{default:n(()=>[q("新建知识库")]),_:1})])]),t(M,{spinning:c.value,delay:100},{default:n(()=>[t(j,{value:p.checkedList,"onUpdate:value":f[1]||(f[1]=N=>p.checkedList=N),style:{width:"100%"}},{default:n(()=>[e("div",mi,[(s(!0),m(T,null,H(I.value,N=>(s(),m("div",{class:"list-item-wraapper",key:N.id},[t(P,{class:"list-item",value:N.id},{default:n(()=>[e("div",vi,C(N.library_name),1),e("div",hi,C(N.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},bi=B(fi,[["__scopeId","data-v-917767e7"]]),De=d=>(J("data-v-a2abcb20"),d=d(),G(),d),yi={class:"recall-settings-box"},ki={class:"form-box"},gi={class:"form-item is-required"},$i=De(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),xi={class:"form-item-body"},wi={class:"retrieval-mode-items"},Si=["onClick"],qi={class:"retrieval-mode-title"},Ci={class:"title-text"},Li={key:0,style:{width:"32px"},src:no,alt:""},Ii={class:"retrieval-mode-desc"},Ri={class:"form-item"},Ui={class:"form-item-label"},Ei=De(()=>e("span",null,"Top K ",-1)),Oi={class:"form-item-body"},Ai={class:"number-box"},ji={class:"number-slider-box"},Mi={class:"number-input-box"},zi={key:0,class:"form-item"},Di={class:"form-item-label"},Pi=De(()=>e("span",null,"相似度阈值 ",-1)),Ni={class:"form-item-body"},Ti={class:"number-box"},Vi={class:"number-slider-box"},Bi={class:"number-input-box"},Qi={class:"form-item"},Fi={class:"form-item-label"},Ji=De(()=>e("span",null,"Rerank模型",-1)),Gi={key:0,class:"form-item-body"},Hi=["src"],Ki={__name:"recall-settings-alert",emits:["change"],setup(d,{expose:r,emit:h}){const u=h,p=k([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),i=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),l=k(!1),S=L=>{$(),i.rerank_status=L.rerank_status||0,i.rerank_use_model=L.rerank_use_model||void 0,i.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",i.top_k=L.top_k,i.similarity=L.similarity,i.search_type=L.search_type,l.value=!0},o=(L,f)=>{if(!L||!f){i.rerank_model_config_id="";return}i.rerank_model_config_id=f.rerank_model_config_id},x=L=>{L==0&&(i.rerank_model_config_id="",i.rerank_use_model="")},I=L=>{i.search_type=L},a=()=>i.rerank_status==1&&!i.rerank_model_config_id,_=()=>{if(a())return W.error("请选择Rerank模型");l.value=!1,c()},c=()=>{u("change",Z(i))},g=k([]),$=()=>{ut({model_type:"RERANK"}).then(L=>{let f=L.data||[];g.value=f.map(w=>({id:w.model_config.id,name:w.model_info.model_name,icon:w.model_info.model_icon_url,children:w.model_info.rerank_model_list}))})};return r({open:S}),(L,f)=>{const w=de,b=ne,v=pt,P=ze,j=ie,M=ct,E=Wt,N=lt,ee=Y;return s(),z(ee,{width:"746px",open:l.value,"onUpdate:open":f[6]||(f[6]=D=>l.value=D),title:"召回设置",onOk:_},{default:n(()=>[e("div",yi,[e("div",ki,[e("div",gi,[$i,e("div",xi,[e("div",wi,[(s(!0),m(T,null,H(p.value,D=>(s(),m("div",{class:Oe(["retrieval-mode-item",{active:i.search_type==D.value}]),key:D.value,onClick:K=>I(D.value)},[i.search_type==D.value?(s(),z(w,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",qi,[t(w,{name:D.iconName,class:"title-icon"},null,8,["name"]),e("span",Ci,C(D.title),1),D.isRecommendation?(s(),m("img",Li)):R("",!0)]),e("div",Ii,C(D.desc),1)],10,Si))),128))])])]),e("div",Ri,[e("div",Ui,[Ei,t(b,null,{title:n(()=>[q("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),e("div",Oi,[e("div",Ai,[e("div",ji,[t(v,{class:"custom-slider",value:i.top_k,"onUpdate:value":f[0]||(f[0]=D=>i.top_k=D),min:1,max:10},null,8,["value"])]),e("div",Mi,[t(P,{value:i.top_k,"onUpdate:value":f[1]||(f[1]=D=>i.top_k=D),min:1,max:10},null,8,["value"])])])])]),i.search_type<=2?(s(),m("div",zi,[e("div",Di,[Pi,t(b,null,{title:n(()=>[q("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:n(()=>[t(y(oe),{class:"question-icon"})]),_:1})]),e("div",Ni,[e("div",Ti,[e("div",Vi,[t(v,{class:"custom-slider",value:i.similarity,"onUpdate:value":f[2]||(f[2]=D=>i.similarity=D),min:0,max:1,step:.01},null,8,["value"])]),e("div",Bi,[t(P,{value:i.similarity,"onUpdate:value":f[3]||(f[3]=D=>i.similarity=D),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",Qi,[e("div",Fi,[Ji,q("   "),t(j,{checkedValue:1,unCheckedValue:0,checked:i.rerank_status,"onUpdate:checked":f[4]||(f[4]=D=>i.rerank_status=D),onChange:x},null,8,["checked"])]),i.rerank_status==1?(s(),m("div",Gi,[t(N,{allowClear:"",value:i.rerank_use_model,"onUpdate:value":f[5]||(f[5]=D=>i.rerank_use_model=D),placeholder:"请选择Rerank模型",onChange:o,style:{width:"60%"}},{default:n(()=>[(s(!0),m(T,null,H(g.value,D=>(s(),z(E,{key:D.id},{label:n(()=>[e("span",null,[e("img",{class:"model-icon",src:D.icon,alt:""},null,8,Hi)])]),default:n(()=>[(s(!0),m(T,null,H(D.children,K=>(s(),z(M,{value:K,rerank_model_config_id:D.id,key:K},{default:n(()=>[e("span",null,C(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):R("",!0)])])])]),_:1},8,["open"])}}},Wi=B(Ki,[["__scopeId","data-v-a2abcb20"]]),Zi=d=>(J("data-v-a87bd0fa"),d=d(),G(),d),Yi={class:"list-box"},Xi=["onClick"],ea={class:"avater-box"},ta=["src"],oa={class:"content-box"},sa={class:"title-block"},na=Zi(()=>e("div",{class:"tag-icon"},"Graph",-1)),ia={class:"title-text"},aa={class:"desc-box"},la={class:"right-icon"},ca={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(d,{expose:r,emit:h}){const u=h,p=d,i=k(!1);me(()=>p.list,()=>{p.list.length==0&&(i.value=!1)},{});const l=()=>{i.value=!0},S=()=>{document.visibilityState==="visible"&&u("refreshList")};ye(()=>{document.addEventListener("visibilitychange",S)}),It(()=>{document.removeEventListener("visibilitychange",S)});const o=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return r({show:l}),(x,I)=>{const a=mt,_=Be,c=Y;return s(),m("div",null,[t(c,{open:i.value,"onUpdate:open":I[0]||(I[0]=g=>i.value=g),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:n(()=>[t(a,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(_,{scrollbar:!1,style:{height:"400px"}},{default:n(()=>[e("div",Yi,[(s(!0),m(T,null,H(p.list,g=>(s(),m("div",{class:"list-item",onClick:$=>o(g),key:g.id},[e("div",ea,[e("img",{src:g.avatar,alt:""},null,8,ta)]),e("div",oa,[e("div",sa,[na,e("div",ia,C(g.library_name),1)]),e("div",aa,C(g.library_intro),1)]),e("div",la,[t(y(io))])],8,Xi))),128))])]),_:1})]),_:1},8,["open"])])}}},ra=B(ca,[["__scopeId","data-v-a87bd0fa"]]),_a={class:"actions-box"},da={key:0,class:"library-list"},ua=["onClick"],pa=["onClick"],ma={class:"library-name"},va={class:"library-name-text"},ha={class:"library-intro"},fa={class:"setting-info-block"},ba={class:"set-item"},ya={key:0},ka={key:1},ga={key:2},$a={key:3},xa={class:"set-item"},wa={key:0,class:"set-item"},Sa={class:"set-item"},qa={key:0},Ca={key:1},La={__name:"index",setup(d){const{getStorage:r,removeStorage:h}=Vt("localStorage"),u=Tt(),p=be(()=>{var E;return((E=u.companyInfo)==null?void 0:E.neo4j_status)=="true"}),i=k(!1),{robotInfo:l,updateRobotInfo:S}=X("robotInfo"),o=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),x=k([]),I=k(null),a=be(()=>x.value.filter(E=>o.library_ids.includes(E.id))),_=be(()=>a.value.filter(E=>E.graph_switch==0)),c=E=>{let N=o.library_ids.indexOf(E.id);o.library_ids.splice(N,1),v()},g=E=>{o.library_ids=[...E],v()},$=()=>{I.value.open([...o.library_ids])},L=k(null),f=()=>{L.value.open(Z(o))},w=k(null),b=E=>{o.rerank_status=E.rerank_status,o.rerank_use_model=E.rerank_use_model,o.rerank_model_config_id=E.rerank_model_config_id,o.top_k=E.top_k,o.similarity=E.similarity,o.search_type=E.search_type,(E.search_type==1||E.search_type==4)&&_.value.length>0&&w.value.show(),v()},v=()=>{let E={...Z(o)};E.library_ids=E.library_ids.join(","),S({...E})},P=async()=>{const E=await nt({type:"",show_open_docs:1});E&&(x.value=E.data||[])},j=()=>{Y.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){$()}})};o.rerank_use_model=l.rerank_use_model||void 0,Ae(()=>{o.library_ids=l.library_ids.split(","),o.rerank_status=l.rerank_status||0,o.rerank_use_model=l.rerank_use_model||void 0,o.rerank_model_config_id=l.rerank_model_config_id||"",o.top_k=l.top_k,o.similarity=l.similarity,o.search_type=l.search_type});const M=E=>{window.open(`#/library/details/knowledge-document?id=${E.id}`)};return ye(()=>{P(),r("showNoLibraryTip")&&(j(),h("showNoLibraryTip"))}),(E,N)=>{const ee=se,D=qe,K=ne;return s(),z(te,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:i.value,"onUpdate:isEdit":N[0]||(N[0]=O=>i.value=O),bodyStyle:{padding:0}},{extra:n(()=>[e("div",_a,[t(D,{gap:8},{default:n(()=>[t(ee,{size:"small",onClick:f},{default:n(()=>[q("召回设置")]),_:1}),t(ee,{size:"small",onClick:$},{default:n(()=>[q("关联知识库")]),_:1})]),_:1})])]),default:n(()=>[a.value.length>0?(s(),m("div",da,[(s(!0),m(T,null,H(a.value,O=>(s(),m("div",{class:"library-item",key:O.id,onClick:F=>M(O)},[e("span",{class:"close-btn",onClick:Rt(F=>c(O),["stop"])},[t(y(ve))],8,pa),e("div",ma,[p.value?(s(),z(K,{key:0},{title:n(()=>[q(C(O.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:n(()=>[e("div",{class:Oe(["graph-tag",{active:O.graph_switch==1}])},"Graph",2)]),_:2},1024)):R("",!0),e("div",va,C(O.library_name),1)]),e("div",ha,C(O.library_intro),1)],8,ua))),128))])):R("",!0),e("div",fa,[e("div",ba,[q(" 检索模式： "),o.search_type==1?(s(),m("span",ya,"混合检索")):R("",!0),o.search_type==2?(s(),m("span",ka,"向量检索")):R("",!0),o.search_type==3?(s(),m("span",ga,"全文检索")):R("",!0),o.search_type==4?(s(),m("span",$a,"知识图谱检索")):R("",!0)]),e("div",xa,[q(" Top K： "),e("span",null,C(o.top_k),1)]),o.search_type<=2?(s(),m("div",wa,[q(" 相似度阈值： "),e("span",null,C(o.similarity),1)])):R("",!0),e("div",Sa,[q(" Rerank模型： "),o.rerank_status==0?(s(),m("span",qa,"关")):(s(),m("span",Ca,C(o.rerank_use_model),1))])]),t(bi,{ref_key:"librarySelectAlertRef",ref:I,onChange:g},null,512),t(Wi,{ref_key:"recallSettingsAlertRef",ref:L,onChange:b},null,512),t(ra,{list:_.value,onRefreshList:P,ref_key:"noOpenGraphModalRef",ref:w},null,8,["list"])]),_:1},8,["isEdit"])}}},Ia=B(La,[["__scopeId","data-v-ede78f9f"]]),Ra=d=>(J("data-v-b559dd08"),d=d(),G(),d),Ua={class:"library-checkbox-box"},Ea={class:"list-box",ref:"scrollContainer"},Oa={class:"library-name"},Aa={class:"library-desc"},ja={key:0,class:"empty-box"},Ma=Ra(()=>e("img",{src:ht,alt:""},null,-1)),za={__name:"library-select-alert",emits:["change"],setup(d,{expose:r,emit:h}){const u=h,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),i=k(!1),l=c=>{I(),p.checkedList=c,i.value=!0},S=()=>{i.value=!1,x()};k("");const o=k([]),x=()=>{u("change",[...p.checkedList])},I=async()=>{const c=await vt();if(c){let g=c.data||[];o.value=g}},a=k(!1),_=()=>{window.open("/#/database/list")};return r({open:l}),(c,g)=>{const $=Fe,L=Qe,f=je,w=Y;return s(),z(w,{width:"746px",open:i.value,"onUpdate:open":g[1]||(g[1]=b=>i.value=b),title:"关联数据表",onOk:S},{default:n(()=>[e("div",Ua,[t(f,{spinning:a.value,delay:100},{default:n(()=>[t(L,{value:p.checkedList,"onUpdate:value":g[0]||(g[0]=b=>p.checkedList=b),style:{width:"100%"}},{default:n(()=>[e("div",Ea,[(s(!0),m(T,null,H(o.value,b=>(s(),m("div",{class:"list-item-wraapper",key:b.id},[t($,{class:"list-item",value:b.id},{default:n(()=>[e("div",Oa,C(b.name),1),e("div",Aa,C(b.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!a.value&&!o.value.length?(s(),m("div",ja,[Ma,e("div",null,[q(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:_}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},Da=B(za,[["__scopeId","data-v-b559dd08"]]),Pa=d=>(J("data-v-c40914ca"),d=d(),G(),d),Na=Pa(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),Ta={class:"actions-box"},Va={key:0,class:"library-list"},Ba=["onClick"],Qa={class:"library-name"},Fa={class:"library-intro"},Ja={__name:"index",setup(d){const r=k(!1),{robotInfo:h,updateRobotInfo:u}=X("robotInfo"),p=Q({form_ids:[]}),i=k([]),l=k(null),S=be(()=>i.value.filter(c=>p.form_ids.includes(c.id))),o=c=>{let g=p.form_ids.indexOf(c.id);p.form_ids.splice(g,1),a()},x=c=>{p.form_ids=[...c],a()},I=()=>{l.value.open([...p.form_ids])},a=()=>{let c={...Z(p)};c.form_ids=c.form_ids.join(","),u({...c})};return(async()=>{const c=await vt();c&&(i.value=c.data||[])})(),Ae(()=>{p.form_ids=h.form_ids.split(",")}),(c,g)=>{const $=ne,L=se,f=qe;return s(),z(te,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:r.value,"onUpdate:isEdit":g[0]||(g[0]=w=>r.value=w),bodyStyle:{padding:0}},{tip:n(()=>[t($,{placement:"top"},{title:n(()=>[Na]),default:n(()=>[t(y(oe))]),_:1})]),extra:n(()=>[e("div",Ta,[t(f,{gap:8},{default:n(()=>[t(L,{size:"small",onClick:I},{default:n(()=>[q("关联数据表")]),_:1})]),_:1})])]),default:n(()=>[S.value.length>0?(s(),m("div",Va,[(s(!0),m(T,null,H(S.value,w=>(s(),m("div",{class:"library-item",key:w.id},[e("span",{class:"close-btn",onClick:b=>o(w)},[t(y(ve))],8,Ba),e("div",Qa,C(w.name),1),e("div",Fa,C(w.description),1)]))),128))])):R("",!0),t(Da,{ref_key:"librarySelectAlertRef",ref:l,onChange:x},null,512)]),_:1},8,["isEdit"])}}},Ga=B(Ja,[["__scopeId","data-v-c40914ca"]]),Ha={class:"form-box"},Ka={class:"question-title"},Wa={class:"question-options"},Za={class:"question-option"},Ya={class:"drag-btn"},Xa={class:"action-box"},el={class:"robot-info-box"},tl={class:"robot-welcome-content"},ol={class:"robot-welcome-question"},sl={__name:"welcome-words",setup(d){const r=k(!1),h=k(!1),{robotInfo:u,updateRobotInfo:p,scrollBoxToBottom:i}=X("robotInfo"),l=Q({welcomes:{content:"",question:[]}}),S=()=>{let _=!1;if(l.welcomes.question.length>0){for(let c=0;c<l.welcomes.question.length;c++)if(!l.welcomes.question[c].content){_=c+1;break}}return _},o=()=>{l.welcomes.question.push({content:"",id:Ee(8)})},x=_=>{l.welcomes.question.splice(_,1)},I=()=>{if(!l.welcomes.content)return W.error("请输入欢迎语");if(S())return W.error("引导问题内容不能为空");p({...Z(l)}),r.value=!1},a=()=>{let _={...u.welcomes},c=[];_.question.forEach(({content:g,id:$})=>{let L={id:$,content:g};L.id||(L.id=Ee(6)),c.push(L)}),l.welcomes.content=_.content,l.welcomes.question=c};return(_,c)=>{const g=Ce,$=de,L=ue;return s(),z(te,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:r.value,"onUpdate:isEdit":c[4]||(c[4]=f=>r.value=f),onSave:I,onEdit:a},{default:n(()=>[re(e("div",Ha,[e("div",Ka,[t(g,{value:l.welcomes.content,"onUpdate:value":c[0]||(c[0]=f=>l.welcomes.content=f),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",Wa,[t(y(Je),{modelValue:l.welcomes.question,"onUpdate:modelValue":c[1]||(c[1]=f=>l.welcomes.question=f),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=f=>h.value=!0),onEnd:c[3]||(c[3]=f=>h.value=!1)},{item:n(({element:f,index:w})=>[e("div",Za,[e("span",Ya,[t($,{name:"drag"})]),t(L,{class:"question-option-content",value:f.content,"onUpdate:value":b=>f.content=b,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Xa,[t(y(ve),{class:"del-btn",onClick:b=>x(w)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:o},[t(y(Me),{class:"add-btn-icon"}),q("添加引导问题 ")])])],512),[[_e,r.value]]),re(e("div",el,[e("div",tl,C(y(u).welcomes.content),1),e("div",ol,[(s(!0),m(T,null,H(y(u).welcomes.question,(f,w)=>(s(),m("div",{class:"question-item",key:w},C(f.content),1))),128))])],512),[[_e,!r.value]])]),_:1},8,["isEdit"])}}},nl=B(sl,[["__scopeId","data-v-ea227a87"]]),il=d=>(J("data-v-bc797bf6"),d=d(),G(),d),al=il(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),ll={class:"form-box"},cl={class:"question-title"},rl={class:"question-options"},_l={class:"question-option"},dl={class:"drag-btn"},ul={class:"action-box"},pl={class:"robot-info-box"},ml={class:"robot-unknown-content"},vl={class:"robot-unknown-question"},hl={__name:"unknown-problem-prompt",setup(d){const r=k(!1),h=k(!1),{robotInfo:u,updateRobotInfo:p,scrollBoxToBottom:i}=X("robotInfo"),l=Q({unknown_question_prompt:{content:"",question:[]}}),S=()=>{l.unknown_question_prompt.question.push({content:"",id:Ee(8)}),st(()=>{i()})},o=a=>{l.unknown_question_prompt.question.splice(a,1)},x=()=>{p({...Z(l)}),r.value=!1},I=()=>{let a={...u.unknown_question_prompt},_=[];a.question&&a.question.forEach(({content:c,id:g})=>{let $={id:g,content:c};$.id||($.id=Ee(6)),_.push($)}),a.content&&(l.unknown_question_prompt.content=a.content),_&&(l.unknown_question_prompt.question=_)};return ye(()=>{}),(a,_)=>{const c=ne,g=Ce,$=de,L=ue;return s(),z(te,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:r.value,"onUpdate:isEdit":_[4]||(_[4]=f=>r.value=f),onSave:x,onEdit:I},{tip:n(()=>[t(c,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[al]),default:n(()=>[t(y(oe))]),_:1})]),default:n(()=>[re(e("div",ll,[e("div",cl,[t(g,{value:l.unknown_question_prompt.content,"onUpdate:value":_[0]||(_[0]=f=>l.unknown_question_prompt.content=f),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",rl,[t(y(Je),{modelValue:l.unknown_question_prompt.question,"onUpdate:modelValue":_[1]||(_[1]=f=>l.unknown_question_prompt.question=f),"item-key":"id",handle:".drag-btn",onStart:_[2]||(_[2]=f=>h.value=!0),onEnd:_[3]||(_[3]=f=>h.value=!1)},{item:n(({element:f,index:w})=>[e("div",_l,[e("span",dl,[t($,{name:"drag"})]),t(L,{class:"question-option-content",value:f.content,"onUpdate:value":b=>f.content=b,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ul,[t(y(ve),{class:"del-btn",onClick:b=>o(w)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:S},[t(y(Me),{class:"add-btn-icon"}),q("添加引导问题 ")])])],512),[[_e,r.value]]),re(e("div",pl,[e("div",ml,C(y(u).unknown_question_prompt.content),1),e("div",vl,[(s(!0),m(T,null,H(y(u).unknown_question_prompt.question,(f,w)=>(s(),m("div",{class:"question-item",key:w},C(f.content),1))),128))])],512),[[_e,!r.value]])]),_:1},8,["isEdit"])}}},fl=B(hl,[["__scopeId","data-v-bc797bf6"]]),Le=d=>(J("data-v-a42248ec"),d=d(),G(),d),bl=Le(()=>e("span",null,null,-1)),yl={class:"robot-info-box"},kl=Le(()=>e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),gl=Le(()=>e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)),$l={class:"modal-box",ref:"modalBoxRef"},xl={class:"modal-item-box"},wl={class:"modal-item"},Sl=Le(()=>e("div",{class:"label"},"模型",-1)),ql={class:"modal-item"},Cl=Le(()=>e("div",{class:"label"},"对话背景",-1)),Ll={__name:"problem-optimization",setup(d){const r=k(!1);k(!1);const{robotInfo:h,updateRobotInfo:u}=X("robotInfo"),p=k("0"),i=Q({optimize_question_use_model:"",optimize_question_model_config_id:""});ye(()=>{p.value=h.optimize_question_model_config_id!=0?"1":"0",i.optimize_question_use_model=h.optimize_question_use_model,i.optimize_question_model_config_id=h.optimize_question_model_config_id});const l=k([]),S=_=>{l.value=_,st(()=>{(!i.optimize_question_use_model||!Number(i.optimize_question_model_config_id))&&o()})},o=()=>{if(l.value.length>0){let _=null,c=null;for(let g of l.value)if(g.model_define==="tongyi"){_=g;for(let $ of _.children)if($.name==="qwen-max"){c=$;break}break}_||(_=l.value[0],c=_.children[0]),_&&c&&(i.optimize_question_use_model=c.name,i.optimize_question_model_config_id=c.model_config_id)}},x=()=>{r.value=!1,u({...Z(i)})},I=_=>{_!=1&&(i.optimize_question_use_model="",i.optimize_question_model_config_id=0)},a=_=>{u({})};return(_,c)=>{const g=ne,$=ie,L=bt,f=ft,w=Ce,b=Y;return s(),z(te,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:n(()=>[bl]),default:n(()=>[e("div",yl,[kl,t(g,null,{title:n(()=>[gl]),default:n(()=>[e("div",{class:"dialog-bg-set",onClick:c[0]||(c[0]=v=>r.value=!0)}," 对话背景设置 ")]),_:1})]),t($,{onChange:a,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(h).enable_question_optimize,"onUpdate:checked":c[1]||(c[1]=v=>y(h).enable_question_optimize=v),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",$l,[t(b,{getContainer:()=>_.$refs.modalBoxRef,open:r.value,"onUpdate:open":c[6]||(c[6]=v=>r.value=v),width:472,title:"用户问题建议设置",onOk:x},{default:n(()=>[e("div",xl,[e("div",wl,[Sl,t(f,{value:p.value,"onUpdate:value":c[2]||(c[2]=v=>p.value=v),onChange:I},{default:n(()=>[t(L,{value:"0"},{default:n(()=>[q("跟随机器人")]),_:1}),t(L,{value:"1"},{default:n(()=>[q("指定模型")]),_:1})]),_:1},8,["value"]),p.value=="1"?(s(),z(ao,{key:0,modelType:"LLM",modeName:i.optimize_question_use_model,"onUpdate:modeName":c[3]||(c[3]=v=>i.optimize_question_use_model=v),modeId:i.optimize_question_model_config_id,"onUpdate:modeId":c[4]||(c[4]=v=>i.optimize_question_model_config_id=v),style:{width:"100%","margin-top":"8px"},onLoaded:S},null,8,["modeName","modeId"])):R("",!0)]),e("div",ql,[Cl,t(w,{style:{height:"120px"},value:y(h).optimize_question_dialogue_background,"onUpdate:value":c[5]||(c[5]=v=>y(h).optimize_question_dialogue_background=v),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Il=B(Ll,[["__scopeId","data-v-a42248ec"]]),Rl=d=>(J("data-v-f6a291d4"),d=d(),G(),d),Ul=Rl(()=>e("span",null,null,-1)),El={class:"robot-info-box"},Ol={class:"robot-prompt"},Al={__name:"suggested-issues",setup(d){k(!1);const{robotInfo:r,updateRobotInfo:h}=X("robotInfo"),u=p=>{h({})};return(p,i)=>{const l=ze,S=ie;return s(),z(te,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:n(()=>[Ul]),default:n(()=>[e("div",El,[e("div",Ol,[q(" 开启后，机器人回答问题后，自动根据对话内容提供 "),t(l,{value:y(r).question_guide_num,"onUpdate:value":i[0]||(i[0]=o=>y(r).question_guide_num=o),style:{width:"80px"},precision:0,min:1,max:10,onBlur:u},null,8,["value"]),q(" 条用户提问建议，最大不超过10条。 ")])]),t(S,{onChange:u,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(r).enable_question_guide,"onUpdate:checked":i[1]||(i[1]=o=>y(r).enable_question_guide=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},jl=B(Al,[["__scopeId","data-v-f6a291d4"]]),Ml=d=>(J("data-v-56c388e6"),d=d(),G(),d),zl=Ml(()=>e("span",null,null,-1)),Dl={__name:"sensitive-words",setup(d){k(!1);const{robotInfo:r,updateRobotInfo:h}=X("robotInfo");Q({prompt:""});const u=()=>{window.open("/#/user/sensitive-words")},p=i=>{h({})};return(i,l)=>{const S=ie;return s(),z(te,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:n(()=>[zl]),default:n(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[q(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:u,style:{cursor:"pointer"}},"设置敏词 >")])]),t(S,{onChange:p,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:y(r).sensitive_words_switch,"onUpdate:checked":l[0]||(l[0]=o=>y(r).sensitive_words_switch=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Pl=B(Dl,[["__scopeId","data-v-56c388e6"]]),He=d=>(J("data-v-a0ec9e93"),d=d(),G(),d),Nl={class:"direct-title"},Tl={class:"direct-desc"},Vl={class:"qa"},Bl={class:"prompt-form-item-label"},Ql=He(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Fl={class:"direct-switch"},Jl={class:"similarity"},Gl=He(()=>e("span",null,"相似度超过",-1)),Hl={class:"number-input-box"},Kl=He(()=>e("span",null,"时直接回复答案",-1)),Wl={__name:"chat-edit-alert",emits:["save"],setup(d,{expose:r,emit:h}){const u=h,p=k(1),i=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],l=Q(i()),S=k(!1),o=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{o.chat_type=p.value.toString(),l.forEach(_=>{_.chat_type==p.value&&(o.chat_type=="3"?(o.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch==1?"true":"false",o.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score.toString()):o.chat_type=="1"&&(o.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch==1?"true":"false",o.library_qa_direct_reply_score=_.library_qa_direct_reply_score.toString()))}),I(),Object.assign(l,i()),S.value=!1},I=()=>{u("save",Z(o))};ye(()=>{});const a=_=>{p.value=parseInt(_.chat_type),o.chat_type=_.chat_type,o.library_qa_direct_reply_score=_.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch,l.forEach(c=>{c.chat_type=="3"?(c.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score,c.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch=="true"?1:0):c.chat_type=="1"&&(c.library_qa_direct_reply_score=_.library_qa_direct_reply_score,c.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch=="true"?1:0)}),S.value=!0};return me(()=>S.value,_=>{_===!1&&Object.assign(l,i())},{immediate:!0}),r({open:a}),(_,c)=>{const g=ne,$=ie,L=ze,f=bt,w=ft,b=Y;return s(),z(b,{width:"746px",open:S.value,"onUpdate:open":c[1]||(c[1]=v=>S.value=v),title:"聊天模式设置",onOk:x},{default:n(()=>[t(w,{class:"direct-box",value:p.value,"onUpdate:value":c[0]||(c[0]=v=>p.value=v)},{default:n(()=>[(s(!0),m(T,null,H(l,v=>(s(),z(f,{class:Oe(["direct-item",{active:p.value==v.direct_id}]),value:v.direct_id,key:v.direct_id},{default:n(()=>[e("div",Nl,C(v.direct_title),1),e("div",Tl,C(v.direct_desc),1),re(e("div",Vl,[e("div",Bl,[Ql,t(g,null,Ut({default:n(()=>[t(y(oe),{class:"question-icon"})]),_:2},[v.chat_type=="1"?{name:"title",fn:n(()=>[q("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:v.chat_type=="3"?{name:"title",fn:n(()=>[q("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Fl,[v.chat_type=="1"?(s(),z($,{key:0,checkedValue:1,unCheckedValue:0,checked:v.library_qa_direct_reply_switch,"onUpdate:checked":P=>v.library_qa_direct_reply_switch=P},null,8,["checked","onUpdate:checked"])):v.chat_type=="3"?(s(),z($,{key:1,checkedValue:1,unCheckedValue:0,checked:v.mixture_qa_direct_reply_switch,"onUpdate:checked":P=>v.mixture_qa_direct_reply_switch=P},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[_e,v.isQaDirectReply&&p.value==v.direct_id]]),re(e("div",Jl,[Gl,e("div",Hl,[v.chat_type=="1"?(s(),z(L,{key:0,value:v.library_qa_direct_reply_score,"onUpdate:value":P=>v.library_qa_direct_reply_score=P,disabled:!v.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):v.chat_type=="3"?(s(),z(L,{key:1,value:v.mixture_qa_direct_reply_score,"onUpdate:value":P=>v.mixture_qa_direct_reply_score=P,disabled:!v.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),Kl],512),[[_e,v.isQaDirectReply&&p.value==v.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Zl=B(Wl,[["__scopeId","data-v-a0ec9e93"]]),Ke=d=>(J("data-v-5b59ec9b"),d=d(),G(),d),Yl=Ke(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),Xl=Ke(()=>e("br",null,null,-1)),ec=Ke(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),tc={class:"actions-box"},oc={class:"setting-info-block"},sc={class:"set-item"},nc={key:0},ic={key:1},ac={key:2},lc={class:"set-item"},cc={key:0,class:"set-item"},rc={class:"set-item"},_c={key:0,class:"set-item"},dc={class:"form-box"},uc={__name:"index",setup(d){const r=k(!1),h=k(null),{robotInfo:u,updateRobotInfo:p}=X("robotInfo"),i=Q({chat_type:u.chat_type,library_qa_direct_reply_score:u.library_qa_direct_reply_score,library_qa_direct_reply_switch:u.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:u.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:u.mixture_qa_direct_reply_switch}),l=x=>{i.chat_type=x.chat_type,i.library_qa_direct_reply_score=x.library_qa_direct_reply_score,i.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,i.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,i.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,S()},S=()=>{p({...Z(i)}),r.value=!1},o=()=>{h.value.open(Z(i)),r.value=!0};return(x,I)=>{const a=ne,_=se;return s(),z(te,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:r.value,"onUpdate:isEdit":I[1]||(I[1]=c=>r.value=c),bodyStyle:{padding:0}},{tip:n(()=>[t(a,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[Yl,Xl,ec]),default:n(()=>[t(y(oe))]),_:1})]),extra:n(()=>[e("div",tc,[t(_,{size:"small",onClick:I[0]||(I[0]=c=>o(!0))},{default:n(()=>[q("修改")]),_:1})])]),default:n(()=>[e("div",oc,[e("div",sc,[q(" 聊天模式： "),y(u).chat_type=="1"?(s(),m("span",nc,"仅知识库")):R("",!0),y(u).chat_type=="2"?(s(),m("span",ic,"直连模式")):R("",!0),y(u).chat_type=="3"?(s(),m("span",ac,"混合模式")):R("",!0)]),y(u).chat_type=="1"?(s(),m(T,{key:0},[e("div",lc,[q(" QA文档直接回复答案： "),e("span",null,C(y(u).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),y(u).library_qa_direct_reply_switch=="true"?(s(),m("div",cc,[q(" 相似度值： "),e("span",null,C(y(u).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),y(u).chat_type=="3"?(s(),m(T,{key:1},[e("div",rc,[q(" QA文档直接回复答案： "),e("span",null,C(y(u).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),y(u).mixture_qa_direct_reply_switch=="true"?(s(),m("div",_c,[q(" 相似度值： "),e("span",null,C(y(u).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",dc,[t(Zl,{ref_key:"ChatEditAlertRef",ref:h,onSave:l},null,512)])]),_:1},8,["isEdit"])}}},pc=B(uc,[["__scopeId","data-v-5b59ec9b"]]),mc=d=>(J("data-v-8d185d5f"),d=d(),G(),d),vc={class:"switch-box"},hc={class:"switch-box-body"},fc={class:"switch-box-header"},bc={class:"left-box"},yc={class:"switch-box-title"},kc={key:0,class:"title-tip"},gc={class:"right-box"},$c={class:"extra-box"},xc=mc(()=>e("div",{class:"extra-box"},null,-1)),wc={class:"switch-desc"},Sc={class:"switch-box-right"},qc={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(d,{emit:r}){const h=r,u=d,p=k(u.value),i=l=>{h("update:value",l),h("change",l)};return(l,S)=>{const o=de,x=ie;return s(),m("div",vc,[e("div",hc,[e("div",fc,[e("div",bc,[t(o,{class:"switch-box-icon",name:u.iconName},null,8,["name"]),e("span",yc,C(u.title),1),l.$slots.tip?(s(),m("span",kc,[pe(l.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",gc,[e("div",$c,[pe(l.$slots,"extra",{},()=>[xc],!0)])])]),e("div",wc,[pe(l.$slots,"default",{},void 0,!0)])]),e("div",Sc,[t(x,{checked:p.value,"onUpdate:checked":S[0]||(S[0]=I=>p.value=I),onChange:i,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Cc=B(qc,[["__scopeId","data-v-8d185d5f"]]),Lc="/assets/img/empty-Bx9z1cwf.png",Ic="/assets/img/phone-head-CDwwPhYa.png",Rc="/assets/img/phone-body-CbEf8GZP.png",Uc="/assets/img/phone-footer-ClQtNpln.png",he=d=>(J("data-v-5125783f"),d=d(),G(),d),Ec={class:"common-problem-box"},Oc={class:"left-content-box"},Ac={key:0,class:"empty-box"},jc=he(()=>e("img",{src:Lc,alt:""},null,-1)),Mc=he(()=>e("div",{class:"title"},"暂无数据",-1)),zc=he(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Dc={key:1,class:"lists-box"},Pc={class:"drag-btn"},Nc={class:"title"},Tc={class:"opration-box"},Vc={class:"preview-box"},Bc=he(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ic,alt:""})],-1)),Qc={class:"phone-body"},Fc=he(()=>e("div",null,[e("img",{class:"body-img",src:Rc,alt:""})],-1)),Jc={key:0,class:"question-box"},Gc=he(()=>e("div",{class:"name"},"常见问题",-1)),Hc=he(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Uc,alt:""})],-1)),Kc={__name:"common-problem",setup(d){k(!1);const{robotInfo:r,updateRobotInfo:h}=X("robotInfo"),u=be(()=>r.common_question_list?JSON.parse(r.common_question_list):[]),p=k([]);p.value=u.value,me(u,()=>{p.value=u.value});const i=Ve.useForm,l=k(!1),S=k("添加问题"),o=Q({question:"",index:-1}),x=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:I,validate:a,validateInfos:_}=i(o,x),c=()=>{if(u.value.length>=10)return W.error("最多设置10条常用问题");l.value=!0,I(),o.question="",o.index=-1},g=(b,v)=>{l.value=!0,I(),o.question=b,o.index=v},$=b=>{let v=[];v=u.value.filter((P,j)=>b!=j),Y.confirm({title:"提醒",icon:t(Te),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){h({common_question_list:JSON.stringify(v)})},onCancel(){}})},L=()=>{a().then(()=>{let b=[];o.index>=0?b=u.value.map((v,P)=>P===o.index?o.question:v):b=[o.question,...u.value],h({common_question_list:JSON.stringify(b)}),l.value=!1})},f=b=>{h({})},w=b=>{h({common_question_list:JSON.stringify(p.value)})};return(b,v)=>{const P=ne,j=ie,M=lo,E=se,N=de,ee=ue,D=at,K=Ve,O=Y;return s(),m("div",Ec,[e("div",Oc,[t(te,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:n(()=>[t(P,null,{title:n(()=>[q("最多10条。开启后，常见问题会显示在每条问答后面")]),default:n(()=>[t(y(oe),{class:"quess-icon"})]),_:1})]),extra:n(()=>[t(j,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(r).enable_common_question,"onUpdate:checked":v[0]||(v[0]=F=>y(r).enable_common_question=F),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(M,{type:"vertical"}),t(E,{type:"primary",size:"small",onClick:c},{default:n(()=>[q("添加")]),_:1})]),default:n(()=>[u.value.length==0?(s(),m("div",Ac,[jc,Mc,zc,t(E,{onClick:c,type:"primary"},{default:n(()=>[q("立即添加")]),_:1})])):(s(),m("div",Dc,[t(y(Je),{modelValue:p.value,"onUpdate:modelValue":v[1]||(v[1]=F=>p.value=F),handle:".drag-btn","item-key":"index",onEnd:w},{item:n(({element:F,index:$e})=>[(s(),m("div",{class:"list-item",key:$e},[e("span",Pc,[t(N,{name:"drag"})]),e("div",Nc,C(F),1),e("div",Tc,[t(y(yt),{onClick:Pe=>g(F,$e)},null,8,["onClick"]),t(y(ve),{onClick:Pe=>$($e)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Vc,[Bc,e("div",Qc,[Fc,u.value.length&&y(r).enable_common_question=="true"?(s(),m("div",Jc,[Gc,(s(!0),m(T,null,H(u.value,F=>(s(),m("div",{class:"list-item",key:F},C(F),1))),128))])):R("",!0)]),Hc]),t(O,{open:l.value,"onUpdate:open":v[3]||(v[3]=F=>l.value=F),title:S.value,onOk:L,width:"476px"},{default:n(()=>[t(K,{class:"form-box",layout:"vertical"},{default:n(()=>[t(D,Et({label:"问题名称"},y(_).question),{default:n(()=>[t(ee,{maxLength:100,value:o.question,"onUpdate:value":v[2]||(v[2]=F=>o.question=F),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Wc=B(Kc,[["__scopeId","data-v-5125783f"]]),Zc=e("span",null,null,-1),Yc=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),Xc={__name:"display-aitations",setup(d){const{robotInfo:r,updateRobotInfo:h}=X("robotInfo"),u=k(!1);me(()=>r.answer_source_switch,i=>{u.value=i=="true"},{immediate:!0});const p=()=>{h({answer_source_switch:u.value?"true":"false"})};return(i,l)=>(s(),z(Cc,{title:"显示引文","icon-name":"jibenpeizhi",value:u.value,"onUpdate:value":l[0]||(l[0]=S=>u.value=S),onChange:p},{extra:n(()=>[Zc]),default:n(()=>[Yc]),_:1},8,["value"]))}},$t=d=>(J("data-v-4948feb9"),d=d(),G(),d),er=$t(()=>e("span",null,null,-1)),tr=$t(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),or={__name:"show-like",setup(d){const{robotInfo:r,updateRobotInfo:h}=X("robotInfo"),u=p=>{h({})};return(p,i)=>{const l=ie;return s(),z(te,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:n(()=>[er]),default:n(()=>[tr,t(l,{onChange:u,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:y(r).feedback_switch,"onUpdate:checked":i[0]||(i[0]=S=>y(r).feedback_switch=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},sr=B(or,[["__scopeId","data-v-4948feb9"]]),ge=d=>(J("data-v-93184c86"),d=d(),G(),d),nr={class:"content-box"},ir={key:0,class:"add-btn-block"},ar={class:"list-content"},lr={key:0,class:"user-block"},cr={class:"name-box"},rr={class:"name"},_r={class:"remark-text"},dr={key:0,class:"hover-btn-box"},ur={key:0},pr={key:1},mr={key:2},vr={key:1,class:"hover-btn-box"},hr={class:"role-menu-box"},fr=["onClick"],br={class:"menu-header"},yr=ge(()=>e("span",{class:"title"},"管理",-1)),kr=ge(()=>e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),gr={key:0,class:"check-box"},$r=["onClick"],xr={class:"menu-header"},wr=ge(()=>e("span",{class:"title"},"编辑",-1)),Sr=ge(()=>e("div",{class:"desc"},"可编辑，可查看",-1)),qr={key:0,class:"check-box"},Cr=["onClick"],Lr={class:"menu-header"},Ir=ge(()=>e("span",{class:"title"},"查看",-1)),Rr=ge(()=>e("div",{class:"desc"},"仅查看",-1)),Ur={key:0,class:"check-box"},Er={class:"hover-btn-box"},Or={key:0},Ar={key:1},jr={key:2},Mr=["onClick"],zr={__name:"role-permission",setup(d){const r=tt().query,h=k(Bt(r.id)),u=k([]),p=Q({object_id:r.id,object_type:1}),i=()=>{ro({...p}).then(a=>{let _=a.data||[];u.value=_})};i();const l=k(null),S=()=>{l.value.show(u.value,[{object_id:+r.id,object_type:1,operate_rights:4}])},o=(a,_)=>{let c=_==4?"管理":_==2?"编辑":"查看";Y.confirm({title:"提示?",icon:t(Te),content:"确认修改该协作者权限为【"+c+"】",okText:"确认",cancelText:"取消",onOk:()=>{let g=[{object_id:+a.object_id,object_type:+a.object_type,operate_rights:+_}];_o({identity_ids:a.identity_id,identity_type:a.identity_type,object_array:JSON.stringify(g)}).then($=>{W.success("修改成功"),i()})},onCancel(){}})},x=a=>{Y.confirm({title:"提示?",icon:t(Te),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{uo({identity_id:a.identity_id,identity_type:a.identity_type,object_id:a.object_id,object_type:a.object_type}).then(_=>{W.success("删除成功"),i()})},onCancel(){}})},I=k([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(a,_)=>{const c=se,g=mo,$=ho,L=fo,f=Be;return s(),z(f,null,{default:n(()=>[e("div",nr,[h.value==4?(s(),m("div",ir,[t(c,{type:"primary",onClick:S,icon:ot(y(Me))},{default:n(()=>[q("添加协助者")]),_:1},8,["icon"])])):R("",!0),e("div",ar,[t(L,{columns:I.value,"data-source":u.value,pagination:!1},{bodyCell:n(({column:w,record:b})=>[w.key==="name"?(s(),m("div",lr,[t(g,{shape:"square",src:b.avatar,size:40},{icon:n(()=>[b.avatar?R("",!0):(s(),z(y(Xe),{key:0}))]),_:2},1032,["src"]),e("div",cr,[e("div",rr,C(b.user_name),1),e("div",_r,C(b.name),1)])])):R("",!0),w.key==="operate_rights"?(s(),m(T,{key:1},[h.value==2?(s(),m("div",dr,[b.operate_rights==4?(s(),m("span",ur,"管理")):R("",!0),b.operate_rights==2?(s(),m("span",pr,"编辑")):R("",!0),b.operate_rights==1?(s(),m("span",mr,"查看")):R("",!0)])):b.role_type==1||b.is_creator==1?(s(),m("div",vr,"管理")):(s(),z($,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:n(()=>[e("div",hr,[e("div",{class:"role-menu",onClick:v=>o(b,4)},[e("div",br,[t(y(Xe)),yr]),kr,b.operate_rights==4?(s(),m("div",gr,[t(y(Ne))])):R("",!0)],8,fr),e("div",{class:"role-menu",onClick:v=>o(b,2)},[e("div",xr,[t(y(yt)),wr]),Sr,b.operate_rights==2?(s(),m("div",qr,[t(y(Ne))])):R("",!0)],8,$r),e("div",{class:"role-menu",onClick:v=>o(b,1)},[e("div",Lr,[t(y(vo)),Ir]),Rr,b.operate_rights==1?(s(),m("div",Ur,[t(y(Ne))])):R("",!0)],8,Cr)])]),default:n(()=>[e("div",Er,[b.operate_rights==4?(s(),m("span",Or,"管理")):R("",!0),b.operate_rights==2?(s(),m("span",Ar,"编辑")):R("",!0),b.operate_rights==1?(s(),m("span",jr,"查看")):R("",!0),t(y(dt))])]),_:2},1024))],64)):R("",!0),w.key==="action"?(s(),m(T,{key:2},[h.value==4?(s(),m(T,{key:0},[b.role_type!=1&&b.is_creator!=1?(s(),m("a",{key:0,onClick:v=>x(b)},"移除",8,Mr)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),t(po,{onOk:i,ref_key:"addCollaboratorRef",ref:l},null,512)]),_:1})}}},Dr=B(zr,[["__scopeId","data-v-93184c86"]]),xt=d=>(J("data-v-e4519b11"),d=d(),G(),d),Pr={class:"library-checkbox-box"},Nr={class:"list-box",ref:"scrollContainer"},Tr={class:"library-name"},Vr={key:0,class:"library-desc"},Br={class:"library-desc"},Qr={key:0,class:"empty-box"},Fr=xt(()=>e("img",{src:ht,alt:""},null,-1)),Jr=xt(()=>e("div",null,"暂无数据表, 请先去添加数据表",-1)),Gr=[Fr,Jr],Hr={__name:"robot-select-alert",emits:["change"],setup(d,{expose:r,emit:h}){const u=h,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),i=k(!1),l=_=>{I(),p.checkedList=_,i.value=!0},S=()=>{i.value=!1,x()};k("");const o=k([]),x=()=>{u("change",[...p.checkedList])},I=async()=>{const _=await it({application_type:1});if(_){let c=_.data||[];o.value=c}},a=k(!1);return r({open:l}),(_,c)=>{const g=Fe,$=Qe,L=je,f=Y;return s(),z(f,{width:"746px",open:i.value,"onUpdate:open":c[1]||(c[1]=w=>i.value=w),title:"添加技能",onOk:S},{default:n(()=>[e("div",Pr,[t(L,{spinning:a.value,delay:100},{default:n(()=>[t($,{value:p.checkedList,"onUpdate:value":c[0]||(c[0]=w=>p.checkedList=w),style:{width:"100%"}},{default:n(()=>[e("div",Nr,[(s(!0),m(T,null,H(o.value,w=>(s(),m("div",{class:"list-item-wraapper",key:w.id},[t(g,{class:"list-item",disabled:w.start_node_key==="",value:w.id},{default:n(()=>[e("div",Tr,[q(C(w.robot_name)+" ",1),w.start_node_key===""?(s(),m("span",Vr," (未发布)")):R("",!0)]),e("div",Br,C(w.robot_intro),1)]),_:2},1032,["disabled","value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!a.value&&!o.value.length?(s(),m("div",Qr,Gr)):R("",!0)])]),_:1},8,["open"])}}},Kr=B(Hr,[["__scopeId","data-v-e4519b11"]]),Wr=d=>(J("data-v-13cb67dc"),d=d(),G(),d),Zr=Wr(()=>e("span",null,"支持关联工作流",-1)),Yr={class:"actions-box"},Xr={key:0,class:"library-list"},e_=["onClick"],t_={class:"library-name"},o_={class:"library-intro"},s_={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(d){const r=k(!1),{robotInfo:h,getRobot:u}=X("robotInfo"),p=d,i=Q({work_flow_ids:[]}),l=k(null),S=be(()=>p.robotList.filter(_=>i.work_flow_ids.includes(_.id))),o=_=>{let c=i.work_flow_ids.indexOf(_.id);i.work_flow_ids.splice(c,1),a()},x=_=>{i.work_flow_ids=[..._],a()},I=()=>{l.value.open([...i.work_flow_ids])},a=()=>{let _={...Z(i)};_.work_flow_ids=_.work_flow_ids.join(","),Jt({id:h.id,..._}).then(c=>{W.success("保存成功"),u(h.id)})};return Ae(()=>{i.work_flow_ids=h.work_flow_ids.split(",")}),(_,c)=>{const g=ne,$=se,L=qe;return s(),z(te,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:r.value,"onUpdate:isEdit":c[0]||(c[0]=f=>r.value=f),bodyStyle:{padding:0}},{tip:n(()=>[t(g,{placement:"top"},{title:n(()=>[Zr]),default:n(()=>[t(y(oe))]),_:1})]),extra:n(()=>[e("div",Yr,[t(L,{gap:8},{default:n(()=>[t($,{size:"small",onClick:I},{default:n(()=>[q("添加技能")]),_:1})]),_:1})])]),default:n(()=>[S.value.length>0?(s(),m("div",Xr,[(s(!0),m(T,null,H(S.value,f=>(s(),m("div",{class:"library-item",key:f.id},[e("span",{class:"close-btn",onClick:w=>o(f)},[t(y(ve))],8,e_),e("div",t_,C(f.robot_name),1),e("div",o_,C(f.robot_intro),1)]))),128))])):R("",!0),t(Kr,{ref_key:"robotSelectAlertRef",ref:l,onChange:x},null,512)]),_:1},8,["isEdit"])}}},n_=B(s_,[["__scopeId","data-v-13cb67dc"]]),i_={key:0,class:"robot-config-page"},a_={class:"setting-box"},l_={class:"setting-box"},c_={class:"setting-box"},r_={class:"setting-box"},__={class:"setting-box"},d_={class:"setting-box"},u_={class:"setting-box"},p_={class:"setting-box"},m_={class:"setting-box"},v_={class:"setting-box"},h_={class:"setting-box"},f_={class:"setting-box"},b_={class:"setting-box"},y_={class:"setting-box"},k_={key:1,class:"robot-config-page"},g_={key:2,class:"robot-config-page"},$_={__name:"index",setup(d){const r=co(),h=k(null),{robotInfo:u}=Ot(r),{getRobot:p}=r,i=()=>{h.value.scrollTop=h.value.scrollHeight},l=k(1),S=k(!1),o=Q(u.value),x=c=>{let g=JSON.parse(JSON.stringify(c));c.robot_avatar&&(g.robot_avatar=new File([c.robot_avatar],c.robot_avatar.name)),Object.assign(o,g),_()},I=k([]);(()=>{it({application_type:1}).then(c=>{I.value=c.data||[]})})(),At("robotInfo",{robotInfo:o,updateRobotInfo:x,scrollBoxToBottom:i,getRobot:p});const _=()=>{let c;o.robot_avatar&&(c=new File([o.robot_avatar],o.robot_avatar.name));let g=JSON.parse(JSON.stringify(Z(o)));c&&(g.robot_avatar=c);let $=g.welcomes;$.question=$.question.map(f=>f.content),g.welcomes=JSON.stringify($),g.prompt_struct=JSON.stringify(g.prompt_struct);let L=g.unknown_question_prompt;L.question=L.question.map(f=>f.content),g.unknown_question_prompt=JSON.stringify(L),delete g.robot_avatar_url,S.value=!0,Gt(g).then(f=>{if(f.res!=0)return W.error(f.msg);S.value=!1,W.success("保存成功"),p(o.id)}).catch(()=>{S.value=!1})};return(c,g)=>{const $=rt,L=_t;return s(),m(T,null,[t(L,{class:"tab-wrapper",activeKey:l.value,"onUpdate:activeKey":g[0]||(g[0]=f=>l.value=f)},{default:n(()=>[(s(),z($,{key:1,tab:"基础配置"})),(s(),z($,{key:3,tab:"权限管理"})),(s(),z($,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),l.value==1?(s(),m("div",i_,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:h},[e("div",a_,[t(Fo)]),e("div",l_,[t(Ia)]),e("div",c_,[t(di)]),e("div",r_,[t(pc)]),e("div",__,[t(wn,{robotList:I.value},null,8,["robotList"])]),e("div",d_,[t(n_,{robotList:I.value},null,8,["robotList"])]),e("div",u_,[t(Ga)]),e("div",p_,[t(nl)]),e("div",m_,[t(fl)]),e("div",v_,[t(Pl)]),e("div",h_,[t(Il)]),e("div",f_,[t(jl)]),e("div",b_,[t(Xc)]),e("div",y_,[t(sr)])],512)])):R("",!0),l.value==2?(s(),m("div",k_,[t(Wc)])):R("",!0),l.value==3?(s(),m("div",g_,[t(Dr)])):R("",!0)],64)}}},Yd=B($_,[["__scopeId","data-v-6f46d4b4"]]);export{Yd as default};
