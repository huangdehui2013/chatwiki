import{_ as ve}from"./empty-CzGZrENG.js";import{b as G,k as he,d as re,B as fe,M as ke}from"../../index-UhR4yadr.js";import{M as r,N as m,a1 as _e,a2 as ce,W as s,b as ge,w as W,B as R,e as E,a7 as $,F as P,k as n,S as a,$ as D,Q as O,Y as d,Z as y,a6 as N,G as Z,H as ie,u as V,z as ye,aa as de,ai as be,V as X}from"./vue-chunks-DWnFCQSz.js";import{a as xe}from"./index-DIUiarE3.js";import{M as ae}from"./model-select-6loF5tMn.js";import{F as ee,_ as qe}from"./index-DzuDS3Yk.js";import"./index--Qvpscnx.js";import{I as me}from"./Input-D7W5TJDt.js";import{Q as le}from"./QuestionCircleOutlined-CV_adx6X.js";import{S as we,_ as Ie}from"./index-9VXz7HRC.js";import{_ as Pe}from"./index-BnhNOVTI.js";import{_ as $e}from"./index-DrSPxL4Q.js";import{_ as Ce}from"./index-kKxyythX.js";import{_ as ue}from"./TextArea-CpTIlaWe.js";import{_ as Se}from"./index-RGagVdKM.js";import{U as Ue}from"./index-f5cCF1C6.js";import{_ as ze,T as Ne}from"./index-teqAjsuU.js";const je={},te=f=>(_e("data-v-ba7325cb"),f=f(),ce(),f),Fe={class:"empty-box"},Te=te(()=>s("img",{src:ve,alt:""},null,-1)),Le=te(()=>s("div",{class:"title"},"暂无分段",-1)),Ae=te(()=>s("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)),Oe=[Te,Le,Ae];function Ee(f,j){return r(),m("div",Fe,Oe)}const no=G(je,[["render",Ee],["__scopeId","data-v-ba7325cb"]]),l=f=>(_e("data-v-c771993a"),f=f(),ce(),f),Me={class:"segmentation-setting"},Qe={class:"setting-items"},Be={class:"setting-item intelligent-setting active"},De={class:"setting-item-body"},Ve=l(()=>s("div",{class:"sub-setting-item-name"},"文件切分",-1)),Ke={key:0,class:"custom-setting-form excel-qa-form"},Re={class:"form-item"},Ge={class:"form-item-box"},Je=l(()=>s("div",{class:"form-item-label"},"问题所在列：",-1)),He={class:"form-item-body"},We={class:"form-item-box"},Xe=l(()=>s("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),Ye={class:"form-item-body"},Ze={class:"form-item-box"},et=l(()=>s("div",{class:"form-item-label"},"答案所在列：",-1)),tt={class:"form-item-body"},st=l(()=>s("div",{class:"sub-setting-item-name"},"索引方式",-1)),ot={class:"indexing-methods-box"},nt={class:"list-title-block"},it=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),at={class:"list-title-block"},lt=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),rt=l(()=>s("div",{class:"btn-box-block"},null,-1)),_t={class:"btn-box-block"},ct={key:1,class:"custom-setting-form excel-qa-form"},dt={class:"form-item"},mt={class:"form-item-box"},ut=l(()=>s("div",{class:"form-item-label"},"问题开始标识符：",-1)),pt={class:"form-item-body"},vt={class:"form-item-box"},ht=l(()=>s("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),ft={class:"form-item-body"},kt={class:"form-item-box"},gt=l(()=>s("div",{class:"form-item-label"},"答案开始标识符：",-1)),yt={class:"form-item-body"},bt=l(()=>s("div",{class:"sub-setting-item-name"},"索引方式",-1)),xt={class:"indexing-methods-box"},qt={class:"list-title-block"},wt=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),It={class:"list-title-block"},Pt=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),$t=l(()=>s("div",{class:"btn-box-block"},null,-1)),Ct={class:"btn-box-block"},St={key:0,class:"custom-setting-form subsection-form"},Ut={class:"form-item"},zt=l(()=>s("div",{class:"form-item-label"},"分段方式：",-1)),Nt={class:"form-item-body"},jt=l(()=>s("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),Ft={class:"select-card-box"},Tt={class:"card-title"},Lt=l(()=>s("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),At={class:"card-title"},Ot=l(()=>s("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),Et={class:"card-title"},Mt=l(()=>s("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),Qt={class:"form-item",style:{"margin-bottom":"18px"}},Bt=l(()=>s("div",{class:"form-item-label"},"分段标识符：",-1)),Dt={class:"form-item-body"},Vt={class:"form-item"},Kt=l(()=>s("div",{class:"form-item-label"},"分段最大长度：",-1)),Rt={class:"form-item-body"},Gt=l(()=>s("span",{class:"unit-text"},"字符",-1)),Jt={class:"form-item"},Ht=l(()=>s("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),Wt={class:"form-item-body"},Xt=l(()=>s("span",{class:"unit-text"},"字符",-1)),Yt={class:"form-item",style:{"margin-bottom":"16px"}},Zt=l(()=>s("div",{class:"form-item-label"},"嵌入模型：",-1)),es={class:"form-item-body"},ts={class:"form-item",style:{"margin-bottom":"16px"}},ss={class:"form-item-label"},os={class:"form-item-body"},ns={class:"form-item"},is=l(()=>s("div",{class:"form-item-label"},"分段最大长度：",-1)),as={class:"form-item-body"},ls=l(()=>s("span",{class:"unit-text"},"字符",-1)),rs={class:"form-item"},_s=l(()=>s("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),cs={class:"form-item-body"},ds=l(()=>s("span",{class:"unit-text"},"字符",-1)),ms={class:"form-item",style:{"margin-bottom":"16px"}},us=l(()=>s("div",{class:"form-item-label"},"AI大模型：",-1)),ps={class:"form-item-body"},vs={class:"form-item",style:{"margin-bottom":"16px"}},hs=l(()=>s("div",{class:"form-item-label"},"提示词设置：",-1)),fs={class:"form-item-body"},ks={class:"form-item",style:{"margin-bottom":"16px"}},gs={class:"form-item-label"},ys={class:"form-item-body form-item-inptu-numbner-box"},bs={class:"btn-box-block"},xs={class:"btn-box-block"},Y="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",qs={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1}},emits:["change","validate","save","changeChunkType"],setup(f,{expose:j,emit:F}){const p=ee.useForm,g=F,u=f;ge(()=>u.libFileInfo.doc_type=="1"&&(u.libFileInfo.file_ext=="docx"||u.libFileInfo.file_ext=="html")),W(u,i=>{let e=i.libFileInfo,k=e.separators_no?e.separators_no.split(","):[11,12];t.separators_no=k.map(v=>+v),t.chunk_size=+e.chunk_size||512,t.ai_chunk_size=+e.ai_chunk_size||5e3,t.chunk_overlap=+e.chunk_overlap||50,t.question_lable=e.question_lable,t.similar_label=e.similar_label,t.answer_lable=e.answer_lable,t.question_column=e.question_column||void 0,t.answer_column=e.answer_column||void 0,t.similar_column=e.similar_column||void 0,t.qa_index_type=+e.qa_index_type,t.enable_extract_image=e.enable_extract_image=="true",t.chunk_type=+e.chunk_type,t.semantic_chunk_size=+e.semantic_chunk_size||512,t.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,t.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,t.semantic_chunk_use_model=e.semantic_chunk_use_model||"",t.ai_chunk_prumpt=e.ai_chunk_prumpt||Y,t.ai_chunk_model=e.ai_chunk_model||"",t.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:"",t.ai_chunk_model_config_id=e.ai_chunk_model_config_id>0?e.ai_chunk_model_config_id:"",setTimeout(()=>{t.semantic_chunk_use_model=e.semantic_chunk_use_model||"",t.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(k=e.normal_chunk_default_separators_no?e.normal_chunk_default_separators_no.split(","):[11,12],t.separators_no=k.map(v=>+v),t.chunk_size=+e.normal_chunk_default_chunk_size||512,t.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,t.chunk_type=+e.default_chunk_type,t.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,t.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,t.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{t.semantic_chunk_use_model=e.default_use_model,t.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),t.is_qa_doc=u.library_type==2?1:0});const t=R({separators_no:[],chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Y});let _={};setTimeout(()=>{_=JSON.parse(JSON.stringify(t))},500);const C=E([]),M=i=>{C.value=i,ye(()=>{(!t.ai_chunk_model||!Number(t.ai_chunk_model_config_id))&&Q()})},Q=()=>{if(C.value.length>0){let i=null,e=null;for(let k of C.value)if(k.model_define==="tongyi"){i=k;for(let v of i.children)if(v.name==="qwen-max"){e=v;break}break}i||(i=C.value[0],e=i.children[0]),i&&e&&(t.ai_chunk_model=e.name,t.ai_chunk_model_config_id=e.model_config_id)}},U=()=>{Object.assign(t,_)},w=()=>{g("save")},J=R({question_lable:[{message:"请输入问题开始标识符",validator:async(i,e)=>t.is_qa_doc==1&&u.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(i,e)=>t.is_qa_doc==0&&t.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(i,e)=>t.is_qa_doc==0&&t.chunk_type==3?e?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(i,e)=>t.is_qa_doc==1&&u.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(i,e)=>u.mode!=1&&t.is_qa_doc==0&&e.length==0&&t.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(i,e)=>{if(u.mode!=1&&t.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(t.chunk_type==3&&!e)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(i,e)=>t.chunk_type==3&&!e?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(i,e)=>!t.ai_chunk_prumpt&&!e?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(i,e)=>u.mode!=1&&t.chunk_type==1&&e>parseInt(t.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(i,e)=>u.mode==1&&t.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(i,e)=>u.mode==1&&t.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:se,validate:z,validateInfos:c}=p(t,J),b=E(!1),x=()=>{b.value=!0,q()},q=(i=!0)=>{let e=de(t);z().then(()=>{g("change",{...e}),g("validate","")}).catch(k=>{const{errorFields:v}=k;if(v.length>0){i&&v[0].name,he.error(v[0].errors[0]),g("validate",v[0].errors[0]),b.value=!1;return}g("validate",""),g("change",{...e})})};let I=null;const S=()=>{I&&(clearTimeout(I),I=null),I=setTimeout(()=>{q()},500)},K=E([]);(()=>{xe().then(i=>{K.value=i.data||[]})})();const T=i=>{i!=t.qa_index_type&&(t.qa_index_type=i,q())};return W(()=>t.chunk_type,i=>{g("changeChunkType",i)}),W(()=>b.value,i=>{}),j({formState:t,reLoading:b,reChange:x}),(i,e)=>{const k=we,v=Ie,h=re,B=fe,H=me,L=Pe,A=$e,ne=Ce,pe=ue;return r(),m("div",Me,[s("div",Qe,[s("div",Be,[s("div",De,[$("",!0),t.is_qa_doc==1?(r(),m(P,{key:1},[Ve,u.mode==1?(r(),m("div",Ke,[s("div",Re,[s("div",Ge,[Je,s("div",He,[n(v,{value:t.question_column,"onUpdate:value":e[2]||(e[2]=o=>t.question_column=o),onChange:S,placeholder:"请选择列名",style:{width:"100%"}},{default:a(()=>[(r(!0),m(P,null,D(u.excellQaLists,o=>(r(),O(k,{value:o.value,key:o.value},{default:a(()=>[d(y(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),s("div",We,[Xe,s("div",Ye,[n(v,{allowClear:"",value:t.similar_column,"onUpdate:value":e[3]||(e[3]=o=>t.similar_column=o),onChange:S,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:a(()=>[(r(!0),m(P,null,D(u.excellQaLists,o=>(r(),O(k,{value:o.value,key:o.value},{default:a(()=>[d(y(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),s("div",Ze,[et,s("div",tt,[n(v,{value:t.answer_column,"onUpdate:value":e[4]||(e[4]=o=>t.answer_column=o),onChange:S,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:a(()=>[(r(!0),m(P,null,D(u.excellQaLists,o=>(r(),O(k,{value:o.value,key:o.value},{default:a(()=>[d(y(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),st,s("div",ot,[s("div",{class:N(["list-item",{active:t.qa_index_type==1}]),onClick:e[5]||(e[5]=o=>T(1))},[n(h,{class:"check-icon",name:"check-arrow-filled"}),s("div",nt,[n(h,{name:"file-search"}),d(" 问题与答案一起生成索引 ")]),it],2),s("div",{class:N(["list-item",{active:t.qa_index_type==2}]),onClick:e[6]||(e[6]=o=>T(2))},[n(h,{class:"check-icon",name:"check-arrow-filled"}),s("div",at,[n(h,{name:"comment-search"}),d(" 仅对问题生成索引 ")]),lt],2),rt,s("div",_t,[n(B,{type:"primary",block:"",onClick:w},{default:a(()=>[d("保存")]),_:1})])])])):(r(),m("div",ct,[s("div",dt,[s("div",mt,[ut,s("div",pt,[n(H,{placeholder:"请输入标识符",value:t.question_lable,"onUpdate:value":e[7]||(e[7]=o=>t.question_lable=o),onChange:S},null,8,["value"])])]),s("div",vt,[ht,s("div",ft,[n(H,{placeholder:"请输入标识符",value:t.similar_label,"onUpdate:value":e[8]||(e[8]=o=>t.similar_label=o),onChange:S},null,8,["value"])])]),s("div",kt,[gt,s("div",yt,[n(H,{placeholder:"请输入标识符",value:t.answer_lable,"onUpdate:value":e[9]||(e[9]=o=>t.answer_lable=o),onChange:S},null,8,["value"])])])]),bt,s("div",xt,[s("div",{class:N(["list-item",{active:t.qa_index_type==1}]),onClick:e[10]||(e[10]=o=>T(1))},[n(h,{class:"check-icon",name:"check-arrow-filled"}),s("div",qt,[n(h,{name:"file-search"}),d(" 问题与答案一起生成索引 ")]),wt],2),s("div",{class:N(["list-item",{active:t.qa_index_type==2}]),onClick:e[11]||(e[11]=o=>T(2))},[n(h,{class:"check-icon",name:"check-arrow-filled"}),s("div",It,[n(h,{name:"comment-search"}),d(" 仅对问题生成索引 ")]),Pt],2),$t,s("div",Ct,[n(B,{type:"primary",block:"",onClick:w},{default:a(()=>[d("保存")]),_:1})])])]))],64)):(r(),m(P,{key:2},[u.mode!=1?(r(),m("div",St,[s("div",Ut,[zt,s("div",Nt,[jt,s("div",Ft,[s("div",{class:N(["select-card-item",{active:t.chunk_type==1}]),onClick:e[12]||(e[12]=o=>t.chunk_type=1)},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Tt,[n(h,{name:"ordinary-segmentation",class:"title-icon"}),d(" 普通分段 ")]),Lt],2),s("div",{class:N(["select-card-item",{active:t.chunk_type==2}]),onClick:e[13]||(e[13]=o=>t.chunk_type=2)},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),s("div",At,[n(h,{name:"semantic-segmentation",class:"title-icon"}),d(" 语义分段 ")]),Ot],2),s("div",{class:N(["select-card-item",{active:t.chunk_type==3}]),onClick:e[14]||(e[14]=o=>t.chunk_type=3)},[n(h,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Et,[n(h,{name:"semantic-segmentation",class:"title-icon"}),d(" AI分段 ")]),Mt],2)])])]),t.chunk_type==1?(r(),m(P,{key:0},[s("div",Qt,[Bt,s("div",Dt,[n(v,{placeholder:"请选择",style:{width:"100%"},mode:"multiple",value:t.separators_no,"onUpdate:value":e[15]||(e[15]=o=>t.separators_no=o)},{default:a(()=>[(r(!0),m(P,null,D(K.value,o=>(r(),O(k,{value:o.no,key:o.no},{default:a(()=>[d(y(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),n(A,{gap:16},{default:a(()=>[s("div",Vt,[Kt,s("div",Rt,[n(A,{align:"center",gap:8},{default:a(()=>[n(L,{style:{flex:"1"},value:t.chunk_size,"onUpdate:value":e[16]||(e[16]=o=>t.chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Gt]),_:1})])]),s("div",Jt,[Ht,s("div",Wt,[n(A,{align:"center",gap:8},{default:a(()=>[n(L,{style:{flex:"1"},value:t.chunk_overlap,"onUpdate:value":e[17]||(e[17]=o=>t.chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Xt]),_:1})])])]),_:1})],64)):$("",!0),Z(s("div",null,[s("div",Yt,[Zt,s("div",es,[n(ae,{modelType:"TEXT EMBEDDING",modeName:t.semantic_chunk_use_model,"onUpdate:modeName":e[18]||(e[18]=o=>t.semantic_chunk_use_model=o),modeId:t.semantic_chunk_model_config_id,"onUpdate:modeId":e[19]||(e[19]=o=>t.semantic_chunk_model_config_id=o),style:{width:"100%"},onLoaded:M},null,8,["modeName","modeId"])])]),s("div",ts,[s("div",ss,[d(" 分段阈值 "),n(ne,null,{title:a(()=>[d("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:a(()=>[n(V(le),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),d("： ")]),s("div",os,[n(L,{style:{width:"100%"},value:t.semantic_chunk_threshold,"onUpdate:value":e[20]||(e[20]=o=>t.semantic_chunk_threshold=o),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),n(A,{gap:16},{default:a(()=>[s("div",ns,[is,s("div",as,[n(A,{align:"center",gap:8},{default:a(()=>[n(L,{style:{flex:"1"},value:t.semantic_chunk_size,"onUpdate:value":e[21]||(e[21]=o=>t.semantic_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),ls]),_:1})])]),s("div",rs,[_s,s("div",cs,[n(A,{align:"center",gap:8},{default:a(()=>[n(L,{style:{flex:"1"},value:t.semantic_chunk_overlap,"onUpdate:value":e[22]||(e[22]=o=>t.semantic_chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),ds]),_:1})])])]),_:1})],512),[[ie,t.chunk_type==2]]),Z(s("div",null,[s("div",ms,[us,s("div",ps,[n(ae,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:t.ai_chunk_model,"onUpdate:modeName":e[23]||(e[23]=o=>t.ai_chunk_model=o),modeId:t.ai_chunk_model_config_id,"onUpdate:modeId":e[24]||(e[24]=o=>t.ai_chunk_model_config_id=o),style:{width:"100%"},onLoaded:M},null,8,["modeName","modeId"])])]),s("div",vs,[hs,s("div",fs,[n(pe,{maxLength:500,style:{height:"80px"},value:t.ai_chunk_prumpt,"onUpdate:value":e[25]||(e[25]=o=>t.ai_chunk_prumpt=o),placeholder:Y},null,8,["value"])])]),s("div",ks,[s("div",gs,[d(" 单次最大字符数 "),n(ne,null,{title:a(()=>[d("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:a(()=>[n(V(le),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),d("： ")]),s("div",ys,[n(L,{class:"form-item-inptu-numbner",value:t.ai_chunk_size,"onUpdate:value":e[26]||(e[26]=o=>t.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),d(" 字符 ")])])],512),[[ie,t.chunk_type==3]]),s("div",bs,[n(B,{onClick:U,style:{flex:"1"}},{default:a(()=>[d("重置")]),_:1}),n(B,{onClick:x,loading:b.value,style:{flex:"1"},type:"primary",ghost:""},{default:a(()=>[d("生成分段预览")]),_:1},8,["loading"])]),s("div",xs,[u.hideSave?$("",!0):(r(),O(B,{key:0,type:"primary",block:"",disabled:b.value,onClick:w},{default:a(()=>[d("保存")]),_:1},8,["disabled"]))])])):$("",!0)],64))])])])])}}},io=G(qs,[["__scopeId","data-v-c771993a"]]),ws={class:"document-fragment"},Is={class:"fragment-header"},Ps={class:"fragment-info"},$s={class:"fragment-number"},Cs={key:0,class:"fragment-title"},Ss={class:"fragment-content-lenght"},Us={class:"fragment-action"},zs={class:"fragment-content"},Ns={key:0,class:"fragment-content"},js={key:1,class:"fragment-content"},Fs={key:2,class:"fragment-content"},Ts={class:"fragment-img"},Ls=["src"],As={__name:"document-fragment",props:{number:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]}},emits:["edit","delete"],setup(f,{emit:j}){const F=j,p=f,g=()=>{F("edit")},u=()=>{F("delete")};return(t,_)=>{const C=Se,M=be("viewer");return r(),m("div",ws,[s("div",Is,[s("div",Ps,[s("span",$s,"#"+y(p.number),1),p.title?(r(),m("span",Cs,y(p.title),1)):$("",!0),s("span",Ss,"共"+y(p.total)+"个字符",1)]),s("div",Us,[s("a",{onClick:g},"编辑"),n(C,{type:"vertical"}),s("a",{onClick:u},"删除")])]),s("div",zs,y(p.content),1),p.question?(r(),m("div",Ns,"Q："+y(p.question),1)):$("",!0),p.similar_question_list&&p.similar_question_list.join("")?(r(),m("div",js," 相似问法："+y(p.similar_question_list.join("/")),1)):$("",!0),p.answer?(r(),m("div",Fs,"A："+y(p.answer),1)):$("",!0),Z((r(),m("div",Ts,[(r(!0),m(P,null,D(p.images,(Q,U)=>(r(),m("img",{key:U,src:Q,alt:""},null,8,Ls))),128))])),[[M]])])}}},ao=G(As,[["__scopeId","data-v-aa59b093"]]),Os={class:"upload-box-wrapper"},Es={key:0},Ms={__name:"edit-fragment-alert",emits:["ok"],setup(f,{expose:j,emit:F}){const p=F,g=E("1"),u=ee.useForm,t=E(!1),_=R({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),C=R({content:[{message:"请输入分段内容",validator:async(z,c)=>w.value||c?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(z,c)=>w.value?c?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(z,c)=>w.value?c?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:M,validate:Q,validateInfos:U}=u(_,C),w=E(!1),J=({title:z,content:c,question:b,answer:x,images:q,similar_question_list:I})=>{_.title=z,_.content=c,_.question=b,_.answer=x,_.images=q||[],_.similar_question_list=I?I.join(`
`):"",w.value=b!="",t.value=!0},se=()=>{Q().then(()=>{t.value=!1,p("ok",de(_))})};return j({open:J}),(z,c)=>{const b=me,x=qe,q=ue,I=re,S=ze,K=Ne,oe=ee,T=ke;return r(),m("div",null,[n(T,{open:t.value,"onUpdate:open":c[7]||(c[7]=i=>t.value=i),title:"编辑分段",onOk:se,width:"746px"},{default:a(()=>[n(oe,{layout:"vertical"},{default:a(()=>[n(x,{label:"分段标题："},{default:a(()=>[n(b,{type:"text",placeholder:"请输入分段标题",value:_.title,"onUpdate:value":c[0]||(c[0]=i=>_.title=i)},null,8,["value"])]),_:1}),w.value?(r(),m(P,{key:0},[n(x,X({label:"分段问题："},V(U).question),{default:a(()=>[n(q,{placeholder:"请输入分段问题",value:_.question,"onUpdate:value":c[1]||(c[1]=i=>_.question=i),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(x,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:a(()=>[n(q,{placeholder:"请输入相似问法",value:_.similar_question_list,"onUpdate:value":c[2]||(c[2]=i=>_.similar_question_list=i),style:{height:"100px"}},null,8,["value"])]),_:1}),n(x,X({label:"分段答案："},V(U).answer),{default:a(()=>[n(q,{placeholder:"请输入分段答案",value:_.answer,"onUpdate:value":c[3]||(c[3]=i=>_.answer=i),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(r(),O(x,X({key:1,label:"分段内容："},V(U).content),{default:a(()=>[n(q,{placeholder:"请输入分段内容",value:_.content,"onUpdate:value":c[4]||(c[4]=i=>_.content=i),style:{height:"150px"}},null,8,["value"])]),_:1},16)),n(x,{label:"附件"},{default:a(()=>[s("div",Os,[n(K,{activeKey:g.value,"onUpdate:activeKey":c[5]||(c[5]=i=>g.value=i),size:"small"},{default:a(()=>[n(S,{key:"1"},{tab:a(()=>[s("span",null,[n(I,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),d(" 图片 "),_.images.length?(r(),m("span",Es,"("+y(_.images.length)+")",1)):$("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Ue,{value:_.images,"onUpdate:value":c[6]||(c[6]=i=>_.images=i)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},lo=G(Ms,[["__scopeId","data-v-50ea1591"]]);export{ao as D,lo as E,io as S,no as a};
