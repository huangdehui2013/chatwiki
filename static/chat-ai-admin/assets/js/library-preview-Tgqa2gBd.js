import{M as n,N as u,W as o,k as e,S as a,u as D,a1 as Ce,a2 as qe,e as c,ai as Je,Y as x,Z as F,F as W,$ as te,Q as L,a7 as z,X as we,a0 as Me,G as Ve,b as se,B as Ge,x as We,z as Ue,a5 as Xe,D as Qt,a4 as pt,a6 as jt,a8 as Ut}from"./vue-chunks-DWnFCQSz.js";import{V as rt}from"./vue-pdf-embed-CTnPXFvH.js";import{_ as Jt}from"./empty-CzGZrENG.js";import{b as re,B as ft,L as Vt,E as ge,M as oe,k as K,b3 as Gt,T as Wt,e as Xt,f as Yt}from"../../index-DQXF0oEW.js";import{P as mt}from"./PlusOutlined-CP-yUfey.js";import{S as Re,c as Fe,a as vt,C as ht,b as Zt,E as Kt}from"./edit-subsection-yO3b-EP-.js";import{C as gt,D as kt,x as yt,y as bt,k as ea,b as St,e as ta,f as aa,s as na,h as oa,E as la,F as ut,G as sa,H as ia}from"./index-CpYnoGfS.js";import{_ as Ye,M as Ze}from"./index-dYCqajUf.js";import"./index-D51vnI4K.js";import{D as Ke}from"./dropdown-yjtk7CCy.js";import{S as xt}from"./SettingOutlined-1CzdHxwK.js";import{S as $t}from"./SyncOutlined-DvqqncSp.js";import{M as wt}from"./MoreOutlined-Bxk_qxvK.js";import{_ as Te}from"./index-CUGUQ2OU.js";import{C as $e}from"./cu-scroll-BZhESYtD.js";import{_ as ca,F as ra}from"./index-DpzELZe5.js";import{S as Ct,_ as qt}from"./index-B-Rt9SA5.js";import{R as ua}from"./rename-modal-BEgLWR3N.js";import{S as De}from"./index-BmqzJuQZ.js";import{S as _a,a as da,D as pa,E as fa}from"./edit-fragment-alert-BuZaK9UL.js";import{C as ma}from"./ClockCircleFilled-DBQsFSrd.js";import{_ as va,a as ha}from"./index-CGOpBClO.js";import{B as ga,_ as ka}from"./index-BP0CV08b.js";import{_ as ya}from"./index-DFjntrox.js";import{_ as ba,a as Sa}from"./RadioButton-Br4fysJT.js";import{L as xa}from"./LeftOutlined-CbjqBZdV.js";import{D as _t}from"./DownOutlined-Bq0bLGm4.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-C3GwfM_a.js";import"./Dropdown-Cb2ylcsA.js";import"./Trigger-CC5n-pw8.js";import"./index-DwY9A703.js";import"./useRefs-CH9tJ50T.js";import"./pick-BcFOJSQC.js";import"./CheckOutlined-BrtNruPW.js";import"./slide-DBTiAtg1.js";import"./index-9760vytK.js";import"./Input-COJTivTx.js";import"./FormItemContext-D4f_Sq6G.js";import"./statusUtils-B7nMMwz3.js";import"./inputProps-Bb0ocHOp.js";import"./index-J-L5YNWa.js";import"./Search-Cm7pOAiq.js";import"./SearchOutlined-Eloz0Xgr.js";import"./isPlainObject-DGw0gsC3.js";import"./TextArea-Cc6YC843.js";import"./Password-DAfpdhAR.js";import"./index-EaNfDv4H.js";import"./index-BOiVmP0S.js";import"./index-QNUrbcgK.js";import"./index-RZ7sMF92.js";import"./partition-D4Qmrw-1.js";import"./collapseMotion-ByInPrfq.js";import"./index-DzhuYAPB.js";import"./shallowequal-C0Ji8tJB.js";import"./RightOutlined-Ctvc7W-t.js";import"./move-DQ5ZIRU6.js";import"./colors-CunZT9q_.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./responsiveObserve-D-e1nmNx.js";import"./QuestionCircleOutlined-DN9kmFuV.js";import"./model-select-DLutQAFv.js";import"./index-DaUzcbAM.js";import"./index-Dq7FbVld.js";import"./index-hPIuiQ85.js";import"./UpOutlined-DA6kJIik.js";import"./index-DwAmRhRT.js";import"./index-C5rBiNWQ.js";import"./useMaxLevel-C0rdSqjh.js";import"./index-CEo7CTw2.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-C791tQco.js";import"./Checkbox-CPCCCpS7.js";import"./index-CGW9ahOu.js";import"./CaretDownOutlined-CbrsSkGN.js";const et=g=>(Ce("data-v-8eb7d862"),g=g(),qe(),g),$a={class:"empty-box"},wa=et(()=>o("img",{src:Jt,alt:""},null,-1)),Ca=et(()=>o("div",{class:"title"},"知识库文档为空，请添加分段",-1)),qa=et(()=>o("span",null,"添加分段",-1)),La={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(g,{emit:V}){const B=V,v=()=>{B("openEditSubscription",{})};return(b,P)=>{const f=ft;return n(),u("div",$a,[wa,Ca,o("div",null,[e(f,{type:"primary",onClick:v},{icon:a(()=>[e(D(mt))]),default:a(()=>[qa]),_:1})])])}}},je=re(La,[["__scopeId","data-v-8eb7d862"]]),Ea=g=>(Ce("data-v-d8b8b86e"),g=g(),qe(),g),Oa={class:"subsection-box"},Pa={class:"subsection-box-title"},Ia=["onClick"],Ma={class:"top-block"},Ra={class:"title"},Fa={class:"title-block"},Ta={class:"cfb363f"},Da={key:0},za={class:"cfb363f"},Aa={class:"right-opration"},Na={class:"hover-btn-box"},Ba=["onClick"],Ha=Ea(()=>o("div",null,"标记设置",-1)),Qa={class:"hover-btn-box"},ja={class:"hover-btn-box"},Ua=["onClick"],Ja=["onClick"],Va={key:0,class:"content-box"},Ga={key:1,class:"content-box"},Wa=["innerHTML"],Xa={class:"fragment-img"},Ya=["src"],Za={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(g,{expose:V,emit:B}){const v=B,b=g,P=(_,m)=>{let{id:l,title:y,content:O,question:T,answer:X,images:p,category_id:U}=_,s=_.similar_questions||[];oe.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${m+1}】吗?`,onOk(){return new Promise((M,h)=>{gt({id:l,title:y,content:O,question:T,answer:X,images:p,category_id:U,similar_questions:JSON.stringify(s)}).then(Q=>{v("handleConvert",_),M()}).catch(()=>{M()})})},onCancel(){}})},f=_=>{v("openEditSubscription",_)},I=_=>{oe.confirm({title:"提示",icon:e(ge),content:"确认是否删除该分段?",onOk(){return new Promise((m,l)=>{kt({id:_}).then(y=>{K.success("删除成功"),v("handleDelParagraph",_),m()}).catch(()=>{m()})})},onCancel(){}})},C=(_,m)=>{v("handleScrollTargetPage",{page_num:_.page_num,index:m})},A=c([]),$=()=>{yt().then(_=>{A.value=_.data||[],v("getStatrList",_.data||[])})};$();const r=c(null),E=()=>{r.value.show()},J=_=>{var l;let m=(l=A.value.filter(y=>y.id==_.category_id)[0])==null?void 0:l.type;return m?Fe[m]:"#F4EA2A"},k=(_,m={})=>{bt({id:_.id,category_id:m.id||0}).then(l=>{K.success("设置成功"),_.category_id=m.id})};return V({handleOpenEditModal:f}),(_,m)=>{const l=Te,y=Ye,O=Ze,T=Ke,X=Je("viewer");return n(),u("div",Oa,[o("div",Pa,[x(" 分段预览 "),o("span",null,"共"+F(b.total)+"个分段",1)]),(n(!0),u(W,null,te(b.paragraphLists,(p,U)=>(n(),u("div",{class:"list-item",key:p.id,onClick:s=>C(p,U)},[o("div",Ma,[o("div",Ra,[x(" 分段"+F(U+1)+" ",1),o("div",Fa,F(p.title),1),o("span",null,"共"+F(p.word_total)+"个字符",1),o("span",null,[x(" 嵌入状态："+F(p.status_text),1),p.status==3?(n(),L(D(Vt),{key:0})):z("",!0),p.status==2&&p.errmsg?(n(),L(l,{key:1,title:p.errmsg},{default:a(()=>[o("strong",Ta,[x("原因"),e(D(ge),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):z("",!0)]),g.detailsInfo.graph_switch?(n(),u("span",Da,[x(" 知识图谱状态："+F(p.graph_status_text)+" ",1),p.graph_status==3&&p.graph_err_msg?(n(),L(l,{key:0,title:p.graph_err_msg},{default:a(()=>[o("strong",za,[x("原因"),e(D(ge),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):z("",!0)])):z("",!0)]),o("div",Aa,[e(T,null,{overlay:a(()=>[e(O,null,{default:a(()=>[(n(!0),u(W,null,te(A.value,s=>(n(),L(y,{key:s.id},{default:a(()=>[o("div",{class:"start-item",onClick:M=>k(p,s)},[e(D(Re),{style:we({color:D(Fe)[s.type]})},null,8,["style"]),o("div",null,F(s.name||"-"),1)],8,Ba)]),_:2},1024))),128)),e(y,null,{default:a(()=>[o("div",{class:"start-item",onClick:E},[e(D(xt)),Ha])]),_:1})]),_:2},1024)]),default:a(()=>[o("div",Na,[p.category_id>0?(n(),L(D(Re),{key:0,onClick:s=>k(p,{}),style:we({color:J(p),"font-size":"16px"})},null,8,["onClick","style"])):(n(),L(D(vt),{key:1,onClick:s=>k(p,A.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),e(l,null,{title:a(()=>[x("重新转换")]),default:a(()=>[o("div",Qa,[e(D($t),{onClick:s=>P(p,U)},null,8,["onClick"])])]),_:2},1024),e(T,{placement:"bottomRight"},{overlay:a(()=>[e(O,null,{default:a(()=>[e(y,null,{default:a(()=>[o("div",{onClick:Me(s=>f(p),["stop"])},"编辑",8,Ua)]),_:2},1024),e(y,null,{default:a(()=>[o("div",{onClick:Me(s=>I(p.id),["stop"])},"删除",8,Ja)]),_:2},1024)]),_:2},1024)]),default:a(()=>[o("div",ja,[e(D(wt))])]),_:2},1024)])]),p.question?(n(),u("div",Va,"Q："+F(p.question),1)):z("",!0),p.answer?(n(),u("div",Ga,"A："+F(p.answer),1)):z("",!0),o("div",{class:"content-box",innerHTML:p.content},null,8,Wa),Ve((n(),u("div",Xa,[(n(!0),u(W,null,te(p.images,(s,M)=>(n(),u("img",{key:M,src:s,alt:""},null,8,Ya))),128))])),[[X]])],8,Ia))),128)),e(ht,{onOk:$,ref_key:"classificationMarkModalRef",ref:r},null,512)])}}},dt=re(Za,[["__scopeId","data-v-d8b8b86e"]]),Ka={class:"mode-box"},en=["innerHTML"],tn={class:"tag-item"},an={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(g){const V=g,B=c(""),v=se(()=>{const{is_table_file:b,is_qa_doc:P,is_diy_split:f,question_lable:I,answer_lable:C,separators:A,chunk_size:$,chunk_overlap:r,question_column:E,answer_column:J,qa_index_type:k,doc_type:_}=V.detailsInfo;if(b!=1&&P!=1&&f!=1)return _==3?(B.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(B.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(b!=1&&P==1)return _==3?(B.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(B.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${I}"
答案开始标识符："${C}"`,"智能分段：QA文档");if(b!=1&&P!=1&&f==1)return B.value=`分段模式：自定义分段
文档标识符：${A}
分段最大长度：${$}字符
文段重叠长度：${r}字符`,"自定义分段";if(b==1&&P!=1)return B.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(b==1&&P==1){let m=k==1?"问题与答案一起生成索引":"仅对问题生成索引";return B.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${E}"
答案所在列："${J}"
索引方式：${m}`,"智能分段：QA文档"}});return(b,P)=>{const f=Te;return n(),u("div",Ka,[e(f,null,{title:a(()=>[o("div",{class:"tooltip-text-box",innerHTML:B.value},null,8,en)]),default:a(()=>[o("div",tn,F(v.value),1)]),_:1})])}}},nn=re(an,[["__scopeId","data-v-e8649c10"]]),on={__name:"update-frequency",emits:["ok"],setup(g,{expose:V,emit:B}){const v=B,b=c(!1),P=c(!1),f=Ge({doc_auto_renew_frequency:1,id:""}),I=A=>{let{doc_auto_renew_frequency:$,id:r}=A;f.doc_auto_renew_frequency=+$,f.id=r,b.value=!0},C=()=>{P.value=!0,ea({...f}).then(A=>{v("ok",f.doc_auto_renew_frequency),b.value=!1,K.success("设置成功")}).finally(()=>{P.value=!1})};return V({open:I}),(A,$)=>{const r=Ct,E=qt,J=ca,k=ra,_=oe;return n(),u("div",null,[e(_,{open:b.value,"onUpdate:open":$[1]||($[1]=m=>b.value=m),"confirm-loading":P.value,maskClosable:!1,title:"设置更新频率",onOk:C},{default:a(()=>[e(k,{style:{margin:"32px 0"},layout:"vertical",model:f},{default:a(()=>[e(J,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:a(()=>[e(E,{value:f.doc_auto_renew_frequency,"onUpdate:value":$[0]||($[0]=m=>f.doc_auto_renew_frequency=m),style:{width:"100%"}},{default:a(()=>[e(r,{value:1},{default:a(()=>[x("不自动更新")]),_:1}),e(r,{value:2},{default:a(()=>[x("每天")]),_:1}),e(r,{value:3},{default:a(()=>[x("每3天")]),_:1}),e(r,{value:4},{default:a(()=>[x("每7天")]),_:1}),e(r,{value:5},{default:a(()=>[x("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},ln={class:"loading"},sn={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(g,{expose:V,emit:B}){const v=g,b=B,P=c(null),f=c([]),I=c(0),C=c(!1),A=se(()=>C.value?null:{"border-bottom":"2px solid #d9d9d9"}),$=c({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});We(async()=>{const l=await rt.getDocument(v.source).promise;I.value=l.numPages,b("getTotalPage",I.value),r()});const r=(l=null)=>{const y=f.value.length;if(y>=I.value||C.value)return;C.value=!0;const O=[];for(let T=1;T<=v.pageSize&&y+T<=I.value;T++)O.push(y+T);f.value.push(...O),Ue(()=>{typeof l=="function"&&l()})},E=l=>{r(),b("onScrollEnd",l)},J=l=>{Ue(()=>{l===f.value[f.value.length-1]&&(C.value=!1,b("rendered",l,I.value))})},k=l=>{b("select",l)},_=()=>P.value,m=l=>{b("scroll",l)};return V({loadMore:r,getScrollInstance:_}),(l,y)=>{const O=De;return n(),L($e,{scrollbar:$.value,ref_key:"scrollRef",ref:P,onScroll:m,onOnScrollEnd:E},{default:a(()=>[(n(!0),u(W,null,te(f.value,T=>(n(),L(D(rt),{onClick:X=>k(T),key:T,source:g.source,page:T,onRendered:()=>J(T),style:we(A.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),o("div",ln,[C.value?(n(),L(O,{key:0})):z("",!0)])]),_:1},8,["scrollbar"])}}},cn=re(sn,[["__scopeId","data-v-8520f2eb"]]),rn=g=>(Ce("data-v-9f322e00"),g=g(),qe(),g),un={key:0,class:"loading-wrap"},_n={class:"document-segmentation"},dn={class:"page-container"},pn={class:"page-left"},fn={class:"page-right"},mn={class:"document-fragment-preview"},vn={class:"preview-header"},hn=rn(()=>o("span",{class:"label-text"},"分段预览",-1)),gn={class:"fragment-number"},kn={key:1,class:"loading-box"},yn="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",bn={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}}},emits:["ok","finish","loading"],setup(g,{expose:V,emit:B}){const v=Xe(),b=B,{id:P}=v.query,f=c(!0),I=c(1);let C=!1;const A=g,$=c(1);let r={id:P,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:yn,ai_chunk_task_id:""};const E=c(null),J=t=>{typeof t.separators_no=="object"&&(t.separators_no=t.separators_no.join(",")),r={...r,...t},C?oe.confirm({title:"提醒",icon:e(ge),content:"文档片段已被编辑重新获取文档片段会丢失当前修改过的文档片段内容，确定要重新获取吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){C=!1,ue("create")},onCancel(){}}):(C=!1,ue("create"))};let k=60*10,_=0;const m=c({}),l=c(0),y=()=>{f.value||(f.value=!0),St({id:P}).then(async t=>{const{status:w}=t.data;if(l.value=t.data.library_type,m.value=t.data,r={...r,separators_no:t.data.separators_no||"11,12",chunk_size:+t.data.chunk_size||512,ai_chunk_size:+t.data.ai_chunk_size||5e3,chunk_overlap:+t.data.chunk_overlap||50,is_qa_doc:l.value==2?1:0,question_lable:t.data.question_lable,answer_lable:t.data.answer_lable,question_column:t.data.question_column,answer_column:t.data.answer_column,enable_extract_image:t.data.enable_extract_image=="true",qa_index_type:+t.data.qa_index_type,chunk_type:+t.data.chunk_type,semantic_chunk_size:+t.data.semantic_chunk_size||512,semantic_chunk_overlap:+t.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+t.data.semantic_chunk_threshold||90,semantic_chunk_use_model:t.data.semantic_chunk_use_model||"",ai_chunk_prumpt:t.data.ai_chunk_prumpt||"",ai_chunk_model:t.data.ai_chunk_model||"",semantic_chunk_model_config_id:t.data.semantic_chunk_model_config_id>0?t.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:t.data.ai_chunk_model_config_id>0?t.data.ai_chunk_model_config_id:"",ai_chunk_task_id:t.data.ai_chunk_task_id||""},t.data.chunk_type==0&&(r={...r,separators_no:t.data.normal_chunk_default_separators_no,chunk_size:t.data.normal_chunk_default_chunk_size,chunk_overlap:t.data.normal_chunk_default_chunk_overlap,chunk_type:+t.data.default_chunk_type,semantic_chunk_size:+t.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+t.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+t.data.semantic_chunk_default_threshold,semantic_chunk_use_model:t.data.default_use_model||"",semantic_chunk_model_config_id:t.data.default_model_config_id>0?t.data.default_model_config_id:""}),w==0){if(_++,_>k){oe.error({title:"提醒",content:"文档解析速度慢请稍后再试"});return}setTimeout(()=>{y()},1e3)}else(w==4||w==2)&&(f.value=!1,I.value=parseInt(t.data.is_table_file),t.data.library_id,l.value==2?(r.question_lable||r.question_column)&&ue():ue());t.data.is_table_file==1&&T()})};We(async()=>{await y()});const O=c([]),T=()=>{ta({id:P}).then(t=>{let w=[];for(let N in t.data)w.push({lable:t.data[N],value:N});O.value=w})},X=c(!1),p=c(!1),U=c(""),s=c(null);let M=null;const h=c([]),Q=c(0),ie=se(()=>Q.value<=0),ue=t=>{b("loading",!0);let w={...r,semantic_chunk_model_config_id:r.semantic_chunk_model_config_id?+r.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:r.ai_chunk_model_config_id?+r.ai_chunk_model_config_id:0,...A.pdfState};return r.chunk_type==3&&(r.ai_chunk_task_id&&!t&&(w.ai_chunk_task_id=r.ai_chunk_task_id),w.ai_chunk_task_id&&t&&t==="create"&&delete w.ai_chunk_task_id),aa(w).then(N=>{var H;h.value=N.data.list||[],Q.value=N.data.list.length||0,r.chunk_type==3&&(U.value=((H=N.data.split_params)==null?void 0:H.ai_chunk_task_id)||"",p.value=!0,E.value.reLoading=!0,s.value=null,!r.ai_chunk_task_id&&I.value!=1||t&&t==="create"?(h.value=[],Q.value=0,ye()):(p.value=!1,E.value.reLoading=!1))}).finally(()=>{r.chunk_type!=3&&(E.value.reLoading=!1),b("loading",!1)})},R=t=>{$.value=t},ne=async()=>{var t;try{const w=await _e();return w.data.err_msg?(s.value=w.data.err_msg,!0):((t=w.data.list)==null?void 0:t.length)>0?(h.value=w.data.list||[],Q.value=w.data.list.length||0,!0):!1}catch{return s.value="请求异常，停止轮询",!0}};function ke(t){return t.split("message:")[1]}const ye=()=>{const t=async()=>{if(!await ne())M=setTimeout(t,3e3);else if(p.value=!1,E.value.reLoading=!1,M!==null&&(clearTimeout(M),M=null),X.value&&pe(),s.value){let N=ke(s.value);oe.error({title:"分段失败提示",content:N?`模型调用失败，失败原因：${N}`:"模型调用失败"})}};t()},_e=()=>oa({id:r.id,task_id:U.value}),Le=c(null);let Y=null;const fe=({title:t,content:w,question:N,answer:H,images:ce},ve)=>{Y=ve,Le.value.open({title:t,content:w,question:N,answer:H,images:ce})},me=({title:t,content:w,question:N,answer:H,images:ce})=>{(h.value[Y].title!=t||h.value[Y].content!=w||h.value[Y].question!=N||h.value[Y].answer!=H)&&(C=!0),h.value[Y].title=t,h.value[Y].content=w,h.value[Y].question=N,h.value[Y].answer=H,h.value[Y].images=ce,h.value[Y].word_total=H.length+N.length+w.length},be=t=>{oe.confirm({title:"提醒",icon:e(ge),content:"确定要删除这个片段吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){C=!0,h.value.splice(t,1)},onCancel(){}})},de=c(""),Ne=t=>{de.value=t},Se=c(!1),Ee=()=>{let t=E.value.formState;t=JSON.parse(JSON.stringify(t)),typeof t.separators_no=="object"&&(t.separators_no=t.separators_no.join(",")),r={...r,...t}},pe=async()=>{if((Q.value<=0||r.chunk_type!=$.value)&&(Ee(),await ue()),Ee(),de.value)return K.error(de.value);if(r.chunk_type==3&&!h.value.length)return X.value=!0,!1;U.value&&(r.ai_chunk_task_id=U.value);let t={...r,semantic_chunk_model_config_id:r.semantic_chunk_model_config_id?+r.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:r.ai_chunk_model_config_id?+r.ai_chunk_model_config_id:0,is_table_file:I.value,...A.pdfState};delete t.id;let w={id:P,word_total:Q.value,split_params:JSON.stringify(t),list:JSON.stringify(h.value),...A.pdfState};t.is_qa_doc==1&&(w.qa_index_type=t.qa_index_type),Se.value=!0,na(w).then(()=>{b("ok"),b("finish")}).finally(()=>{Se.value=!1}).catch(N=>{N.data&&N.data.index&&le(N.data.index),b("finish")})},xe=c(null),le=t=>{t=t-1;let w=xe.value.querySelectorAll(".fragment-item");w.length>=t&&w[t].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return Qt(()=>{M&&(clearTimeout(M),M=null)}),V({handleSaveLibFileSplit:pe}),(t,w)=>{const N=De;return n(),u(W,null,[f.value?(n(),u("div",un,[e(N)])):z("",!0),o("div",_n,[o("div",dn,[o("div",pn,[e(_a,{excellQaLists:O.value,libFileInfo:m.value,library_type:l.value,mode:I.value,hideSave:!0,ref_key:"segmentationSettingRef",ref:E,onChange:J,onChangeChunkType:R,onSave:pe,onValidate:Ne},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),o("div",fn,[o("div",mn,[o("div",vn,[hn,o("span",gn,"共"+F(Q.value)+"个分段",1)]),ie.value&&!p.value?(n(),L(da,{key:0})):z("",!0),p.value?(n(),u("div",kn,[e(N),x("数据处理中...")])):z("",!0),o("div",{class:"preview-box",ref_key:"previewBoxRef",ref:xe},[(n(!0),u(W,null,te(h.value,(H,ce)=>(n(),u("div",{class:"fragment-item",key:H.number},[e(pa,{number:H.number,title:H.title,content:H.content,total:H.word_total,question:H.question,answer:H.answer,images:H.images,onDelete:ve=>be(ce),onEdit:ve=>fe(H,ce)},null,8,["number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),e(fa,{ref_key:"editFragmentAlertRef",ref:Le,onOk:me},null,512)])],64)}}},Sn=re(bn,[["__scopeId","data-v-9f322e00"]]),xn={class:"select-box"},$n=["onClick"],wn={class:"title"},Cn={class:"desc"},qn={class:"main-content-box"},Ln={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(g,{expose:V,emit:B}){const v=Xe().query,b=pt(),P=g,f=c(!1),I=c(!1),C=c(""),A=B;let $={};const r=[{title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。",pdf_parse_type:2},{title:"纯文本解析",desc:"只提取Pdf中的文字内容，如果文档为扫描件可能提取不到内容。",pdf_parse_type:1},{title:"图文解析",desc:"提取PDF文档中的图片和文字",pdf_parse_type:3}],E=Ge({pdf_parse_type:2,pdf_page_num:0}),J=()=>{A("enable")},k=c(!1),_=s=>{k.value=s},m=s=>{$={...s},E.pdf_parse_type=2,E.pdf_page_num=s.pdf_page_num,s.type==1&&(C.value=`当页(${s.pdf_page_num})重新分段`),s.type==2&&(C.value="将文档重新分段"),s.type==3&&(C.value="重新学习文档"),f.value=!0},l=s=>{E.pdf_parse_type=s.pdf_parse_type},y=c(!1),O=()=>{if($.type==3){if(E.pdf_parse_type==1){b.push("/library/document-segmentation?document_id="+v.id+"&source=preview");return}y.value=!0,la({id:v.id,pdf_parse_type:E.pdf_parse_type}).then(s=>{K.success("重新学习成功"),(E.pdf_parse_type==2||E.pdf_parse_type==3)&&b.push({path:"/library/details/knowledge-document",query:{id:P.detailsInfo.library_id}}),E.pdf_parse_type==1&&b.push("/library/document-segmentation?document_id="+v.id+"&source=preview"),f.value=!1}).finally(()=>{y.value=!1});return}f.value=!1,I.value=!0},T=c(null),X=()=>{y.value=!0,T.value.handleSaveLibFileSplit()},p=()=>{K.success("保存成功"),I.value=!1,A("ok",$.type)},U=()=>{y.value=!1};return V({show:m}),(s,M)=>{const h=oe;return n(),u("div",null,[e(h,{open:f.value,"onUpdate:open":M[0]||(M[0]=Q=>f.value=Q),title:C.value,onOk:O,onCancel:J,width:720,confirmLoading:y.value},{default:a(()=>[o("div",xn,[(n(),u(W,null,te(r,Q=>o("div",{class:jt(["select-list-item",{active:Q.pdf_parse_type==E.pdf_parse_type}]),onClick:ie=>l(Q),key:Q.pdf_parse_type},[o("div",wn,F(Q.title),1),o("div",Cn,F(Q.desc),1)],10,$n)),64))])]),_:1},8,["open","title","confirmLoading"]),e(h,{open:I.value,"onUpdate:open":M[1]||(M[1]=Q=>I.value=Q),onCancel:J,title:C.value,maskClosable:!1,"ok-text":k.value?"文档解析中,请稍候...":"确定",confirmLoading:y.value||k.value,onOk:X,width:1e3},{default:a(()=>[o("div",qn,[I.value?(n(),L(Sn,{key:0,onOk:p,onFinish:U,onLoading:_,pdfState:E,ref_key:"documentSegmentationModalRef",ref:T},null,8,["pdfState"])):z("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},En=re(Ln,[["__scopeId","data-v-589f4c8b"]]),ze=g=>(Ce("data-v-b1f3fb5c"),g=g(),qe(),g),On={class:"subsection-box"},Pn={class:"qa-list-box"},In={class:"list-item"},Mn=ze(()=>o("div",{class:"list-label"},"问题",-1)),Rn={class:"list-content"},Fn={key:0,class:"list-item"},Tn=ze(()=>o("div",{class:"list-label"},"相似问法",-1)),Dn={class:"list-content"},zn={class:"list-item"},An=ze(()=>o("div",{class:"list-label"},"答案",-1)),Nn={class:"list-content"},Bn={class:"fragment-img"},Hn=["src"],Qn={key:0,class:"status-tag"},jn={key:1,class:"status-tag complete"},Un={class:"status-tag status-error"},Jn={key:3,class:"status-tag running"},Vn={class:"right-opration"},Gn={class:"hover-btn-box"},Wn=["onClick"],Xn=ze(()=>o("div",null,"标记设置",-1)),Yn=["onClick"],Zn={class:"hover-btn-box"},Kn=["onClick"],eo=["onClick"],to={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(g,{expose:V,emit:B}){const v=B,b=g,P=(k,_)=>{let{id:m,title:l,content:y,question:O,answer:T,images:X,category_id:p}=k,U=k.similar_questions||[];oe.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${_+1}】吗?`,onOk(){return new Promise((s,M)=>{gt({id:m,title:l,content:y,question:O,answer:T,images:X,category_id:p,similar_questions:JSON.stringify(U)}).then(h=>{v("handleConvert",k),s()}).catch(()=>{s()})})},onCancel(){}})},f=k=>{v("openEditSubscription",k)},I=k=>{oe.confirm({title:"提示",icon:e(ge),content:"确认是否删除该分段?",onOk(){return new Promise((_,m)=>{kt({id:k}).then(l=>{K.success("删除成功"),v("handleDelParagraph",k),_()}).catch(()=>{_()})})},onCancel(){}})},C=c([]),A=()=>{yt().then(k=>{C.value=k.data||[],v("getStatrList",k.data||[])})};A();const $=c(null),r=()=>{$.value.show()},E=k=>{var m;let _=(m=C.value.filter(l=>l.id==k.category_id)[0])==null?void 0:m.type;return _?Fe[_]:"#F4EA2A"},J=(k,_={})=>{bt({id:k.id,category_id:_.id||0}).then(m=>{K.success("设置成功"),k.category_id=_.id})};return V({handleOpenEditModal:f}),(k,_)=>{const m=va,l=Te,y=De,O=Ye,T=Ze,X=Ke,p=ha,U=Je("viewer");return n(),u("div",On,[e(p,{"data-source":g.paragraphLists,pagination:!1},{default:a(()=>[e(m,{key:"id","data-index":"id",width:1148},{title:a(()=>[x("问答（共"+F(b.total)+"个）",1)]),default:a(({record:s})=>[o("div",Pn,[o("div",In,[Mn,o("div",Rn,F(s.question),1)]),s.similar_questions&&s.similar_questions.length?(n(),u("div",Fn,[Tn,o("div",Dn,F(s.similar_questions.join("/")),1)])):z("",!0),o("div",zn,[An,o("div",Nn,F(s.answer),1)]),Ve((n(),u("div",Bn,[(n(!0),u(W,null,te(s.images,(M,h)=>(n(),u("img",{key:h,src:M,alt:""},null,8,Hn))),128))])),[[U]])])]),_:1}),e(m,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:a(({record:s})=>[s.status==0?(n(),u("span",Qn,[e(D(ma)),x(" 未转换")])):z("",!0),s.status==1?(n(),u("span",jn,[e(D(Gt)),x(" 已转换")])):z("",!0),s.status==2?(n(),L(l,{key:2,placement:"top"},{title:a(()=>[o("span",null,F(s.errmsg),1)]),default:a(()=>[o("span",null,[o("span",Un,[e(D(Wt)),x(" 转换异常")])])]),_:2},1024)):z("",!0),s.status==3?(n(),u("span",Jn,[e(y,{size:"small"}),x(" 转换中")])):z("",!0)]),_:1}),e(m,{title:"操作",key:"action","data-index":"action",width:120},{default:a(({record:s,index:M})=>[o("div",Vn,[e(X,null,{overlay:a(()=>[e(T,null,{default:a(()=>[(n(!0),u(W,null,te(C.value,h=>(n(),L(O,{key:h.id},{default:a(()=>[o("div",{class:"start-item",onClick:Q=>J(s,h)},[e(D(Re),{style:we({color:D(Fe)[h.type]})},null,8,["style"]),o("div",null,F(h.name||"-"),1)],8,Wn)]),_:2},1024))),128)),e(O,null,{default:a(()=>[o("div",{class:"start-item",onClick:r},[e(D(xt)),Xn])]),_:1})]),_:2},1024)]),default:a(()=>[o("div",Gn,[s.category_id>0?(n(),L(D(Re),{key:0,onClick:h=>J(s,{}),style:we({color:E(s),"font-size":"16px"})},null,8,["onClick","style"])):(n(),L(D(vt),{key:1,onClick:h=>J(s,C.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),e(l,null,{title:a(()=>[x("重新转换")]),default:a(()=>[o("div",{class:"hover-btn-box",onClick:h=>P(s,M)},[e(D($t))],8,Yn)]),_:2},1024),e(X,{placement:"bottomRight"},{overlay:a(()=>[e(T,null,{default:a(()=>[e(O,null,{default:a(()=>[o("div",{onClick:Me(h=>f(s),["stop"])},"编辑",8,Kn)]),_:2},1024),e(O,null,{default:a(()=>[o("div",{onClick:Me(h=>I(s.id),["stop"])},"删除",8,eo)]),_:2},1024)]),_:2},1024)]),default:a(()=>[o("div",Zn,[e(D(wt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),e(ht,{onOk:A,ref_key:"classificationMarkModalRef",ref:$},null,512)])}}},ao=re(to,[["__scopeId","data-v-b1f3fb5c"]]),Ae=g=>(Ce("data-v-3df37e2d"),g=g(),qe(),g),no={class:"library-preview-page"},oo={class:"breadcrumb-block"},lo={class:"document-title-block",style:{height:"22px"}},so={class:"title"},io={class:"search-content-block"},co={class:"selct-star-box"},ro=Ae(()=>o("span",null,"添加分段",-1)),uo={key:0,class:"page-loading-box"},_o={class:"content-block"},po={class:"content-block"},fo={key:1,class:"pdf-view-box"},mo={class:"view-content-wrap"},vo={key:0,class:"pdf-mode-switch"},ho={key:0},go={key:1,class:"segmentation-btn"},ko=Ae(()=>o("div",null,"将当页重新分段",-1)),yo=Ae(()=>o("div",null,"将文档重新分段",-1)),bo=Ae(()=>o("div",null,"重新学习文档",-1)),So={class:"view-content-box",style:{"padding-top":"60px"}},xo=["onClick"],$o={key:0,class:"content-box"},wo={key:1,class:"content-box"},Co=["innerHTML"],qo={class:"fragment-img"},Lo=["src"],Eo={class:"right-contnt-box"},Oo={class:"content-block"},Po={__name:"library-preview",setup(g){const V=Xt(),B=se(()=>{var i;return((i=V.companyInfo)==null?void 0:i.neo4j_status)=="true"}),v=c(null),b=c(0),P=c(0),f={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I=c([]),C=i=>{I.value=i},A=c({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),$=Xe(),r=pt(),E=Yt(),J=se(()=>l.value.is_table_file=="1"),k=se(()=>l.value.doc_type),_=se(()=>{let i=l.value.status;return!(i=="1"||i=="2")||R.value.length==0}),m=se(()=>l.value.is_qa_doc=="1"),l=c({}),y=Ge({status:-1,graph_status:-1,category_id:-1}),O=c(1),T=se(()=>"/manage/getLibRawFile?id="+$.query.id+"&token="+E.getToken);We(()=>{$.query.graph_status&&(y.graph_status=$.query.graph_status,_e())});const X=()=>{r.back()},p=c(null),U=c(null);let s=-1;const M=(i,d=1)=>{let S,q;d==1?(S=".subsection-box .list-item",q=U.value):(S=".view-content-box .list-item",q=p.value);const ee=document.querySelectorAll(S)[i];ee.classList.add("flash-border"),s>=0&&document.querySelectorAll(S)[s].classList.remove("flash-border"),setTimeout(()=>{s=-1,ee.classList.remove("flash-border")},2500),s=i,q.scrollToElement({el:ee,time:1e3})},h=c(!0);(async()=>{St({id:$.query.id}).then(i=>{l.value={...i.data,graph_switch:i.data.graph_switch=="1"&&B.value};let d=i.data.status;d==1||d==2?fe():h.value=!1})})();const ie=c({page:1,size:10}),ue=c({}),R=c([]),ne=c(0),ke={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."};let ye=!0;const _e=()=>{ie.value.page=1,ne.value=0,R.value=[],fe()},Le=i=>{y.category_id=i,_e()},Y=(i=null)=>{ie.value.page++,fe(i)},fe=(i=null)=>{ye=!0,ut({file_id:$.query.id,...ie.value,...y}).then(d=>{var ae,j;h.value=!1,ye=!1;let S=d.data,q=S.list||[],ee=((ae=S.info)==null?void 0:ae.is_qa_doc)=="1"&&((j=S.info)==null?void 0:j.is_table_file)=="1";q.forEach(Z=>{Z.status_text=ke[Z.status],Z.graph_status_text=f[Z.graph_status],Z.isExcelQa=ee,Z.similar_questions&&(Z.similar_questions=JSON.parse(Z.similar_questions))}),ue.value=S.info,ie.value.page==1&&(R.value=[]),R.value=[...R.value,...q],ne.value=S.total,typeof i=="function"&&i()})},me=()=>{ye||R.value.length>=ne.value||(Y(),v.value&&v.value.loadMore())},be=()=>{Se()};let de=null;function Ne(){clearInterval(de),R.value.filter(d=>d.status==3).length?de=setInterval(()=>{Se()},5e3):clearInterval(de)}const Se=()=>{ut({file_id:$.query.id,page:1,size:R.value.length,...y}).then(i=>{var ee,ae;let d=i.data,S=d.list||[],q=((ee=d.info)==null?void 0:ee.is_qa_doc)=="1"&&((ae=d.info)==null?void 0:ae.is_table_file)=="1";S.forEach(j=>{j.status_text=ke[j.status],j.graph_status_text=f[j.graph_status],j.isExcelQa=q,j.similar_questions&&(j.similar_questions=JSON.parse(j.similar_questions))}),R.value=S,Ne()})},Ee=i=>{if(!i.id){ie.value.page=1,fe();return}let d=R.value,S=d.findIndex(q=>q.id==i.id);if(S>-1){let q=d[S];q.title=i.title,q.content=i.content,q.question=i.question,q.answer=i.answer,q.answer=i.answer,q.images=i.images,q.category_id=i.category_id,q.word_total=i.question.length+i.answer.length+i.content.length,q.similar_questions=JSON.parse(i.similar_questions),d.splice(S,1,q),R.value=d}},pe=i=>{let d=R.value,S=d.findIndex(q=>q.id==i);S>-1&&(d.splice(S,1),R.value=d,ne.value=ne.value--)};c(!0);const xe=c(null),le=i=>{xe.value.showModal(JSON.parse(JSON.stringify(i)))},t=c(null),w=()=>{sa({id:$.query.id}).then(()=>K.success("操作完成"))},N=()=>{ia({id:$.query.id}).then(()=>K.success("操作完成"))},H=c(null),ce=()=>{H.value.show(l.value)},ve=()=>{r.push("/library/document-segmentation?document_id="+$.query.id+"&source=preview")},Lt=()=>{t.value.open({id:$.query.id,doc_auto_renew_frequency:l.value.doc_auto_renew_frequency})},Et=i=>{l.value.doc_auto_renew_frequency=i},Ot=i=>{l.value.file_name=i},Pt=i=>{const d=()=>{for(let S in R.value)if(R.value[S].page_num==i){M(S);return}};if(i>R.value[R.value.length-1].page_num){K.warning("分段数据正在加载，请稍后...");const S=()=>{i<=R.value[R.value.length-1].page_num?(K.success("加载完成"),Ue(()=>{d()})):Y(S)};Y(S)}else d()},It=(i,d)=>{P.value=d,b.value=i,R.value[R.value.length-1].page_num<i&&Y()},Mt=i=>{var d;if(((d=l.value)==null?void 0:d.file_ext)=="pdf"&&O.value==1){const S=i.page_num-1,q=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[S],ee=()=>{const j=q();j.classList.add("flash-border"),setTimeout(()=>j.classList.remove("flash-border"),2500),v.value.getScrollInstance().scrollToElement({el:j,time:1e3})};if(q())ee();else{K.warning("PDF正在加载，请稍后...");const j=()=>{q()?(K.success("加载完成"),ee()):v.value&&v.value.loadMore()};v.value&&v.value.loadMore(j)}}else M(i.index,2)},Be=c(1);let He=null;const Oe=c(0),Rt=i=>{Oe.value=i},Ft=({y:i})=>{if(!He){const S=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];He=S&&S.clientHeight}let d=Math.floor(Math.abs(i)/He)+1;Be.value=Math.max(d,1)},Qe=c(null),Tt=i=>{let{key:d}=i;v.value&&v.value.getScrollInstance().disable(),d==1&&Qe.value.show({type:d,pdf_page_num:Be.value}),d==2&&ve(),d==3&&Qe.value.show({type:d,pdf_page_num:0})},tt=()=>{v.value&&v.value.getScrollInstance().enable()},Dt=()=>{tt(),_e()};return(i,d)=>{var lt,st,it;const S=Ut("router-link"),q=ka,ee=ga,ae=Ct,j=qt,Z=Ye,at=Ze,Pe=ft,nt=Ke,zt=ya,At=De,Ie=Te,ot=Sa,Nt=ba,Bt=Je("viewer");return n(),u("div",no,[o("div",oo,[e(ee,null,{default:a(()=>[e(q,null,{default:a(()=>[e(S,{to:"/library/list"},{default:a(()=>[x(" 知识库管理 ")]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(S,{to:{path:"/library/details/knowledge-document",query:{id:l.value.library_id}}},{default:a(()=>[x(F(l.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),e(q,null,{default:a(()=>[x("知识库详情")]),_:1})]),_:1})]),o("div",lo,[e(D(xa),{onClick:X}),o("span",so,F(l.value.file_name),1),e(nn,{detailsInfo:l.value},null,8,["detailsInfo"])]),o("div",io,[o("div",co,[e(Zt,{startLists:I.value,onChange:Le},null,8,["startLists"])]),e(zt,null,{default:a(()=>[e(j,{value:y.status,"onUpdate:value":d[0]||(d[0]=G=>y.status=G),placeholder:"请选择",style:{width:"160px"},onChange:_e},{default:a(()=>[e(ae,{value:-1},{default:a(()=>[x("全部嵌入状态")]),_:1}),(n(),u(W,null,te(ke,(G,he)=>e(ae,{value:he},{default:a(()=>[x(F(G),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),l.value.graph_switch?(n(),L(j,{key:0,value:y.graph_status,"onUpdate:value":d[1]||(d[1]=G=>y.graph_status=G),placeholder:"请选择",onChange:_e,style:{width:"160px"}},{default:a(()=>[e(ae,{value:-1},{default:a(()=>[x("全部知识图谱状态")]),_:1}),(n(),u(W,null,te(f,(G,he)=>e(ae,{value:he},{default:a(()=>[x(F(G),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):z("",!0),e(nt,null,{overlay:a(()=>[e(at,null,{default:a(()=>[e(Z,{onClick:w},{default:a(()=>[x("重新嵌入向量")]),_:1}),l.value.graph_switch?(n(),L(Z,{key:0,onClick:N},{default:a(()=>[x("重新抽取知识图谱")]),_:1})):z("",!0),e(Z,{onClick:ce},{default:a(()=>[x("重命名")]),_:1}),k.value==2?(n(),L(Z,{key:1,onClick:Lt},{default:a(()=>[x("设置更新频率")]),_:1})):z("",!0)]),_:1})]),default:a(()=>[e(Pe,null,{default:a(()=>[x("其他操作 "),e(D(_t))]),_:1})]),_:1}),k.value!=3?(n(),L(Pe,{key:1,onClick:ve},{default:a(()=>[x("重新分段")]),_:1})):z("",!0),e(Pe,{onClick:d[2]||(d[2]=G=>le({})),type:"primary"},{icon:a(()=>[e(D(mt))]),default:a(()=>[ro]),_:1})]),_:1})]),h.value?(n(),u("div",uo,[e(At)])):(n(),u(W,{key:1},[m.value?(n(),u(W,{key:0},[_.value?(n(),L(je,{key:0,onOpenEditSubscription:le})):(n(),L($e,{key:1,scrollbar:{minSize:0},onOnScrollEnd:me},{default:a(()=>[o("div",_o,[e(ao,{ref:"subsectionBoxRef",total:ne.value,paragraphLists:R.value,detailsInfo:l.value,onOpenEditSubscription:le,onHandleDelParagraph:pe,onHandleConvert:be,onGetStatrList:C},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(n(),u(W,{key:1},[J.value||k.value==3?(n(),u(W,{key:0},[_.value?(n(),L(je,{key:0,onOpenEditSubscription:le})):(n(),L($e,{key:1,scrollbar:{minSize:0},onOnScrollEnd:me},{default:a(()=>[o("div",po,[e(dt,{ref:"subsectionBoxRef",total:ne.value,paragraphLists:R.value,detailsInfo:l.value,onOpenEditSubscription:le,onHandleDelParagraph:pe,onHandleConvert:be,onGetStatrList:C},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(n(),u("div",fo,[o("div",mo,[((lt=l.value)==null?void 0:lt.file_ext)=="pdf"?(n(),u("div",vo,[e(Nt,{value:O.value,"onUpdate:value":d[3]||(d[3]=G=>O.value=G)},{default:a(()=>[e(ot,{value:1},{default:a(()=>[e(Ie,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:a(()=>[x(" 原文预览 "),O.value==1&&Oe.value>0?(n(),u("span",ho,"("+F(Be.value)+" / "+F(Oe.value)+")",1)):z("",!0)]),_:1})]),_:1}),e(ot,{value:2},{default:a(()=>[x("纯文本预览")]),_:1})]),_:1},8,["value"])])):z("",!0),((st=l.value)==null?void 0:st.file_ext)=="pdf"?(n(),u("div",go,[e(nt,null,{overlay:a(()=>[e(at,{onClick:Tt},{default:a(()=>[O.value==1&&Oe.value>0?(n(),L(Z,{key:1},{default:a(()=>[e(Ie,{placement:"right",title:"将当前页重新解析并分段"},{default:a(()=>[ko]),_:1})]),_:1})):z("",!0),(n(),L(Z,{key:2},{default:a(()=>[e(Ie,{placement:"right",title:"将整个文档重新分段，注意，重新分段并不会重新提取文档的内容，只是将内容重新分段。"},{default:a(()=>[yo]),_:1})]),_:1})),(n(),L(Z,{key:3},{default:a(()=>[e(Ie,{placement:"right",title:"将整个文档重新学习，包含重新解析并提取文档内容，重新分段。"},{default:a(()=>[bo]),_:1})]),_:1}))]),_:1})]),default:a(()=>[e(Pe,null,{default:a(()=>[x(" 重新分段 "),e(D(_t))]),_:1})]),_:1})])):z("",!0),((it=l.value)==null?void 0:it.file_ext)=="pdf"&&O.value==1?(n(),L(cn,{key:2,ref_key:"pdfRef",ref:v,class:"scroll-box pdf-render-box",source:T.value,onSelect:Pt,onScroll:Ft,onRendered:It,onGetTotalPage:Rt},null,8,["source"])):(n(),L($e,{key:3,scrollbar:A.value,ref_key:"leftScrollRef",ref:p,class:"scroll-box",onOnScrollEnd:me},{default:a(()=>[o("div",So,[(n(!0),u(W,null,te(R.value,(G,he)=>(n(),u("div",{class:"list-item",onClick:ct=>M(he),key:he},[G.question?(n(),u("div",$o,F(G.question),1)):z("",!0),G.answer?(n(),u("div",wo,F(G.answer),1)):z("",!0),o("div",{class:"content-box",innerHTML:G.content},null,8,Co),Ve((n(),u("div",qo,[(n(!0),u(W,null,te(G.images,(ct,Ht)=>(n(),u("img",{key:Ht,src:ct,alt:""},null,8,Lo))),128))])),[[Bt]])],8,xo))),128))])]),_:1},8,["scrollbar"]))]),o("div",Eo,[_.value?(n(),L(je,{key:0,onOpenEditSubscription:le})):(n(),L($e,{key:1,scrollbar:A.value,ref_key:"rightScrollRef",ref:U,onOnScrollEnd:me},{default:a(()=>[o("div",Oo,[e(dt,{ref:"subsectionBoxRef",total:ne.value,detailsInfo:l.value,paragraphLists:R.value,onOpenEditSubscription:le,onHandleDelParagraph:pe,onHandleConvert:be,onHandleScrollTargetPage:Mt,onGetStatrList:C},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),e(Kt,{detailsInfo:l.value,onHandleEdit:Ee,ref_key:"editSubscriptionRef",ref:xe},null,8,["detailsInfo"]),e(on,{onOk:Et,ref_key:"updateFrequencyRef",ref:t},null,512),e(ua,{onOk:Ot,ref_key:"renameModalRef",ref:H},null,512),e(En,{onOk:Dt,onEnable:tt,detailsInfo:l.value,ref_key:"reSegmentationPageRef",ref:Qe},null,8,["detailsInfo"])])}}},os=re(Po,[["__scopeId","data-v-3df37e2d"]]);export{os as default};
