import{b as $e,B as Mt,bt as bn,d as Ze,M as ge,dg as Sn,V as wn,E as Le,Z as xn,dk as Pt,dl as Dt,k as pe,ds as Ft,dv as zt,bU as $n,bL as Nt,dw as Cn,bM as Ln,bN as qn,bP as On,dx as En,e as At,dy as In,a1 as Tn,bq as Rn,h as Mn,dz as Pn,df as Et,dA as Dn,dB as Fn,bO as zn}from"../../index-BdYv4pbp.js";import{M as v,N as l,W as n,k as t,S as o,u as ee,a1 as Pe,a2 as De,e as s,B as Ce,x as Be,a7 as H,Z as X,F as _e,a0 as Se,z as je,a4 as We,d as ve,D as Bt,ai as it,Y as E,X as Me,$ as he,G as ct,Q as j,a6 as Ht,a3 as Ut,a8 as Nn}from"./vue-chunks-Dagx-vSq.js";import{_ as An}from"./empty-CzGZrENG.js";import{P as Qt}from"./PlusOutlined-BEhntgqt.js";import{S as Ge,a as Jt,c as Ve,C as jt,b as Bn,E as Hn}from"./edit-subsection-DNEqsZMW.js";import{Z as Un,f as Qn,a as Jn,P as jn,H as Gn,C as Vn,b as Zn}from"./cu-scroll--EBlKgwL.js";import{S as He}from"./index-BITuwxer.js";import{M as rt,_ as ut}from"./index-CJ0orYu6.js";import{S as Gt}from"./SettingOutlined-CygDtKy4.js";import"./index-Dq7HAFaD.js";import{D as dt}from"./dropdown-BiE8xfl_.js";import{S as Vt}from"./SyncOutlined-wUPVjOdF.js";import{M as Zt}from"./MoreOutlined-D2HKzNS9.js";import{_ as Ke}from"./index-CCsePsqL.js";import{_ as Ae}from"./cu-scroll-BvD9XPVC.js";import{F as Wn,_ as Kn}from"./index-CbmBRnKK.js";import{S as Wt,a as Kt}from"./index-BddIR2yb.js";import{R as Xn}from"./rename-modal-BDoDYwPR.js";import{V as It}from"./vue-pdf-embed-C14rZuMz.js";import{S as Yn,a as ea,D as ta,E as na}from"./edit-fragment-alert-dIH3YLzo.js";import{C as aa}from"./ClockCircleFilled-dX4v8WIw.js";import{_ as oa,a as la}from"./index-p8d_9U1-.js";import{B as sa,_ as ia}from"./index--uMQ1kyV.js";import{L as ca}from"./LeftOutlined-DfhC6gKx.js";import{S as ra}from"./index-C4cR8MsS.js";import{T as ua,_ as da}from"./index-DgTptGPI.js";import{D as Tt}from"./DownOutlined-bF62ZcFO.js";import{_ as _a,a as pa}from"./RadioButton-CKy5Sstn.js";import"./axios-BZ84_VUH.js";import"./qs-CSiAN3u4.js";import"./crypto-js-DN0vhd75.js";import"./dayjs-CZ5VaChI.js";import"./index-B11WLJj_.js";import"./Input-C2qOGQ_1.js";import"./FormItemContext-Cdyd-mYe.js";import"./index-ffqjZvit.js";import"./inputProps-BIa77Hqy.js";import"./Search-B65y9BZx.js";import"./SearchOutlined-C-SKizIr.js";import"./isPlainObject-BUQ58MPT.js";import"./TextArea-DRJIYohD.js";import"./index-p3MxSJUT.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-D2_IM1Jy.js";import"./index-CIGUcmws.js";import"./index-qGbzu_6t.js";import"./index-DtgLQTOT.js";import"./Trigger-DWEODdVI.js";import"./DownloadOutlined-B8UItTFz.js";import"./CheckOutlined-Zj7x0G_2.js";import"./collapseMotion-D5mGic4t.js";import"./index-DrvGOKxR.js";import"./index-DulBynFY.js";import"./index-BMSQkwth.js";import"./index-CzzmSx3J.js";import"./index-BMih6iRe.js";import"./UpOutlined-DlgZFWNa.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./shallowequal-CI97GdPH.js";import"./slide-4EGAbcnD.js";import"./RightOutlined-Dc3RESo2.js";import"./move-Du4Gi3iM.js";import"./colors-CJx9DhIW.js";import"./responsiveObserve-YIOA4WXQ.js";import"./QuestionCircleOutlined-BY31qbwb.js";import"./model-select-C7NXQtts.js";import"./index-B6ctIxYh.js";import"./index-3na9OQqB.js";import"./index-DNsujCXu.js";import"./useMaxLevel-B54cygJO.js";import"./CaretDownFilled-7_Xowb8a.js";import"./index-_xQpb7Ga.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-Dzb8yElx.js";import"./Checkbox-B2wqz-LK.js";import"./index-TeHk_coF.js";import"./CaretDownOutlined-Ch0ng0P7.js";import"./pick-RXfaHpPL.js";const _t=x=>(Pe("data-v-8eb7d862"),x=x(),De(),x),fa={class:"empty-box"},ma=_t(()=>n("img",{src:An,alt:""},null,-1)),va=_t(()=>n("div",{class:"title"},"知识库文档为空，请添加分段",-1)),ha=_t(()=>n("span",null,"添加分段",-1)),ga={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(x,{emit:oe}){const $=oe,U=()=>{$("openEditSubscription",{})};return(r,m)=>{const h=Mt;return l(),v("div",fa,[ma,va,n("div",null,[t(h,{type:"primary",onClick:U},{icon:o(()=>[t(ee(Qt))]),default:o(()=>[ha]),_:1})])])}}},st=$e(ga,[["__scopeId","data-v-8eb7d862"]]),ka=x=>(Pe("data-v-f0ead6c0"),x=x(),De(),x),ya={class:"chart-wrapper"},ba=ka(()=>n("div",{class:"chart-mini-map",id:"chatMap"},null,-1)),Sa={class:"zoom-toolbar-wrapper"},wa={__name:"chart-box",emits:["nodeClick"],setup(x,{expose:oe,emit:$}){const U=$,r=s(null);let m=null;const h=Ce({nodes:[],edges:[]}),M=s(1),I={},C=()=>{m&&m.destroy();const f={layout:"forceDirected",initialZoom:M.value,disableTelemetry:!0,maxZoom:10,minZoom:.1,minimapContainer:document.getElementById("chatMap"),styling:{minimapViewportBoxColor:"#4399FF",selectedBorderColor:"rgba(255, 255, 255, 1)"}},p=document.getElementById("chartBox");m=new Qn(p,h.nodes,h.edges,f,I);const w=new Jn(m);new jn(m),w.updateCallback("onZoom",O=>{M.value=Number(O.toFixed(1))}),new Gn(m,{drawShadowOnHover:!0}),new Vn(m,{selectOnClick:!0}).updateCallback("onNodeClick",O=>{U("nodeClick",O)})},V=f=>{M.value=f,m&&m.setZoom(f)},i=({nodes:f,edges:p})=>{h.nodes=[h.nodes,...f],h.edges=[h.edges,...p],m&&m.addElementsToGraph(f,p)},z=({nodes:f,edges:p})=>{h.nodes=[h.nodes,...f],h.edges=[h.edges,...p],m&&m.addAndUpdateElementsInGraph(f,p)},te=({nodes:f,edges:p})=>{h.nodes=f,h.edges=p,m&&m.updateElementsInGraph(f,p)},L=()=>{m&&m.destroy()},Q=({nodes:f,edges:p})=>{h.nodes=f,h.edges=p,C()};return Be(()=>{}),oe({render:Q,add:i,addAndUpdate:z,update:te,destroy:L}),(f,p)=>(l(),v("div",ya,[n("div",{class:"chart",id:"chartBox",ref_key:"chartBox",ref:r},null,512),ba,n("div",Sa,[t(Un,{value:M.value,onChange:V},null,8,["value"])])]))}},xa=$e(wa,[["__scopeId","data-v-f0ead6c0"]]),Ue=x=>(Pe("data-v-bb7b1011"),x=x(),De(),x),$a={key:0,class:"popup-wrapper entity-details-wrapper"},Ca={class:"popup-header"},La=Ue(()=>n("div",{class:"popup-title"},"实体详情",-1)),qa={key:0,class:"popup-body"},Oa={class:"popup-content"},Ea={class:"entity-details"},Ia={class:"entity-item"},Ta=Ue(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"实体")],-1)),Ra={class:"entity-name"},Ma={class:"entity-item",style:{"margin-bottom":"8px"}},Pa=Ue(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"归属文档")],-1)),Da={class:"file-info"},Fa={class:"file-name"},za={class:"entity-item"},Na=Ue(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"分段")],-1)),Aa={class:"doc-item"},Ba={class:"fragment-content"},Ha={class:"entity-item"},Ua=Ue(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"子图")],-1)),Qa={key:0,class:""},Ja={class:"fragment-content"},ja={__name:"entity-details",setup(x,{expose:oe}){const $=Ce({show:!1,node:null,fromNodes:[]}),U=()=>{$.show=!1};return oe({open:(m,h)=>{$.node=m,$.fromNodes=h,$.show?($.show=!1,je(()=>{$.show=!0})):$.show=!0},close:U}),(m,h)=>{const M=Ze;return $.show?(l(),v("div",$a,[n("div",Ca,[La,t(ee(bn),{class:"close-btn",onClick:U})]),$.node?(l(),v("div",qa,[t(Zn,null,{default:o(()=>[n("div",Oa,[n("div",Ea,[n("div",Ia,[Ta,n("div",Ra,X($.node.name),1)]),n("div",Ma,[Pa,n("div",Da,[t(M,{class:"file-icon",name:"doc-file",style:{}}),n("span",Fa,X($.node.file_name),1)])]),n("div",za,[Na,n("div",null,[n("div",Aa,[n("div",Ba,X($.node.content),1)])])]),n("div",Ha,[Ua,n("div",null,[$.fromNodes.length==0?(l(),v("div",Qa,"无")):H("",!0),(l(!0),v(_e,null,Se($.fromNodes,I=>(l(),v("div",{class:"subgraph-item",key:I.id},[n("div",Ja,X(I.name),1)]))),128))])])])])]),_:1})])):H("",!0)])):H("",!0)}}},Ga=$e(ja,[["__scopeId","data-v-bb7b1011"]]),Va={class:"graph-model-body"},Za={key:0,class:"loading-wrapper"},Wa={class:"right-box"},Ka={__name:"index",setup(x,{expose:oe}){const $=s(!1),U=s(null),r=s(null),m=s(null),h=s(!1),M=Ce({file_id:"",data_id:""}),I=Ce({edges:[],nodes:[]});let C={};const V=()=>{i()},i=()=>{h.value=!0,Sn({file_id:M.file_id,data_id:M.data_id,search_term:M.search_term}).then(f=>{h.value=!1;let p=f.data.edges||[],w=f.data.nodes||[];const k=new Map;p=p.filter(y=>{const P=`${y.from_id}_${y.to_id}`,ie=`${y.to_id}_${y.from_id}`;return k.has(P)||k.has(ie)?!1:(k.set(P,!0),!0)}),p.forEach(y=>{y.id=y.id.toString(),y.from=y.from_id.toString(),y.to=y.to_id.toString(),y.caption=y.label});const O=new Set(p.map(y=>y.from)),ae=new Set(p.map(y=>y.to));w.forEach(y=>{y.caption=y.name,y.id=y.id.toString(),y.nodeType=O.has(y.id)&&ae.has(y.id)?"both":O.has(y.id)?"from":ae.has(y.id)?"to":"normal",y.nodeType==="from"?(y.size=35,y.color="#FFB1B2"):y.nodeType==="to"?(y.size=45,y.color="#005AFF"):(y.size=30,y.color="#69E9BE")});let se={edges:p,nodes:w};I.edges=se.edges,I.nodes=se.nodes,setTimeout(()=>{r.value.render(se)},0),C={},p.forEach(y=>{C[y.to]||(C[y.to]=[]),C[y.to].push(y.from)})}).catch(f=>{h.value=!1})},z=f=>{let p=C[f.id]||[],w=[];for(let k=0;k<I.nodes.length;k++)p.indexOf(I.nodes[k].id)>-1&&w.push(I.nodes[k]);m.value.open(f,w)},te=()=>{r.value.destroy(),$.value=!1},L=()=>{$.value=!1};return oe({open:f=>{M.file_id=f.file_id,M.data_id=f.id,$.value=!0,setTimeout(()=>{V()},350)}}),(f,p)=>{const w=He,k=ge;return l(),v("div",{ref_key:"mymodal",ref:U},[t(k,{wrapClassName:"graph-model-wrapper",zIndex:99999,centered:"",open:$.value,"onUpdate:open":p[0]||(p[0]=O=>$.value=O),title:"知识图谱",width:"90vw",footer:null,onOk:L,onCancel:te},{default:o(()=>[n("div",Va,[h.value?(l(),v("div",Za,[t(w)])):H("",!0),t(xa,{ref_key:"chartBoxRef",ref:r,loading:h.value,onNodeClick:z},null,8,["loading"]),n("div",Wa,[t(Ga,{ref_key:"entityDetailsRef",ref:m},null,512)])])]),_:1},8,["open"])],512)}}},Xa=$e(Ka,[["__scopeId","data-v-56e1b6be"]]),Ya=x=>(Pe("data-v-1dcfe3b0"),x=x(),De(),x),eo={class:"subsection-box-title"},to=["onClick"],no={class:"top-block"},ao={class:"title"},oo={class:"title-block"},lo={class:"status-box"},so={class:"cfb363f"},io={class:"split-err"},co={key:0},ro={class:"cfb363f"},uo={class:"right-opration"},_o={class:"hover-btn-box"},po=["onClick"],fo=Ya(()=>n("div",null,"精选设置",-1)),mo=["onClick"],vo=["onClick"],ho={class:"hover-btn-box"},go={class:"hover-btn-box"},ko=["onClick"],yo=["onClick"],bo={key:0,class:"content-box"},So={key:1,class:"content-box"},wo=["onMouseup","innerHTML"],xo={key:2,class:"fragment-img"},$o=["src"],Co={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList","handleSplit","handleSplitNext","handleSplitUp","handleSplitDelete","handleSegmentation"],setup(x,{expose:oe,emit:$}){const U=We(),r=$,m=x,h=(u,d)=>{let{id:N,title:T,content:re,question:K,answer:G,images:ce,category_id:_}=u,le=u.similar_questions||[];ge.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${d+1}】吗?`,onOk(){return new Promise(F=>{Ft({id:N,title:T,content:re,question:K,answer:G,images:ce,category_id:_,similar_questions:JSON.stringify(le)}).then(()=>{r("handleConvert",u),F()}).catch(()=>{F()})})},onCancel(){}})},M=u=>{r("openEditSubscription",u)},I=u=>{ge.confirm({title:"提示",icon:t(Le),content:"确认是否删除该分段?",onOk(){return new Promise(d=>{zt({id:u}).then(()=>{pe.success("删除成功"),r("handleDelParagraph",u),d()}).catch(()=>{d()})})},onCancel(){}})},C=(u,d,N)=>{window.getSelection().toString().trim()||(r("handleScrollTargetPage",{page_num:u.page_num,index:d}),we(N))},V=u=>{r("handleSegmentation",u)},i=s([]),z=()=>{let u={file_id:U.query.id};Pt(u).then(d=>{i.value=d.data||[],r("getStatrList",d.data||[])})};z();const te=s(null),L=()=>{te.value.show()},Q=u=>{var N;let d=(N=i.value.filter(T=>T.id==u.category_id)[0])==null?void 0:N.type;return d?Ve[d]:""},f=(u,d={})=>{Dt({id:u.id,category_id:d.id||0}).then(()=>{pe.success("设置成功"),u.category_id=d.id,z()})},p=s(null),w=u=>{p.value.open(u)},k=s(null),O=s(!1),ae=s({x:0,y:0}),se=s(""),y=s(null),P=s({text:"",parentIndex:-1,originalHtml:""}),ie=ve(()=>{if(!O.value)return{};const u=162;let d=ae.value.x,N=ae.value.y;const T=k.value.getBoundingClientRect(),re=window.innerWidth;d<10?d=10:d+u>re-50&&(d=re-u-50);const K=d-T.left,G=N;return{left:`${K}px`,top:`${G}px`}}),D=(u,d)=>{setTimeout(()=>{const N=window.getSelection(),T=N.toString().trim();if(T){u.stopPropagation(),P.value={text:T,parentIndex:d,originalHtml:m.paragraphLists[d].content},se.value=T,y.value=N.getRangeAt(0).cloneRange();const K=N.getRangeAt(0).getBoundingClientRect(),G=k.value.getBoundingClientRect();ae.value={x:K.left+K.width/2,y:K.top-G.top-50},O.value=!0}else O.value=!1},50)},B=u=>{const{parentIndex:d}=P.value;switch(u){case"separate":Oe(d);break;case"merge-next":S(d);break;case"merge-prev":be(d);break;case"delete":qe(d);break}O.value=!1,window.getSelection().removeAllRanges()},ye=(u,d,N)=>{if(d===0&&N===u.textContent.length&&u.textContent.trim().length>0)return["",u.innerHTML,""];const re=document.createTreeWalker(u,NodeFilter.SHOW_TEXT);let K,G=0,ce,_,le,F;for(;K=re.nextNode();){const Y=K.nodeValue.length;if(!ce&&G+Y>=d&&(ce=K,le=d-G),!_&&G+Y>=N){_=K,F=N-G;break}G+=Y}const xe=document.createRange();xe.setStart(ce,le),xe.setEnd(_,F);const a=document.createRange();a.setStart(u,0),a.setEnd(ce,le);const R=document.createRange();return R.setStart(_,F),R.setEnd(u,u.childNodes.length),[fe(a),fe(xe),fe(R)]},fe=u=>{const d=document.createElement("div");return d.appendChild(u.cloneContents()),d.innerHTML},Oe=u=>{const d=m.paragraphLists[u].content,T=window.getSelection().getRangeAt(0);T.toString()&&ge.confirm({title:"单独分段",icon:t(Le),content:"确认将该分段内容单独分段么？分段后，原分段的内容会被删除",onOk(){const K=document.createElement("div");K.innerHTML=d;const[G,ce,_]=ye(K,T.startOffset,T.endOffset),le=G.replace(/<[^>]+>/g,"").trim()==="",F=_.replace(/<[^>]+>/g,"").trim()==="";le&&F?r("handleSplit",{index:u,beforeContent:"",selectedContent:ce,afterContent:"",isFullSelection:!0}):r("handleSplit",{index:u,beforeContent:G,selectedContent:ce,afterContent:_,originalSelection:{start:T.startOffset,end:T.endOffset,parentIndex:u}})}})},S=u=>{if(u>=m.paragraphLists.length-1)return pe.error("没有下一个分段");const d=m.paragraphLists[u].content,T=window.getSelection().getRangeAt(0);T.toString()&&ge.confirm({title:"合并到下一个分段",icon:t(Le),content:"确认将该分段内容合并到下一个分段么？分段后，原分段的内容会被删除",onOk(){const K=document.createElement("div");K.innerHTML=d;const[G,ce,_]=ye(K,T.startOffset,T.endOffset),le=G.replace(/<[^>]+>/g,"").trim()==="",F=_.replace(/<[^>]+>/g,"").trim()==="";le&&F?r("handleSplitNext",{index:u,beforeContent:"",selectedContent:ce,afterContent:"",isFullSelection:!0}):r("handleSplitNext",{index:u,beforeContent:G,selectedContent:ce,afterContent:_,originalSelection:{start:T.startOffset,end:T.endOffset,parentIndex:u}})}})},be=u=>{if(u<=0)return pe.error("没有上一个分段");const d=m.paragraphLists[u].content,T=window.getSelection().getRangeAt(0);T.toString()&&ge.confirm({title:"合并到上一个分段",icon:t(Le),content:"确认将该分段内容合并到上一个分段么？分段后，原分段的内容会被删除",onOk(){const K=document.createElement("div");K.innerHTML=d;const[G,ce,_]=ye(K,T.startOffset,T.endOffset),le=G.replace(/<[^>]+>/g,"").trim()==="",F=_.replace(/<[^>]+>/g,"").trim()==="";le&&F?r("handleSplitUp",{index:u,beforeContent:"",selectedContent:ce,afterContent:"",isFullSelection:!0}):r("handleSplitUp",{index:u,beforeContent:G,selectedContent:ce,afterContent:_,originalSelection:{start:T.startOffset,end:T.endOffset,parentIndex:u}})}})},qe=u=>{const d=m.paragraphLists[u].content,T=window.getSelection().getRangeAt(0);T.toString()&&ge.confirm({title:"删除",icon:t(Le),content:"确认将该分段内容删除么？",onOk(){const K=document.createElement("div");K.innerHTML=d;const[G,ce,_]=ye(K,T.startOffset,T.endOffset),le=G.replace(/<[^>]+>/g,"").trim()==="",F=_.replace(/<[^>]+>/g,"").trim()==="";le&&F?r("handleSplitDelete",{index:u,beforeContent:"",selectedContent:"",afterContent:"",isFullSelection:!0}):r("handleSplitDelete",{index:u,beforeContent:G,selectedContent:"",afterContent:_,originalSelection:{start:T.startOffset,end:T.endOffset,parentIndex:u}})}})},we=u=>{O.value&&!u.target.closest(".bubble-card")&&(O.value=!1)};return Be(()=>{document.addEventListener("click",we)}),Bt(()=>{document.removeEventListener("click",we)}),oe({handleOpenEditModal:M}),(u,d)=>{const N=Ke,T=ut,re=rt,K=dt,G=Ze,ce=it("viewer");return l(),v("div",{class:"subsection-box content-container",ref_key:"containerRef",ref:k},[n("div",eo,[E(" 分段预览 "),n("span",null,"共"+X(m.total)+"个分段",1)]),(l(!0),v(_e,null,Se(m.paragraphLists,(_,le)=>(l(),v("div",{class:"list-item",key:_.id,onClick:he(F=>C(_,le,F),["stop"]),style:Me({"--status-color":Q(_)})},[n("div",no,[n("div",ao,[E(" 分段"+X(le+1)+" ",1),n("div",oo,X(_.title),1),n("span",null,"共"+X(_.word_total)+"个字符",1),n("span",lo,[E(" 嵌入状态："+X(_.status_text),1),_.status==3?(l(),j(ee(wn),{key:0})):H("",!0),_.status==2&&_.errmsg?(l(),j(N,{key:1,title:_.errmsg},{default:o(()=>[n("strong",so,[E("原因"),t(ee(Le),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):H("",!0),_.split_status==4&&_.split_err_msg?(l(),j(N,{key:2,title:_.split_err_msg},{default:o(()=>[n("div",io,[t(ee(xn),{style:{"margin-left":"0"},class:"cfb363f"}),E(" 分段失败 ")])]),_:2},1032,["title"])):H("",!0)]),x.detailsInfo.graph_switch?(l(),v("span",co,[E(" 知识图谱状态："+X(_.graph_status_text)+" ",1),_.graph_status==3&&_.graph_err_msg?(l(),j(N,{key:0,title:_.graph_err_msg},{default:o(()=>[n("strong",ro,[E("原因"),t(ee(Le),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):H("",!0)])):H("",!0)]),n("div",uo,[t(K,null,{overlay:o(()=>[t(re,null,{default:o(()=>[(l(!0),v(_e,null,Se(i.value,F=>(l(),j(T,{key:F.id},{default:o(()=>[n("div",{class:"start-item",onClick:he(xe=>f(_,F),["stop"])},[t(ee(Ge),{style:Me({color:ee(Ve)[F.type]})},null,8,["style"]),n("div",null,X(F.name||"-"),1)],8,po)]),_:2},1024))),128)),t(T,null,{default:o(()=>[n("div",{class:"start-item",onClick:he(L,["stop"])},[t(ee(Gt)),fo])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",_o,[_.category_id>0?(l(),j(ee(Ge),{key:0,onClick:he(F=>f(_,{}),["stop"]),style:Me({color:Q(_),"font-size":"16px"})},null,8,["onClick","style"])):(l(),j(ee(Jt),{key:1,onClick:F=>f(_,i.value[0]),style:{"font-size":"16px",color:"#595959"}},null,8,["onClick"]))])]),_:2},1024),t(N,null,{title:o(()=>[E("重新分段")]),default:o(()=>[n("div",{class:"hover-btn-box",onClick:he(F=>V(_),["stop"])},[t(G,{name:"segmentation-icon",style:{"font-size":"16px"}})],8,mo)]),_:2},1024),x.detailsInfo.graph_switch?(l(),j(N,{key:0},{title:o(()=>[E("知识图谱")]),default:o(()=>[n("div",{class:"hover-btn-box",onClick:F=>w(_)},[t(G,{name:"graph-icon",style:{"font-size":"16px",color:"#595959"}})],8,vo)]),_:2},1024)):H("",!0),t(N,null,{title:o(()=>[E("重新转换")]),default:o(()=>[n("div",ho,[t(ee(Vt),{onClick:he(F=>h(_,le),["stop"])},null,8,["onClick"])])]),_:2},1024),t(K,{placement:"bottomRight"},{overlay:o(()=>[t(re,null,{default:o(()=>[t(T,null,{default:o(()=>[n("div",{onClick:he(F=>M(_),["stop"])},"编辑",8,ko)]),_:2},1024),t(T,null,{default:o(()=>[n("div",{onClick:he(F=>I(_.id),["stop"])},"删除",8,yo)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",go,[t(ee(Zt),{style:{"font-size":"16px",color:"#595959"}})])]),_:2},1024)])]),_.question?(l(),v("div",bo,"Q："+X(_.question),1)):H("",!0),_.answer?(l(),v("div",So,"A："+X(_.answer),1)):H("",!0),n("div",{class:"content-box",onMouseup:he(F=>D(F,le),["stop"]),innerHTML:_.content},null,40,wo),_.images.length>0?ct((l(),v("div",xo,[(l(!0),v(_e,null,Se(_.images,(F,xe)=>(l(),v("img",{key:xe,src:F,alt:""},null,8,$o))),128))])),[[ce]]):H("",!0)],12,to))),128)),t(jt,{onOk:z,ref_key:"classificationMarkModalRef",ref:te},null,512),t(Xa,{ref_key:"graphModelRef",ref:p},null,512),O.value?(l(),v("div",{key:0,class:"bubble-card",style:Me(ie.value)},[n("button",{class:"bubble-item",onClick:d[0]||(d[0]=he(_=>B("separate"),["stop"]))},[t(G,{name:"segmentation",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 单独成段 ")]),n("button",{class:"bubble-item",onClick:d[1]||(d[1]=he(_=>B("merge-prev"),["stop"]))},[t(G,{name:"segmentation-up",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 合并到上一分段 ")]),n("button",{class:"bubble-item",onClick:d[2]||(d[2]=he(_=>B("merge-next"),["stop"]))},[t(G,{name:"segmentation-down",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 合并到下一分段 ")]),n("button",{class:"bubble-item",onClick:d[3]||(d[3]=he(_=>B("delete"),["stop"]))},[t(G,{name:"delete",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 删除 ")])],4)):H("",!0)],512)}}},Rt=$e(Co,[["__scopeId","data-v-1dcfe3b0"]]),Lo={class:"mode-box"},qo=["innerHTML"],Oo={class:"tag-item"},Eo={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(x){const oe=x,$=s(""),U=ve(()=>{const{is_table_file:r,is_qa_doc:m,is_diy_split:h,question_lable:M,answer_lable:I,separators:C,chunk_size:V,chunk_overlap:i,question_column:z,answer_column:te,qa_index_type:L,doc_type:Q}=oe.detailsInfo;if(r!=1&&m!=1&&h!=1)return Q==3?($.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):($.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(r!=1&&m==1)return Q==3?($.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):($.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${M}"
答案开始标识符："${I}"`,"智能分段：QA文档");if(r!=1&&m!=1&&h==1)return $.value=`分段模式：自定义分段
文档标识符：${C}
分段最大长度：${V}字符
文段重叠长度：${i}字符`,"自定义分段";if(r==1&&m!=1)return $.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(r==1&&m==1){let f=L==1?"问题与答案一起生成索引":"仅对问题生成索引";return $.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${z}"
答案所在列："${te}"
索引方式：${f}`,"智能分段：QA文档"}});return(r,m)=>{const h=Ke;return l(),v("div",Lo,[t(h,null,{title:o(()=>[n("div",{class:"tooltip-text-box",innerHTML:$.value},null,8,qo)]),default:o(()=>[n("div",Oo,X(U.value),1)]),_:1})])}}},Io=$e(Eo,[["__scopeId","data-v-e8649c10"]]),To={__name:"update-frequency",emits:["ok"],setup(x,{expose:oe,emit:$}){const U=$,r=s(!1),m=s(!1),h=Ce({doc_auto_renew_frequency:1,id:""}),M=C=>{let{doc_auto_renew_frequency:V,id:i}=C;h.doc_auto_renew_frequency=+V,h.id=i,r.value=!0},I=()=>{m.value=!0,$n({...h}).then(C=>{U("ok",h.doc_auto_renew_frequency),r.value=!1,pe.success("设置成功")}).finally(()=>{m.value=!1})};return oe({open:M}),(C,V)=>{const i=Kt,z=Wt,te=Kn,L=Wn,Q=ge;return l(),v("div",null,[t(Q,{open:r.value,"onUpdate:open":V[1]||(V[1]=f=>r.value=f),"confirm-loading":m.value,maskClosable:!1,title:"设置更新频率",onOk:I},{default:o(()=>[t(L,{style:{margin:"32px 0"},layout:"vertical",model:h},{default:o(()=>[t(te,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:o(()=>[t(z,{value:h.doc_auto_renew_frequency,"onUpdate:value":V[0]||(V[0]=f=>h.doc_auto_renew_frequency=f),style:{width:"100%"}},{default:o(()=>[t(i,{value:1},{default:o(()=>[E("不自动更新")]),_:1}),t(i,{value:2},{default:o(()=>[E("每天")]),_:1}),t(i,{value:3},{default:o(()=>[E("每3天")]),_:1}),t(i,{value:4},{default:o(()=>[E("每7天")]),_:1}),t(i,{value:5},{default:o(()=>[E("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},Ro={class:"loading"},Mo={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(x,{expose:oe,emit:$}){const U=x,r=$,m=s(null),h=s([]),M=s(0),I=s(!1),C=ve(()=>I.value?null:{"border-bottom":"2px solid #d9d9d9"}),V=s({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});Be(async()=>{const p=await It.getDocument(U.source).promise;M.value=p.numPages,r("getTotalPage",M.value),i()});const i=(p=null)=>{const w=h.value.length;if(w>=M.value||I.value)return;I.value=!0;const k=[];for(let O=1;O<=U.pageSize&&w+O<=M.value;O++)k.push(w+O);h.value.push(...k),je(()=>{typeof p=="function"&&p()})},z=p=>{i(),r("onScrollEnd",p)},te=p=>{je(()=>{p===h.value[h.value.length-1]&&(I.value=!1,r("rendered",p,M.value))})},L=p=>{r("select",p)},Q=()=>m.value,f=p=>{r("scroll",p)};return oe({loadMore:i,getScrollInstance:Q}),(p,w)=>{const k=He;return l(),j(Ae,{scrollbar:V.value,ref_key:"scrollRef",ref:m,onScroll:f,onOnScrollEnd:z},{default:o(()=>[(l(!0),v(_e,null,Se(h.value,O=>(l(),j(ee(It),{onClick:ae=>L(O),key:O,source:x.source,page:O,onRendered:()=>te(O),style:Me(C.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),n("div",Ro,[I.value?(l(),j(k,{key:0})):H("",!0)])]),_:1},8,["scrollbar"])}}},Po=$e(Mo,[["__scopeId","data-v-8520f2eb"]]),Do=x=>(Pe("data-v-cef98768"),x=x(),De(),x),Fo={key:0,class:"loading-wrap"},zo={class:"document-segmentation"},No={class:"page-container"},Ao={class:"page-left"},Bo={class:"page-right"},Ho={class:"document-fragment-preview"},Uo={class:"preview-header"},Qo=Do(()=>n("span",{class:"label-text"},"分段预览",-1)),Jo={class:"fragment-number"},jo={key:1,class:"loading-box"},Go="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Vo={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}},currentData:{type:Object,default:()=>{}},paragraphType:{type:String,default:""}},emits:["ok","finish","loading"],setup(x,{expose:oe,emit:$}){const U=We(),r=$,{id:m}=U.query,h=s(!0),M=s(1);let I=!1;const C=x,V=s(1);let i={id:m,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Go,ai_chunk_task_id:""};const z=s(null),te=a=>{typeof a.separators_no=="object"&&(a.separators_no=a.separators_no.join(",")),i={...i,...a},I?ge.confirm({title:"提醒",icon:t(Le),content:"文档片段已被编辑重新获取文档片段会丢失当前修改过的文档片段内容，确定要重新获取吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){I=!1,fe("create")},onCancel(){}}):(I=!1,fe("create"))};let L=60*10,Q=0;const f=s({}),p=s(0),w=()=>{h.value||(h.value=!0),Nt({id:m}).then(async a=>{const{status:R}=a.data;if(p.value=a.data.library_type,f.value=a.data,i={...i,separators_no:a.data.separators_no||"11,12",chunk_size:+a.data.chunk_size||512,ai_chunk_size:+a.data.ai_chunk_size||5e3,chunk_overlap:+a.data.chunk_overlap||50,is_qa_doc:p.value==2?1:0,question_lable:a.data.question_lable,answer_lable:a.data.answer_lable,question_column:a.data.question_column,answer_column:a.data.answer_column,enable_extract_image:a.data.enable_extract_image=="true",qa_index_type:+a.data.qa_index_type,chunk_type:+a.data.chunk_type,semantic_chunk_size:+a.data.semantic_chunk_size||512,semantic_chunk_overlap:+a.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+a.data.semantic_chunk_threshold||90,semantic_chunk_use_model:a.data.semantic_chunk_use_model||"",ai_chunk_prumpt:a.data.ai_chunk_prumpt||"",ai_chunk_model:a.data.ai_chunk_model||"",semantic_chunk_model_config_id:a.data.semantic_chunk_model_config_id>0?a.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:a.data.ai_chunk_model_config_id>0?a.data.ai_chunk_model_config_id:"",ai_chunk_task_id:a.data.ai_chunk_task_id||""},a.data.chunk_type==0&&(i={...i,separators_no:a.data.normal_chunk_default_separators_no,chunk_size:a.data.normal_chunk_default_chunk_size,chunk_overlap:a.data.normal_chunk_default_chunk_overlap,chunk_type:+a.data.default_chunk_type,semantic_chunk_size:+a.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+a.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+a.data.semantic_chunk_default_threshold,semantic_chunk_use_model:a.data.default_use_model||"",semantic_chunk_model_config_id:a.data.default_model_config_id>0?a.data.default_model_config_id:""}),R==0){if(Q++,Q>L){ge.error({title:"提醒",content:"文档解析速度慢请稍后再试"});return}setTimeout(()=>{w()},1e3)}else(R==4||R==2)&&(h.value=!1,M.value=parseInt(a.data.is_table_file),a.data.library_id,p.value==2?(i.question_lable||i.question_column)&&fe():fe());a.data.is_table_file==1&&O()})};Be(async()=>{await w()});const k=s([]),O=()=>{qn({id:m}).then(a=>{let R=[];for(let Y in a.data)R.push({lable:a.data[Y],value:Y});k.value=R})},ae=s(!1),se=s(!1),y=s(""),P=s(null);let ie=null;const D=s([]),B=s(0),ye=ve(()=>B.value<=0),fe=a=>{var ue;r("loading",!0);let R={...i,semantic_chunk_model_config_id:i.semantic_chunk_model_config_id?+i.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:i.ai_chunk_model_config_id?+i.ai_chunk_model_config_id:0,...C.pdfState};i.chunk_type==3&&(i.ai_chunk_task_id&&!a&&(R.ai_chunk_task_id=i.ai_chunk_task_id),R.ai_chunk_task_id&&a&&a==="create"&&delete R.ai_chunk_task_id);let Y=Ln;return C.paragraphType&&C.paragraphType==="paragraphsSegmented"&&a=="create"&&(Y=En,delete R.id),C.paragraphType&&C.paragraphType==="paragraphsSegmented"&&!a?(D.value=C.currentData.list||[],C.currentData.list.map(ke=>{B.value+=ke.content.length||0}),i.chunk_type==3&&(y.value=((ue=C.currentData.split_params)==null?void 0:ue.ai_chunk_task_id)||"",se.value=!0,z.value.reLoading=!0,P.value=null,!i.ai_chunk_task_id&&M.value!=1||a&&a==="create"?(D.value=[],B.value=0,qe()):(se.value=!1,z.value.reLoading=!1)),i.chunk_type!=3&&(z.value.reLoading=!1,z.value.saveLoading=!1),r("loading",!1),!1):Y(R).then(ke=>{var Ee;D.value=ke.data.list||[],B.value=ke.data.list.length||0,i.chunk_type==3&&(y.value=((Ee=ke.data.split_params)==null?void 0:Ee.ai_chunk_task_id)||"",se.value=!0,z.value.reLoading=!0,z.value.saveLoading=!0,P.value=null,!i.ai_chunk_task_id&&M.value!=1||a&&a==="create"?(D.value=[],B.value=0,qe()):(se.value=!1,z.value.reLoading=!1,z.value.saveLoading=!1))}).finally(()=>{i.chunk_type!=3&&(z.value.reLoading=!1,z.value.saveLoading=!1),r("loading",!1)})},Oe=a=>{V.value=a},S=async()=>{var a;try{const R=await we();return R.data.err_msg?(P.value=R.data.err_msg,!0):((a=R.data.list)==null?void 0:a.length)>0?(D.value=R.data.list||[],B.value=R.data.list.length||0,!0):!1}catch{return P.value="请求异常，停止轮询",!0}};function be(a){return a.split("message:")[1]}const qe=()=>{const a=async()=>{if(!await S())ie=setTimeout(a,3e3);else if(se.value=!1,z.value.reLoading=!1,z.value.saveLoading=!1,ie!==null&&(clearTimeout(ie),ie=null),ae.value&&le(),P.value){let Y=be(P.value);ge.error({title:"分段失败提示",content:Y?`模型调用失败，失败原因：${Y}`:"模型调用失败"})}};a()},we=()=>On({id:i.id,task_id:y.value}),u=s(null);let d=null;const N=({title:a,content:R,question:Y,answer:ue,images:ke},Ee)=>{d=Ee,u.value.open({title:a,content:R,question:Y,answer:ue,images:ke})},T=({title:a,content:R,question:Y,answer:ue,images:ke})=>{(D.value[d].title!=a||D.value[d].content!=R||D.value[d].question!=Y||D.value[d].answer!=ue)&&(I=!0),D.value[d].title=a,D.value[d].content=R,D.value[d].question=Y,D.value[d].answer=ue,D.value[d].images=ke,D.value[d].word_total=ue.length+Y.length+R.length},re=a=>{ge.confirm({title:"提醒",icon:t(Le),content:"确定要删除这个片段吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){I=!0,D.value.splice(a,1)},onCancel(){}})},K=s(""),G=a=>{K.value=a},ce=s(!1),_=()=>{let a=z.value.formState;a=JSON.parse(JSON.stringify(a)),typeof a.separators_no=="object"&&(a.separators_no=a.separators_no.join(",")),i={...i,...a}},le=async()=>{if((B.value<=0||i.chunk_type!=V.value)&&(_(),await fe()),_(),K.value)return pe.error(K.value);if(i.chunk_type==3&&!D.value.length)return ae.value=!0,!1;y.value&&(i.ai_chunk_task_id=y.value);let a={...i,semantic_chunk_model_config_id:i.semantic_chunk_model_config_id?+i.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:i.ai_chunk_model_config_id?+i.ai_chunk_model_config_id:0,is_table_file:M.value,...C.pdfState};delete a.id;let R={file_id:m,word_total:B.value,split_params:JSON.stringify(a),list:JSON.stringify(D.value),...C.pdfState};a.is_qa_doc==1&&(R.qa_index_type=a.qa_index_type),ce.value=!0,C.paragraphType&&C.paragraphType==="paragraphsSegmented"&&(R.data_id=R.data_ids,delete R.data_ids),Cn(R).then(()=>{r("ok"),r("finish")}).finally(()=>{ce.value=!1}).catch(Y=>{Y.data&&Y.data.index&&xe(Y.data.index),r("finish")})},F=s(null),xe=a=>{a=a-1;let R=F.value.querySelectorAll(".fragment-item");R.length>=a&&R[a].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return Bt(()=>{ie&&(clearTimeout(ie),ie=null)}),oe({handleSaveLibFileSplit:le}),(a,R)=>{const Y=He;return l(),v(_e,null,[h.value?(l(),v("div",Fo,[t(Y)])):H("",!0),n("div",zo,[n("div",No,[n("div",Ao,[t(Yn,{excellQaLists:k.value,libFileInfo:f.value,library_type:p.value,mode:M.value,hideSave:!0,status:"paragraphsSegmented",ref_key:"segmentationSettingRef",ref:z,onChange:te,onChangeChunkType:Oe,onSave:le,onValidate:G},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),n("div",Bo,[n("div",Ho,[n("div",Uo,[Qo,n("span",Jo,"共"+X(B.value)+"个分段",1)]),ye.value&&!se.value?(l(),j(ea,{key:0})):H("",!0),se.value?(l(),v("div",jo,[t(Y),E("数据处理中...")])):H("",!0),n("div",{class:"preview-box",ref_key:"previewBoxRef",ref:F},[(l(!0),v(_e,null,Se(D.value,(ue,ke)=>(l(),v("div",{class:"fragment-item",key:ue.number},[t(ta,{status:"paragraphsSegmented",currentData:x.currentData,number:ue.number,title:ue.title,content:ue.content,total:ue.word_total,question:ue.question,answer:ue.answer,images:ue.images,onDelete:Ee=>re(ke),onEdit:Ee=>N(ue,ke)},null,8,["currentData","number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),t(na,{ref_key:"editFragmentAlertRef",ref:u,onOk:T},null,512)])],64)}}},Xt=$e(Vo,[["__scopeId","data-v-cef98768"]]),Zo={class:"select-box"},Wo=["onClick"],Ko={class:"title"},Xo={class:"desc"},Yo={key:0,class:"card-switch"},el={class:"main-content-box"},tl={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(x,{expose:oe,emit:$}){const U=At(),r=ve(()=>{var B;return((B=U.companyInfo)==null?void 0:B.ali_ocr_switch)=="1"}),m=We().query,h=Ut(),M=x,I=s(!1),C=s(!1),V=s(""),i=$;let z={};const te=s([{title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。",icon:"pdf-ocr",pdf_parse_type:2},{title:"纯文本解析",desc:"只提取Pdf中的文字内容，如果文档为扫描件可能提取不到内容。",icon:"pdf-text",pdf_parse_type:1},{title:"图文解析",desc:"提取PDF文档中的图片和文字",icon:"pdf-img",pdf_parse_type:3}]),L=Ce({pdf_parse_type:2,pdf_page_num:0}),Q=()=>{te.value=te.value.filter(B=>B.pdf_parse_type!=4),i("enable")},f=s(!1),p=B=>{f.value=B},w=B=>{z={...B},L.pdf_parse_type=2,L.pdf_page_num=B.pdf_page_num,B.type==1&&(V.value=`当页(${B.pdf_page_num})重新分段`),B.type==2&&(V.value="将文档重新分段"),B.type==3&&(V.value="重新学习文档",te.value.push({title:"阿里云OCR解析",desc:"通过阿里云文档智能接口解析提取图片和文字",icon:"ali-ocr",pdf_parse_type:4})),I.value=!0},k=()=>{window.open("#/user/aliocr")},O=B=>{if(B.pdf_parse_type==4&&!r.value)return!1;L.pdf_parse_type=B.pdf_parse_type},ae=s(!1),se=()=>{if(z.type==3){if(L.pdf_parse_type==1){h.push("/library/document-segmentation?document_id="+m.id+"&source=preview");return}ae.value=!0,In({id:m.id,pdf_parse_type:L.pdf_parse_type}).then(B=>{pe.success("重新学习成功"),(L.pdf_parse_type==2||L.pdf_parse_type==3||L.pdf_parse_type==4)&&h.push({path:"/library/details/knowledge-document",query:{id:M.detailsInfo.library_id}}),L.pdf_parse_type==1&&h.push("/library/document-segmentation?document_id="+m.id+"&source=preview"),I.value=!1}).finally(()=>{ae.value=!1});return}I.value=!1,C.value=!0},y=s(null),P=()=>{ae.value=!0,y.value.handleSaveLibFileSplit()},ie=()=>{pe.success("保存成功"),C.value=!1,i("ok",z.type)},D=()=>{ae.value=!1};return oe({show:w}),(B,ye)=>{const fe=Ze,Oe=ge;return l(),v("div",null,[t(Oe,{open:I.value,"onUpdate:open":ye[0]||(ye[0]=S=>I.value=S),title:V.value,onOk:se,onCancel:Q,width:720,confirmLoading:ae.value},{default:o(()=>[n("div",Zo,[(l(!0),v(_e,null,Se(te.value,S=>(l(),v("div",{class:Ht(["select-list-item",{active:S.pdf_parse_type==L.pdf_parse_type},{disabled:S.pdf_parse_type==4&&!r.value}]),onClick:be=>O(S),key:S.pdf_parse_type},[n("div",Ko,[t(fe,{name:S.icon,style:{"font-size":"16px"}},null,8,["name"]),E(" "+X(S.title),1)]),n("div",Xo,X(S.desc),1),S.pdf_parse_type==4&&!r.value?(l(),v("div",Yo,[E(" 未开启阿里云OCR "),n("div",{class:"card-switch-btn",onClick:he(k,["stop"])},"去开启")])):H("",!0)],10,Wo))),128))])]),_:1},8,["open","title","confirmLoading"]),t(Oe,{open:C.value,"onUpdate:open":ye[1]||(ye[1]=S=>C.value=S),onCancel:Q,title:V.value,maskClosable:!1,"ok-text":f.value?"文档解析中,请稍候...":"确定",confirmLoading:ae.value||f.value,onOk:P,width:1e3},{default:o(()=>[n("div",el,[C.value?(l(),j(Xt,{key:0,onOk:ie,onFinish:D,onLoading:p,pdfState:L,ref_key:"documentSegmentationModalRef",ref:y},null,8,["pdfState"])):H("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},nl=$e(tl,[["__scopeId","data-v-ed67085d"]]),Xe=x=>(Pe("data-v-b1f3fb5c"),x=x(),De(),x),al={class:"subsection-box"},ol={class:"qa-list-box"},ll={class:"list-item"},sl=Xe(()=>n("div",{class:"list-label"},"问题",-1)),il={class:"list-content"},cl={key:0,class:"list-item"},rl=Xe(()=>n("div",{class:"list-label"},"相似问法",-1)),ul={class:"list-content"},dl={class:"list-item"},_l=Xe(()=>n("div",{class:"list-label"},"答案",-1)),pl={class:"list-content"},fl={class:"fragment-img"},ml=["src"],vl={key:0,class:"status-tag"},hl={key:1,class:"status-tag complete"},gl={class:"status-tag status-error"},kl={key:3,class:"status-tag running"},yl={class:"right-opration"},bl={class:"hover-btn-box"},Sl=["onClick"],wl=Xe(()=>n("div",null,"标记设置",-1)),xl=["onClick"],$l={class:"hover-btn-box"},Cl=["onClick"],Ll=["onClick"],ql={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(x,{expose:oe,emit:$}){const U=$,r=x,m=(L,Q)=>{let{id:f,title:p,content:w,question:k,answer:O,images:ae,category_id:se}=L,y=L.similar_questions||[];ge.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${Q+1}】吗?`,onOk(){return new Promise((P,ie)=>{Ft({id:f,title:p,content:w,question:k,answer:O,images:ae,category_id:se,similar_questions:JSON.stringify(y)}).then(D=>{U("handleConvert",L),P()}).catch(()=>{P()})})},onCancel(){}})},h=L=>{U("openEditSubscription",L)},M=L=>{ge.confirm({title:"提示",icon:t(Le),content:"确认是否删除该分段?",onOk(){return new Promise((Q,f)=>{zt({id:L}).then(p=>{pe.success("删除成功"),U("handleDelParagraph",L),Q()}).catch(()=>{Q()})})},onCancel(){}})},I=s([]),C=()=>{Pt().then(L=>{I.value=L.data||[],U("getStatrList",L.data||[])})};C();const V=s(null),i=()=>{V.value.show()},z=L=>{var f;let Q=(f=I.value.filter(p=>p.id==L.category_id)[0])==null?void 0:f.type;return Q?Ve[Q]:"#F4EA2A"},te=(L,Q={})=>{Dt({id:L.id,category_id:Q.id||0}).then(f=>{pe.success("设置成功"),L.category_id=Q.id})};return oe({handleOpenEditModal:h}),(L,Q)=>{const f=oa,p=Ke,w=He,k=ut,O=rt,ae=dt,se=la,y=it("viewer");return l(),v("div",al,[t(se,{"data-source":x.paragraphLists,pagination:!1},{default:o(()=>[t(f,{key:"id","data-index":"id",width:1148},{title:o(()=>[E("问答（共"+X(r.total)+"个）",1)]),default:o(({record:P})=>[n("div",ol,[n("div",ll,[sl,n("div",il,X(P.question),1)]),P.similar_questions&&P.similar_questions.length?(l(),v("div",cl,[rl,n("div",ul,X(P.similar_questions.join("/")),1)])):H("",!0),n("div",dl,[_l,n("div",pl,X(P.answer),1)]),ct((l(),v("div",fl,[(l(!0),v(_e,null,Se(P.images,(ie,D)=>(l(),v("img",{key:D,src:ie,alt:""},null,8,ml))),128))])),[[y]])])]),_:1}),t(f,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:o(({record:P})=>[P.status==0?(l(),v("span",vl,[t(ee(aa)),E(" 未转换")])):H("",!0),P.status==1?(l(),v("span",hl,[t(ee(Tn)),E(" 已转换")])):H("",!0),P.status==2?(l(),j(p,{key:2,placement:"top"},{title:o(()=>[n("span",null,X(P.errmsg),1)]),default:o(()=>[n("span",null,[n("span",gl,[t(ee(Rn)),E(" 转换异常")])])]),_:2},1024)):H("",!0),P.status==3?(l(),v("span",kl,[t(w,{size:"small"}),E(" 转换中")])):H("",!0)]),_:1}),t(f,{title:"操作",key:"action","data-index":"action",width:120},{default:o(({record:P,index:ie})=>[n("div",yl,[t(ae,null,{overlay:o(()=>[t(O,null,{default:o(()=>[(l(!0),v(_e,null,Se(I.value,D=>(l(),j(k,{key:D.id},{default:o(()=>[n("div",{class:"start-item",onClick:B=>te(P,D)},[t(ee(Ge),{style:Me({color:ee(Ve)[D.type]})},null,8,["style"]),n("div",null,X(D.name||"-"),1)],8,Sl)]),_:2},1024))),128)),t(k,null,{default:o(()=>[n("div",{class:"start-item",onClick:i},[t(ee(Gt)),wl])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",bl,[P.category_id>0?(l(),j(ee(Ge),{key:0,onClick:D=>te(P,{}),style:Me({color:z(P),"font-size":"16px"})},null,8,["onClick","style"])):(l(),j(ee(Jt),{key:1,onClick:D=>te(P,I.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),t(p,null,{title:o(()=>[E("重新转换")]),default:o(()=>[n("div",{class:"hover-btn-box",onClick:D=>m(P,ie)},[t(ee(Vt))],8,xl)]),_:2},1024),t(ae,{placement:"bottomRight"},{overlay:o(()=>[t(O,null,{default:o(()=>[t(k,null,{default:o(()=>[n("div",{onClick:he(D=>h(P),["stop"])},"编辑",8,Cl)]),_:2},1024),t(k,null,{default:o(()=>[n("div",{onClick:he(D=>M(P.id),["stop"])},"删除",8,Ll)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",$l,[t(ee(Zt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),t(jt,{onOk:C,ref_key:"classificationMarkModalRef",ref:V},null,512)])}}},Ol=$e(ql,[["__scopeId","data-v-b1f3fb5c"]]),El={class:"main-content-box"},Il={__name:"segmentation-setting-modal",emits:["ok","enable"],setup(x,{expose:oe,emit:$}){const U=s(!1),r=s("重新分段"),m=$;let h={};const M=Ce({data_ids:0,file_id:0}),I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中",4:"分段失败",10:"分段中"},C=Ce({status:"",errmsg:"",status_text:""}),V=()=>{m("enable")},i=s(!1),z=k=>{i.value=k},te=k=>{U.value=!0,M.data_ids=k.id,M.file_id=k.file_id,C.list=[{content:k.content,number:k.number,title:k.title,word_total:k.word_total,question:k.question,answer:k.answer,images:k.images}],C.status=k.status,C.errmsg=k.errmsg,C.status_text=I[k.status]},L=s(!1),Q=s(null),f=()=>{L.value=!0,Q.value.handleSaveLibFileSplit()},p=()=>{pe.success("保存成功"),U.value=!1,m("ok",h.type)},w=()=>{L.value=!1};return oe({show:te}),(k,O)=>{const ae=ge;return l(),v("div",null,[t(ae,{open:U.value,"onUpdate:open":O[0]||(O[0]=se=>U.value=se),onCancel:V,title:r.value,maskClosable:!1,"ok-text":i.value?"文档解析中,请稍候...":"确定",confirmLoading:L.value||i.value,onOk:f,width:1084},{default:o(()=>[n("div",El,[U.value?(l(),j(Xt,{key:0,onOk:p,onFinish:w,onLoading:z,paragraphType:"paragraphsSegmented",pdfState:M,currentData:C,ref_key:"documentSegmentationModalRef",ref:Q},null,8,["pdfState","currentData"])):H("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},Tl=$e(Il,[["__scopeId","data-v-e57c7bfa"]]),Ye=x=>(Pe("data-v-8f2a7cfe"),x=x(),De(),x),Rl={class:"library-preview-page"},Ml={class:"breadcrumb-block"},Pl={class:"library-line1"},Dl={class:"selct-star-box"},Fl={class:"document-title-block",style:{height:"22px"}},zl={class:"title"},Nl={class:"search-content-block"},Al={class:"preview-box"},Bl=Ye(()=>n("span",null,"添加分段",-1)),Hl={key:0,class:"page-loading-box"},Ul={class:"content-block"},Ql={class:"content-block"},Jl={key:1,class:"pdf-view-box"},jl={key:0,class:"pdf-mode-switch"},Gl={key:0},Vl={key:1,class:"segmentation-btn"},Zl=Ye(()=>n("div",null,"将当页重新分段",-1)),Wl=Ye(()=>n("div",null,"将文档重新分段",-1)),Kl=Ye(()=>n("div",null,"重新学习文档",-1)),Xl={class:"view-content-box",style:{"padding-top":"60px"}},Yl=["onClick"],es={key:0,class:"content-box"},ts={key:1,class:"content-box"},ns=["innerHTML"],as={class:"fragment-img"},os=["src"],ls={class:"right-contnt-box"},ss={key:0,class:"right-tabs-box"},is={class:"content-block"},cs="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",rs={__name:"library-preview",setup(x){const oe=At(),$=ve(()=>{var e;return((e=oe.companyInfo)==null?void 0:e.neo4j_status)=="true"}),U=s(!1),r=s(null),m=s(0),h=s(0),M={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I=s([]),C=e=>{I.value=e},V=s({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),i=We(),z=Ut(),te=Mn(),L=ve(()=>w.value.is_table_file=="1"),Q=ve(()=>w.value.doc_type),f=ve(()=>{let e=w.value.status;return!(e=="1"||e=="2")||S.value.length==0}),p=ve(()=>w.value.is_qa_doc=="1"),w=s({}),k=Ce({status:-1,graph_status:-1,category_id:-1}),O=s(1),ae=ve(()=>"/manage/getLibRawFile?id="+i.query.id+"&token="+te.getToken),se=()=>{z.back()},y=s(null),P=s(null);let ie=-1;const D=(e,c=1)=>{let g,q;c==1?(g=".subsection-box .list-item",q=P.value):(g=".view-content-box .list-item",q=y.value);const A=document.querySelectorAll(g)[e];A.classList.add("flash-border"),ie>=0&&document.querySelectorAll(g)[ie].classList.remove("flash-border"),setTimeout(()=>{ie=-1,A.classList.remove("flash-border")},2500),ie=e,q.scrollToElement({el:A,time:1e3})},B=s(!0),ye=s(0),fe=s({page:1,size:10}),Oe=s({}),S=s([]),be=s(0),qe={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},we=Ce({split_status_exception:0,total:0,vector_status_converted:0,vector_status_converting:0,vector_status_exception:0,vector_status_initial:0}),u=Ce([{value:-1,label:"全部",num:ve(()=>we.total)},{value:4,label:"分段失败",num:ve(()=>we.split_status_exception)},{value:0,label:"未转换",num:ve(()=>we.vector_status_initial)},{value:3,label:"转换中",num:ve(()=>we.vector_status_converting)},{value:2,label:"转换异常",num:ve(()=>we.vector_status_exception)},{value:1,label:"已转换",num:ve(()=>we.vector_status_converted)}]),d=s(1);let N={id:i.query.id,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:cs,ai_chunk_task_id:""};const T=s(!1);let re=!0;(async()=>{Nt({id:i.query.id}).then(e=>{ye.value=e.data.library_type,w.value={...e.data,graph_switch:e.data.graph_switch=="1"&&$.value};let c=e.data.status;c==1||c==2?xe():B.value=!1,N={...N,separators_no:e.data.separators_no||"11,12",chunk_size:+e.data.chunk_size||512,ai_chunk_size:+e.data.ai_chunk_size||5e3,chunk_overlap:+e.data.chunk_overlap||50,is_qa_doc:ye.value==2?1:0,question_lable:e.data.question_lable,similar_label:e.data.similar_label,answer_lable:e.data.answer_lable,question_column:e.data.question_column,similar_column:e.data.similar_column,answer_column:e.data.answer_column,enable_extract_image:e.data.enable_extract_image=="true",qa_index_type:+e.data.qa_index_type,chunk_type:+e.data.chunk_type,semantic_chunk_size:+e.data.semantic_chunk_size||512,semantic_chunk_overlap:+e.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+e.data.semantic_chunk_threshold||90,semantic_chunk_use_model:e.data.semantic_chunk_use_model||"",ai_chunk_prumpt:e.data.ai_chunk_prumpt||"",ai_chunk_model:e.data.ai_chunk_model||"",semantic_chunk_model_config_id:e.data.semantic_chunk_model_config_id>0?e.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:e.data.ai_chunk_model_config_id>0?e.data.ai_chunk_model_config_id:"",ai_chunk_task_id:e.data.ai_chunk_task_id||""},e.data.chunk_type==0&&(N={...N,separators_no:e.data.normal_chunk_default_separators_no,chunk_size:+e.data.normal_chunk_default_chunk_size,chunk_overlap:+e.data.normal_chunk_default_chunk_overlap,chunk_type:+e.data.default_chunk_type,semantic_chunk_size:+e.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+e.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+e.data.semantic_chunk_default_threshold,semantic_chunk_use_model:e.data.default_use_model||"",semantic_chunk_model_config_id:e.data.default_model_config_id>0?e.data.default_model_config_id:""}),(c==4||c==2)&&(d.value=parseInt(e.data.is_table_file))})})();const G=()=>{Pn({file_id:i.query.id}).then(e=>{Object.assign(we,e.data)})},ce=()=>{window.location.reload()},_=()=>{fe.value.page=1,be.value=0,S.value=[],xe()},le=e=>{k.category_id=e,_()},F=(e=null)=>{fe.value.page++,xe(e)},xe=(e=null)=>{re=!0,Et({file_id:i.query.id,...fe.value,...k}).then(c=>{var b,J;B.value=!1,re=!1;let g=c.data,q=g.list||[],A=((b=g.info)==null?void 0:b.is_qa_doc)=="1"&&((J=g.info)==null?void 0:J.is_table_file)=="1";q.forEach(me=>{me.status_text=qe[me.status],me.graph_status_text=M[me.graph_status],me.isExcelQa=A,me.similar_questions&&(me.similar_questions=JSON.parse(me.similar_questions))}),Oe.value=g.info,fe.value.page==1&&(S.value=[]),S.value=[...S.value,...q],be.value=g.total,typeof e=="function"&&e()})},a=()=>{re||S.value.length>=be.value||(F(),r.value&&r.value.loadMore())},R=()=>{ke()};let Y=null;function ue(){clearInterval(Y),S.value.filter(c=>c.status==3).length?Y=setInterval(()=>{ke()},5e3):clearInterval(Y)}const ke=()=>{Et({file_id:i.query.id,page:1,size:S.value.length,...k}).then(e=>{var A,b;let c=e.data,g=c.list||[],q=((A=c.info)==null?void 0:A.is_qa_doc)=="1"&&((b=c.info)==null?void 0:b.is_table_file)=="1";g.forEach(J=>{J.status_text=qe[J.status],J.graph_status_text=M[J.graph_status],J.isExcelQa=q,J.similar_questions&&(J.similar_questions=JSON.parse(J.similar_questions))}),S.value=g,ue()})},Ee=e=>{if(!e.id){fe.value.page=1,xe();return}let c=S.value,g=c.findIndex(q=>q.id==e.id);if(g>-1){let q=c[g];q.title=e.title,q.content=e.content,q.question=e.question,q.answer=e.answer,q.images=e.images,q.category_id=e.category_id,q.word_total=e.question.length+e.answer.length+e.content.length,q.similar_questions=e.similar_questions.length?JSON.parse(e.similar_questions):[],c.splice(g,1,q),S.value=c}},et=e=>{let c=S.value,g=c.findIndex(q=>q.id==e);g>-1&&(c.splice(g,1),S.value=c,be.value=be.value--)},pt=s(null),Re=e=>{pt.value.showModal(JSON.parse(JSON.stringify(e)))},ft=s(null),Yt=()=>{Dn({id:i.query.id}).then(()=>pe.success("操作完成"))},en=()=>{Fn({id:i.query.id}).then(()=>pe.success("操作完成"))},mt=s(null),tn=()=>{mt.value.show(w.value)},vt=()=>{z.push("/library/document-segmentation?document_id="+i.query.id+"&source=preview")},nn=()=>{ft.value.open({id:i.query.id,doc_auto_renew_frequency:w.value.doc_auto_renew_frequency})},an=e=>{w.value.doc_auto_renew_frequency=e},on=e=>{w.value.file_name=e},ln=e=>{const c=()=>{for(let g in S.value)if(S.value[g].page_num==e){D(g);return}};if(e>S.value[S.value.length-1].page_num){pe.warning("分段数据正在加载，请稍后...");const g=()=>{e<=S.value[S.value.length-1].page_num?(pe.success("加载完成"),je(()=>{c()})):F(g)};F(g)}else c()},sn=(e,c)=>{h.value=c,m.value=e,S.value[S.value.length-1].page_num<e&&F()},ht=e=>{var c;if(((c=w.value)==null?void 0:c.file_ext)=="pdf"&&O.value==1){const g=e.page_num-1,q=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[g],A=()=>{const J=q();J.classList.add("flash-border"),setTimeout(()=>J.classList.remove("flash-border"),2500),r.value.getScrollInstance().scrollToElement({el:J,time:1e3})};if(q())A();else{pe.warning("PDF正在加载，请稍后...");const J=()=>{q()?(pe.success("加载完成"),A()):r.value&&r.value.loadMore()};r.value&&r.value.loadMore(J)}}else D(e.index,2)},tt=s(1);let nt=null;const Qe=s(0),cn=e=>{Qe.value=e},rn=({y:e})=>{if(!nt){const g=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];nt=g&&g.clientHeight}let c=Math.floor(Math.abs(e)/nt)+1;tt.value=Math.max(c,1)},at=s(null),ot=s(null),un=e=>{let{key:c}=e;r.value&&r.value.getScrollInstance().disable(),c==1&&at.value.show({type:c,pdf_page_num:tt.value}),c==2&&vt(),c==3&&at.value.show({type:c,pdf_page_num:0})},gt=e=>{ot.value&&ot.value.show(e)},kt=()=>{r.value&&r.value.getScrollInstance().enable()},dn=()=>{kt(),_()},yt=()=>{U.value=!U.value},lt=(e,c)=>{let g=JSON.parse(JSON.stringify(e));return g.content=c,g.word_total=c.length,g},Ie=s(!1),Te=s(1),bt=({index:e,beforeContent:c,selectedContent:g,afterContent:q,isFullSelection:A})=>{const b=[...S.value];Ie.value=A,Te.value=1,A?(b.splice(e+1,0,lt(b[e],g)),b.splice(e,1)):(b[e].content=c||"",b[e].word_total=c.length||0,q.trim()&&b.splice(e+1,0,lt(b[e],q)),b.splice(e+1,0,lt(b[e],g)),b[e+1].images=[]),S.value=b,Fe(b,e)},St=({index:e,beforeContent:c,selectedContent:g,afterContent:q,isFullSelection:A})=>{const b=[...S.value];Ie.value=A,Te.value=2,A?(b[e+1].content=g+b[e+1].content,b[e+1].word_total+=g.length,b.splice(e,1),S.value=b,Fe(b,e)):(b[e].content=c||"",b[e].word_total=c.length||0,b[e+1].content=g+b[e+1].content,q.trim()&&(b[e].content+=q||"",b[e].word_total+=q.length||0),S.value=b,Fe(b,e+1))},wt=({index:e,beforeContent:c,selectedContent:g,afterContent:q,isFullSelection:A})=>{const b=[...S.value];Ie.value=A,Te.value=3,A?(b[e-1].content+=g,b[e-1].word_total+=g.length,b.splice(e,1),S.value=b,Fe(b,e)):(b[e].content=c||"",b[e].word_total=c.length||0,b[e-1].content+=g,q.trim()&&(b[e].content+=q||"",b[e].word_total+=q.length||0),S.value=b,Fe(b,e-1))},xt=({index:e,beforeContent:c,afterContent:g,isFullSelection:q})=>{const A=[...S.value];Ie.value=q,Te.value=4,q?A.splice(e,1):(A[e].content=c||"",A[e].word_total=c.length||0,g.trim()&&(A[e].content+=g||"",A[e].word_total+=g.length||0)),S.value=A,Fe(A,e)};function _n(e,c,g={},q){let A=q+1;if(!Array.isArray(e)||!Array.isArray(c))return JSON.stringify([]);const b=e.map((J,me)=>{const Z={};for(const W of c){const Ne=g[W]||W,de=J[Ne];if(Object.prototype.hasOwnProperty.call(J,Ne))if(W==="number")Z[W]=me+1;else if(W==="page_num"||W==="word_total")Z[W]=+de;else if(W==="content"){if(!de)return null;Z[W]=de}else W==="images"?Te.value==1?Ie.value?(A==Z.number,Z[W]=de):A+1==Z.number?Z[W]=[]:Z[W]=de:Te.value==2?(Ie.value,A==Z.number,Z[W]=de):Te.value==3?Ie.value?(A-1==Z.number,Z[W]=de):(A==Z.number,Z[W]=de):Te.value==4&&(Ie.value,Z[W]=de):Z[W]=de}return Z}).filter(J=>J!==null&&J.content!==void 0&&J.content!=="");return JSON.stringify(b)}const pn={similar_question_list:"similar_questions"},Fe=async(e,c)=>{let g={...N,semantic_chunk_model_config_id:N.semantic_chunk_model_config_id?+N.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:N.ai_chunk_model_config_id?+N.ai_chunk_model_config_id:0,is_table_file:d.value};delete g.id;let q={id:i.query.id,word_total:be.value,split_params:JSON.stringify(g),list:_n(e,["number","page_num","title","content","question","similar_question_list","answer","word_total","images"],pn,c)};g.is_qa_doc==1&&(q.qa_index_type=g.qa_index_type),T.value=!0,zn(q).then(A=>{pe.success("操作成功");const b=A.data;for(let J=0;J<b.length;J++){const me=b[J],Z=S.value[J];if(J<S.value.length)Z.id=me.toString(),Z.status="0",Z.status_text=qe[Z.status];else break}}).finally(()=>{T.value=!1})};return Be(()=>{G(),i.query.graph_status&&(k.graph_status=i.query.graph_status,_())}),(e,c)=>{var Ct,Lt,qt;const g=Nn("router-link"),q=ia,A=sa,b=Ze,J=Mt,me=Kt,Z=Wt,W=ut,Ne=rt,de=dt,fn=ra,mn=He,Je=Ke,$t=pa,vn=_a,hn=da,gn=ua,kn=it("viewer");return l(),v("div",Rl,[n("div",Ml,[t(A,null,{default:o(()=>[t(q,null,{default:o(()=>[t(g,{to:"/library/list"},{default:o(()=>[E(" 知识库管理 ")]),_:1})]),_:1}),t(q,null,{default:o(()=>[t(g,{to:{path:"/library/details/knowledge-document",query:{id:w.value.library_id}}},{default:o(()=>[n("div",Pl,X(w.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),t(q,null,{default:o(()=>[E("知识库详情")]),_:1})]),_:1}),n("div",Dl,[t(Bn,{startLists:I.value,onChange:le},null,8,["startLists"])])]),n("div",Fl,[t(ee(ca),{onClick:se}),n("span",zl,X(w.value.file_name),1),t(Io,{detailsInfo:w.value},null,8,["detailsInfo"])]),n("div",Nl,[n("div",Al,[U.value?(l(),j(J,{key:1,onClick:c[1]||(c[1]=ne=>yt())},{default:o(()=>[t(b,{class:"preview-box-icon",name:"expand"}),E(" 展开预览")]),_:1})):(l(),j(J,{key:0,onClick:c[0]||(c[0]=ne=>yt())},{default:o(()=>[t(b,{class:"preview-box-icon",name:"put-away"}),E(" 收起预览")]),_:1}))]),t(fn,null,{default:o(()=>[p.value?(l(),j(Z,{key:0,value:k.status,"onUpdate:value":c[2]||(c[2]=ne=>k.status=ne),placeholder:"请选择",style:{width:"160px"},onChange:_},{default:o(()=>[t(me,{value:-1},{default:o(()=>[E("全部嵌入状态")]),_:1}),(l(),v(_e,null,Se(qe,(ne,ze)=>t(me,{key:ne,value:ze},{default:o(()=>[E(X(ne),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):H("",!0),w.value.graph_switch?(l(),j(Z,{key:1,value:k.graph_status,"onUpdate:value":c[3]||(c[3]=ne=>k.graph_status=ne),placeholder:"请选择",onChange:_,style:{width:"160px"}},{default:o(()=>[t(me,{value:-1},{default:o(()=>[E("全部知识图谱状态")]),_:1}),(l(),v(_e,null,Se(M,(ne,ze)=>t(me,{key:ne,value:ze},{default:o(()=>[E(X(ne),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):H("",!0),t(de,null,{overlay:o(()=>[t(Ne,null,{default:o(()=>[t(W,{onClick:Yt},{default:o(()=>[E("重新嵌入向量")]),_:1}),w.value.graph_switch?(l(),j(W,{key:0,onClick:en},{default:o(()=>[E("重新抽取知识图谱")]),_:1})):H("",!0),t(W,{onClick:tn},{default:o(()=>[E("重命名")]),_:1}),Q.value==2?(l(),j(W,{key:1,onClick:nn},{default:o(()=>[E("设置更新频率")]),_:1})):H("",!0)]),_:1})]),default:o(()=>[t(J,null,{default:o(()=>[E("其他操作 "),t(ee(Tt))]),_:1})]),_:1}),Q.value!=3?(l(),j(J,{key:2,onClick:vt},{default:o(()=>[E("重新分段")]),_:1})):H("",!0),t(J,{onClick:c[4]||(c[4]=ne=>Re({})),type:"primary"},{icon:o(()=>[t(ee(Qt))]),default:o(()=>[Bl]),_:1})]),_:1})]),B.value?(l(),v("div",Hl,[t(mn)])):(l(),v(_e,{key:1},[p.value?(l(),v(_e,{key:0},[f.value?(l(),j(st,{key:0,onOpenEditSubscription:Re})):(l(),j(Ae,{key:1,scrollbar:{minSize:0},onOnScrollEnd:a},{default:o(()=>[n("div",Ul,[t(Ol,{ref:"subsectionBoxRef",total:be.value,paragraphLists:S.value,detailsInfo:w.value,onOpenEditSubscription:Re,onHandleDelParagraph:et,onHandleConvert:R,onGetStatrList:C},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(l(),v(_e,{key:1},[L.value||Q.value==3?(l(),v(_e,{key:0},[f.value?(l(),j(st,{key:0,onOpenEditSubscription:Re})):(l(),j(Ae,{key:1,scrollbar:{minSize:0},onOnScrollEnd:a,disableMouse:!0},{default:o(()=>[n("div",Ql,[t(Rt,{ref:"subsectionBoxRef",total:be.value,detailsInfo:w.value,paragraphLists:S.value,onOpenEditSubscription:Re,onHandleDelParagraph:et,onHandleConvert:R,onHandleScrollTargetPage:ht,onGetStatrList:C,onHandleSplit:bt,onHandleSplitNext:St,onHandleSplitUp:wt,onHandleSplitDelete:xt,onHandleSegmentation:gt},null,8,["total","detailsInfo","paragraphLists"])])]),_:1}))],64)):(l(),v("div",Jl,[n("div",{class:Ht(["view-content-wrap",{collapsed:U.value}])},[((Ct=w.value)==null?void 0:Ct.file_ext)=="pdf"?(l(),v("div",jl,[t(vn,{value:O.value,"onUpdate:value":c[5]||(c[5]=ne=>O.value=ne)},{default:o(()=>[t($t,{value:1},{default:o(()=>[t(Je,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:o(()=>[E(" 原文预览 "),O.value==1&&Qe.value>0?(l(),v("span",Gl,"("+X(tt.value)+" / "+X(Qe.value)+")",1)):H("",!0)]),_:1})]),_:1}),t($t,{value:2},{default:o(()=>[E("纯文本预览")]),_:1})]),_:1},8,["value"])])):H("",!0),((Lt=w.value)==null?void 0:Lt.file_ext)=="pdf"?(l(),v("div",Vl,[t(de,null,{overlay:o(()=>[t(Ne,{onClick:un},{default:o(()=>[O.value==1&&Qe.value>0?(l(),j(W,{key:1},{default:o(()=>[t(Je,{placement:"right",title:"将当前页重新解析并分段"},{default:o(()=>[Zl]),_:1})]),_:1})):H("",!0),(l(),j(W,{key:2},{default:o(()=>[t(Je,{placement:"right",title:"将整个文档重新分段，注意，重新分段并不会重新提取文档的内容，只是将内容重新分段。"},{default:o(()=>[Wl]),_:1})]),_:1})),(l(),j(W,{key:3},{default:o(()=>[t(Je,{placement:"right",title:"将整个文档重新学习，包含重新解析并提取文档内容，重新分段。"},{default:o(()=>[Kl]),_:1})]),_:1}))]),_:1})]),default:o(()=>[t(J,null,{default:o(()=>[E(" 重新分段 "),t(ee(Tt))]),_:1})]),_:1})])):H("",!0),((qt=w.value)==null?void 0:qt.file_ext)=="pdf"&&O.value==1?(l(),j(Po,{key:2,ref_key:"pdfRef",ref:r,class:"scroll-box pdf-render-box",source:ae.value,onSelect:ln,onScroll:rn,onRendered:sn,onGetTotalPage:cn},null,8,["source"])):(l(),j(Ae,{key:3,scrollbar:V.value,ref_key:"leftScrollRef",ref:y,class:"scroll-box",onOnScrollEnd:a},{default:o(()=>[n("div",Xl,[(l(!0),v(_e,null,Se(S.value,(ne,ze)=>(l(),v("div",{class:"list-item",onClick:Ot=>D(ze),key:ze},[ne.question?(l(),v("div",es,X(ne.question),1)):H("",!0),ne.answer?(l(),v("div",ts,X(ne.answer),1)):H("",!0),n("div",{class:"content-box",innerHTML:ne.content},null,8,ns),ct((l(),v("div",as,[(l(!0),v(_e,null,Se(ne.images,(Ot,yn)=>(l(),v("img",{key:yn,src:Ot,alt:""},null,8,os))),128))])),[[kn]])],8,Yl))),128))])]),_:1},8,["scrollbar"]))],2),n("div",ls,[p.value?H("",!0):(l(),v("div",ss,[t(gn,{activeKey:k.status,"onUpdate:activeKey":c[6]||(c[6]=ne=>k.status=ne),style:{"background-color":"#f2f4f7",padding:"0px 16px","border-radius":"6px"},onChange:_},{default:o(()=>[(l(!0),v(_e,null,Se(u,ne=>(l(),j(hn,{key:ne.value,tab:`${ne.label} (${ne.num})`},null,8,["tab"]))),128))]),_:1},8,["activeKey"])])),f.value?(l(),j(st,{key:1,onOpenEditSubscription:Re})):(l(),j(Ae,{key:2,scrollbar:V.value,disableMouse:!0,ref_key:"rightScrollRef",ref:P,onOnScrollEnd:a},{default:o(()=>[n("div",is,[t(Rt,{ref:"subsectionBoxRef",total:be.value,detailsInfo:w.value,paragraphLists:S.value,onOpenEditSubscription:Re,onHandleDelParagraph:et,onHandleConvert:R,onHandleScrollTargetPage:ht,onGetStatrList:C,onHandleSplit:bt,onHandleSplitNext:St,onHandleSplitUp:wt,onHandleSplitDelete:xt,onHandleSegmentation:gt},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),t(Hn,{detailsInfo:w.value,onHandleEdit:Ee,ref_key:"editSubscriptionRef",ref:pt},null,8,["detailsInfo"]),t(To,{onOk:an,ref_key:"updateFrequencyRef",ref:ft},null,512),t(Xn,{onOk:on,ref_key:"renameModalRef",ref:mt},null,512),t(nl,{onOk:dn,onEnable:kt,detailsInfo:w.value,ref_key:"reSegmentationPageRef",ref:at},null,8,["detailsInfo"]),t(Tl,{ref_key:"segmentationSettingModalRef",ref:ot,onOk:ce},null,512)])}}},Di=$e(rs,[["__scopeId","data-v-8f2a7cfe"]]);export{Di as default};
