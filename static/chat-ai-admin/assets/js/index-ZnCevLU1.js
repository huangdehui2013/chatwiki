import{b as E,d as Q,B as ee,ab as he,k as O,M as be,a1 as ye,dO as te,h as ge,dP as ke,dQ as xe,dh as we,bZ as Se}from"../../index-BYXP5-K6.js";import{B as T,d as H,e as x,w as $e,x as Y,M as f,N as i,W as t,k as e,S as o,Q as P,a7 as z,Y as k,F as W,a0 as ae,Z as I,a1 as oe,a2 as se,b as le,a8 as Ce,a6 as Le,G as De,H as Ie,u as q,z as Ue,$ as K,a4 as Re,aa as Me,p as X}from"./vue-chunks-DKljrDvA.js";import{C as Oe}from"./config-page-menu-C2-Rf4YW.js";import{u as Pe}from"./index-B6tAcODo.js";import"./index-BNZqkHuq.js";import{_ as re,R as ne}from"./RadioButton-D6KxmP_c.js";import{S as ze,a as Be}from"./index-ChLzCBr1.js";import{_ as Fe}from"./index-CcC8Vz_q.js";import{I as je}from"./Input-Bfzy8tJK.js";import{_ as ie,F as ce}from"./index-DvGRcWf4.js";import{B as V,P as Ae,S as Te,M as Ne}from"./pull-up.esm-D94Swpvl.js";import{d as _e}from"./role_avatar-DL0r08JY.js";import{A as ue}from"./index-MtM9MNDA.js";import{P as Ve}from"./PlusOutlined-wIhQX_dJ.js";import"./index-CYLnLfoe.js";import{D as qe}from"./dropdown-QXBOTlLU.js";import{D as We}from"./DownOutlined-BfzuAtqc.js";import{M as Ee,_ as He}from"./index-DcQhmA5K.js";import{S as Qe}from"./index-BRcNjiSH.js";import{_ as Ye}from"./index-BbQZiPUc.js";import{a as Ze}from"./index-DHPFv2fi.js";import"./axios-BZ84_VUH.js";import"./qs-DB0tj3pA.js";import"./crypto-js-fJpLWOEv.js";import"./dayjs-BpZi_McX.js";import"./FormItemContext-BbeLgxF6.js";import"./Checkbox-DoUvt9dJ.js";import"./Trigger-DAizGHX4.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-DxTO0j69.js";import"./slide-C8pAsQDb.js";import"./index-2d7y8GiQ.js";import"./CheckOutlined-tNTNjiBd.js";import"./SearchOutlined-BAHqMa3J.js";import"./move-BNsvENtF.js";import"./Search-1aGcXLAr.js";import"./isPlainObject-BRAWLrZZ.js";import"./inputProps-B3PFVydJ.js";import"./TextArea-Dnm7usWJ.js";import"./Password-CPQYqxS0.js";import"./responsiveObserve-DRuL2_me.js";import"./collapseMotion-CxHtxgWr.js";import"./index-C9HKvTtP.js";import"./colors-BsGfXzR0.js";import"./QuestionCircleOutlined-DYrN9KdY.js";import"./index-CHnEDbAe.js";import"./useMaxLevel-C1O2TwYp.js";import"./CaretDownFilled-BzXYTSEq.js";import"./index-Did3xK-p.js";import"./index-cp-3f9TC.js";import"./RightOutlined-D_XHCIbp.js";import"./shallowequal-CthuG9FU.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-B7oz8JPj.js";import"./LeftOutlined-Dpm3sl41.js";import"./index-CkWGTpL1.js";import"./CaretDownOutlined-DGGt9FQx.js";const Z=h=>(oe("data-v-4dd4332d"),h=h(),se(),h),Ge={class:"form-box"},Je={class:"form-box-header"},Ke={class:"form-box-label"},Xe=Z(()=>t("span",{class:"form-box-label-text"},"访问权限",-1)),et=Z(()=>t("div",null,null,-1)),tt={class:"share-url-box"},at=Z(()=>t("div",null,[t("a",{href:"/#/user/domain"},"添加自定义域名")],-1)),ot={__name:"permissions-form",props:{value:{type:Object,default:()=>({})},saveLoading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(h,{emit:U}){const{toClipboard:L}=Pe(),m=U,$=h,s=T({access_rights:"0",share_url:void 0,library_key:""}),p=H(()=>s.share_url+"/open/home/"+s.library_key),b=()=>{m("submit",s)},a=x([]),_=()=>{he().then(c=>{a.value=c.data||[],s.share_url||(a.value.length>0?s.share_url=a.value[0].url:s.share_url=window.location.origin)})},R=c=>{s.access_rights=c.access_rights,s.share_url=c.share_url,s.library_key=c.library_key,(a.value.length==0||!s.share_url)&&_()},B=async()=>{s.share_url||O.error("请选择自定义域名");let c=p.value;try{await L(c),O.success("复制成功")}catch{O.error("复制失败")}};return $e($.value,c=>{R({...c})}),Y(()=>{_()}),(c,D)=>{const y=Q,C=ne,r=re,l=ie,g=Be,u=ze,F=je,M=Fe,j=ee,A=ce;return i(),f("div",Ge,[t("div",Je,[t("div",Ke,[e(y,{name:"auth",style:{"font-size":"14px",color:"#333"}}),Xe]),et]),e(A,{"label-col":{span:4},style:{width:"750px"}},{default:o(()=>[e(l,{label:"访问权限"},{default:o(()=>[e(r,{value:s.access_rights,"onUpdate:value":D[0]||(D[0]=w=>s.access_rights=w),onChange:b},{default:o(()=>[e(C,{value:"0"},{default:o(()=>[k("私有，仅能与应用关联，作为应用知识库")]),_:1}),e(C,{value:"1"},{default:o(()=>[k("公开，发布到互联网，所有人可访问")]),_:1})]),_:1},8,["value"])]),_:1}),s.access_rights==1?(i(),P(l,{key:0,label:"分享链接"},{default:o(()=>[t("div",tt,[e(M,{compact:"",style:{width:"460px"}},{default:o(()=>[e(u,{style:{width:"45%"},value:s.share_url,"onUpdate:value":D[1]||(D[1]=w=>s.share_url=w),placeholder:"请选择自定义域名",onChange:b},{default:o(()=>[(i(!0),f(W,null,ae(a.value,w=>(i(),P(g,{value:w.url,key:w.id},{default:o(()=>[k(I(w.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e(F,{disabled:!0,value:"/open/home/"+s.library_key,style:{width:"55%"}},null,8,["value"])]),_:1}),e(j,{class:"copy-btn",onClick:B},{default:o(()=>[k("复制")]),_:1})]),at]),_:1})):z("",!0)]),_:1})])}}},st=E(ot,[["__scopeId","data-v-4dd4332d"]]),lt={class:"form-box"},rt={class:"collaborator-list-tip"},nt={class:"list-content"},it={class:"collaborator-grid"},ct=["onClick"],_t={class:"user-info"},ut={class:"user-details"},dt={class:"user-name"},pt={class:"user-nickname"},mt={key:0,class:"loading-more"},vt={key:1,class:"no-more"},ft={__name:"add-collaborator",props:{excludedIds:{type:Array,default:()=>[]}},emits:["ok"],setup(h,{expose:U,emit:L}){V.use(Ae),V.use(Te),V.use(Ne);const m=L,$=h,s=le("libraryState",{}),p=x(!1),b=x(null),a=x(!1),_=T({permission:"2",collaborators:[]}),R={permission:[{required:!0,message:"请选择协作权限"}],collaborators:[{required:!0,message:"请选择协作者",type:"array",min:1}]},B=n=>{let d=_.collaborators.indexOf(n.id);d>-1?_.collaborators.splice(d,1):_.collaborators.push(n.id)},c=x([]),D=H(()=>c.value.filter(n=>!$.excludedIds.includes(n.id))),y=T({page:1,size:20,total:0,search:""}),C=x(null),r=x(!1),l=x(!1);let g=x(null);const u=()=>{if(g.value){g.value.refresh();return}g.value=new V(C.value,{probeType:2,click:!0,scrollY:!0,bounce:!1,pullUpLoad:!0,scrollbar:{fade:!1,interactive:!0},mouseWheel:{speed:20,invert:!1,easeTime:300}}),g.value.on("pullingUp",F)},F=async()=>{r.value||l.value||(y.page=y.page+1,r.value=!0,await M(),g.value.finishPullUp(),r.value=!1)},M=async()=>{let n={page:y.page,size:y.size,search:y.search};return ye(n).then(d=>{let v=d.data.list||[];return y.page==1?c.value=c.value=v:c.value=c.value.concat(v),y.total=+d.data.total,c.value.length>=y.total&&(l.value=!0),Ue(()=>{g.value&&g.value.refresh()}),d})},j=()=>{let n={operate_rights:_.permission,user_ids:_.collaborators.join(","),type:1,library_key:s.library_key};a.value=!0,te(n).then(()=>{p.value=!1,a.value=!1,m("ok",n),O.success("添加成功")}).catch(()=>{a.value=!1})},A=async()=>{var n;try{await((n=b.value)==null?void 0:n.validate()),j()}catch(d){console.error("表单验证失败:",d)}},w=()=>{var n;(n=b.value)==null||n.resetFields(),p.value=!1};return U({open:()=>{var n;p.value=!0,(n=b.value)==null||n.resetFields(),y.page=1,M(),setTimeout(()=>{u()},200)}}),(n,d)=>{const v=ne,N=re,J=ie,de=Ce("RouterLink"),pe=Q,me=ue,ve=ce,fe=be;return i(),P(fe,{open:p.value,"onUpdate:open":d[1]||(d[1]=S=>p.value=S),title:"添加协作者",width:"760px",confirmLoading:a.value,onOk:A,onCancel:w},{default:o(()=>[t("div",lt,[e(ve,{layout:"vertical",model:_,rules:R,ref_key:"formRef",ref:b},{default:o(()=>[e(J,{name:"permission",label:"协作权限"},{default:o(()=>[e(N,{value:_.permission,"onUpdate:value":d[0]||(d[0]=S=>_.permission=S)},{default:o(()=>[e(v,{value:"4"},{default:o(()=>[k("可管理")]),_:1}),e(v,{value:"2"},{default:o(()=>[k("可编辑")]),_:1})]),_:1},8,["value"])]),_:1}),e(J,{name:"collaborators",label:"协作者"},{default:o(()=>[t("div",rt,[k(" 如果协作者没有账号，请先到团队管理中添加账号 "),e(de,{to:"/user/manage",target:"_blank"},{default:o(()=>[k("去添加")]),_:1})]),t("div",{class:"collaborator-list",ref_key:"listRef",ref:C},[t("div",nt,[t("div",it,[(i(!0),f(W,null,ae(D.value,S=>(i(),f("div",{class:Le(["collaborator-item",{active:_.collaborators.includes(S.id)}]),key:S.id,onClick:Tt=>B(S)},[De(e(pe,{name:"check-arrow-filled",class:"check-icon"},null,512),[[Ie,_.collaborators.includes(S.id)]]),t("div",_t,[e(me,{class:"user-avatar",src:S.avatar||q(_e)},null,8,["src"]),t("div",ut,[t("div",dt,I(S.user_name),1),t("div",pt,I(S.nick_name),1)])])],10,ct))),128))]),r.value?(i(),f("div",mt,"加载中...")):z("",!0),l.value?(i(),f("div",vt,"没有更多了")):z("",!0)])],512)]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},ht=E(ft,[["__scopeId","data-v-49f98487"]]),bt=h=>(oe("data-v-bd0b2d18"),h=h(),se(),h),yt={class:"collaborator-list-box"},gt={class:"list-tools-box"},kt={class:"list-label"},xt={class:"label-text"},wt={class:"tools-box-right"},St={class:"list-box"},$t={key:0,class:"name-cell"},Ct={class:"user-info"},Lt={class:"username"},Dt={class:"nickname"},It={key:0,class:"role-cell"},Ut={key:1,class:"role-cell"},Rt=bt(()=>t("a",{href:"#"},"移除",-1)),Mt={key:1},Ot={__name:"collaborator-list",setup(h){const U=ge(),L=le("libraryState",{}),m=x(null),$=[{title:"姓名",key:"name",width:"40%"},{title:"角色",dataIndex:"role",key:"role",width:"40%"},{title:"操作",key:"action",width:"20%"}],s={4:{label:"可管理",value:"4"},2:{label:"可编辑",value:"2"}},p=T({current:1,pageSize:999,total:0}),b=x([]),a=H(()=>b.value.map(r=>r.user_id)),_=(r,l)=>{l.operate_rights=r.key*1,l.operate_rights_label=s[l.operate_rights].label||"",R(l)},R=r=>{let l={operate_rights:r.operate_rights,user_ids:r.user_id,type:2,library_key:L.library_key};te(l).then(()=>{O.success("修改成功")}).catch(()=>{})},B=()=>{m.value.open()},c=r=>{let l={id:r.id,library_key:L.library_key};xe(l).then(()=>{O.success("移除成功"),C()}).catch(()=>{})},D=()=>{C()},y=r=>{Object.assign(p,r),C()},C=()=>{ke({library_key:L.library_key,page:p.current,size:p.pageSize}).then(r=>{let l=r.data.list||[],{user_id:g}=U.userInfo;p.total=r.data.total,l.forEach(u=>{u.showDelete=!0,g==u.user_id&&(u.showDelete=!1),u.role_type==1&&(u.showDelete=!1),u.operate_rights=u.operate_rights*1,u.operate_rights_label="无权限",s[u.operate_rights]&&(u.operate_rights_label=s[u.operate_rights].label)}),b.value=l})};return Y(()=>{C()}),(r,l)=>{const g=Q,u=ee,F=ue,M=He,j=Ee,A=qe,w=Ye,G=Qe,n=Ze;return i(),f("div",yt,[t("div",gt,[t("div",kt,[e(g,{name:"collaborator"}),t("span",xt,"协助权限 ("+I(p.total)+")",1)]),t("div",wt,[e(u,{type:"primary",size:"small",onClick:B},{default:o(()=>[e(q(Ve)),k(" 添加协助者")]),_:1})])]),t("div",St,[e(n,{columns:$,"data-source":b.value,pagination:p,onChange:y},{bodyCell:o(({column:d,record:v})=>[d.key==="name"?(i(),f("div",$t,[e(F,{class:"avatar",src:v.avatar||q(_e)},null,8,["src"]),t("div",Ct,[t("div",Lt,I(v.user_name),1),t("div",Dt,I(v.nick_name),1)])])):z("",!0),d.key==="role"?(i(),f(W,{key:1},[v.showDelete?(i(),f("div",It,[e(A,null,{overlay:o(()=>[e(j,{onClick:N=>_(N,v)},{default:o(()=>[(i(),P(M,{key:4},{default:o(()=>[k("可管理")]),_:1})),(i(),P(M,{key:2},{default:o(()=>[k("可编辑")]),_:1}))]),_:2},1032,["onClick"])]),default:o(()=>[t("a",{class:"dropdown-label",onClick:l[0]||(l[0]=K(()=>{},["prevent"]))},[k(I(v.operate_rights_label)+" ",1),e(q(We),{style:{"font-size":"12px"}})])]),_:2},1024)])):(i(),f("div",Ut,[t("a",{class:"dropdown-label disabled",onClick:l[1]||(l[1]=K(()=>{},["prevent"]))},I(v.operate_rights_label),1)]))],64)):z("",!0),d.key==="action"?(i(),f(W,{key:2},[v.showDelete?(i(),P(G,{key:0},{default:o(()=>[e(w,{title:"确定要移除此协作者吗?","ok-text":"确定","cancel-text":"取消",onConfirm:N=>c(v)},{default:o(()=>[Rt]),_:2},1032,["onConfirm"])]),_:2},1024)):(i(),f("span",Mt,[e(u,{style:{padding:"0"},type:"link",disabled:""},{default:o(()=>[k("移除")]),_:1})]))],64)):z("",!0)]),_:1},8,["data-source","pagination"])]),e(ht,{excludedIds:a.value,ref_key:"addCollaboratorRef",ref:m,onOk:D},null,8,["excludedIds"])])}}},Pt=E(Ot,[["__scopeId","data-v-bd0b2d18"]]),zt={class:"permissions-page"},Bt={class:"page-container"},Ft={class:"form-box-wrapper"},jt={class:"collaborator-list-wrapper"},At={__name:"index",setup(h){const U=Re(),L=H(()=>U.query.library_id),m=T({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""});X("libraryState",m),X("updateState",a=>{Object.assign(m,a)});const $=x(!1),s=a=>{Object.assign(m,a),$.value=!0,p().then(()=>{$.value=!1}).catch(()=>{$.value=!1})},p=async()=>{let a={...Me(m)};delete a.library_key,a.avatar_file?(a.avatar=a.avatar_file,delete a.avatar_file):(delete a.avatar,delete a.avatar_file),await Se(a),O.success("修改成功")},b=()=>{we({id:L.value}).then(a=>{Object.assign(m,a.data)})};return Y(()=>{b()}),(a,_)=>(i(),f("div",zt,[e(Oe),t("div",Bt,[t("div",Ft,[e(st,{value:m,"onUpdate:value":_[0]||(_[0]=R=>m=R),saveLoading:$.value,onSubmit:s},null,8,["value","saveLoading"])]),t("div",jt,[m.library_key?(i(),P(Pt,{key:0})):z("",!0)])])]))}},Ea=E(At,[["__scopeId","data-v-8b81102f"]]);export{Ea as default};
