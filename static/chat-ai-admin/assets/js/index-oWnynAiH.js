import{_ as nt}from"./cu-scroll-BvD9XPVC.js";import{a4 as tt,e as k,ai as lt,M as c,N as n,k as o,S as i,Z as u,W as a,a7 as P,G,F as I,a0 as H,Y as v,Q as z,u as h,X as U,$ as W,a1 as rt,a2 as ct,B as _t}from"./vue-chunks-Dagx-vSq.js";import{S as X,a as ut,c as Y,C as pt,b as dt,E as mt}from"./edit-subsection-DNEqsZMW.js";import{b as et,a1 as ht,bq as vt,dk as ft,dl as gt,k as st,M as Z,dm as yt,E as kt,dn as K,B as St,dp as bt}from"../../index-BdYv4pbp.js";import{C as Ct}from"./ClockCircleFilled-dX4v8WIw.js";import{S as xt}from"./index-BITuwxer.js";import"./index-Dq7HAFaD.js";import{D as Lt}from"./dropdown-BiE8xfl_.js";import{M as qt,_ as wt}from"./index-CJ0orYu6.js";import{S as Mt}from"./SettingOutlined-CygDtKy4.js";import{S as Ot}from"./SyncOutlined-wUPVjOdF.js";import{M as Et}from"./MoreOutlined-D2HKzNS9.js";import{_ as It,a as $t}from"./index-p8d_9U1-.js";import{_ as Dt}from"./index-CCsePsqL.js";import{_ as Nt}from"./index-se_NG1zo.js";import{S as Pt}from"./index-C4cR8MsS.js";import{S as Bt,a as Ft}from"./index-BddIR2yb.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-DgTptGPI.js";import"./index-p3MxSJUT.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./DownloadOutlined-B8UItTFz.js";import"./pick-RXfaHpPL.js";import"./index-CbmBRnKK.js";import"./Trigger-DWEODdVI.js";import"./isPlainObject-BUQ58MPT.js";import"./responsiveObserve-YIOA4WXQ.js";import"./collapseMotion-D5mGic4t.js";import"./QuestionCircleOutlined-BY31qbwb.js";import"./FormItemContext-Cdyd-mYe.js";import"./CheckOutlined-Zj7x0G_2.js";import"./PlusOutlined-BEhntgqt.js";import"./slide-4EGAbcnD.js";import"./index-B11WLJj_.js";import"./Input-C2qOGQ_1.js";import"./index-ffqjZvit.js";import"./inputProps-BIa77Hqy.js";import"./Search-B65y9BZx.js";import"./SearchOutlined-C-SKizIr.js";import"./TextArea-DRJIYohD.js";import"./Password-D2_IM1Jy.js";import"./index-CIGUcmws.js";import"./index-qGbzu_6t.js";import"./index-DtgLQTOT.js";import"./index-DrvGOKxR.js";import"./index-DulBynFY.js";import"./index-BMSQkwth.js";import"./LeftOutlined-DfhC6gKx.js";import"./index-CzzmSx3J.js";import"./index-BMih6iRe.js";import"./UpOutlined-DlgZFWNa.js";import"./DownOutlined-bF62ZcFO.js";import"./axios-BZ84_VUH.js";import"./qs-CSiAN3u4.js";import"./crypto-js-DN0vhd75.js";import"./dayjs-CZ5VaChI.js";import"./RightOutlined-Dc3RESo2.js";import"./move-Du4Gi3iM.js";import"./colors-CJx9DhIW.js";import"./shallowequal-CI97GdPH.js";import"./index-DNsujCXu.js";import"./useMaxLevel-B54cygJO.js";import"./CaretDownFilled-7_Xowb8a.js";import"./index-_xQpb7Ga.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-Dzb8yElx.js";import"./Checkbox-B2wqz-LK.js";import"./index-TeHk_coF.js";import"./RadioButton-CKy5Sstn.js";import"./CaretDownOutlined-Ch0ng0P7.js";import"./index-7XEwOeX1.js";const J=f=>(rt("data-v-a02e9965"),f=f(),ct(),f),Rt={class:"subsection-box"},zt=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#F40"}},Jt={key:2,class:"qa-list-box"},Qt={class:"list-item"},Vt=J(()=>a("div",{class:"list-label"},"问题",-1)),Tt={class:"list-content"},At={key:0,class:"list-item"},jt=J(()=>a("div",{class:"list-label"},"相似问法",-1)),Gt={class:"list-content"},Ut={class:"list-item"},Wt=J(()=>a("div",{class:"list-label"},"答案",-1)),Xt={class:"list-content"},Yt={class:"fragment-img"},Zt=["src"],Kt={key:3,class:"common-list-box"},te={class:"top-block"},ee={class:"title"},se={class:"title"},oe=["innerHTML"],ae={class:"fragment-img"},ie=["src"],ne={key:0,class:"status-tag"},le={key:1,class:"status-tag complete"},re={class:"status-tag status-error"},ce={key:3,class:"status-tag running"},_e={class:"right-opration"},ue={class:"hover-btn-box"},pe=["onClick"],de=J(()=>a("div",null,"标记设置",-1)),me=["onClick"],he={class:"hover-btn-box"},ve=["onClick"],fe=["onClick"],ge={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(f,{expose:j,emit:B}){const q=B,_=f,F=tt().query,$=(l,p)=>{let{id:d,title:b,content:N,question:O,answer:y,images:C,category_id:x,library_id:L}=l,s=l.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${p+1}】吗?`,onOk(){return new Promise((t,r)=>{yt({id:d,library_id:L,title:b,content:N,question:O,answer:y,images:C,category_id:x,similar_questions:JSON.stringify(s)}).then(e=>{q("handleConvert",l),t()}).catch(()=>{t()})})},onCancel(){}})},w=l=>{q("openEditSubscription",l)},R=l=>{Z.confirm({title:"提示",icon:o(kt),content:"是否取消该标记?",onOk(){M(l,{})},onCancel(){}})},m=k([]),g=()=>{ft({library_id:F.id}).then(l=>{m.value=l.data||[],q("getStatrList",l.data||[])})};g();const D=k(null),Q=()=>{D.value.show()},V=l=>{var d;let p=(d=m.value.filter(b=>b.id==l.category_id)[0])==null?void 0:d.type;return p?Y[p]:"#F4EA2A"},M=(l,p={})=>{gt({id:l.id,category_id:p.id||0}).then(d=>{st.success("修改成功"),p.id?l.category_id=p.id:q("handleDelParagraph",l.id),g()})},T=l=>{window.open(`/#/library/preview?id=${l.file_id}`)};return j({handleOpenEditModal:w}),(l,p)=>{const d=It,b=Dt,N=xt,O=Nt,y=wt,C=qt,x=Lt,L=$t,s=lt("viewer");return n(),c("div",Rt,[o(L,{"data-source":f.paragraphLists,pagination:!1},{default:i(()=>[o(d,{key:"id","data-index":"id",width:1148},{title:i(()=>[f.isQaLibray?(n(),c(I,{key:0},[v(" 问答（共"+u(_.total)+"个） ",1)],64)):(n(),c(I,{key:1},[v("分段 （共"+u(_.total)+"个分段）",1)],64))]),default:i(({record:t,index:r})=>[t.file_name?(n(),c("a",{key:0,class:"file-name-text",onClick:e=>T(t)},u(t.file_name),9,zt)):(n(),c("div",Ht,"原文档已删除")),f.isQaLibray?(n(),c("div",Jt,[a("div",Qt,[Vt,a("div",Tt,u(t.question),1)]),t.similar_questions&&t.similar_questions.length?(n(),c("div",At,[jt,a("div",Gt,u(t.similar_questions.join("/")),1)])):P("",!0),a("div",Ut,[Wt,a("div",Xt,u(t.answer),1)]),G((n(),c("div",Yt,[(n(!0),c(I,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,Zt))),128))])),[[s]])])):(n(),c("div",Kt,[a("div",te,[a("div",ee,"分段"+u(r+1),1),a("div",se,u(t.title),1),a("span",null,"共"+u(t.word_total)+"个字符",1)]),a("div",{class:"content-box",innerHTML:t.content},null,8,oe),G((n(),c("div",ae,[(n(!0),c(I,null,H(t.images,(e,E)=>(n(),c("img",{key:E,src:e,alt:""},null,8,ie))),128))])),[[s]])]))]),_:1}),o(d,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:i(({record:t})=>[t.status==0?(n(),c("span",ne,[o(h(Ct)),v(" 未转换")])):P("",!0),t.status==1?(n(),c("span",le,[o(h(ht)),v(" 已转换")])):P("",!0),t.status==2?(n(),z(b,{key:2,placement:"top"},{title:i(()=>[a("span",null,u(t.errmsg),1)]),default:i(()=>[a("span",null,[a("span",re,[o(h(vt)),v(" 转换异常")])])]),_:2},1024)):P("",!0),t.status==3?(n(),c("span",ce,[o(N,{size:"small"}),v(" 转换中")])):P("",!0)]),_:1}),o(d,{title:"操作",key:"action","data-index":"action",width:120},{default:i(({record:t,index:r})=>[a("div",_e,[o(x,null,{overlay:i(()=>[o(C,null,{default:i(()=>[(n(!0),c(I,null,H(m.value,e=>(n(),z(y,{key:e.id},{default:i(()=>[a("div",{class:"start-item",onClick:E=>M(t,e)},[o(h(X),{style:U({color:h(Y)[e.type]})},null,8,["style"]),a("div",null,u(e.name||"-"),1)],8,pe)]),_:2},1024))),128)),o(y,null,{default:i(()=>[a("div",{class:"start-item",onClick:Q},[o(h(Mt)),de])]),_:1})]),_:2},1024)]),default:i(()=>[a("div",ue,[t.category_id>0?(n(),z(O,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>M(t,{})},{default:i(()=>[o(h(X),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(n(),z(h(ut),{key:1,onClick:e=>M(t,m.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),o(b,null,{title:i(()=>[v("重新转换")]),default:i(()=>[a("div",{class:"hover-btn-box",onClick:e=>$(t,r)},[o(h(Ot))],8,me)]),_:2},1024),o(x,{placement:"bottomRight"},{overlay:i(()=>[o(C,null,{default:i(()=>[o(y,null,{default:i(()=>[a("div",{onClick:W(e=>w(t),["stop"])},"编辑",8,ve)]),_:2},1024),o(y,null,{default:i(()=>[a("div",{onClick:W(e=>R(t),["stop"])},"删除",8,fe)]),_:2},1024)]),_:2},1024)]),default:i(()=>[a("div",he,[o(h(Et))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),o(pt,{onOk:g,ref_key:"classificationMarkModalRef",ref:D},null,512)])}}},ye=et(ge,[["__scopeId","data-v-a02e9965"]]),ke={class:"robot-page"},Se={class:"search-content-block"},be={class:"selct-star-box"},Ce={class:"scroll-box"},xe={class:"content-block"},Le={__name:"index",setup(f){const B=tt().query,q=k([]),_=k([]),S=k(0),F={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},$={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},w=k({}),R=s=>{q.value=s},m=k({page:1,size:10}),g=_t({status:-1,category_id:-1,library_id:B.id}),D=()=>{m.value.page=1,S.value=0,_.value=[],L()},Q=s=>{g.category_id=s,D()},V=()=>{bt({id:B.id}).then(()=>st.success("操作完成"))},M=k(null),T=s=>{M.value.showModal(JSON.parse(JSON.stringify(s)))},l=s=>{if(!s.id){m.value.page=1,L();return}let t=_.value,r=t.findIndex(e=>e.id==s.id);if(r>-1){let e=t[r];e.title=s.title,e.content=s.content,e.question=s.question,e.answer=s.answer,e.answer=s.answer,e.images=s.images,e.category_id=s.category_id,e.word_total=s.question.length+s.answer.length+s.content.length,e.similar_questions=JSON.parse(s.similar_questions),t.splice(r,1,e),_.value=t}},p=s=>{let t=_.value,r=t.findIndex(e=>e.id==s);r>-1&&(t.splice(r,1),_.value=t,S.value=--S.value,S.value)},d=()=>{x.value||_.value.length>=S.value||b()},b=()=>{m.value.page++,L()},N=()=>{y()};function O(){clearInterval(C),_.value.filter(t=>t.status==3).length?C=setInterval(()=>{y()},5e3):clearInterval(C)}const y=()=>{K({page:1,size:_.value.length,...g}).then(s=>{let r=s.data.list||[];r.forEach(e=>{e.status_text=$[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),_.value=r,O()})};let C=null;const x=k(!1),L=()=>{x.value=!0,K({...m.value,...g}).then(s=>{x.value=!1;let t=s.data,r=t.list||[];t.info&&(w.value={...t.info,is_qa_doc:t.info.type==2?1:0}),w.value={...t.info,is_qa_doc:t.info.type==2?1:0},r.forEach(e=>{e.status_text=$[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),m.value.page==1&&(_.value=[]),_.value=[..._.value,...r],S.value=t.total,O()})};return L(),(s,t)=>{const r=Ft,e=Bt,E=St,ot=Pt,at=nt;return n(),c("div",ke,[a("div",Se,[a("div",be,[o(dt,{hideId:[0],startLists:q.value,onChange:Q},null,8,["startLists"])]),o(ot,null,{default:i(()=>[o(e,{value:g.status,"onUpdate:value":t[0]||(t[0]=A=>g.status=A),placeholder:"请选择",style:{width:"160px"},onChange:D},{default:i(()=>[o(r,{value:-1},{default:i(()=>[v("全部嵌入状态")]),_:1}),(n(),c(I,null,H($,(A,it)=>o(r,{value:it},{default:i(()=>[v(u(A),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),o(E,{onClick:V},{default:i(()=>[v("重新嵌入向量")]),_:1})]),_:1})]),a("div",Ce,[o(at,{scrollbar:{minSize:0},onOnScrollEnd:d},{default:i(()=>[a("div",xe,[o(ye,{ref:"subsectionBoxRef",isQaLibray:w.value.is_qa_doc,total:S.value,paragraphLists:_.value,onOpenEditSubscription:T,onHandleDelParagraph:p,onHandleConvert:N,onGetStatrList:R},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),o(mt,{detailsInfo:w.value,onHandleEdit:l,onHandleStatrList:R,ref_key:"editSubscriptionRef",ref:M},null,8,["detailsInfo"])])}}},As=et(Le,[["__scopeId","data-v-ea13d700"]]);export{As as default};
