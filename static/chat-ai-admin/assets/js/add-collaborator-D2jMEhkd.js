import{b as W,l as Y,d as Z,M as G,a2 as H,k as w}from"../../index-BdYv4pbp.js";import{c as K,e as X}from"./index-DQctwWcD.js";import{F as U,_ as ee}from"./index-CbmBRnKK.js";import"./index-TeHk_coF.js";import{_ as te,R as ae}from"./RadioButton-CKy5Sstn.js";import{A as oe}from"./index-Nuz6o6dK.js";import{U as se}from"./UserOutlined-BscmVZKR.js";import{_ as ne,C as le}from"./index-Dzb8yElx.js";import{d as ie,e as u,B as j,M as d,N as i,k as n,S as s,W as _,a7 as v,Y as c,F as A,a0 as F,Q as h,u as re,Z as g}from"./vue-chunks-Dagx-vSq.js";const _e={class:"form-box"},de={key:0,class:"form-tip"},ue={key:0,class:"list-box"},ce=["onClick"],pe={class:"user-block"},ve={class:"name-box"},me={class:"name"},fe={class:"remark-text"},ye={key:1,class:"checkbox-list"},he={class:"checklist-item"},ge={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(ke,{expose:N,emit:M}){const k=ie(()=>Y().role_permission||[]),S=M,B=U.useForm,m=u(!1),l=j({identity_type:"1",operate_rights:"4"}),r=u([]),p=u([]),O=t=>{t.role_type!=1&&(r.value.includes(t.id)?r.value=r.value.filter(a=>a!=t.id):r.value.push(t.id))},V=j({}),{resetFields:be,validate:xe,validateInfos:Ce}=B(l,V);let f=[];const q=(t,a)=>{D(),I(),r.value=[],p.value=[],t.forEach(o=>{o.identity_type==1&&r.value.push(o.identity_id),o.identity_type==2&&p.value.push(o.identity_id)}),l.operate_rights="4",l.identity_type="1",f=a,m.value=!0},y=u(!1),z=()=>{f=f.map(o=>({object_id:+o.object_id,object_type:+o.object_type,operate_rights:+l.operate_rights}));let t=[];if(l.identity_type==1?t=r.value:t=p.value,t.length==0){w.error("请选择成员或成员组织");return}let a={identity_type:l.identity_type,object_array:JSON.stringify(f),identity_ids:t.join(",")};y.value=!0,X(a).then(o=>{w.success("保存成功"),m.value=!1,S("ok")}).finally(()=>{y.value=!1})},b=u([]),D=()=>{H({page:1,size:200}).then(t=>{b.value=t.data.list})},x=u([]),I=()=>{K().then(t=>{let a=t.data||[];x.value=a})},P=()=>{window.open("/#/user/manage")};return N({show:q}),(t,a)=>{const o=ae,C=te,L=ee,R=oe,E=Z,T=le,$=ne,J=U,Q=G;return i(),d("div",null,[n(Q,{open:m.value,"onUpdate:open":a[3]||(a[3]=e=>m.value=e),title:"添加协作者",onOk:z,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:y.value},{default:s(()=>[_("div",_e,[n(J,{layout:"vertical"},{default:s(()=>[n(L,{label:"协作权限",required:""},{default:s(()=>[n(C,{value:l.operate_rights,"onUpdate:value":a[0]||(a[0]=e=>l.operate_rights=e)},{default:s(()=>[n(o,{value:"4"},{default:s(()=>[c("管理")]),_:1}),n(o,{value:"2"},{default:s(()=>[c("编辑")]),_:1}),n(o,{value:"1"},{default:s(()=>[c("查看")]),_:1})]),_:1},8,["value"])]),_:1}),n(L,{label:"协作者",required:""},{default:s(()=>[n(C,{value:l.identity_type,"onUpdate:value":a[1]||(a[1]=e=>l.identity_type=e)},{default:s(()=>[n(o,{value:"1"},{default:s(()=>[c("按成员选")]),_:1}),n(o,{value:"2"},{default:s(()=>[c("按组织架构")]),_:1})]),_:1},8,["value"]),k.value&&k.value.includes("TeamManage")?(i(),d("div",de,[c(" 如果协作者没有账号，请先到团队管理中添加账号 "),_("a",{onClick:P},"去添加")])):v("",!0)]),_:1}),l.identity_type==1?(i(),d("div",ue,[(i(!0),d(A,null,F(b.value,e=>(i(),d("div",{class:"type-item",key:e.value,onClick:Le=>O(e)},[_("div",pe,[n(R,{shape:"square",src:e.avatar,size:40},{icon:s(()=>[e.avatar?v("",!0):(i(),h(re(se),{key:0}))]),_:2},1032,["src"]),_("div",ve,[_("div",me,g(e.user_name),1),_("div",fe,g(e.nick_name),1)])]),r.value.includes(e.id)?(i(),h(E,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],8,ce))),128))])):v("",!0),l.identity_type==2?(i(),d("div",ye,[n($,{value:p.value,"onUpdate:value":a[2]||(a[2]=e=>p.value=e),style:{width:"100%"}},{default:s(()=>[_("div",he,[(i(!0),d(A,null,F(x.value,e=>(i(),h(T,{key:e.id,value:e.id},{default:s(()=>[_("div",null,g(e.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):v("",!0)]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Oe=W(ge,[["__scopeId","data-v-fc1952f5"]]);export{Oe as A};
