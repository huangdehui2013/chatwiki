import{b as ce,dJ as ge,d as me,dh as Le,bJ as De,dK as xe,dL as pe,dI as le,k as te,M as we,E as He,dM as Re,dN as Ve}from"../../index-BYXP5-K6.js";import{c as Y,M as R,N as H,F as fe,a0 as Me,a7 as z,u as Q,a6 as re,k as u,W as f,Z as de,e as $,S as v,Y as oe,Q as $e,$ as A,a1 as Ee,a2 as Fe,d as ie,a4 as Be,B as Se,w as _e,x as Ae,a8 as Ie,a3 as Ke,z as se}from"./vue-chunks-DKljrDvA.js";import{P as ye}from"./PlusOutlined-wIhQX_dJ.js";import{M as je,_ as Oe}from"./index-DcQhmA5K.js";import"./index-CYLnLfoe.js";import{D as Te}from"./dropdown-QXBOTlLU.js";import{M as Ze}from"./MoreOutlined-D7oVfKnU.js";import{C as Ue}from"./CaretDownOutlined-DGGt9FQx.js";import{_ as qe}from"./index-C9HKvTtP.js";import{_ as Pe}from"./index-CHnEDbAe.js";import{S as ze}from"./share-modal-IFdhFdQz.js";import"./axios-BZ84_VUH.js";import"./qs-DB0tj3pA.js";import"./crypto-js-fJpLWOEv.js";import"./dayjs-BpZi_McX.js";import"./shallowequal-CthuG9FU.js";import"./Trigger-DAizGHX4.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-CxHtxgWr.js";import"./slide-C8pAsQDb.js";import"./index-2d7y8GiQ.js";import"./RightOutlined-D_XHCIbp.js";import"./move-BNsvENtF.js";import"./colors-BsGfXzR0.js";import"./useMaxLevel-C1O2TwYp.js";import"./index-ChLzCBr1.js";import"./index-DxTO0j69.js";import"./CheckOutlined-tNTNjiBd.js";import"./DownOutlined-BfzuAtqc.js";import"./SearchOutlined-BAHqMa3J.js";import"./FormItemContext-BbeLgxF6.js";import"./CaretDownFilled-BzXYTSEq.js";import"./index-Did3xK-p.js";import"./responsiveObserve-DRuL2_me.js";import"./share-form-DAhgURc4.js";import"./index-B6tAcODo.js";import"./index-BNZqkHuq.js";import"./RadioButton-D6KxmP_c.js";import"./Checkbox-DoUvt9dJ.js";import"./index-CcC8Vz_q.js";import"./Input-Bfzy8tJK.js";import"./inputProps-B3PFVydJ.js";import"./Search-1aGcXLAr.js";import"./isPlainObject-BRAWLrZZ.js";import"./TextArea-Dnm7usWJ.js";import"./Password-CPQYqxS0.js";import"./index-DvGRcWf4.js";import"./QuestionCircleOutlined-DYrN9KdY.js";const We="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.9993%2015.3363C14.4596%2015.3363%2014.8327%2014.9632%2014.8327%2014.503C14.8327%2014.0428%2014.4596%2013.6697%2013.9993%2013.6697C13.5391%2013.6697%2013.166%2014.0428%2013.166%2014.503C13.166%2014.9632%2013.5391%2015.3363%2013.9993%2015.3363Z'%20fill='%23BFBFBF'%20stroke='%23BFBFBF'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%207V12.3333Z'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14%207V12.3333'%20stroke='%23BFBFBF'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M30.328%204.576H31.672V6.382H36.362V7.67H31.672V9.84H37.104V11.128H32.778C33.702%2012.766%2035.256%2014.236%2037.426%2015.538L36.488%2016.742C34.234%2015.062%2032.652%2013.2%2031.728%2011.128H31.672V17.4H30.328V11.128H30.272C29.278%2013.396%2027.64%2015.272%2025.372%2016.756L24.602%2015.51C26.702%2014.362%2028.242%2012.892%2029.222%2011.128H24.896V9.84H30.328V7.67H25.736V6.382H30.328V4.576ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='white'/%3e%3c/svg%3e",Ge="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23CCDFFF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='%232475FC'/%3e%3cpath%20d='M11.334%2011L13.334%2013L17.334%209'%20stroke='white'%20stroke-width='1.33'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M35.816%2011.058H27.136V14.908C27.136%2015.44%2027.402%2015.706%2027.934%2015.706H34.92C35.172%2015.706%2035.41%2015.622%2035.606%2015.454C35.83%2015.244%2035.97%2014.404%2036.054%2012.934L37.356%2013.354C37.188%2015.118%2036.95%2016.168%2036.656%2016.49C36.32%2016.798%2035.872%2016.966%2035.298%2016.994H27.57C26.38%2016.994%2025.792%2016.378%2025.792%2015.146V7.866H27.136V9.784H34.458V6.452H25.218V5.178H35.816V11.058ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='%232475FC'/%3e%3c/svg%3e";var he={exports:{}};(function(g,E){(function(L,h){h()})(Y,function(){function L(o,i){return typeof i>"u"?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function h(o,i,s){var r=new XMLHttpRequest;r.open("GET",o),r.responseType="blob",r.onload=function(){c(r.response,i,s)},r.onerror=function(){console.error("could not download file")},r.send()}function x(o){var i=new XMLHttpRequest;i.open("HEAD",o,!1);try{i.send()}catch{}return 200<=i.status&&299>=i.status}function y(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(i)}}var p=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Y=="object"&&Y.global===Y?Y:void 0,D=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=p.saveAs||(typeof window!="object"||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!D?function(o,i,s){var r=p.URL||p.webkitURL,_=document.createElement("a");i=i||o.name||"download",_.download=i,_.rel="noopener",typeof o=="string"?(_.href=o,_.origin===location.origin?y(_):x(_.href)?h(o,i,s):y(_,_.target="_blank")):(_.href=r.createObjectURL(o),setTimeout(function(){r.revokeObjectURL(_.href)},4e4),setTimeout(function(){y(_)},0))}:"msSaveOrOpenBlob"in navigator?function(o,i,s){if(i=i||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(L(o,s),i);else if(x(o))h(o,i,s);else{var r=document.createElement("a");r.href=o,r.target="_blank",setTimeout(function(){y(r)})}}:function(o,i,s,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof o=="string")return h(o,i,s);var _=o.type==="application/octet-stream",I=/constructor/i.test(p.HTMLElement)||p.safari,U=/CriOS\/[\d]+/.test(navigator.userAgent);if((U||_&&I||D)&&typeof FileReader<"u"){var K=new FileReader;K.onloadend=function(){var M=K.result;M=U?M:M.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=M:location=M,r=null},K.readAsDataURL(o)}else{var F=p.URL||p.webkitURL,j=F.createObjectURL(o);r?r.location=j:location.href=j,r=null,setTimeout(function(){F.revokeObjectURL(j)},4e4)}});p.saveAs=c.saveAs=c,g.exports=c})})(he);var Je=he.exports;const Xe={class:"side-meuns"},Ye=["onClick"],Qe={class:"menu-name"},Ne={__name:"side-menus",props:{menus:{type:Array,default:()=>[]},active:{type:String,default:""}},emits:["menuClick"],setup(g,{emit:E}){const L=E,h=g,{checkPermission:x}=ge(),y=p=>{L("menuClick",p)};return(p,D)=>{const c=me;return H(),R("div",Xe,[(H(!0),R(fe,null,Me(h.menus,o=>(H(),R(fe,{key:o.key},[Q(x)(o.permissions)?(H(),R("div",{key:0,class:re(["side-meun-item",{active:o.key===h.active}]),onClick:i=>y(o)},[u(c,{class:"menu-icon",name:o.icon},null,8,["name"]),f("span",Qe,de(o.name),1)],10,Ye)):z("",!0)],64))),128))])}}},et=ce(Ne,[["__scopeId","data-v-00b2c2a7"]]),tt={__name:"upload-doc",emits:["file-loaded"],setup(g,{expose:E,emit:L}){const h=L,x=$(null);let y={};const p=c=>{y=c||{},x.value.click()},D=c=>{const o=c.target.files[0];if(!o)return;if(!o.name.endsWith(".md")){alert("请选择.md文件");return}const i=new FileReader;i.onload=s=>{h("file-loaded",{content:s.target.result,title:o.name,file:o,...y})},i.readAsText(o),c.target.value=null};return E({triggerUpload:p}),(c,o)=>(H(),R("input",{type:"file",style:{opacity:"0",position:"fixed",bottom:"-9999px",left:"-9999px"},ref_key:"fileInput",ref:x,onChange:D,accept:".md"},null,544))}},Z=g=>(Ee("data-v-9de614d1"),g=g(),Fe(),g),ot={class:"side-directory"},nt={class:"directory-header"},at=Z(()=>f("div",{class:"label-text"},"文档目录",-1)),lt={class:"action-box"},it={class:"action-btn"},st={class:"directory-body"},rt={class:"directory-content"},ct={style:{"margin-right":"4px"}},dt={class:"action-btn toggle-btn"},ut=["data-level"],pt={class:"doc-title"},ft={class:"doc-action-box"},_t=Z(()=>f("span",{class:"menu-name"},"添加文档",-1)),yt=Z(()=>f("span",{class:"menu-name"},"导入文档",-1)),mt=Z(()=>f("span",{class:"menu-name"},null,-1)),ht=Z(()=>f("span",{class:"menu-name"},"复制文档",-1)),vt=Z(()=>f("span",{class:"menu-name"},"导出文档",-1)),Ct=Z(()=>f("span",{class:"menu-name"},"删除文档",-1)),kt={__name:"side-directory",props:{list:{type:Array,default:()=>[]},loadData:{type:Function,default:()=>{}},selectedKeys:{type:Array,default:()=>[]}},emits:["addDoc","importDoc","copyLink","copyDoc","deleteDoc","exportDoc","dragenter","drop","select"],setup(g,{expose:E,emit:L}){const h=L,x=g,y=$([]),p=$([]),D=d=>{p.value.includes(d)||p.value.push(d)},c=(d,C)=>{const V=y.value.indexOf(d);typeof C=="boolean"?V>-1&&C===!1?y.value.splice(V,1):y.value.push(d):V>-1?y.value.splice(V,1):y.value.push(d)},o=d=>{y.value=[]},i=$(null),s=d=>{h("addDoc",d)};let r=null;const _=d=>{r=d,i.value.triggerUpload()},I=d=>{h("importDoc",r,d)},U=d=>{h("copyLink",d)},K=d=>{h("copyDoc",d)},F=d=>{h("exportDoc",d)},j=d=>{h("deleteDoc",d)},M=d=>{h("dragenter",d)},N=d=>{h("drop",d)},ne=(d,C)=>{h("select",C.node.dataRef)};return E({toggleExpand:c,addLoadedKey:D}),(d,C)=>{const V=me,w=Oe,W=je,G=Te,ae=qe,O=Pe;return H(),R("div",ot,[f("div",nt,[u(V,{name:"doc-directory",style:{"font-size":"16px",color:"#595959"}}),at,f("div",lt,[u(G,null,{overlay:v(()=>[u(W,null,{default:v(()=>[u(w,{key:"addDoc",onClick:C[0]||(C[0]=k=>s())},{default:v(()=>[oe(" 添加文档 ")]),_:1}),u(w,{key:"importDoc",onClick:C[1]||(C[1]=k=>_())},{default:v(()=>[oe(" 导入文档 ")]),_:1})]),_:1})]),default:v(()=>[f("span",it,[u(Q(ye),{style:{color:"#595959"}})])]),_:1}),u(ae,null,{title:v(()=>[oe("收起全部文档")]),default:v(()=>[f("span",{class:"action-btn",onClick:C[2]||(C[2]=k=>o(!1))},[u(V,{name:"menu-expand",style:{"font-size":"16px",color:"#595959"}})])]),_:1})])]),f("div",st,[f("div",rt,[u(O,{class:"directory-tree",expandedKeys:y.value,"onUpdate:expandedKeys":C[5]||(C[5]=k=>y.value=k),"selected-keys":g.selectedKeys,loadedKeys:p.value,"block-node":"","tree-data":x.list,"load-data":g.loadData,"field-names":{key:"id",title:"title",children:"children"},draggable:"",onDragenter:M,onDrop:N,onSelect:ne},{switcherIcon:v(({switcherCls:k})=>[f("div",ct,[f("span",dt,[u(Q(Ue),{style:{"font-size":"12px"},class:re(k)},null,8,["class"])])])]),title:v(k=>[f("div",{class:re(["doc-item",{"is-leaf":k.dataRef.isLeaf}]),"data-level":k.level},[u(V,{class:"doc-icon",name:"doc-file"}),f("div",pt,de(k.dataRef.title),1),f("div",ft,[k.level<2?(H(),$e(G,{key:0},{overlay:v(()=>[u(W,null,{default:v(()=>[u(w,{key:"addDoc",onClick:A(T=>s(k),["stop","prevent"])},{default:v(()=>[_t]),_:2},1032,["onClick"]),u(w,{key:"importDoc",onClick:A(T=>_(k),["stop","prevent"])},{default:v(()=>[yt]),_:2},1032,["onClick"])]),_:2},1024)]),default:v(()=>[f("span",{class:"action-btn",onClick:C[3]||(C[3]=A(()=>{},["stop"]))},[u(Q(ye))])]),_:2},1024)):z("",!0),u(G,null,{overlay:v(()=>[u(W,null,{default:v(()=>[u(w,{key:"copyLink",onClick:A(T=>U(k),["stop","prevent"])},{default:v(()=>[oe(" 复制链接"),mt]),_:2},1032,["onClick"]),u(w,{key:"copyDoc",onClick:A(T=>K(k),["stop","prevent"])},{default:v(()=>[ht]),_:2},1032,["onClick"]),u(w,{key:"exportDoc",onClick:A(T=>F(k),["stop","prevent"])},{default:v(()=>[vt]),_:2},1032,["onClick"]),u(w,{key:"deleteDoc",onClick:A(T=>j(k),["stop","prevent"])},{default:v(()=>[Ct]),_:2},1032,["onClick"])]),_:2},1024)]),default:v(()=>[f("span",{class:"action-btn",onClick:C[4]||(C[4]=A(()=>{},["stop"]))},[u(Q(Ze))])]),_:2},1024)])],10,ut)]),_:1},8,["expandedKeys","selected-keys","loadedKeys","tree-data","load-data"])])]),u(tt,{ref_key:"uploadDocRef",ref:i,onFileLoaded:I},null,512)])}}},bt=ce(kt,[["__scopeId","data-v-9de614d1"]]),gt={class:"public-library-layout"},Lt={class:"layout-left"},Dt={class:"library-title"},xt=["src"],wt={class:"library-name"},Ht={key:1,class:"publish-status"},Rt={key:0,class:"icon",src:We,alt:""},Vt={key:1,class:"icon",src:Ge,alt:""},Mt={class:"side-directory-wrapper"},$t={class:"layout-body"},Et={__name:"index",setup(g){const E=(e,t)=>{const a=new Blob([e],{type:"text/markdown;charset=utf-8"});Je.saveAs(a,t)},L=(e,t)=>{{for(let a=0;a<e.length;a++){const n=e[a];if(n.id==t)return n;if(n.children){const l=L(n.children,t);if(l)return l}}return null}},h=(e,t,a=null)=>{for(let n=0;n<e.length;n++){const l=e[n];if(l.id==t)return a;if(l.children){const b=h(l.children,t,l);if(b)return b}}return null};function x(e="无标题文档",t=[]){const a=new Set(t.map(b=>b.title));let n=1,l=`${e}(${n})`;for(;a.has(l);)n++,l=`${e}(${n})`;return l}const y=Ke(),p=Be(),D=ie(()=>p.query.library_id),c=Se({type:1,library_intro:"",library_name:"",library_key:"",avatar:""}),o=ie(()=>p.query.doc_id),i=$(null),s=$([]),r=$([]),_=$(null),I=ie(()=>p.meta.activeMenu||""),U=[{name:"知识库配置",key:"config",icon:"jichupeizhi",path:"/public-library/config",permissions:["4"]},{name:"首页",key:"home",icon:"ai",path:"/public-library/home",permissions:["*"]}],K=e=>{y.push({path:e.path,query:{library_id:p.query.library_id,library_key:c.library_key}})};_e(()=>p.path,e=>{e!=="/public-library/editor"&&(M(),_.value=null)}),o.value&&(r.value=[Number(o.value)]),_e(o,e=>{e&&(r.value=[Number(o.value)])});const F=e=>{let t={library_key:c.library_key,pid:e?e.id:0};return xe(t).then(a=>{let n=a.data||[];n.forEach(l=>{l.id=l.id*1,l.pid=l.pid*1,l.key=l.id,l.level=e?e.level+1:0,l.sort=l.sort*1,l.children_num=l.children_num*1,l.children=[],l.hasLoaded=!1,l.isLeaf=l.children_num==0}),e?(e.hasLoaded=!0,e.children=n,s.value=[...s.value]):s.value=n})},j=e=>new Promise(t=>{if(e.dataRef.hasLoaded){t();return}F(e.dataRef).then(()=>{t()})}),M=()=>{r.value=[]},N=$(null),ne=e=>{N.value.show({doc_key:e.doc_key})},d=(e,t)=>{let a=t.title;a.endsWith(".md")&&(a=a.replace(/\.md$/i,""));let n={library_key:c.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:"0",title:a,content:t.content,sort:0};le(n).then(l=>{te.success("导入成功"),n.id=l.data.doc_id,n.sort=l.data.sort;let b=e?e.dataRef:null;w(b,n)})},C=e=>{let t="无标题文档";e?t=x("无标题文档",e.dataRef.children):t=x("无标题文档",s.value);let a={library_key:c.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:0,title:t,content:"# 无标题文档",sort:0};le(a).then(n=>{te.success("添加成功"),a.id=n.data.doc_id,a.sort=n.data.sort;let l=e?e.dataRef:null;w(l,a)})},V=e=>{pe({library_key:c.library_key,doc_id:e.dataRef.id}).then(t=>{let a={library_key:c.library_key,doc_id:"",doc_type:"4",pid:t.data.pid*1,title:t.data.title+"(副本)",content:t.data.content,sort:0};le(a).then(n=>{te.success("复制成功"),a.id=n.data.doc_id,a.sort=n.data.sort;let l=L(s.value,a.pid);w(l,a)})})},w=(e,t)=>{t.children_num=0,t.children=[],t.hasLoaded=!1,t.key=t.id,t.isLeaf=!0,t.level=0,e?(t.level=e.level+1,e.children_num++,e.isLeaf=!1,e.hasLoaded?(e.children.unshift(t),se(()=>{i.value.toggleExpand(e.id,!0)})):(e.hasLoaded=!1,se(()=>{i.value.toggleExpand(e.id,!0)}))):(t.level=0,s.value.unshift(t)),O(t)},W=e=>{we.confirm({title:"删除文档",icon:u(He),content:`确定删除文档 ${e.dataRef.title} 吗？`,onOk(){G(e)},onCancel(){}})},G=e=>{Ve({library_key:c.library_key,doc_id:e.dataRef.id}).then(()=>{te.success("删除成功");let t=L(s.value,e.dataRef.pid);if(t){let a=t.children.findIndex(n=>n.id==e.dataRef.id);if(t.children_num--,t.isLeaf=t.children_num==0,t.children.splice(a,1),I.value!="doc")return;t.children.length>0?O(t.children[0]):s.value.length>0?O(s.value[0]):(_.value=null,y.replace({path:"/public-library/home",query:{library_id:D.value,library_key:c.library_key}}))}else{let a=s.value.findIndex(n=>n.id==e.dataRef.id);if(s.value.splice(a,1),I.value!="doc")return;s.value.length>0?O(s.value[0]):(_.value=null,y.replace({path:"/public-library/home",query:{library_id:D.value,library_key:c.library_key}}))}})},ae=e=>{pe({library_key:c.library_key,doc_id:e.dataRef.id}).then(t=>{let{content:a,title:n}=t.data;n.endsWith(".md")||(n+=".md"),E(a,n)})},O=e=>{_.value=e,r.value=[e.id],p.path=="/public-library/editor"?y.replace({path:"/public-library/editor",query:{library_id:D.value,library_key:c.library_key,doc_id:e.id}}):y.push({path:"/public-library/editor",query:{library_id:D.value,library_key:c.library_key,doc_id:e.id}})},k=()=>{},T=e=>{const t=[...s.value],a=e.node,n=e.dragNode,l=a.key,b=n.key,q=a.pos.split("-"),ue=e.dropPosition-Number(q[q.length-1]),J=(m,B,ee=0,P)=>{for(let S=0;S<m.length;S++){if(m[S].key===B){P(m[S],S,ee,m);break}m[S].children&&J(m[S].children,B,ee+1,P)}};let X;if(J(t,b,0,(m,B,ee,P)=>{X={...m},P.splice(B,1)}),n.parent&&n.parent.node.children_num>0&&(n.parent.node.children_num--,n.parent.node.isLeaf=n.parent.node.children_num==0),!e.dropToGap)J(t,l,0,m=>{m.children=m.children||[],m.children_num++,m.isLeaf=!1,m.children.unshift(X)});else if((e.node.children||[]).length>0&&e.node.expanded&&ue===1)J(t,l,0,m=>{m.children=m.children||[],m.children_num++,m.isLeaf=!1,m.children.unshift(X)});else{let m=[],B=0;J(t,l,0,(ee,P,S,be)=>{m=be,B=P}),ue===-1?m.splice(B,0,X):m.splice(B+1,0,X)}s.value=t,ve(n,a)},ve=(e,t)=>{let a=h(s.value,e.dataRef.id);e.dataRef.pid=a?a.id:0;let n={library_key:c.library_key,doc_id:e.dataRef.id,pid:e.dataRef.pid,level:a?a.level+1:0,sort:0},l=a?a.children:s.value,b=-1;l.length>1&&(b=l.findIndex(q=>q.id==e.dataRef.id),b===0?(n.top=1,n.sort=l[b+1].sort):n.sort=l[b-1].sort),Re(n).then(q=>{e.dataRef.sort=q.data.sort,t.pid!=n.pid&&(t.dataRef.children.length>=t.dataRef.children_num?(t.dataRef.hasLoaded=!0,i.value.addLoadedKey(t.id),i.value.toggleExpand(t.id,!0)):F(t.dataRef).then(()=>{l[b]=e.dataRef,se(()=>{t.dataRef.hasLoaded=!0,i.value.toggleExpand(t.id,!0)})}))})},Ce=e=>{let t=L(s.value,e.id);t.title=e.title,t.is_draft=e.is_draft,_.value=t},ke=async()=>{try{const e=await Le({id:D.value});e.data.avatar||(e.data.avatar=De),Object.assign(c,e.data)}catch(e){}};return Ae(()=>{ke().then(()=>{F()})}),(e,t)=>{const a=Ie("router-view");return H(),R("div",gt,[f("div",Lt,[f("div",Dt,[c.avatar?(H(),R("img",{key:0,class:"library-logo",src:c.avatar,alt:""},null,8,xt)):z("",!0),f("span",wt,de(c.library_name),1),_.value?(H(),R("span",Ht,[_.value.is_draft==1?(H(),R("img",Rt)):z("",!0),_.value.is_draft==0?(H(),R("img",Vt)):z("",!0)])):z("",!0)]),u(et,{menus:U,active:I.value,onMenuClick:K},null,8,["active"]),f("div",Mt,[u(bt,{ref_key:"docTreeRef",ref:i,list:s.value,"load-data":j,selectedKeys:r.value,onImportDoc:d,onAddDoc:C,onDeleteDoc:W,onCopyDoc:V,onCopyLink:ne,onExportDoc:ae,onDragenter:k,onDrop:T,onSelect:O},null,8,["list","selectedKeys"])])]),f("div",$t,[u(a,{onChangeDoc:Ce})]),u(ze,{ref_key:"shareModalRef",ref:N},null,512)])}}},H2=ce(Et,[["__scopeId","data-v-58998fe3"]]);export{H2 as default};
