import{b as w,az as C,aA as V}from"../../index-G9f-mAi5.js";import{c as G}from"./index-BMQPDzC_.js";import{i as $,a as q,S as z}from"./index-zZJepEpM.js";import{e as k,w as I,x as F,Q as y,N as c,S as _,M,F as T,a0 as x,Y as J,Z as E,k as X,W as L}from"./vue-chunks-DKljrDvA.js";import{_ as b}from"./index-_ttAfm4V.js";const K=["src"],Q={__name:"model-select",props:{modelType:{type:String,validator:f=>["TEXT EMBEDDING","RERAN","LLM"].includes(f),required:!0},isOffline:{type:Boolean,default:!1},modeName:{type:[String,Number],default:""},modeId:{type:[String,Number],default:""},placeholder:{type:String,default:"请选择嵌入模型"}},emits:["change","update:modeName","update:modeId","loaded"],setup(f,{emit:O}){function B(t,n,a){const l=new Set(t.map(d=>d.model_define));return n.filter(d=>{let m=d[a];l.has(m)&&t.filter(e=>{if(e.model_define==m)return e.children=V(e.children,d.children),!1})}),t}const p=O,o=f,s=k();I([()=>o.modeId,()=>o.modeName],([t,n])=>{!t||!n||(s.value=t+"-"+n)});const h=k([]),D=["azure","ollama","xinference","openaiAgent"],R=(t,n)=>{p("update:modeName",n.modelName),p("update:modeId",n.modelId),p("change",t,n)},v=()=>{G({model_type:o.modelType,is_offline:o.isOffline}).then(t=>{let a=(t.data||[]).map(l=>{let{model_define:d,deployment_name:m,id:e}=l.model_config,i=`${d}-${m||""}-${e}`,r=[],N=[];o.modelType=="TEXT EMBEDDING"?r=l.model_info.vector_model_list:o.modelType=="RERANK"?r=l.model_info.rerank_model_list:o.modelType=="LLM"&&(r=l.model_info.llm_model_list);for(let g=0;g<r.length;g++){let u=r[g],S=u,A=e+"-"+u;D.indexOf(l.model_config.model_define)>-1&&l.model_config.deployment_name&&(S=l.model_config.deployment_name),N.push({key:e+"_"+u,label:S,name:u,deployment_name:m,model_config_id:e,model_define:d,value:A})}return{key:i,model_define:d,children:N,model_config_id:e,deployment_name:m,name:l.model_info.model_name,icon:l.model_info.model_icon_url}});a=B(C(a,"model_define"),a,"model_define"),a.length===0&&(s.value="无可用模型"),h.value=[...a],p("loaded",JSON.parse(JSON.stringify(a)))})};return I(()=>o.isOffline,()=>{v()}),F(()=>{v(),o.modeId&&o.modeName&&(s.value=o.modeId+"-"+o.modeName)}),(t,n)=>{const a=b,l=q,d=$,m=z;return c(),y(m,{value:s.value,"onUpdate:value":n[0]||(n[0]=e=>s.value=e),placeholder:f.placeholder,onChange:R,style:{width:"100%"}},{default:_(()=>[(c(!0),M(T,null,x(h.value,e=>(c(),y(d,{key:e.key},{label:_(()=>[X(a,{align:"center",gap:6},{default:_(()=>[L("img",{class:"model-icon",src:e.icon,alt:""},null,8,K),L("span",null,E(e.name),1)]),_:2},1024)]),default:_(()=>[(c(!0),M(T,null,x(e.children,i=>(c(),y(l,{value:i.value,modelId:i.model_config_id,modelName:i.name,key:i.key},{default:_(()=>[J(E(i.label),1)]),_:2},1032,["value","modelId","modelName"]))),128))]),_:2},1024))),128))]),_:1},8,["value","placeholder"])}}},P=w(Q,[["__scopeId","data-v-5c6a8e90"]]);export{P as M};
