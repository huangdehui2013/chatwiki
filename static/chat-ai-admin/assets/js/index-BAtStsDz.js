import{b as C,M as B,f as he,k as X,cR as be,cS as we,cL as te,B as Ee,cT as Se,cI as Le,d as Te,cU as xe}from"../../index-DJqZYlN8.js";import{h as Ie}from"./index-CQKu1YIs.js";import{e as c,B as x,M as f,Q as R,S as r,W as s,k as n,aa as Q,N as S,U as Be,a1 as ae,a2 as ne,a5 as Re,b as oe,x as Ce,o as De,Z as Ue,a7 as M,Y as J,u as Oe}from"./vue-chunks-Dpmhapcm.js";import{_ as K,F as G}from"./index-BearFCS_.js";import{_ as j}from"./TextArea-DEZsPG5C.js";import{_ as qe,S as Me}from"./share-popup-BDxEEv9r.js";import{C as Je}from"./CheckOutlined-D8sWUycq.js";import{_ as Ne,a as Ye}from"./RadioButton-BdTnsnL8.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./dayjs-BAOQ3IvD.js";import"./index-DzhuYAPB.js";import"./Trigger-DcF6kXOl.js";import"./isPlainObject--mHlhHEN.js";import"./responsiveObserve-D_TTA_LO.js";import"./collapseMotion-DmHD1G9F.js";import"./index-BY-bgrX3.js";import"./colors-CZV0Zir8.js";import"./QuestionCircleOutlined-D2lOE5qu.js";import"./FormItemContext-DcHP2mNJ.js";import"./statusUtils-Bnl8Rf7N.js";import"./index-Bn-6W96d.js";import"./inputProps-B4Qz7YgH.js";import"./index-DGofXs4a.js";import"./index-9XFVXge0.js";import"./Input-k3gxptQd.js";import"./Search-CxIvru6q.js";import"./SearchOutlined-C4P1S4P5.js";import"./Password-DASsPHld.js";import"./index-DyP1V5nr.js";import"./share-form-CzGYIhS2.js";import"./index-CGwIWR4F.js";import"./index-Dk60SqR7.js";import"./index-DT9vq-9c.js";import"./slide-B4S8cqER.js";import"./DownOutlined-D5t3juQ7.js";import"./move-B1-eDBNJ.js";import"./index-DLehNBk6.js";import"./Checkbox-DQSCt5wV.js";const Ve={class:"upload-ssl-form"},Pe={__name:"edit-title",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const A=h,b=u,m=c(),a=x({title:""}),p={title:[{required:!0,message:"请输入标题"}]},t=c(!1),v=l=>{a.title=l.title,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{A("ok",Q(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const L=j,g=K,y=G,T=B;return f(),R(T,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑标题",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",Ve,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(g,{label:"",name:"title"},{default:r(()=>[n(L,{rows:5,value:a.title,"onUpdate:value":i[0]||(i[0]=_=>a.title=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Xe=C(Pe,[["__scopeId","data-v-32d29b31"]]),Qe={class:"upload-ssl-form"},Ke={__name:"edit-desc",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const A=h,b=u,m=c(),a=x({content:""}),p={},t=c(!1),v=l=>{a.content=l.content,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{A("ok",Q(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const L=j,g=K,y=G,T=B;return f(),R(T,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑描述",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",Qe,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(g,{label:"",name:"content"},{default:r(()=>[n(L,{rows:5,value:a.content,"onUpdate:value":i[0]||(i[0]=_=>a.content=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Ge=C(Ke,[["__scopeId","data-v-661cb706"]]),je={class:"upload-ssl-form"},ze={__name:"edit-question-guide",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const A=h,b=u,m=c(),a=x({question:""}),p={question:[{required:!0,message:"请输入问题引导"}]},t=c(!1),v=l=>{a.question=l.question,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{A("ok",Q(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const L=j,g=K,y=G,T=B;return f(),R(T,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑问题引导",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",je,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(g,{label:"",name:"question"},{default:r(()=>[n(L,{rows:5,value:a.question,"onUpdate:value":i[0]||(i[0]=_=>a.question=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Fe=C(ze,[["__scopeId","data-v-680592b4"]]),We="data:image/png;base64,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",He={},se=u=>(ae("data-v-91f8ee88"),u=u(),ne(),u),Ze={class:"phone-wrapper"},$e={class:"phone-box"},et=se(()=>s("div",{class:"phone-header"},[s("img",{class:"navbar",src:We,alt:""})],-1)),tt={class:"phone-body"},ot=se(()=>s("div",{class:"phone-footer"},null,-1));function at(u,k){return f(),S("div",Ze,[s("div",$e,[et,s("div",tt,[Be(u.$slots,"default",{},void 0,!0)]),ot])])}const nt=C(He,[["render",at],["__scopeId","data-v-91f8ee88"]]);var st={VITE_BASE_API_URL:"",VITE_DROP_DEBUGGER:"true",VITE_DROP_CONSOLE:"true",VITE_SOURCEMAP:"false",VITE_USE_BUNDLE_ANALYZER:"true",VITE_USE_CSS_SPLIT:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const z=u=>(ae("data-v-d1cf448e"),u=u(),ne(),u),it={class:"home-preview"},lt={class:"toolbar-wrapper"},ct={class:"toolbar-left"},rt={class:"toolbar-item"},dt={class:"toolbar-right"},ut={key:0,class:"edit-user"},_t=["src"],mt={class:"user-name"},ft=z(()=>s("span",{class:"edit-status-text"},"编辑中...",-1)),pt={class:"action-item"},vt={key:1,class:"action-item"},yt=z(()=>s("span",null,"SEO设置",-1)),At={class:"action-item"},gt=z(()=>s("span",null,"编辑",-1)),kt={class:"preview-box"},ht={key:0,class:"mobile-box"},bt=["src"],wt={key:1,class:"pc-box"},Et=["src"],St={__name:"index",setup(u){const k=Re(),{getToken:h,user_id:A}=he(),b=oe(()=>k.query.library_id),m=c(null),a=c(new Date().getTime()),p=c(!1),t=x({doc_id:"",title:"",content:"",library_intro:"",library_name:"",library_key:""}),v=x({doc_id:"",is_pub:"",doc_key:"",seo_title:"",seo_desc:"",seo_keywords:""}),d=x({show:!1,user_name:"",avatar:"",nick_name:""}),w=async e=>{let o=await Se({id:e});return d.avatar=o.data.avatar,d.user_name=o.data.user_name,d.nick_name=o.data.nick_name,o},l=c(null),i=c(!1),L=e=>{t.title=e.title,i.value=!0,F().then(()=>{i.value=!1,l.value.close()}).catch(()=>{i.value=!1})},g=c(null),y=c(!1),T=e=>{t.content=e.content,y.value=!0,F().then(()=>{y.value=!1,g.value.close()}).catch(()=>{y.value=!1})},_=async()=>await Le({library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1}).then(o=>(t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,a.value=new Date().getTime(),o)),F=async()=>{await _()&&X.success("保存成功")},D=c(!1),ie=()=>{let e={library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1};D.value=!0,be(e).then(o=>{t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,D.value=!1,X.success("发布成功"),O(!1),a.value=new Date().getTime()}).catch(()=>{D.value=!1})},W=c(null),le=()=>{let e={library_key:t.library_key,seo_title:v.seo_title,seo_desc:v.seo_desc,seo_keywords:v.seo_keywords,doc_id:t.doc_id};W.value.open(e)},ce=()=>{Z(),a.value=new Date().getTime()},N=c(null),U=c(!1),E=x({id:"",question:""}),re=e=>{E.question=e.question,U.value=!0,we({library_key:t.library_key,id:E.id||"",question:E.question}).then(()=>{a.value=new Date().getTime(),U.value=!1,N.value.close()}).catch(()=>{U.value=!1})},Y=c("pc");let de=st.VITE_OPEN_DOC_HOST||"";const H=oe(()=>`${de}/manage/libDocHome/${t.library_key}?&v=${a.value}&token=${h}`),ue=()=>{Ie({id:b.value}).then(e=>{Object.assign(t,e.data)})},Z=()=>{te({doc_id:t.doc_id,library_key:t.library_key}).then(e=>{Object.assign(v,e.data);let o=e.data.edit_user&&e.data.edit_user!=0;o&&e.data.edit_user!=A&&(d.show=!0,w(e.data.edit_user)),o&&e.data.edit_user==A?O(!0):O(!1)})},_e=e=>{t.doc_id=e.doc_id,t.title=e.title,t.content=e.content,Z()},me=e=>{t.title=e.title,t.content=e.content,l.value.open(e)},fe=e=>{t.title=e.title,t.content=e.content,g.value.open(e)},$=e=>{E.id=e.id,E.question=e.question,N.value.open(e)},pe=e=>{E.id=e.id,E.question=e.question,B.confirm({title:"删除问题引导",content:"确定要删除该问题引导吗？",okText:"确定",cancelText:"取消",onOk(){xe({library_key:t.library_key,id:E.id}).then(()=>{X.success("删除成功"),a.value=new Date().getTime()})}})},ve=e=>{e.key=="title"&&me(e.data),e.key=="content"&&fe(e.data),e.key=="question"&&$(e.data)},ye=e=>{e.key=="question"&&$(e.data)},Ae=e=>{e.key=="question"&&pe(e.data)},ge=async()=>{try{let e=await te({doc_id:t.doc_id,library_key:t.library_key});if(e.data.edit_user&&e.data.edit_user!=0&&e.data.edit_user!=A){let I=await w(e.data.edit_user),V=I.data.nick_name||I.data.user_name;d.show=!0,B.warning({title:V+"正在编辑此文档",content:"需要其他协作者结束编辑并发布后才可以继续编辑",okText:"知道了"});return}_(),p.value=!0,d.show=!1}catch{return}},O=e=>{p.value=e,m.value.contentWindow.postMessage({action:"setEditStatus",data:{type:p.value}},"*")},ee=e=>{const o=e.data;o.action==="check_preview"&&m.value.contentWindow.postMessage({action:"setPreview",token:h},"*"),o.action==="init"&&(_e(o.data),p.value&&O(!0)),o.action==="edit"&&ve(o),o.action==="add"&&ye(o),o.action==="delete"&&Ae(o)};return Ce(()=>{ue(),window.addEventListener("message",ee)}),De(()=>{window.removeEventListener("message",ee)}),(e,o)=>{const I=Ye,V=Ne,P=Te,q=Ee;return f(),S("div",it,[s("div",lt,[s("div",ct,[s("div",rt,[n(V,{value:Y.value,"onUpdate:value":o[0]||(o[0]=ke=>Y.value=ke)},{default:r(()=>[n(I,{value:"pc"},{default:r(()=>[J("PC端样式")]),_:1}),n(I,{value:"mobile"},{default:r(()=>[J("移动端样式")]),_:1})]),_:1},8,["value"])])]),s("div",dt,[d.show&&d.user_name?(f(),S("div",ut,[s("img",{class:"user-avatar",src:d.avatar,alt:""},null,8,_t),s("span",mt,Ue(d.nick_name||d.user_name),1),ft])):M("",!0),s("div",pt,[n(qe,{ref:"sharePopupRef","base-url":"/open/home",docKey:t.library_key,libraryId:b.value},{default:r(()=>[n(q,null,{default:r(()=>[n(P,{class:"action-icon",name:"share",style:{"font-size":"16px"}}),J(" 分享")]),_:1})]),_:1},8,["docKey","libraryId"])]),p.value?(f(),S("div",vt,[n(q,{onClick:le},{default:r(()=>[n(P,{class:"action-icon",name:"jibenpeizhi",style:{"font-size":"16px",color:"#595959"}}),yt]),_:1})])):M("",!0),s("div",At,[p.value?(f(),R(q,{key:0,type:"primary",loading:D.value,onClick:ie},{default:r(()=>[n(Oe(Je)),J(" 发布")]),_:1},8,["loading"])):(f(),R(q,{key:1,type:"primary",onClick:ge},{default:r(()=>[n(P,{class:"action-icon",name:"edit",style:{"font-size":"16px",color:"#fff"}}),gt]),_:1}))])])]),s("div",kt,[Y.value=="mobile"?(f(),S("div",ht,[n(nt,null,{default:r(()=>[t.library_key?(f(),S("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:H.value,frameborder:"0"},null,8,bt)):M("",!0)]),_:1})])):(f(),S("div",wt,[t.library_key?(f(),S("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:H.value,frameborder:"0"},null,8,Et)):M("",!0)]))]),n(Xe,{ref_key:"editTitleRef",ref:l,onOk:L,"confirm-loading":i.value},null,8,["confirm-loading"]),n(Ge,{ref_key:"editDescRef",ref:g,onOk:T,"confirm-loading":y.value},null,8,["confirm-loading"]),n(Fe,{ref_key:"editQuestionGuideRef",ref:N,onOk:re,"confirm-loading":U.value},null,8,["confirm-loading"]),n(Me,{ref_key:"seoSettingRef",ref:W,onOk:ce},null,512)])}}},mo=C(St,[["__scopeId","data-v-d1cf448e"]]);export{mo as default};
