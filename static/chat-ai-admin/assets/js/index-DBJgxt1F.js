import{M as s,N as m,W as e,k as t,Y as L,Z as w,U as ue,a7 as A,Q as j,S as n,X as nt,a6 as Se,e as x,d as Z,B as Q,G as le,H as ce,u as k,aa as Y,a1 as K,a2 as G,a5 as it,F as z,$ as J,w as pe,l as at,j as Le,ad as be,af as ye,x as qe,D as lt,b as ke,a0 as ct,z as rt,ac as _t,V as dt,a9 as ut,p as pt}from"./vue-chunks-DWnFCQSz.js";import{b as T,d as re,B as ne,X as mt,Y as De,k as te,M as oe,Z as he,$ as vt,a0 as ht,e as ft,W as bt,a1 as we,E as yt}from"../../index-DQXF0oEW.js";import{_ as ge}from"./index-Dq7FbVld.js";import{C as kt,E as gt}from"./cu-upload-DR-ahUML.js";import"./index-9760vytK.js";import{I as me}from"./Input-COJTivTx.js";import{_ as Ce}from"./TextArea-Cc6YC843.js";import{C as Ve}from"./cu-scroll-BZhESYtD.js";import{f as $t,c as xt}from"./index-CchQf1sK.js";import{_ as wt}from"./index-TPMWTn8a.js";import{S as Ue}from"./index-BmqzJuQZ.js";import{D as St}from"./DownOutlined-Bq0bLGm4.js";import{U as qt}from"./UpOutlined-DA6kJIik.js";import{_ as ze,T as Pe}from"./index-C3GwfM_a.js";import{P as Ee}from"./PlusOutlined-CP-yUfey.js";import{_ as se}from"./index-BZQEdDUD.js";import{c as Te}from"./index-DaUzcbAM.js";import{S as Be,a as Qe,_ as Fe}from"./index-B-Rt9SA5.js";import{_ as Je}from"./index-DfejieBQ.js";import{_ as Re}from"./index-hPIuiQ85.js";import{Q as ee}from"./QuestionCircleOutlined-DN9kmFuV.js";import{_ as Ct,a as It}from"./index-Ktba8Tuo.js";import{_ as _e}from"./index-CUGUQ2OU.js";import{g as Ke}from"./index-CpYnoGfS.js";import{S as Lt}from"./SearchOutlined-Eloz0Xgr.js";import{S as Ut}from"./SyncOutlined-DvqqncSp.js";import{C as Ge,_ as He}from"./index-C791tQco.js";import{_ as We}from"./index-EaNfDv4H.js";import{_ as Et}from"./recommendation-AQ4_FPQ9.js";import{R as Rt}from"./RightOutlined-Ctvc7W-t.js";import{g as Ze}from"./index-CDNjx7uv.js";import{_ as Ot}from"./empty-CzGZrENG.js";import{d as Oe}from"./vuedraggable.umd-DPgBjE-X.js";import"./index-CGW9ahOu.js";import{R as At,_ as Mt}from"./RadioButton-Br4fysJT.js";import{F as Ne,_ as jt}from"./index-DpzELZe5.js";import{_ as Dt}from"./index-DwAmRhRT.js";import{u as Nt}from"./robot-DpRojvB8.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./FormItemContext-D4f_Sq6G.js";import"./index-J-L5YNWa.js";import"./Search-Cm7pOAiq.js";import"./isPlainObject-DGw0gsC3.js";import"./inputProps-Bb0ocHOp.js";import"./Password-DAfpdhAR.js";import"./statusUtils-B7nMMwz3.js";import"./index-DwY9A703.js";import"./Trigger-CC5n-pw8.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-CunZT9q_.js";import"./index-dYCqajUf.js";import"./shallowequal-C0Ji8tJB.js";import"./collapseMotion-ByInPrfq.js";import"./slide-DBTiAtg1.js";import"./Dropdown-Cb2ylcsA.js";import"./useRefs-CH9tJ50T.js";import"./pick-BcFOJSQC.js";import"./CheckOutlined-BrtNruPW.js";import"./move-DQ5ZIRU6.js";import"./index-DzhuYAPB.js";import"./Checkbox-CPCCCpS7.js";import"./index-CEo7CTw2.js";import"./responsiveObserve-D-e1nmNx.js";const Vt={class:"edit-box-header"},zt={class:"left-box"},Pt={class:"edit-box-title"},Tt={key:0},Bt={key:0,class:"title-tip"},Qt={class:"right-box"},Ft={class:"extra-box"},Jt={class:"actions-box"},Kt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(_,{emit:l}){const y=l,v=_,c=i=>{y("edit"),y("update:isEdit",i)},a=()=>{y("save")};return(i,S)=>{const o=re,g=ne,r=ge;return s(),m("div",{class:Se(["edit-box",{"is-edit":_.isEdit}])},[e("div",Vt,[e("div",zt,[t(o,{class:"edit-box-icon",name:v.iconName},null,8,["name"]),e("span",Pt,[L(w(v.title)+" ",1),i.$slots.icon?(s(),m("span",Tt,[ue(i.$slots,"icon",{},void 0,!0)])):A("",!0)]),i.$slots.tip?(s(),m("span",Bt,[ue(i.$slots,"tip",{},void 0,!0)])):A("",!0)]),e("div",Qt,[e("div",Ft,[ue(i.$slots,"extra",{},()=>[e("div",Jt,[v.isEdit?(s(),j(r,{key:0,gap:8},{default:n(()=>[t(g,{onClick:a,size:"small",type:"primary"},{default:n(()=>[L("保存")]),_:1}),t(g,{onClick:S[0]||(S[0]=$=>c(!1)),size:"small"},{default:n(()=>[L("取消")]),_:1})]),_:1})):(s(),j(g,{key:1,onClick:S[1]||(S[1]=$=>c(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:nt({..._.bodyStyle})},[ue(i.$slots,"default",{},void 0,!0)],4)],2)}}},X=T(Kt,[["__scopeId","data-v-dbe09743"]]),Ye=_=>(K("data-v-899bcb03"),_=_(),G(),_),Gt={class:"robot-form-box"},Ht={class:"form-item"},Wt=Ye(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Zt={class:"form-item-body robot-name-item"},Yt={class:"robot-avetar-upload"},Xt=["src"],eo={class:"robot-name-box"},to={class:"form-item"},oo=Ye(()=>e("div",{class:"form-item-label"},"简介",-1)),so={class:"form-item-body"},no={class:"robot-info-box"},io={class:"robot-name-box"},ao=["src"],lo={class:"robot-name"},co={class:"robot-intro"},ro={__name:"basic-config",setup(_){const l=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo"),c=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),a=()=>{v({...Y(c)}),l.value=!1},i=o=>{let g=o[0];return c.robot_avatar=g,mt(g).then(r=>{c.robot_avatar_url=r}),!1},S=()=>{c.robot_name=y.robot_name,c.robot_intro=y.robot_intro,c.robot_avatar=y.robot_avatar,c.robot_avatar_url=y.robot_avatar_url};return(o,g)=>{const r=me,$=Ce;return s(),j(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:l.value,"onUpdate:isEdit":g[2]||(g[2]=p=>l.value=p),onSave:a,onEdit:S},{default:n(()=>[le(e("div",Gt,[e("div",Ht,[Wt,e("div",Zt,[t(kt,{accept:"image/*",onChange:i},{default:n(()=>[e("div",Yt,[c.robot_avatar_url?(s(),m("img",{key:0,class:"robot-avetar",src:c.robot_avatar_url},null,8,Xt)):A("",!0)])]),_:1}),e("div",eo,[t(r,{value:c.robot_name,"onUpdate:value":g[0]||(g[0]=p=>c.robot_name=p),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",to,[oo,e("div",so,[t($,{rows:3,value:c.robot_intro,"onUpdate:value":g[1]||(g[1]=p=>c.robot_intro=p),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ce,l.value]]),le(e("div",no,[e("div",io,[e("img",{class:"robot-avatar",src:k(y).robot_avatar_url,alt:""},null,8,ao),e("span",lo,w(k(y).robot_name),1)]),e("div",co,w(k(y).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ce,!l.value]])]),_:1},8,["isEdit"])}}},_o=T(ro,[["__scopeId","data-v-899bcb03"]]),Xe=_=>(K("data-v-896a48d0"),_=_(),G(),_),uo={class:"ai-create-box"},po={class:"input-box"},mo=Xe(()=>e("span",null,"生成",-1)),vo={class:"quick-tags-box"},ho=Xe(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),fo={class:"ai-list-box"},bo={key:0,class:"loading-box"},yo={key:0,class:"prompt-list-box"},ko={class:"prompt-list"},go={class:"prompt-header"},$o={class:"prompt-title"},xo={class:"prompt-content"},wo={class:"prompt-list"},So={class:"prompt-header"},qo={class:"prompt-title"},Co={class:"prompt-content"},Io={class:"prompt-list"},Lo={class:"prompt-header"},Uo={class:"prompt-title"},Eo={class:"prompt-content"},Ro={class:"prompt-list"},Oo={class:"prompt-header"},Ao={class:"prompt-title"},Mo={class:"prompt-content"},jo={class:"prompt-list"},Do={class:"prompt-header"},No={class:"prompt-title"},Vo={class:"prompt-content"},zo={class:"prompt-header"},Po={class:"prompt-title"},To={class:"prompt-content"},Bo={key:1,class:"empty-box"},Qo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(_,{expose:l,emit:y}){const v=De.PRESENTED_IMAGE_SIMPLE,c=x(!1),a=x(!1),i=it().query,S=y,o=x(""),g=x(!1),r=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],$=x("在上方输入框输入要求，点击生成提示词"),p=()=>{d.value=!1,I.promptStruct=C,o.value="",$.value="在上方输入框输入要求，点击生成提示词",c.value=!0},d=x(!1),C={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},I=Q({promptStruct:C}),U=q=>{o.value=q},h=()=>{if(!o.value)return te.error("请输入AI 生成提示词");if(g.value)return te.error("正在生成中...");g.value=!0,$t({id:i.id,demand:o.value}).then(q=>{I.promptStruct=JSON.parse(q.data.promptStruct),d.value=!0}).finally(()=>{g.value=!1}).catch(q=>{d.value=!1,$.value=q.msg})},b=()=>{if(!d.value)return te.error("请先生成提示词");S("handleAiSave",I.promptStruct),c.value=!1};return l({show:p}),(q,f)=>{const M=ne,B=me,F=re,E=wt,N=Ue,D=De,u=Ve,H=oe;return s(),m("div",null,[t(H,{open:c.value,"onUpdate:open":f[1]||(f[1]=V=>c.value=V),title:"AI 生成提示词",width:746},{footer:n(()=>[t(M,{type:"primary",loading:a.value,onClick:b},{default:n(()=>[L("使用该提示")]),_:1},8,["loading"])]),default:n(()=>[e("div",uo,[e("div",po,[t(B,{style:{width:"100%"},value:o.value,"onUpdate:value":f[0]||(f[0]=V=>o.value=V),size:"large",onPressEnter:h,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:h},[t(F,{name:"ai-mark"}),mo])]),e("div",vo,[ho,(s(),m(z,null,J(r,V=>t(E,{key:V.title,onClick:P=>U(V.title),color:"blue"},{default:n(()=>[L(w(V.title),1)]),_:2},1032,["onClick"])),64))]),e("div",fo,[t(u,{style:{height:"100%"}},{default:n(()=>[g.value?(s(),m("div",bo,[t(N,{tip:"正在生成中..."})])):(s(),m(z,{key:1},[d.value?(s(),m("div",yo,[e("div",ko,[e("div",go,[e("div",$o,w(I.promptStruct.role.subject),1)]),e("div",xo,w(I.promptStruct.role.describe),1)]),e("div",wo,[e("div",So,[e("div",qo,w(I.promptStruct.task.subject),1)]),e("div",Co,w(I.promptStruct.task.describe),1)]),e("div",Io,[e("div",Lo,[e("div",Uo,w(I.promptStruct.constraints.subject),1)]),e("div",Eo,w(I.promptStruct.constraints.describe),1)]),e("div",Ro,[e("div",Oo,[e("div",Ao,w(I.promptStruct.output.subject),1)]),e("div",Mo,w(I.promptStruct.output.describe),1)]),e("div",jo,[e("div",Do,[e("div",No,w(I.promptStruct.tone.subject),1)]),e("div",Vo,w(I.promptStruct.tone.describe),1)]),(s(!0),m(z,null,J(I.promptStruct.custom,(V,P)=>(s(),m("div",{class:"prompt-list",key:P+V.key?V.key:""},[e("div",zo,[e("div",Po,w(V.subject),1)]),e("div",To,w(V.describe),1)]))),128))])):(s(),m("div",Bo,[t(D,{image:k(v),description:$.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Fo=T(Qo,[["__scopeId","data-v-896a48d0"]]),Jo={class:"prompt-box"},Ko={class:"tab-header"},Go={key:0,class:"opt-block"},Ho={key:1,class:"opt-block"},Wo={class:"tip-text"},Zo={key:0,class:"prompt-list-box"},Yo={class:"prompt-list"},Xo={class:"prompt-header"},es={class:"prompt-title"},ts={key:0,class:"btn-wrapper-box"},os={class:"prompt-content"},ss={class:"prompt-list"},ns={class:"prompt-header"},is={class:"prompt-title"},as={key:0,class:"btn-wrapper-box"},ls={class:"prompt-content"},cs={class:"prompt-list"},rs={class:"prompt-header"},_s={class:"prompt-title"},ds={key:0,class:"btn-wrapper-box"},us={class:"prompt-content"},ps={class:"prompt-list"},ms={class:"prompt-header"},vs={class:"prompt-title"},hs={key:0,class:"btn-wrapper-box"},fs={class:"swich-item"},bs={class:"swich-item"},ys={class:"prompt-content"},ks={class:"prompt-list"},gs={class:"prompt-header"},$s={class:"prompt-title"},xs={key:0,class:"btn-wrapper-box"},ws={class:"prompt-content"},Ss={class:"prompt-header"},qs={class:"prompt-title",style:{flex:"1"}},Cs={key:0,class:"btn-wrapper-box"},Is=["onClick"],Ls={class:"prompt-content"},Us={key:0,class:"add-theme-block"},Es={class:"show-more-block"},Rs={key:1,class:"diy-prompt-box"},Os={key:0,class:"diy-switch-box"},As={class:"swich-item"},Ms={class:"swich-item"},ie="- 请使用markdown格式回答问题。",ae="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",js={__name:"system-prompt-words",setup(_){const l=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo");let c={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const a=x({}),i=x(!1),S=x(!1),o=x(!1),g=x(!1),r=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),$=x(localStorage.getItem("system_prompt_words_ishide")=="1"),p=()=>{$.value=!$.value,localStorage.setItem("system_prompt_words_ishide",$.value?1:0)},d=(D,u)=>D.includes(u),C=x(y.prompt_type);pe(()=>y,()=>{r.prompt=y.prompt,r.prompt_struct=y.prompt_struct,a.value=y.prompt_struct_default},{immediate:!0,deep:!0}),pe(()=>r.prompt_struct.output.describe,D=>{i.value=d(D,ie),S.value=d(D,ae)},{immediate:!0,deep:!0}),pe(()=>r.prompt,D=>{o.value=d(D,ie),g.value=d(D,ae)},{immediate:!0,deep:!0});const I=(D,u)=>{D?(u=="outSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ie:r.prompt_struct.output.describe+=ie),u=="imgSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ae:r.prompt_struct.output.describe+=ae)):(u=="outSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),u=="imgSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ae,"g"),"")),r.prompt_struct.output.describe=r.prompt_struct.output.describe.trim())},U=(D,u)=>{D?(u=="outDiySwitch"&&(r.prompt?r.prompt+=`
`+ie:r.prompt+=ie),u=="imgDiySwitch"&&(r.prompt?r.prompt+=`
`+ae:r.prompt+=ae)):(u=="outDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ie,"g"),"")),u=="imgDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ae,"g"),"")),r.prompt=r.prompt.trim())},h=D=>{r.prompt_struct[D].describe=a.value[D].describe},b=()=>{r.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),C.value=1},q=D=>{r.prompt_struct.custom.splice(D,1)},f=()=>{v({...Y(r),prompt_type:C.value}),l.value=!1},M=D=>{C.value=1,v({prompt_type:C.value,prompt:r.prompt,prompt_struct:D}),l.value=!1},B=()=>{l.value=!0},F=()=>{l.value=!1},E=x(null),N=()=>{E.value.show()};return(D,u)=>{const H=ze,V=Pe,P=re,O=ne,W=ge,de=Ce,$e=se,st=me;return s(),m("div",Jo,[e("div",Ko,[t(V,{activeKey:C.value,"onUpdate:activeKey":u[0]||(u[0]=R=>C.value=R)},{default:n(()=>[(s(),j(H,{key:1,tab:"结构化提示词"})),(s(),j(H,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),l.value?(s(),m("div",Go,[e("div",{class:"ai-mark-box",onClick:N},[t(P,{name:"ai-mark"}),L(" AI自动生成 ")]),t(W,{gap:8},{default:n(()=>[t(O,{size:"small",type:"primary",onClick:f},{default:n(()=>[L("保存")]),_:1}),t(O,{size:"small",onClick:F},{default:n(()=>[L("取消")]),_:1})]),_:1})])):(s(),m("div",Ho,[e("span",Wo,"当前类型："+w(C.value==1?"结构化提示词":"自定义提示词"),1),t(O,{size:"small",onClick:B},{default:n(()=>[L("修改")]),_:1})]))]),C.value==1?(s(),m("div",Zo,[e("div",Yo,[e("div",Xo,[e("div",es,w(r.prompt_struct.role.subject),1),l.value?(s(),m("div",ts,[e("a",{onClick:u[1]||(u[1]=R=>h("role"))},"恢复默认")])):A("",!0)]),e("div",os,[t(de,{bordered:!1,disabled:!l.value,value:r.prompt_struct.role.describe,"onUpdate:value":u[2]||(u[2]=R=>r.prompt_struct.role.describe=R),placeholder:k(c).role},null,8,["disabled","value","placeholder"])])]),e("div",ss,[e("div",ns,[e("div",is,w(r.prompt_struct.task.subject),1),l.value?(s(),m("div",as,[e("a",{onClick:u[3]||(u[3]=R=>h("task"))},"恢复默认")])):A("",!0)]),e("div",ls,[t(de,{bordered:!1,disabled:!l.value,value:r.prompt_struct.task.describe,"onUpdate:value":u[4]||(u[4]=R=>r.prompt_struct.task.describe=R),placeholder:k(c).task},null,8,["disabled","value","placeholder"])])]),$.value?(s(),m(z,{key:0},[e("div",cs,[e("div",rs,[e("div",_s,w(r.prompt_struct.constraints.subject),1),l.value?(s(),m("div",ds,[e("a",{onClick:u[5]||(u[5]=R=>h("constraints"))},"恢复默认")])):A("",!0)]),e("div",us,[t(de,{bordered:!1,disabled:!l.value,value:r.prompt_struct.constraints.describe,"onUpdate:value":u[6]||(u[6]=R=>r.prompt_struct.constraints.describe=R),placeholder:k(c).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",ps,[e("div",ms,[e("div",vs,w(r.prompt_struct.output.subject),1),l.value?(s(),m("div",hs,[e("div",fs,[L(" 输出markdown： "),t($e,{onChange:u[7]||(u[7]=R=>I(R,"outSwitch")),checked:i.value,"onUpdate:checked":u[8]||(u[8]=R=>i.value=R),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",bs,[L(" 回复图片： "),t($e,{onChange:u[9]||(u[9]=R=>I(R,"imgSwitch")),checked:S.value,"onUpdate:checked":u[10]||(u[10]=R=>S.value=R),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:u[11]||(u[11]=R=>h("output"))},"恢复默认")])):A("",!0)]),e("div",ys,[t(de,{bordered:!1,disabled:!l.value,value:r.prompt_struct.output.describe,"onUpdate:value":u[12]||(u[12]=R=>r.prompt_struct.output.describe=R),placeholder:k(c).output},null,8,["disabled","value","placeholder"])])]),e("div",ks,[e("div",gs,[e("div",$s,w(r.prompt_struct.tone.subject),1),l.value?(s(),m("div",xs,[e("a",{onClick:u[13]||(u[13]=R=>h("tone"))},"恢复默认")])):A("",!0)]),e("div",ws,[t(de,{bordered:!1,disabled:!l.value,value:r.prompt_struct.tone.describe,"onUpdate:value":u[14]||(u[14]=R=>r.prompt_struct.tone.describe=R),placeholder:k(c).tone},null,8,["disabled","value","placeholder"])])]),(s(!0),m(z,null,J(r.prompt_struct.custom,(R,je)=>(s(),m("div",{class:"prompt-list",key:je+R.key?R.key:""},[e("div",Ss,[e("div",qs,[t(st,{bordered:!1,disabled:!l.value,style:{width:"100%"},value:R.subject,"onUpdate:value":xe=>R.subject=xe,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),l.value?(s(),m("div",Cs,[e("div",{class:"hover-btn-box",onClick:xe=>q(je)},[t(k(he))],8,Is)])):A("",!0)]),e("div",Ls,[t(de,{bordered:!1,disabled:!l.value,value:R.describe,"onUpdate:value":xe=>R.describe=xe,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),l.value?(s(),m("div",Us,[t(O,{onClick:b,block:"",icon:at(k(Ee))},{default:n(()=>[L("添加主题")]),_:1},8,["icon"])])):A("",!0)],64)):A("",!0),e("div",Es,[e("div",{class:"btn-item",onClick:p},[$.value?(s(),m(z,{key:1},[L("收起"),t(k(qt))],64)):(s(),m(z,{key:0},[L("展开"),t(k(St))],64))])])])):(s(),m("div",Rs,[l.value?(s(),m("div",Os,[e("div",As,[L(" 输出markdown： "),t($e,{size:"small",onChange:u[15]||(u[15]=R=>U(R,"outDiySwitch")),checked:o.value,"onUpdate:checked":u[16]||(u[16]=R=>o.value=R),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ms,[L(" 回复图片： "),t($e,{size:"small",onChange:u[17]||(u[17]=R=>U(R,"imgDiySwitch")),checked:g.value,"onUpdate:checked":u[18]||(u[18]=R=>g.value=R),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):A("",!0),t(de,{bordered:l.value,value:r.prompt,"onUpdate:value":u[19]||(u[19]=R=>r.prompt=R),disabled:!l.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(Fo,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:E},null,512)])}}},Ds=T(js,[["__scopeId","data-v-5a6a6277"]]),fe=_=>(K("data-v-45e42f1f"),_=_(),G(),_),Ns={class:"actions-box"},Vs={class:"setting-info-block"},zs={class:"set-item w-100"},Ps={class:"set-item"},Ts={class:"set-item"},Bs={class:"set-item"},Qs={class:"set-item"},Fs={class:"form-box"},Js={class:"form-item"},Ks=fe(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),Gs={class:"form-item-body"},Hs=["src"],Ws={key:0},Zs={key:1},Ys={class:"form-item"},Xs={class:"form-item-label"},en=fe(()=>e("span",null,"温度 ",-1)),tn={class:"form-item-body"},on={class:"number-box"},sn={class:"number-slider-box"},nn={class:"number-input-box"},an={class:"form-item"},ln={class:"form-item-label"},cn=fe(()=>e("span",null,"最大token ",-1)),rn={class:"form-item-body"},_n={class:"number-box"},dn={class:"number-slider-box"},un={class:"number-input-box"},pn={class:"form-item"},mn={class:"form-item-label"},vn=fe(()=>e("span",null,"上下文数量 ",-1)),hn={class:"form-item-body"},fn={class:"number-box"},bn={class:"number-slider-box"},yn={class:"number-input-box"},kn={class:"form-item justify-between"},gn={class:"form-item-label"},$n=fe(()=>e("span",null,"显示推理过程 ",-1)),xn=fe(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),wn={__name:"model-settings",setup(_){const l=["azure","ollama","xinference","openaiAgent"],y=["azure"],v=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),c=x([]),a=x(!1),{robotInfo:i,updateRobotInfo:S}=Z("robotInfo"),o=Q({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),g=x(""),r=x(""),$=x(""),p=(h,b)=>{const q=b.current_obj;o.use_model=l.indexOf(q.model_define)>-1&&q.deployment_name?q.deployment_name:q.name,g.value=q.model_define,o.model_config_id=q.id||b.model_config_id},d=()=>{$.value=o.use_model,y.indexOf(g.value)>-1&&(o.use_model="默认"),S({...Y(o)}),a.value=!1},C=h=>{h||(g.value=r.value),l.indexOf(g.value)>-1?o.use_model=$.value:o.use_model=i.use_model,o.model_config_id=i.model_config_id,o.temperature=i.temperature,o.max_token=i.max_token,o.context_pair=i.context_pair,o.think_switch=Number(i.think_switch),a.value=h};Le(()=>{l.indexOf(g.value)>-1?o.use_model=$.value:o.use_model=i.use_model,o.model_config_id=i.model_config_id,o.temperature=i.temperature,o.max_token=i.max_token,o.context_pair=i.context_pair,o.think_switch=Number(i.think_switch)});function I(h,b,q){const f=new Set(h.map(M=>M.model_define));return b.filter(M=>{let B=M[q];f.has(B)&&h.filter(F=>{if(F.model_define==B)return F.children=ht(F.children,M.children),!1})}),h}return(()=>{Te({model_type:"LLM"}).then(h=>{$.value=i.use_model;let b=h.data||[],q=[];c.value=b.map(f=>{q=[];for(let M=0;M<f.model_info.llm_model_list.length;M++){const B=f.model_info.llm_model_list[M];l.indexOf(f.model_info.model_define)>-1&&i.model_config_id==f.model_config.id&&($.value=f.model_config.deployment_name,g.value=f.model_info.model_define,r.value=f.model_info.model_define),q.push({name:B,deployment_name:f.model_config.deployment_name,id:f.model_config.id,model_define:f.model_info.model_define})}return{id:f.model_config.id,name:f.model_info.model_name,model_define:f.model_info.model_define,icon:f.model_info.model_icon_url,children:q,deployment_name:f.model_config.deployment_name}}),c.value=I(vt(c.value,"model_define"),c.value,"model_define")})})(),(h,b)=>{const q=ne,f=ge,M=Be,B=Qe,F=Fe,E=Ct,N=_e,D=Je,u=Re,H=se,V=It,P=oe;return s(),j(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:a.value,"onUpdate:isEdit":b[10]||(b[10]=O=>a.value=O)},{extra:n(()=>[e("div",Ns,[t(q,{onClick:b[0]||(b[0]=O=>C(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1})])]),default:n(()=>[e("div",Vs,[e("div",zs,[L(" LLM模型： "),e("span",null,w(o.use_model),1)]),e("div",Ps,[L(" 温度： "),e("span",null,w(o.temperature),1)]),e("div",Ts,[L(" 最大token： "),e("span",null,w(o.max_token),1)]),e("div",Bs,[L(" 上下文数量： "),e("span",null,w(o.context_pair),1)]),e("div",Qs,[L(" 显示推理过程： "),e("span",null,w(o.think_switch==1?"开":"关"),1)])]),t(P,{open:a.value,"onUpdate:open":b[9]||(b[9]=O=>a.value=O),width:672,title:"模型设置",onOk:d},{default:n(()=>[e("div",Fs,[t(V,{gutter:[32,24]},{default:n(()=>[t(E,be(ye(v)),{default:n(()=>[e("div",Js,[Ks,e("div",Gs,[t(F,{value:o.use_model,"onUpdate:value":b[1]||(b[1]=O=>o.use_model=O),placeholder:"请选择LLM模型",onChange:p,style:{width:"100%"}},{default:n(()=>[(s(!0),m(z,null,J(c.value,O=>(s(),j(B,{key:O.id},{label:n(()=>[t(f,{align:"center",gap:6},{default:n(()=>[e("img",{class:"model-icon",src:O.icon,alt:""},null,8,Hs),L(w(O.name),1)]),_:2},1024)]),default:n(()=>[(s(!0),m(z,null,J(O.children,W=>(s(),j(M,{value:l.indexOf(O.model_define)>-1&&W.deployment_name?W.deployment_name:W.name+W.id,model_config_id:O.id,current_obj:W,key:W.name+W.id},{default:n(()=>[l.indexOf(O.model_define)>-1&&W.deployment_name?(s(),m("span",Ws,w(W.deployment_name),1)):(s(),m("span",Zs,w(W.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(E,be(ye(v)),{default:n(()=>[e("div",Ys,[e("div",Xs,[en,t(N,null,{title:n(()=>[L("温度越低，回答越严谨。温度越高，回答越发散。")]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",tn,[e("div",on,[e("div",sn,[t(D,{class:"custom-slider",value:o.temperature,"onUpdate:value":b[2]||(b[2]=O=>o.temperature=O),min:0,max:2,step:.1},null,8,["value"])]),e("div",nn,[t(u,{value:o.temperature,"onUpdate:value":b[3]||(b[3]=O=>o.temperature=O),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(E,be(ye(v)),{default:n(()=>[e("div",an,[e("div",ln,[cn,t(N,null,{title:n(()=>[L("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",rn,[e("div",_n,[e("div",dn,[t(D,{class:"custom-slider",value:o.max_token,"onUpdate:value":b[4]||(b[4]=O=>o.max_token=O),min:0,max:100*1024},null,8,["value"])]),e("div",un,[t(u,{value:o.max_token,"onUpdate:value":b[5]||(b[5]=O=>o.max_token=O),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(E,be(ye(v)),{default:n(()=>[e("div",pn,[e("div",mn,[vn,t(N,null,{title:n(()=>[L("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",hn,[e("div",fn,[e("div",bn,[t(D,{class:"custom-slider",value:o.context_pair,"onUpdate:value":b[6]||(b[6]=O=>o.context_pair=O),min:0,max:10},null,8,["value"])]),e("div",yn,[t(u,{value:o.context_pair,"onUpdate:value":b[7]||(b[7]=O=>o.context_pair=O),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(E,be(ye(v)),{default:n(()=>[e("div",kn,[e("div",gn,[$n,t(N,null,{title:n(()=>[xn]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),t(H,{checked:o.think_switch,"onUpdate:checked":b[8]||(b[8]=O=>o.think_switch=O),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Sn=T(wn,[["__scopeId","data-v-45e42f1f"]]),qn={class:"library-checkbox-box"},Cn={class:"list-tools"},In={class:"list-box",ref:"scrollContainer"},Ln={class:"library-name"},Un={class:"library-desc"},En={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:y}){const v=y,c=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),a=x(!1),i=U=>{p(),c.checkedList=U,a.value=!0},S=()=>{a.value=!1,$()},o=x(""),g=()=>{p()},r=x([]),$=()=>{v("change",[...c.checkedList])},p=async()=>{const U=await Ke({library_name:o.value,type:""});if(U){let h=U.data||[];r.value=h}},d=x(!1),C=async()=>{d.value=!0,await p(),d.value=!1,te.success("刷新完成")},I=()=>{window.open("/#/library/list")};return l({open:i}),(U,h)=>{const b=We,q=me,f=ne,M=Ge,B=He,F=Ue,E=oe;return s(),j(E,{width:"746px",open:a.value,"onUpdate:open":h[2]||(h[2]=N=>a.value=N),title:"关联知识库",onOk:S},{default:n(()=>[e("div",qn,[t(b,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Cn,[e("div",null,[t(q,{style:{width:"282px"},value:o.value,"onUpdate:value":h[0]||(h[0]=N=>o.value=N),placeholder:"请输入知识库名称搜索",onChange:g},{suffix:n(()=>[t(k(Lt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(f,{style:{"margin-right":"8px"},onClick:C},{default:n(()=>[t(k(Ut)),L(" 刷新 ")]),_:1}),t(f,{type:"primary",ghost:"",onClick:I},{default:n(()=>[L("新建知识库")]),_:1})])]),t(F,{spinning:d.value,delay:100},{default:n(()=>[t(B,{value:c.checkedList,"onUpdate:value":h[1]||(h[1]=N=>c.checkedList=N),style:{width:"100%"}},{default:n(()=>[e("div",In,[(s(!0),m(z,null,J(r.value,N=>(s(),m("div",{class:"list-item-wraapper",key:N.id},[t(M,{class:"list-item",value:N.id},{default:n(()=>[e("div",Ln,w(N.library_name),1),e("div",Un,w(N.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Rn=T(En,[["__scopeId","data-v-75c5cc9c"]]),Ie=_=>(K("data-v-a2abcb20"),_=_(),G(),_),On={class:"recall-settings-box"},An={class:"form-box"},Mn={class:"form-item is-required"},jn=Ie(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Dn={class:"form-item-body"},Nn={class:"retrieval-mode-items"},Vn=["onClick"],zn={class:"retrieval-mode-title"},Pn={class:"title-text"},Tn={key:0,style:{width:"32px"},src:Et,alt:""},Bn={class:"retrieval-mode-desc"},Qn={class:"form-item"},Fn={class:"form-item-label"},Jn=Ie(()=>e("span",null,"Top K ",-1)),Kn={class:"form-item-body"},Gn={class:"number-box"},Hn={class:"number-slider-box"},Wn={class:"number-input-box"},Zn={key:0,class:"form-item"},Yn={class:"form-item-label"},Xn=Ie(()=>e("span",null,"相似度阈值 ",-1)),ei={class:"form-item-body"},ti={class:"number-box"},oi={class:"number-slider-box"},si={class:"number-input-box"},ni={class:"form-item"},ii={class:"form-item-label"},ai=Ie(()=>e("span",null,"Rerank模型",-1)),li={key:0,class:"form-item-body"},ci=["src"],ri={__name:"recall-settings-alert",emits:["change"],setup(_,{expose:l,emit:y}){const v=y,c=x([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),a=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),i=x(!1),S=U=>{I(),a.rerank_status=U.rerank_status||0,a.rerank_use_model=U.rerank_use_model||void 0,a.rerank_model_config_id=U.rerank_model_config_id>0?U.rerank_model_config_id:"",a.top_k=U.top_k,a.similarity=U.similarity,a.search_type=U.search_type,i.value=!0},o=(U,h)=>{if(!U||!h){a.rerank_model_config_id="";return}a.rerank_model_config_id=h.rerank_model_config_id},g=U=>{U==0&&(a.rerank_model_config_id="",a.rerank_use_model="")},r=U=>{a.search_type=U},$=()=>a.rerank_status==1&&!a.rerank_model_config_id,p=()=>{if($())return te.error("请选择Rerank模型");i.value=!1,d()},d=()=>{v("change",Y(a))},C=x([]),I=()=>{Te({model_type:"RERANK"}).then(U=>{let h=U.data||[];C.value=h.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})};return l({open:S}),(U,h)=>{const b=re,q=_e,f=Je,M=Re,B=se,F=Be,E=Qe,N=Fe,D=oe;return s(),j(D,{width:"746px",open:i.value,"onUpdate:open":h[6]||(h[6]=u=>i.value=u),title:"召回设置",onOk:p},{default:n(()=>[e("div",On,[e("div",An,[e("div",Mn,[jn,e("div",Dn,[e("div",Nn,[(s(!0),m(z,null,J(c.value,u=>(s(),m("div",{class:Se(["retrieval-mode-item",{active:a.search_type==u.value}]),key:u.value,onClick:H=>r(u.value)},[a.search_type==u.value?(s(),j(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):A("",!0),e("div",zn,[t(b,{name:u.iconName,class:"title-icon"},null,8,["name"]),e("span",Pn,w(u.title),1),u.isRecommendation?(s(),m("img",Tn)):A("",!0)]),e("div",Bn,w(u.desc),1)],10,Vn))),128))])])]),e("div",Qn,[e("div",Fn,[Jn,t(q,null,{title:n(()=>[L("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",Kn,[e("div",Gn,[e("div",Hn,[t(f,{class:"custom-slider",value:a.top_k,"onUpdate:value":h[0]||(h[0]=u=>a.top_k=u),min:1,max:10},null,8,["value"])]),e("div",Wn,[t(M,{value:a.top_k,"onUpdate:value":h[1]||(h[1]=u=>a.top_k=u),min:1,max:10},null,8,["value"])])])])]),a.search_type<=2?(s(),m("div",Zn,[e("div",Yn,[Xn,t(q,null,{title:n(()=>[L("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:n(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",ei,[e("div",ti,[e("div",oi,[t(f,{class:"custom-slider",value:a.similarity,"onUpdate:value":h[2]||(h[2]=u=>a.similarity=u),min:0,max:1,step:.01},null,8,["value"])]),e("div",si,[t(M,{value:a.similarity,"onUpdate:value":h[3]||(h[3]=u=>a.similarity=u),min:0,max:1,step:.01},null,8,["value"])])])])])):A("",!0),e("div",ni,[e("div",ii,[ai,L("   "),t(B,{checkedValue:1,unCheckedValue:0,checked:a.rerank_status,"onUpdate:checked":h[4]||(h[4]=u=>a.rerank_status=u),onChange:g},null,8,["checked"])]),a.rerank_status==1?(s(),m("div",li,[t(N,{allowClear:"",value:a.rerank_use_model,"onUpdate:value":h[5]||(h[5]=u=>a.rerank_use_model=u),placeholder:"请选择Rerank模型",onChange:o,style:{width:"60%"}},{default:n(()=>[(s(!0),m(z,null,J(C.value,u=>(s(),j(E,{key:u.id},{label:n(()=>[e("span",null,[e("img",{class:"model-icon",src:u.icon,alt:""},null,8,ci)])]),default:n(()=>[(s(!0),m(z,null,J(u.children,H=>(s(),j(F,{value:H,rerank_model_config_id:u.id,key:H},{default:n(()=>[e("span",null,w(H),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):A("",!0)])])])]),_:1},8,["open"])}}},_i=T(ri,[["__scopeId","data-v-a2abcb20"]]),di=_=>(K("data-v-a87bd0fa"),_=_(),G(),_),ui={class:"list-box"},pi=["onClick"],mi={class:"avater-box"},vi=["src"],hi={class:"content-box"},fi={class:"title-block"},bi=di(()=>e("div",{class:"tag-icon"},"Graph",-1)),yi={class:"title-text"},ki={class:"desc-box"},gi={class:"right-icon"},$i={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(_,{expose:l,emit:y}){const v=y,c=_,a=x(!1);pe(()=>c.list,()=>{c.list.length==0&&(a.value=!1)},{});const i=()=>{a.value=!0},S=()=>{document.visibilityState==="visible"&&v("refreshList")};qe(()=>{document.addEventListener("visibilitychange",S)}),lt(()=>{document.removeEventListener("visibilitychange",S)});const o=g=>{window.open(`/#/library/details/knowledge-config?id=${g.id}`)};return l({show:i}),(g,r)=>{const $=We,p=Ve,d=oe;return s(),m("div",null,[t(d,{open:a.value,"onUpdate:open":r[0]||(r[0]=C=>a.value=C),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:n(()=>[t($,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(p,{scrollbar:!1,style:{height:"400px"}},{default:n(()=>[e("div",ui,[(s(!0),m(z,null,J(c.list,C=>(s(),m("div",{class:"list-item",onClick:I=>o(C),key:C.id},[e("div",mi,[e("img",{src:C.avatar,alt:""},null,8,vi)]),e("div",hi,[e("div",fi,[bi,e("div",yi,w(C.library_name),1)]),e("div",ki,w(C.library_intro),1)]),e("div",gi,[t(k(Rt))])],8,pi))),128))])]),_:1})]),_:1},8,["open"])])}}},xi=T($i,[["__scopeId","data-v-a87bd0fa"]]),wi={class:"actions-box"},Si={key:0,class:"library-list"},qi=["onClick"],Ci=["onClick"],Ii={class:"library-name"},Li={class:"library-name-text"},Ui={class:"library-intro"},Ei={class:"setting-info-block"},Ri={class:"set-item"},Oi={key:0},Ai={key:1},Mi={key:2},ji={key:3},Di={class:"set-item"},Ni={key:0,class:"set-item"},Vi={class:"set-item"},zi={key:0},Pi={key:1},Ti={__name:"index",setup(_){const{getStorage:l,removeStorage:y}=bt("localStorage"),v=ft(),c=ke(()=>{var E;return((E=v.companyInfo)==null?void 0:E.neo4j_status)=="true"}),a=x(!1),{robotInfo:i,updateRobotInfo:S}=Z("robotInfo"),o=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),g=x([]),r=x(null),$=ke(()=>g.value.filter(E=>o.library_ids.includes(E.id))),p=ke(()=>$.value.filter(E=>E.graph_switch==0)),d=E=>{let N=o.library_ids.indexOf(E.id);o.library_ids.splice(N,1),f()},C=E=>{o.library_ids=[...E],f()},I=()=>{r.value.open([...o.library_ids])},U=x(null),h=()=>{U.value.open(Y(o))},b=x(null),q=E=>{o.rerank_status=E.rerank_status,o.rerank_use_model=E.rerank_use_model,o.rerank_model_config_id=E.rerank_model_config_id,o.top_k=E.top_k,o.similarity=E.similarity,o.search_type=E.search_type,(E.search_type==1||E.search_type==4)&&p.value.length>0&&b.value.show(),f()},f=()=>{let E={...Y(o)};E.library_ids=E.library_ids.join(","),S({...E})},M=async()=>{const E=await Ke({type:""});E&&(g.value=E.data||[])},B=()=>{oe.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){I()}})};o.rerank_use_model=i.rerank_use_model||void 0,Le(()=>{o.library_ids=i.library_ids.split(","),o.rerank_status=i.rerank_status||0,o.rerank_use_model=i.rerank_use_model||void 0,o.rerank_model_config_id=i.rerank_model_config_id||"",o.top_k=i.top_k,o.similarity=i.similarity,o.search_type=i.search_type});const F=E=>{window.open(`#/library/details/knowledge-document?id=${E.id}`)};return qe(()=>{M(),l("showNoLibraryTip")&&(B(),y("showNoLibraryTip"))}),(E,N)=>{const D=ne,u=ge,H=_e;return s(),j(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:a.value,"onUpdate:isEdit":N[0]||(N[0]=V=>a.value=V),bodyStyle:{padding:0}},{extra:n(()=>[e("div",wi,[t(u,{gap:8},{default:n(()=>[t(D,{size:"small",onClick:h},{default:n(()=>[L("召回设置")]),_:1}),t(D,{size:"small",onClick:I},{default:n(()=>[L("关联知识库")]),_:1})]),_:1})])]),default:n(()=>[$.value.length>0?(s(),m("div",Si,[(s(!0),m(z,null,J($.value,V=>(s(),m("div",{class:"library-item",key:V.id,onClick:P=>F(V)},[e("span",{class:"close-btn",onClick:ct(P=>d(V),["stop"])},[t(k(he))],8,Ci),e("div",Ii,[c.value?(s(),j(H,{key:0},{title:n(()=>[L(w(V.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:n(()=>[e("div",{class:Se(["graph-tag",{active:V.graph_switch==1}])},"Graph",2)]),_:2},1024)):A("",!0),e("div",Li,w(V.library_name),1)]),e("div",Ui,w(V.library_intro),1)],8,qi))),128))])):A("",!0),e("div",Ei,[e("div",Ri,[L(" 检索模式： "),o.search_type==1?(s(),m("span",Oi,"混合检索")):A("",!0),o.search_type==2?(s(),m("span",Ai,"向量检索")):A("",!0),o.search_type==3?(s(),m("span",Mi,"全文检索")):A("",!0),o.search_type==4?(s(),m("span",ji,"知识图谱检索")):A("",!0)]),e("div",Di,[L(" Top K： "),e("span",null,w(o.top_k),1)]),o.search_type<=2?(s(),m("div",Ni,[L(" 相似度阈值： "),e("span",null,w(o.similarity),1)])):A("",!0),e("div",Vi,[L(" Rerank模型： "),o.rerank_status==0?(s(),m("span",zi,"关")):(s(),m("span",Pi,w(o.rerank_use_model),1))])]),t(Rn,{ref_key:"librarySelectAlertRef",ref:r,onChange:C},null,512),t(_i,{ref_key:"recallSettingsAlertRef",ref:U,onChange:q},null,512),t(xi,{list:p.value,onRefreshList:M,ref_key:"noOpenGraphModalRef",ref:b},null,8,["list"])]),_:1},8,["isEdit"])}}},Bi=T(Ti,[["__scopeId","data-v-984e0c25"]]),Qi=_=>(K("data-v-b559dd08"),_=_(),G(),_),Fi={class:"library-checkbox-box"},Ji={class:"list-box",ref:"scrollContainer"},Ki={class:"library-name"},Gi={class:"library-desc"},Hi={key:0,class:"empty-box"},Wi=Qi(()=>e("img",{src:Ot,alt:""},null,-1)),Zi={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:y}){const v=y,c=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),a=x(!1),i=d=>{r(),c.checkedList=d,a.value=!0},S=()=>{a.value=!1,g()};x("");const o=x([]),g=()=>{v("change",[...c.checkedList])},r=async()=>{const d=await Ze();if(d){let C=d.data||[];o.value=C}},$=x(!1),p=()=>{window.open("/#/database/list")};return l({open:i}),(d,C)=>{const I=Ge,U=He,h=Ue,b=oe;return s(),j(b,{width:"746px",open:a.value,"onUpdate:open":C[1]||(C[1]=q=>a.value=q),title:"关联数据表",onOk:S},{default:n(()=>[e("div",Fi,[t(h,{spinning:$.value,delay:100},{default:n(()=>[t(U,{value:c.checkedList,"onUpdate:value":C[0]||(C[0]=q=>c.checkedList=q),style:{width:"100%"}},{default:n(()=>[e("div",Ji,[(s(!0),m(z,null,J(o.value,q=>(s(),m("div",{class:"list-item-wraapper",key:q.id},[t(I,{class:"list-item",value:q.id},{default:n(()=>[e("div",Ki,w(q.name),1),e("div",Gi,w(q.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!$.value&&!o.value.length?(s(),m("div",Hi,[Wi,e("div",null,[L(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:p}," 去添加")])])):A("",!0)])]),_:1},8,["open"])}}},Yi=T(Zi,[["__scopeId","data-v-b559dd08"]]),Xi=_=>(K("data-v-c40914ca"),_=_(),G(),_),ea=Xi(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),ta={class:"actions-box"},oa={key:0,class:"library-list"},sa=["onClick"],na={class:"library-name"},ia={class:"library-intro"},aa={__name:"index",setup(_){const l=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo"),c=Q({form_ids:[]}),a=x([]),i=x(null),S=ke(()=>a.value.filter(d=>c.form_ids.includes(d.id))),o=d=>{let C=c.form_ids.indexOf(d.id);c.form_ids.splice(C,1),$()},g=d=>{c.form_ids=[...d],$()},r=()=>{i.value.open([...c.form_ids])},$=()=>{let d={...Y(c)};d.form_ids=d.form_ids.join(","),v({...d})};return(async()=>{const d=await Ze();d&&(a.value=d.data||[])})(),Le(()=>{c.form_ids=y.form_ids.split(",")}),(d,C)=>{const I=_e,U=ne,h=ge;return s(),j(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":C[0]||(C[0]=b=>l.value=b),bodyStyle:{padding:0}},{tip:n(()=>[t(I,{placement:"top"},{title:n(()=>[ea]),default:n(()=>[t(k(ee))]),_:1})]),extra:n(()=>[e("div",ta,[t(h,{gap:8},{default:n(()=>[t(U,{size:"small",onClick:r},{default:n(()=>[L("关联数据表")]),_:1})]),_:1})])]),default:n(()=>[S.value.length>0?(s(),m("div",oa,[(s(!0),m(z,null,J(S.value,b=>(s(),m("div",{class:"library-item",key:b.id},[e("span",{class:"close-btn",onClick:q=>o(b)},[t(k(he))],8,sa),e("div",na,w(b.name),1),e("div",ia,w(b.description),1)]))),128))])):A("",!0),t(Yi,{ref_key:"librarySelectAlertRef",ref:i,onChange:g},null,512)]),_:1},8,["isEdit"])}}},la=T(aa,[["__scopeId","data-v-c40914ca"]]),ca={class:"form-box"},ra={class:"question-title"},_a={class:"question-options"},da={class:"question-option"},ua={class:"drag-btn"},pa={class:"action-box"},ma={class:"robot-info-box"},va={class:"robot-welcome-content"},ha={class:"robot-welcome-question"},fa={__name:"welcome-words",setup(_){const l=x(!1),y=x(!1),{robotInfo:v,updateRobotInfo:c,scrollBoxToBottom:a}=Z("robotInfo"),i=Q({welcomes:{content:"",question:[]}}),S=()=>{let p=!1;if(i.welcomes.question.length>0){for(let d=0;d<i.welcomes.question.length;d++)if(!i.welcomes.question[d].content){p=d+1;break}}return p},o=()=>{i.welcomes.question.push({content:"",id:we(8)})},g=p=>{i.welcomes.question.splice(p,1)},r=()=>{if(!i.welcomes.content)return te.error("请输入欢迎语");if(S())return te.error("引导问题内容不能为空");c({...Y(i)}),l.value=!1},$=()=>{let p={...v.welcomes},d=[];p.question.forEach(({content:C,id:I})=>{let U={id:I,content:C};U.id||(U.id=we(6)),d.push(U)}),i.welcomes.content=p.content,i.welcomes.question=d};return(p,d)=>{const C=Ce,I=re,U=me;return s(),j(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:l.value,"onUpdate:isEdit":d[4]||(d[4]=h=>l.value=h),onSave:r,onEdit:$},{default:n(()=>[le(e("div",ca,[e("div",ra,[t(C,{value:i.welcomes.content,"onUpdate:value":d[0]||(d[0]=h=>i.welcomes.content=h),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",_a,[t(k(Oe),{modelValue:i.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=h=>i.welcomes.question=h),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=h=>y.value=!0),onEnd:d[3]||(d[3]=h=>y.value=!1)},{item:n(({element:h,index:b})=>[e("div",da,[e("span",ua,[t(I,{name:"drag"})]),t(U,{class:"question-option-content",value:h.content,"onUpdate:value":q=>h.content=q,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",pa,[t(k(he),{class:"del-btn",onClick:q=>g(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:o},[t(k(Ee),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[ce,l.value]]),le(e("div",ma,[e("div",va,w(k(v).welcomes.content),1),e("div",ha,[(s(!0),m(z,null,J(k(v).welcomes.question,(h,b)=>(s(),m("div",{class:"question-item",key:b},w(h.content),1))),128))])],512),[[ce,!l.value]])]),_:1},8,["isEdit"])}}},ba=T(fa,[["__scopeId","data-v-ea227a87"]]),ya=_=>(K("data-v-bc797bf6"),_=_(),G(),_),ka=ya(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),ga={class:"form-box"},$a={class:"question-title"},xa={class:"question-options"},wa={class:"question-option"},Sa={class:"drag-btn"},qa={class:"action-box"},Ca={class:"robot-info-box"},Ia={class:"robot-unknown-content"},La={class:"robot-unknown-question"},Ua={__name:"unknown-problem-prompt",setup(_){const l=x(!1),y=x(!1),{robotInfo:v,updateRobotInfo:c,scrollBoxToBottom:a}=Z("robotInfo"),i=Q({unknown_question_prompt:{content:"",question:[]}}),S=()=>{i.unknown_question_prompt.question.push({content:"",id:we(8)}),rt(()=>{a()})},o=$=>{i.unknown_question_prompt.question.splice($,1)},g=()=>{c({...Y(i)}),l.value=!1},r=()=>{let $={...v.unknown_question_prompt},p=[];$.question&&$.question.forEach(({content:d,id:C})=>{let I={id:C,content:d};I.id||(I.id=we(6)),p.push(I)}),$.content&&(i.unknown_question_prompt.content=$.content),p&&(i.unknown_question_prompt.question=p)};return qe(()=>{}),($,p)=>{const d=_e,C=Ce,I=re,U=me;return s(),j(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:l.value,"onUpdate:isEdit":p[4]||(p[4]=h=>l.value=h),onSave:g,onEdit:r},{tip:n(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[ka]),default:n(()=>[t(k(ee))]),_:1})]),default:n(()=>[le(e("div",ga,[e("div",$a,[t(C,{value:i.unknown_question_prompt.content,"onUpdate:value":p[0]||(p[0]=h=>i.unknown_question_prompt.content=h),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",xa,[t(k(Oe),{modelValue:i.unknown_question_prompt.question,"onUpdate:modelValue":p[1]||(p[1]=h=>i.unknown_question_prompt.question=h),"item-key":"id",handle:".drag-btn",onStart:p[2]||(p[2]=h=>y.value=!0),onEnd:p[3]||(p[3]=h=>y.value=!1)},{item:n(({element:h,index:b})=>[e("div",wa,[e("span",Sa,[t(I,{name:"drag"})]),t(U,{class:"question-option-content",value:h.content,"onUpdate:value":q=>h.content=q,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",qa,[t(k(he),{class:"del-btn",onClick:q=>o(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:S},[t(k(Ee),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[ce,l.value]]),le(e("div",Ca,[e("div",Ia,w(k(v).unknown_question_prompt.content),1),e("div",La,[(s(!0),m(z,null,J(k(v).unknown_question_prompt.question,(h,b)=>(s(),m("div",{class:"question-item",key:b},w(h.content),1))),128))])],512),[[ce,!l.value]])]),_:1},8,["isEdit"])}}},Ea=T(Ua,[["__scopeId","data-v-bc797bf6"]]),et=_=>(K("data-v-c60b8d8e"),_=_(),G(),_),Ra=et(()=>e("span",null,null,-1)),Oa=et(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Aa={__name:"problem-optimization",setup(_){x(!1);const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const v=c=>{y({})};return(c,a)=>{const i=se;return s(),j(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:n(()=>[Ra]),default:n(()=>[Oa,t(i,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_question_optimize,"onUpdate:checked":a[0]||(a[0]=S=>k(l).enable_question_optimize=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ma=T(Aa,[["__scopeId","data-v-c60b8d8e"]]),tt=_=>(K("data-v-34918831"),_=_(),G(),_),ja=tt(()=>e("span",null,null,-1)),Da=tt(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),Na={__name:"suggested-issues",setup(_){x(!1);const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo"),v=c=>{y({})};return(c,a)=>{const i=se;return s(),j(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:n(()=>[ja]),default:n(()=>[Da,t(i,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_question_guide,"onUpdate:checked":a[0]||(a[0]=S=>k(l).enable_question_guide=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Va=T(Na,[["__scopeId","data-v-34918831"]]),za=_=>(K("data-v-56c388e6"),_=_(),G(),_),Pa=za(()=>e("span",null,null,-1)),Ta={__name:"sensitive-words",setup(_){x(!1);const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const v=()=>{window.open("/#/user/sensitive-words")},c=a=>{y({})};return(a,i)=>{const S=se;return s(),j(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:n(()=>[Pa]),default:n(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[L(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:v,style:{cursor:"pointer"}},"设置敏词 >")])]),t(S,{onChange:c,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(l).sensitive_words_switch,"onUpdate:checked":i[0]||(i[0]=o=>k(l).sensitive_words_switch=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ba=T(Ta,[["__scopeId","data-v-56c388e6"]]),Ae=_=>(K("data-v-a0ec9e93"),_=_(),G(),_),Qa={class:"direct-title"},Fa={class:"direct-desc"},Ja={class:"qa"},Ka={class:"prompt-form-item-label"},Ga=Ae(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Ha={class:"direct-switch"},Wa={class:"similarity"},Za=Ae(()=>e("span",null,"相似度超过",-1)),Ya={class:"number-input-box"},Xa=Ae(()=>e("span",null,"时直接回复答案",-1)),el={__name:"chat-edit-alert",emits:["save"],setup(_,{expose:l,emit:y}){const v=y,c=x(1),a=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],i=Q(a()),S=x(!1),o=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),g=()=>{o.chat_type=c.value.toString(),i.forEach(p=>{p.chat_type==c.value&&(o.chat_type=="3"?(o.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch==1?"true":"false",o.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score.toString()):o.chat_type=="1"&&(o.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch==1?"true":"false",o.library_qa_direct_reply_score=p.library_qa_direct_reply_score.toString()))}),r(),Object.assign(i,a()),S.value=!1},r=()=>{v("save",Y(o))};qe(()=>{});const $=p=>{c.value=parseInt(p.chat_type),o.chat_type=p.chat_type,o.library_qa_direct_reply_score=p.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch,i.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=p.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch=="true"?1:0)}),S.value=!0};return pe(()=>S.value,p=>{p===!1&&Object.assign(i,a())},{immediate:!0}),l({open:$}),(p,d)=>{const C=_e,I=se,U=Re,h=At,b=Mt,q=oe;return s(),j(q,{width:"746px",open:S.value,"onUpdate:open":d[1]||(d[1]=f=>S.value=f),title:"聊天模式设置",onOk:g},{default:n(()=>[t(b,{class:"direct-box",value:c.value,"onUpdate:value":d[0]||(d[0]=f=>c.value=f)},{default:n(()=>[(s(!0),m(z,null,J(i,f=>(s(),j(h,{class:Se(["direct-item",{active:c.value==f.direct_id}]),value:f.direct_id,key:f.direct_id},{default:n(()=>[e("div",Qa,w(f.direct_title),1),e("div",Fa,w(f.direct_desc),1),le(e("div",Ja,[e("div",Ka,[Ga,t(C,null,_t({default:n(()=>[t(k(ee),{class:"question-icon"})]),_:2},[f.chat_type=="1"?{name:"title",fn:n(()=>[L("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:f.chat_type=="3"?{name:"title",fn:n(()=>[L("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Ha,[f.chat_type=="1"?(s(),j(I,{key:0,checkedValue:1,unCheckedValue:0,checked:f.library_qa_direct_reply_switch,"onUpdate:checked":M=>f.library_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):f.chat_type=="3"?(s(),j(I,{key:1,checkedValue:1,unCheckedValue:0,checked:f.mixture_qa_direct_reply_switch,"onUpdate:checked":M=>f.mixture_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):A("",!0)])])],512),[[ce,f.isQaDirectReply&&c.value==f.direct_id]]),le(e("div",Wa,[Za,e("div",Ya,[f.chat_type=="1"?(s(),j(U,{key:0,value:f.library_qa_direct_reply_score,"onUpdate:value":M=>f.library_qa_direct_reply_score=M,disabled:!f.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):f.chat_type=="3"?(s(),j(U,{key:1,value:f.mixture_qa_direct_reply_score,"onUpdate:value":M=>f.mixture_qa_direct_reply_score=M,disabled:!f.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):A("",!0)]),Xa],512),[[ce,f.isQaDirectReply&&c.value==f.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},tl=T(el,[["__scopeId","data-v-a0ec9e93"]]),Me=_=>(K("data-v-5b59ec9b"),_=_(),G(),_),ol=Me(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),sl=Me(()=>e("br",null,null,-1)),nl=Me(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),il={class:"actions-box"},al={class:"setting-info-block"},ll={class:"set-item"},cl={key:0},rl={key:1},_l={key:2},dl={class:"set-item"},ul={key:0,class:"set-item"},pl={class:"set-item"},ml={key:0,class:"set-item"},vl={class:"form-box"},hl={__name:"index",setup(_){const l=x(!1),y=x(null),{robotInfo:v,updateRobotInfo:c}=Z("robotInfo"),a=Q({chat_type:v.chat_type,library_qa_direct_reply_score:v.library_qa_direct_reply_score,library_qa_direct_reply_switch:v.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:v.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:v.mixture_qa_direct_reply_switch}),i=g=>{a.chat_type=g.chat_type,a.library_qa_direct_reply_score=g.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch,S()},S=()=>{c({...Y(a)}),l.value=!1},o=()=>{y.value.open(Y(a)),l.value=!0};return(g,r)=>{const $=_e,p=ne;return s(),j(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:l.value,"onUpdate:isEdit":r[1]||(r[1]=d=>l.value=d),bodyStyle:{padding:0}},{tip:n(()=>[t($,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[ol,sl,nl]),default:n(()=>[t(k(ee))]),_:1})]),extra:n(()=>[e("div",il,[t(p,{size:"small",onClick:r[0]||(r[0]=d=>o(!0))},{default:n(()=>[L("修改")]),_:1})])]),default:n(()=>[e("div",al,[e("div",ll,[L(" 聊天模式： "),k(v).chat_type=="1"?(s(),m("span",cl,"仅知识库")):A("",!0),k(v).chat_type=="2"?(s(),m("span",rl,"直连模式")):A("",!0),k(v).chat_type=="3"?(s(),m("span",_l,"混合模式")):A("",!0)]),k(v).chat_type=="1"?(s(),m(z,{key:0},[e("div",dl,[L(" QA文档直接回复答案： "),e("span",null,w(k(v).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(v).library_qa_direct_reply_switch=="true"?(s(),m("div",ul,[L(" 相似度值： "),e("span",null,w(k(v).library_qa_direct_reply_score),1)])):A("",!0)],64)):A("",!0),k(v).chat_type=="3"?(s(),m(z,{key:1},[e("div",pl,[L(" QA文档直接回复答案： "),e("span",null,w(k(v).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(v).mixture_qa_direct_reply_switch=="true"?(s(),m("div",ml,[L(" 相似度值： "),e("span",null,w(k(v).mixture_qa_direct_reply_score),1)])):A("",!0)],64)):A("",!0)]),e("div",vl,[t(tl,{ref_key:"ChatEditAlertRef",ref:y,onSave:i},null,512)])]),_:1},8,["isEdit"])}}},fl=T(hl,[["__scopeId","data-v-5b59ec9b"]]),bl=_=>(K("data-v-8d185d5f"),_=_(),G(),_),yl={class:"switch-box"},kl={class:"switch-box-body"},gl={class:"switch-box-header"},$l={class:"left-box"},xl={class:"switch-box-title"},wl={key:0,class:"title-tip"},Sl={class:"right-box"},ql={class:"extra-box"},Cl=bl(()=>e("div",{class:"extra-box"},null,-1)),Il={class:"switch-desc"},Ll={class:"switch-box-right"},Ul={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(_,{emit:l}){const y=l,v=_,c=x(v.value),a=i=>{y("update:value",i),y("change",i)};return(i,S)=>{const o=re,g=se;return s(),m("div",yl,[e("div",kl,[e("div",gl,[e("div",$l,[t(o,{class:"switch-box-icon",name:v.iconName},null,8,["name"]),e("span",xl,w(v.title),1),i.$slots.tip?(s(),m("span",wl,[ue(i.$slots,"tip",{},void 0,!0)])):A("",!0)]),e("div",Sl,[e("div",ql,[ue(i.$slots,"extra",{},()=>[Cl],!0)])])]),e("div",Il,[ue(i.$slots,"default",{},void 0,!0)])]),e("div",Ll,[t(g,{checked:c.value,"onUpdate:checked":S[0]||(S[0]=r=>c.value=r),onChange:a,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},El=T(Ul,[["__scopeId","data-v-8d185d5f"]]),Rl="/assets/img/empty-Bx9z1cwf.png",Ol="/assets/img/phone-head-CDwwPhYa.png",Al="/assets/img/phone-body-CbEf8GZP.png",Ml="/assets/img/phone-footer-ClQtNpln.png",ve=_=>(K("data-v-5125783f"),_=_(),G(),_),jl={class:"common-problem-box"},Dl={class:"left-content-box"},Nl={key:0,class:"empty-box"},Vl=ve(()=>e("img",{src:Rl,alt:""},null,-1)),zl=ve(()=>e("div",{class:"title"},"暂无数据",-1)),Pl=ve(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Tl={key:1,class:"lists-box"},Bl={class:"drag-btn"},Ql={class:"title"},Fl={class:"opration-box"},Jl={class:"preview-box"},Kl=ve(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ol,alt:""})],-1)),Gl={class:"phone-body"},Hl=ve(()=>e("div",null,[e("img",{class:"body-img",src:Al,alt:""})],-1)),Wl={key:0,class:"question-box"},Zl=ve(()=>e("div",{class:"name"},"常见问题",-1)),Yl=ve(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Ml,alt:""})],-1)),Xl={__name:"common-problem",setup(_){x(!1);const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo"),v=ke(()=>l.common_question_list?JSON.parse(l.common_question_list):[]),c=x([]);c.value=v.value,pe(v,()=>{c.value=v.value});const a=Ne.useForm,i=x(!1),S=x("添加问题"),o=Q({question:"",index:-1}),g=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:r,validate:$,validateInfos:p}=a(o,g),d=()=>{if(v.value.length>=10)return te.error("最多设置10条常用问题");i.value=!0,r(),o.question="",o.index=-1},C=(q,f)=>{i.value=!0,r(),o.question=q,o.index=f},I=q=>{let f=[];f=v.value.filter((M,B)=>q!=B),oe.confirm({title:"提醒",icon:t(yt),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){y({common_question_list:JSON.stringify(f)})},onCancel(){}})},U=()=>{$().then(()=>{let q=[];o.index>=0?q=v.value.map((f,M)=>M===o.index?o.question:f):q=[o.question,...v.value],y({common_question_list:JSON.stringify(q)}),i.value=!1})},h=q=>{y({})},b=q=>{y({common_question_list:JSON.stringify(c.value)})};return(q,f)=>{const M=_e,B=se,F=Dt,E=ne,N=re,D=me,u=jt,H=Ne,V=oe;return s(),m("div",jl,[e("div",Dl,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:n(()=>[t(M,null,{title:n(()=>[L("最多10条。开启后，常见问题会显示在每条问答后面")]),default:n(()=>[t(k(ee),{class:"quess-icon"})]),_:1})]),extra:n(()=>[t(B,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(l).enable_common_question,"onUpdate:checked":f[0]||(f[0]=P=>k(l).enable_common_question=P),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(F,{type:"vertical"}),t(E,{type:"primary",size:"small",onClick:d},{default:n(()=>[L("添加")]),_:1})]),default:n(()=>[v.value.length==0?(s(),m("div",Nl,[Vl,zl,Pl,t(E,{onClick:d,type:"primary"},{default:n(()=>[L("立即添加")]),_:1})])):(s(),m("div",Tl,[t(k(Oe),{modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=P=>c.value=P),handle:".drag-btn","item-key":"index",onEnd:b},{item:n(({element:P,index:O})=>[(s(),m("div",{class:"list-item",key:O},[e("span",Bl,[t(N,{name:"drag"})]),e("div",Ql,w(P),1),e("div",Fl,[t(k(gt),{onClick:W=>C(P,O)},null,8,["onClick"]),t(k(he),{onClick:W=>I(O)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Jl,[Kl,e("div",Gl,[Hl,v.value.length&&k(l).enable_common_question=="true"?(s(),m("div",Wl,[Zl,(s(!0),m(z,null,J(v.value,P=>(s(),m("div",{class:"list-item",key:P},w(P),1))),128))])):A("",!0)]),Yl]),t(V,{open:i.value,"onUpdate:open":f[3]||(f[3]=P=>i.value=P),title:S.value,onOk:U,width:"476px"},{default:n(()=>[t(H,{class:"form-box",layout:"vertical"},{default:n(()=>[t(u,dt({label:"问题名称"},k(p).question),{default:n(()=>[t(D,{maxLength:100,value:o.question,"onUpdate:value":f[2]||(f[2]=P=>o.question=P),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},ec=T(Xl,[["__scopeId","data-v-5125783f"]]),tc=e("span",null,null,-1),oc=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),sc={__name:"display-aitations",setup(_){const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo"),v=x(!1);pe(()=>l.answer_source_switch,a=>{v.value=a=="true"},{immediate:!0});const c=()=>{y({answer_source_switch:v.value?"true":"false"})};return(a,i)=>(s(),j(El,{title:"显示引文","icon-name":"jibenpeizhi",value:v.value,"onUpdate:value":i[0]||(i[0]=S=>v.value=S),onChange:c},{extra:n(()=>[tc]),default:n(()=>[oc]),_:1},8,["value"]))}},ot=_=>(K("data-v-4948feb9"),_=_(),G(),_),nc=ot(()=>e("span",null,null,-1)),ic=ot(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),ac={__name:"show-like",setup(_){const{robotInfo:l,updateRobotInfo:y}=Z("robotInfo"),v=c=>{y({})};return(c,a)=>{const i=se;return s(),j(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:n(()=>[nc]),default:n(()=>[ic,t(i,{onChange:v,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(l).feedback_switch,"onUpdate:checked":a[0]||(a[0]=S=>k(l).feedback_switch=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},lc=T(ac,[["__scopeId","data-v-4948feb9"]]),cc={key:0,class:"robot-config-page"},rc={class:"setting-box"},_c={class:"setting-box"},dc={class:"setting-box"},uc={class:"setting-box"},pc={class:"setting-box"},mc={class:"setting-box"},vc={class:"setting-box"},hc={class:"setting-box"},fc={class:"setting-box"},bc={class:"setting-box"},yc={class:"setting-box"},kc={class:"setting-box"},gc={class:"setting-box"},$c={key:1,class:"robot-config-page"},xc={__name:"index",setup(_){const l=Nt(),y=x(null),{robotInfo:v}=ut(l),{getRobot:c}=l,a=()=>{y.value.scrollTop=y.value.scrollHeight},i=x(1),S=x(!1),o=Q(v.value);pt("robotInfo",{robotInfo:o,updateRobotInfo:$=>{let p=JSON.parse(JSON.stringify($));$.robot_avatar&&(p.robot_avatar=new File([$.robot_avatar],$.robot_avatar.name)),Object.assign(o,p),r()},scrollBoxToBottom:a});const r=()=>{let $;o.robot_avatar&&($=new File([o.robot_avatar],o.robot_avatar.name));let p=JSON.parse(JSON.stringify(Y(o)));$&&(p.robot_avatar=$);let d=p.welcomes;d.question=d.question.map(I=>I.content),p.welcomes=JSON.stringify(d),p.prompt_struct=JSON.stringify(p.prompt_struct);let C=p.unknown_question_prompt;C.question=C.question.map(I=>I.content),p.unknown_question_prompt=JSON.stringify(C),delete p.robot_avatar_url,S.value=!0,xt(p).then(I=>{if(I.res!=0)return te.error(I.msg);S.value=!1,te.success("保存成功"),c(o.id)}).catch(()=>{S.value=!1})};return($,p)=>{const d=ze,C=Pe;return s(),m(z,null,[t(C,{class:"tab-wrapper",activeKey:i.value,"onUpdate:activeKey":p[0]||(p[0]=I=>i.value=I)},{default:n(()=>[(s(),j(d,{key:1,tab:"基础配置"})),(s(),j(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),i.value==1?(s(),m("div",cc,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:y},[e("div",rc,[t(_o)]),e("div",_c,[t(Bi)]),e("div",dc,[t(Sn)]),e("div",uc,[t(fl)]),e("div",pc,[t(Ds)]),e("div",mc,[t(la)]),e("div",vc,[t(ba)]),e("div",hc,[t(Ea)]),e("div",fc,[t(Ba)]),e("div",bc,[t(Ma)]),e("div",yc,[t(Va)]),e("div",kc,[t(sc)]),e("div",gc,[t(lc)])],512)])):(s(),m("div",$c,[t(ec)]))],64)}}},Dr=T(xc,[["__scopeId","data-v-387189e7"]]);export{Dr as default};
