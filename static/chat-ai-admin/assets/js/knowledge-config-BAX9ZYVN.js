import{C as fe}from"./cu-scroll-DUDOFjFZ.js";import{b as he,e as ge,Z as ke,bg as ve,$ as ye,k as F,d as be,M as we,b2 as xe}from"../../index-DJqZYlN8.js";import{b as Ce,a5 as Be,a4 as Se,B as G,e as f,M as d,Q as b,S as _,W as s,k as n,V as L,u as C,a7 as k,N as g,$ as Q,Y as h,Z as I,F as w,G as j,H as P,a6 as Y,a1 as Me,a2 as ze,l as Le}from"./vue-chunks-Dpmhapcm.js";import{a as Ie,h as Ne,k as Oe}from"./index-CQKu1YIs.js";import{c as Ae}from"./index-Cd8_BaNA.js";import{A as Ue}from"./avatar-input-CNarvNcR.js";import{M as Ve}from"./model-select-BawuzGA8.js";import{O as qe}from"./open-grapg-modal-t7pSNHCy.js";import{F as Z,_ as $e}from"./index-BearFCS_.js";import"./index-9XFVXge0.js";import{I as De}from"./Input-k3gxptQd.js";import{Q as Ee}from"./QuestionCircleOutlined-D2lOE5qu.js";import{_ as Re}from"./TextArea-DEZsPG5C.js";import{_ as Te}from"./index-Bpgeg3Jc.js";import{S as Fe,a as Ge,_ as Qe}from"./index-DT9vq-9c.js";import{_ as je}from"./index-D7DELBhV.js";import{_ as Pe}from"./index-DyP1V5nr.js";import{_ as Ye}from"./index-Ci9XZtrG.js";import{_ as Ze}from"./index-BY-bgrX3.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./dayjs-BAOQ3IvD.js";import"./index-DzhuYAPB.js";import"./PlusOutlined-CTNlEK-E.js";import"./index-O15OSOpm.js";import"./partition-DekNjavo.js";import"./Trigger-DcF6kXOl.js";import"./Password-DASsPHld.js";import"./inputProps-B4Qz7YgH.js";import"./CheckOutlined-D8sWUycq.js";import"./useRefs-CxyIWkWE.js";import"./collapseMotion-DmHD1G9F.js";import"./FormItemContext-DcHP2mNJ.js";import"./isPlainObject--mHlhHEN.js";import"./responsiveObserve-D_TTA_LO.js";import"./index-DGofXs4a.js";import"./Search-CxIvru6q.js";import"./SearchOutlined-C4P1S4P5.js";import"./statusUtils-Bnl8Rf7N.js";import"./index-Bn-6W96d.js";import"./slide-B4S8cqER.js";import"./DownOutlined-D5t3juQ7.js";import"./move-B1-eDBNJ.js";import"./UpOutlined-BLzSJSuk.js";import"./colors-CZV0Zir8.js";const B=x=>(Me("data-v-5a8c3d1d"),x=x(),ze(),x),He={class:"add-library-page"},We={class:"form-box"},Xe=B(()=>s("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const Je=["src"],Ke={key:0},ea={key:1},aa=B(()=>s("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1)),oa={class:"select-card-box"},na={class:"card-title"},ta=B(()=>s("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),la={class:"card-title"},_a=B(()=>s("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),ia={__name:"knowledge-config",setup(x){const H=ge(),N=Ce(()=>{var a;return((a=H.companyInfo)==null?void 0:a.neo4j_status)=="true"}),O=Be(),W=Se(),A=O.query,U=ve,e=G({library_name:"",library_intro:"",use_model:"",is_offline:"",model_config_id:"",avatar:U,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90}),V=f(""),X=f(0),q=f({}),$=f([]);Ie().then(a=>{$.value=a.data.map(o=>({label:o.name,value:o.no}))});const D=f(!0);(()=>{Ne({id:A.id}).then(a=>{q.value=a.data,X.value=q.value.is_offline?2:1,e.library_name=a.data.library_name,e.library_intro=a.data.library_intro,e.use_model=a.data.use_model,e.is_offline=a.data.is_offline,e.model_config_id=a.data.model_config_id,e.avatar=a.data.avatar?a.data.avatar:U,e.avatar_file=a.data.avatar_file?a.data.avatar_file:"",e.graph_switch=a.data.graph_switch!="0",e.graph_model_config_id=a.data.graph_model_config_id>0?a.data.graph_model_config_id:void 0,e.graph_use_model=a.data.graph_use_model,e.chunk_type=+a.data.chunk_type,e.normal_chunk_default_separators_no=a.data.normal_chunk_default_separators_no?a.data.normal_chunk_default_separators_no.split(",").map(o=>+o):[],e.normal_chunk_default_chunk_size=a.data.normal_chunk_default_chunk_size,e.normal_chunk_default_chunk_overlap=a.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=a.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=a.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=a.data.semantic_chunk_default_threshold,D.value=a.data.type==2})})();const da=f([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),J=Z.useForm,K=G({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:S}=J(e,K),ee=(a,o)=>{const i=o.current_obj;e.use_model=M.indexOf(i.model_define)>-1&&i.deployment_name?i.deployment_name:i.name,V.value=i.model_define,e.model_config_id=i.id||o.model_config_id,r()},ae=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file,r()},sa=()=>!1,v=f([]),M=["azure","ollama","xinference","openaiAgent"],oe=["azure"];function ne(a,o,i){const l=new Set(a.map(c=>c.model_define));return o.filter(c=>{let m=c[i];l.has(m)&&a.filter(p=>{if(p.model_define==m)return p.children=ye(p.children,c.children),!1})}),a}(()=>{Ae({model_type:"TEXT EMBEDDING",is_offline:!1}).then(a=>{let o=a.data||[],i=[];v.value=o.map(l=>{i=[];for(let c=0;c<l.model_info.vector_model_list.length;c++){const m=l.model_info.vector_model_list[c];i.push({name:m,deployment_name:l.model_config.deployment_name,id:l.model_config.id,model_define:l.model_info.model_define})}return{id:l.model_config.id,name:l.model_info.model_name,model_define:l.model_info.model_define,icon:l.model_info.model_icon_url,children:i,deployment_name:l.model_config.deployment_name}}),v.value=ne(ke(v.value,"model_define"),v.value,"model_define")})})();const te=()=>{r()},z=f([]),le=a=>{z.value=a},E=f(null),_e=a=>{if(a){e.graph_switch=!1;let o={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&z.value.length>0){let i=z.value[0];if(i){let l=i.children[0];o.graph_use_model=l.name,o.graph_model_config_id=l.model_config_id}}E.value.show(o)}else e.graph_switch=!1,r()},R=a=>{e.chunk_type=a,r()},ie=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model,r(()=>{we.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:Le(xe,{style:{color:"#52c41a"}}),onOk:()=>W.push({path:"/library/details/knowledge-document",query:{id:A.id}})})}))},r=(a=null)=>{if(!e.library_name)return F.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:e.normal_chunk_default_separators_no.join(","),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,id:O.query.id};oe.indexOf(V.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),Oe(o).then(i=>{typeof a=="function"?a():F.success("修改成功")})};return(a,o)=>{const i=De,l=$e,c=Re,m=be,p=Te,re=Fe,de=Ge,T=Qe,se=je,ue=Pe,y=Ye,ce=Ze,me=Z,pe=fe;return d(),b(pe,null,{default:_(()=>[s("div",He,[s("div",We,[n(me,{"label-col":{span:5}},{default:_(()=>[n(l,L({ref:"name",label:"知识库名称"},C(S).library_name),{default:_(()=>[n(i,{onBlur:r,value:e.library_name,"onUpdate:value":o[0]||(o[0]=t=>e.library_name=t),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(l,{label:"知识库简介"},{default:_(()=>[n(c,{onBlur:r,value:e.library_intro,"onUpdate:value":o[1]||(o[1]=t=>e.library_intro=t),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(l,L({ref:"name",label:"知识库封面"},C(S).avatar),{default:_(()=>[n(Ue,{value:e.avatar,"onUpdate:value":o[2]||(o[2]=t=>e.avatar=t),onChange:ae},null,8,["value"]),Xe]),_:1},16),n(l,L({label:"嵌入模型"},C(S).use_model),{default:_(()=>[k("",!0),n(T,{onChange:ee,value:e.use_model,"onUpdate:value":o[3]||(o[3]=t=>e.use_model=t),placeholder:"请选择嵌入模型"},{default:_(()=>[(d(!0),g(w,null,Q(v.value,t=>(d(),b(de,{key:t.id},{label:_(()=>[n(p,{align:"center",gap:6},{default:_(()=>[s("img",{class:"model-icon",src:t.icon,alt:""},null,8,Je),h(I(t.name),1)]),_:2},1024)]),default:_(()=>[(d(!0),g(w,null,Q(t.children,u=>(d(),b(re,{value:M.indexOf(t.model_define)>-1&&u.deployment_name?u.deployment_name:u.name+u.id,model_config_id:t.id,current_obj:u,key:u.name+u.id},{default:_(()=>[M.indexOf(t.model_define)>-1&&u.deployment_name?(d(),g("span",Ke,I(u.deployment_name),1)):(d(),g("span",ea,I(u.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16),j(n(l,{label:"生成知识图谱"},{default:_(()=>[n(se,{onChange:_e,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),aa]),_:1},512),[[P,N.value]]),j(n(l,{label:"知识图谱模型"},{default:_(()=>[n(Ve,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":o[4]||(o[4]=t=>e.graph_use_model=t),modeId:e.graph_model_config_id,"onUpdate:modeId":o[5]||(o[5]=t=>e.graph_model_config_id=t),style:{width:"300px"},onChange:te,onLoaded:le},null,8,["modeName","modeId"])]),_:1},512),[[P,e.graph_switch&&N.value]]),D.value?k("",!0):(d(),g(w,{key:0},[n(l,{label:"分段方式",required:""},{default:_(()=>[s("div",oa,[s("div",{class:Y(["select-card-item",{active:e.chunk_type==1}]),onClick:o[6]||(o[6]=t=>R(1))},[n(m,{class:"check-arrow",name:"check-arrow-filled"}),s("div",na,[n(m,{name:"ordinary-segmentation",class:"title-icon"}),h(" 普通分段 ")]),ta],2),s("div",{class:Y(["select-card-item",{active:e.chunk_type==2}]),onClick:o[7]||(o[7]=t=>R(2))},[n(m,{class:"check-arrow",name:"check-arrow-filled"}),s("div",la,[n(m,{name:"semantic-segmentation",class:"title-icon"}),h(" 语义分段 ")]),_a],2)]),e.chunk_type==2?(d(),b(ue,{key:0,style:{"margin-top":"12px",width:"650px"},message:"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段"})):k("",!0)]),_:1}),e.chunk_type==1?(d(),g(w,{key:0},[n(l,{label:"分段标识符",required:""},{default:_(()=>[n(T,{onChange:r,value:e.normal_chunk_default_separators_no,"onUpdate:value":o[8]||(o[8]=t=>e.normal_chunk_default_separators_no=t),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:$.value},null,8,["value","options"])]),_:1}),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.normal_chunk_default_chunk_size,"onUpdate:value":o[9]||(o[9]=t=>e.normal_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":o[10]||(o[10]=t=>e.normal_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1})],64)):k("",!0),e.chunk_type==2?(d(),g(w,{key:1},[e.chunk_type==2?(d(),b(l,{key:0,required:""},{label:_(()=>[h(" 分段阈值 "),n(ce,null,{title:_(()=>[h("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:_(()=>[n(C(Ee),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_threshold,"onUpdate:value":o[11]||(o[11]=t=>e.semantic_chunk_default_threshold=t),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):k("",!0),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":o[12]||(o[12]=t=>e.semantic_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":o[13]||(o[13]=t=>e.semantic_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1})],64)):k("",!0)],64))]),_:1})]),n(qe,{onOk:ie,ref_key:"openGrapgModalRef",ref:E},null,512)])]),_:1})}}},_o=he(ia,[["__scopeId","data-v-5a8c3d1d"]]);export{_o as default};
