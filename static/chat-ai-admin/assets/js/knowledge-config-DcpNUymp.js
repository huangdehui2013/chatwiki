import{C as fe}from"./cu-scroll-jRkjVxy8.js";import{b as he,e as ke,$ as ge,bh as ve,a0 as ye,k as P,d as be,M as we,b3 as Ce}from"../../index-UhR4yadr.js";import{b as Y,a5 as xe,a4 as ze,B as H,e as m,M as p,Q as M,S as _,W as d,k as n,V as N,u as w,a7 as f,G as W,H as X,N as x,a6 as S,Y as u,F as z,z as Be,a1 as Ie,a2 as Le,l as Me}from"./vue-chunks-DWnFCQSz.js";import{a as Ne,i as Se,m as Ae}from"./index-DIUiarE3.js";import{c as De}from"./index-cS6xwXeR.js";import{A as Ue}from"./avatar-input-BYUxlGNo.js";import{M as Z}from"./model-select-6loF5tMn.js";import{O as Ve}from"./open-grapg-modal-CP0saIUH.js";import{C as qe}from"./index-DWY9ihNz.js";import{F as j,_ as Te}from"./index-DzuDS3Yk.js";import"./index--Qvpscnx.js";import{I as Oe}from"./Input-D7W5TJDt.js";import{Q as J}from"./QuestionCircleOutlined-CV_adx6X.js";import{_ as $e}from"./TextArea-CpTIlaWe.js";import{_ as Ee}from"./index-CovtKLUB.js";import{_ as Re}from"./index-9VXz7HRC.js";import{_ as Fe}from"./index-BnhNOVTI.js";import{_ as Ge}from"./index-DrSPxL4Q.js";import{_ as Qe}from"./index-kKxyythX.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-DzhuYAPB.js";import"./PlusOutlined-CeclvJCi.js";import"./index-BJ4SSG33.js";import"./partition-CNXo-yhR.js";import"./Trigger-DcWVD-r5.js";import"./Password-XreinKYD.js";import"./inputProps-CiDWLiIl.js";import"./CheckOutlined-B_iCQ6FL.js";import"./useRefs-CH9tJ50T.js";import"./collapseMotion-ByInPrfq.js";import"./FormItemContext-BJa1evck.js";import"./isPlainObject-BeqP4IC7.js";import"./responsiveObserve-Bs6--9PQ.js";import"./index-DmSlXGTl.js";import"./Search-BRb_v-2B.js";import"./SearchOutlined-bV5WeZB5.js";import"./statusUtils--roYFmJe.js";import"./index-DXeZ5ybK.js";import"./slide-BR5NTmcW.js";import"./DownOutlined-CvDOGKH1.js";import"./move-cWZng2f8.js";import"./UpOutlined-BkQ7BaZ8.js";import"./colors-BiofrUQp.js";const g=C=>(Ie("data-v-a77c34a1"),C=C(),Le(),C),Pe={class:"add-library-page"},Ye={class:"form-box"},He=g(()=>d("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const We=g(()=>d("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1)),Xe=g(()=>d("div",{class:"form-alert-tip"},"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段",-1)),Ze={class:"select-card-box"},je={class:"card-title"},Je=g(()=>d("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),Ke={class:"card-title"},ea=g(()=>d("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),aa={class:"card-title"},oa=g(()=>d("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),A="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",na={__name:"knowledge-config",setup(C){const K=ke(),D=Y(()=>{var a;return((a=K.companyInfo)==null?void 0:a.neo4j_status)=="true"}),U=xe(),ee=ze(),V=U.query,q=ve,e=H({library_name:"",library_intro:"",use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",avatar:q,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:A}),T=m(""),ae=m(0),O=m({}),oe=Y(()=>v.value.map(a=>({groupLabel:a.name,groupIcon:a.icon,children:a.children.map(o=>({icon:o.icon,use_model_name:o.use_model_name,value:I.includes(o.model_define)&&o.deployment_name?o.deployment_name:o.name,rawData:o}))}))),ne=a=>{e.use_model=I.includes(a.rawData.model_define)&&a.rawData.deployment_name?a.rawData.deployment_name:a.rawData.name,e.use_model_icon=a.icon,e.use_model_name=a.use_model_name,e.model_config_id=a.rawData.id,T.value=a.rawData.model_define,i()},$=m([]);Ne().then(a=>{$.value=a.data.map(o=>({label:o.name,value:o.no}))});const E=m(!0);(()=>{Se({id:V.id}).then(a=>{O.value=a.data,ae.value=O.value.is_offline?2:1,e.library_name=a.data.library_name,e.library_intro=a.data.library_intro,e.use_model=a.data.use_model,e.is_offline=a.data.is_offline,e.model_config_id=a.data.model_config_id,e.avatar=a.data.avatar?a.data.avatar:q,e.avatar_file=a.data.avatar_file?a.data.avatar_file:"",e.graph_switch=a.data.graph_switch!="0",e.graph_model_config_id=a.data.graph_model_config_id>0?a.data.graph_model_config_id:void 0,e.graph_use_model=a.data.graph_use_model,e.chunk_type=+a.data.chunk_type,e.normal_chunk_default_separators_no=a.data.normal_chunk_default_separators_no?a.data.normal_chunk_default_separators_no.split(",").map(o=>+o):[],e.normal_chunk_default_chunk_size=a.data.normal_chunk_default_chunk_size,e.normal_chunk_default_chunk_overlap=a.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=a.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=a.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=a.data.semantic_chunk_default_threshold,e.ai_chunk_size=a.data.ai_chunk_size||5e3,e.ai_chunk_model=a.data.ai_chunk_model,e.ai_chunk_model_config_id=a.data.ai_chunk_model_config_id,e.ai_chunk_prumpt=a.data.ai_chunk_prumpt||A,E.value=a.data.type==2})})();const ta=m([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),le=j.useForm,te=H({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:B}=le(e,te),_e=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file,i()},_a=()=>!1,v=m([]),I=["azure","ollama","xinference","openaiAgent"],ie=["azure"];function de(a,o,r){const t=new Set(a.map(s=>s.model_define));return o.filter(s=>{let c=s[r];t.has(c)&&a.filter(y=>{if(y.model_define==c)return y.children=ye(y.children,s.children),!1})}),a}(()=>{De({model_type:"TEXT EMBEDDING",is_offline:!1}).then(a=>{let o=a.data||[],r=[];v.value=o.map(t=>{r=[];for(let s=0;s<t.model_info.vector_model_list.length;s++){const c=t.model_info.vector_model_list[s];r.push({name:c,deployment_name:t.model_config.deployment_name,id:t.model_config.id,model_define:t.model_info.model_define,icon:t.model_info.model_icon_url,use_model_name:t.model_info.model_name})}return{id:t.model_config.id,name:t.model_info.model_name,model_define:t.model_info.model_define,icon:t.model_info.model_icon_url,children:r,deployment_name:t.model_config.deployment_name}}),v.value=de(ge(v.value,"model_define"),v.value,"model_define")})})();const R=()=>{i()},h=m([]),F=a=>{h.value=a,Be(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&re()})},re=()=>{if(h.value.length>0){let a=null,o=null;for(let r of h.value)if(r.model_define==="tongyi"){a=r;for(let t of a.children)if(t.name==="qwen-max"){o=t;break}break}a||(a=h.value[0],o=a.children[0]),a&&o&&(e.ai_chunk_model=o.name,e.ai_chunk_model_config_id=o.model_config_id)}},G=m(null),ue=a=>{if(a){e.graph_switch=!1;let o={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&h.value.length>0){let r=h.value[0];if(r){let t=r.children[0];o.graph_use_model=t.name,o.graph_model_config_id=t.model_config_id}}G.value.show(o)}else e.graph_switch=!1,i()},L=a=>{e.chunk_type=a,i()},se=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model,i(()=>{we.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:Me(Ce,{style:{color:"#52c41a"}}),onOk:()=>ee.push({path:"/library/details/knowledge-document",query:{id:V.id}})})}))},i=(a=null)=>{if(!e.library_name)return P.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:e.normal_chunk_default_separators_no.join(","),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,ai_chunk_size:e.ai_chunk_size,ai_chunk_model:e.ai_chunk_model,ai_chunk_model_config_id:e.ai_chunk_model_config_id,ai_chunk_prumpt:e.ai_chunk_prumpt,id:U.query.id};ie.indexOf(T.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),Ae(o).then(r=>{typeof a=="function"?a():P.success("修改成功")})};return(a,o)=>{const r=Oe,t=Te,s=$e,c=be,y=Ee,ce=Re,k=Fe,b=Ge,Q=Qe,me=j,pe=fe;return p(),M(pe,null,{default:_(()=>[d("div",Pe,[d("div",Ye,[n(me,{"label-col":{span:5}},{default:_(()=>[n(t,N({ref:"name",label:"知识库名称"},w(B).library_name),{default:_(()=>[n(r,{onBlur:i,value:e.library_name,"onUpdate:value":o[0]||(o[0]=l=>e.library_name=l),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(t,{label:"知识库简介"},{default:_(()=>[n(s,{onBlur:i,value:e.library_intro,"onUpdate:value":o[1]||(o[1]=l=>e.library_intro=l),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(t,N({ref:"name",label:"知识库封面"},w(B).avatar),{default:_(()=>[n(Ue,{value:e.avatar,"onUpdate:value":o[2]||(o[2]=l=>e.avatar=l),onChange:_e},null,8,["value"]),He]),_:1},16),n(t,N({label:"嵌入模型"},w(B).use_model),{default:_(()=>[f("",!0),n(qe,{modelValue:e.use_model,"onUpdate:modelValue":o[3]||(o[3]=l=>e.use_model=l),options:oe.value,placeholder:"请选择嵌入模型","label-key":"use_model_name","value-key":"value","model-define":I,"model-config-id":e.model_config_id,onChange:ne},null,8,["modelValue","options","model-config-id"])]),_:1},16),W(n(t,{label:"生成知识图谱"},{default:_(()=>[n(y,{onChange:ue,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),We]),_:1},512),[[X,D.value]]),W(n(t,{label:"知识图谱模型"},{default:_(()=>[n(Z,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":o[4]||(o[4]=l=>e.graph_use_model=l),modeId:e.graph_model_config_id,"onUpdate:modeId":o[5]||(o[5]=l=>e.graph_model_config_id=l),style:{width:"300px"},onChange:R,onLoaded:F},null,8,["modeName","modeId"])]),_:1},512),[[X,e.graph_switch&&D.value]]),E.value?f("",!0):(p(),x(z,{key:0},[n(t,{label:"分段方式",required:""},{default:_(()=>[Xe,d("div",Ze,[d("div",{class:S(["select-card-item",{active:e.chunk_type==1}]),onClick:o[6]||(o[6]=l=>L(1))},[n(c,{class:"check-arrow",name:"check-arrow-filled"}),d("div",je,[n(c,{name:"ordinary-segmentation",class:"title-icon"}),u(" 普通分段 ")]),Je],2),d("div",{class:S(["select-card-item",{active:e.chunk_type==2}]),onClick:o[7]||(o[7]=l=>L(2))},[n(c,{class:"check-arrow",name:"check-arrow-filled"}),d("div",Ke,[n(c,{name:"semantic-segmentation",class:"title-icon"}),u(" 语义分段 ")]),ea],2),d("div",{class:S(["select-card-item",{active:e.chunk_type==3}]),onClick:o[8]||(o[8]=l=>L(3))},[n(c,{class:"check-arrow",name:"check-arrow-filled"}),d("div",aa,[n(c,{name:"semantic-segmentation",class:"title-icon"}),u(" AI分段 ")]),oa],2)])]),_:1}),e.chunk_type==1?(p(),x(z,{key:0},[n(t,{label:"分段标识符",required:""},{default:_(()=>[n(ce,{onChange:i,value:e.normal_chunk_default_separators_no,"onUpdate:value":o[9]||(o[9]=l=>e.normal_chunk_default_separators_no=l),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:$.value},null,8,["value","options"])]),_:1}),n(t,{label:"分段最大长度",required:""},{default:_(()=>[n(b,{gap:8,align:"center"},{default:_(()=>[n(k,{onBlur:i,value:e.normal_chunk_default_chunk_size,"onUpdate:value":o[10]||(o[10]=l=>e.normal_chunk_default_chunk_size=l),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),u(" 字符 ")]),_:1})]),_:1}),n(t,{label:"分段重叠长度"},{default:_(()=>[n(b,{gap:8,align:"center"},{default:_(()=>[n(k,{onBlur:i,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":o[11]||(o[11]=l=>e.normal_chunk_default_chunk_overlap=l),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),u(" 字符 ")]),_:1})]),_:1})],64)):f("",!0),e.chunk_type==2?(p(),x(z,{key:1},[e.chunk_type==2?(p(),M(t,{key:0,required:""},{label:_(()=>[u(" 分段阈值 "),n(Q,null,{title:_(()=>[u("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:_(()=>[n(w(J),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:_(()=>[n(k,{onBlur:i,value:e.semantic_chunk_default_threshold,"onUpdate:value":o[12]||(o[12]=l=>e.semantic_chunk_default_threshold=l),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):f("",!0),n(t,{label:"分段最大长度",required:""},{default:_(()=>[n(b,{gap:8,align:"center"},{default:_(()=>[n(k,{onBlur:i,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":o[13]||(o[13]=l=>e.semantic_chunk_default_chunk_size=l),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),u(" 字符 ")]),_:1})]),_:1}),n(t,{label:"分段重叠长度"},{default:_(()=>[n(b,{gap:8,align:"center"},{default:_(()=>[n(k,{onBlur:i,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":o[14]||(o[14]=l=>e.semantic_chunk_default_chunk_overlap=l),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),u(" 字符 ")]),_:1})]),_:1})],64)):f("",!0),e.chunk_type==3?(p(),x(z,{key:2},[e.chunk_type==3?(p(),M(t,{key:0,required:""},{label:_(()=>[u(" AI大模型 ")]),default:_(()=>[n(Z,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":o[15]||(o[15]=l=>e.ai_chunk_model=l),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":o[16]||(o[16]=l=>e.ai_chunk_model_config_id=l),style:{width:"300px"},onChange:R,onLoaded:F},null,8,["modeName","modeId"])]),_:1})):f("",!0),n(t,{label:"提示词设置",required:""},{default:_(()=>[n(b,{gap:8,align:"center"},{default:_(()=>[n(s,{onBlur:i,maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":o[17]||(o[17]=l=>e.ai_chunk_prumpt=l),placeholder:A},null,8,["value"])]),_:1})]),_:1}),n(t,null,{label:_(()=>[u(" 单次最大字符数 "),n(Q,null,{title:_(()=>[u("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:_(()=>[n(w(J),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:_(()=>[n(k,{onBlur:i,class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":o[18]||(o[18]=l=>e.ai_chunk_size=l),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:l=>parseInt(l),parser:l=>parseInt(l)},null,8,["value","formatter","parser"]),u(" 字符 ")]),_:1})],64)):f("",!0)],64))]),_:1})]),n(Ve,{onOk:se,ref_key:"openGrapgModalRef",ref:G},null,512)])]),_:1})}}},to=he(na,[["__scopeId","data-v-a77c34a1"]]);export{to as default};
