import{C as it}from"./cu-scroll-BZhESYtD.js";import{e as k,ai as nt,M as l,N as _,k as a,S as n,F as $,Y as v,Z as p,W as i,a7 as B,G as j,$ as Q,u as h,Q as J,X as G,a0 as U,a1 as lt,a2 as rt,a5 as ct,B as _t}from"./vue-chunks-DWnFCQSz.js";import{S as W,c as X,a as ut,C as pt,b as dt,E as mt}from"./edit-subsection-yO3b-EP-.js";import{w as ht,x as vt,y as ft,z as Y,A as gt}from"./index-CpYnoGfS.js";import{b as K,b3 as yt,T as kt,M as Z,E as St,k as tt,B as bt}from"../../index-DQXF0oEW.js";import{S as Ct}from"./index-BmqzJuQZ.js";import{_ as xt,M as wt}from"./index-dYCqajUf.js";import"./index-D51vnI4K.js";import{D as Lt}from"./dropdown-yjtk7CCy.js";import{C as qt}from"./ClockCircleFilled-DBQsFSrd.js";import{S as Mt}from"./SettingOutlined-1CzdHxwK.js";import{S as Ot}from"./SyncOutlined-DvqqncSp.js";import{M as Et}from"./MoreOutlined-Bxk_qxvK.js";import{_ as $t,a as It}from"./index-CGOpBClO.js";import{_ as Dt}from"./index-CUGUQ2OU.js";import{_ as Nt}from"./index-CvML6ywu.js";import{_ as Pt}from"./index-DFjntrox.js";import{S as Bt,_ as Ft}from"./index-B-Rt9SA5.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-C3GwfM_a.js";import"./Dropdown-Cb2ylcsA.js";import"./Trigger-CC5n-pw8.js";import"./index-DwY9A703.js";import"./useRefs-CH9tJ50T.js";import"./pick-BcFOJSQC.js";import"./index-DpzELZe5.js";import"./isPlainObject-DGw0gsC3.js";import"./responsiveObserve-D-e1nmNx.js";import"./collapseMotion-ByInPrfq.js";import"./QuestionCircleOutlined-DN9kmFuV.js";import"./FormItemContext-D4f_Sq6G.js";import"./CheckOutlined-BrtNruPW.js";import"./PlusOutlined-CP-yUfey.js";import"./slide-DBTiAtg1.js";import"./index-9760vytK.js";import"./Input-COJTivTx.js";import"./statusUtils-B7nMMwz3.js";import"./inputProps-Bb0ocHOp.js";import"./index-J-L5YNWa.js";import"./Search-Cm7pOAiq.js";import"./SearchOutlined-Eloz0Xgr.js";import"./TextArea-Cc6YC843.js";import"./Password-DAfpdhAR.js";import"./index-EaNfDv4H.js";import"./index-BOiVmP0S.js";import"./index-QNUrbcgK.js";import"./index-RZ7sMF92.js";import"./partition-D4Qmrw-1.js";import"./index-DzhuYAPB.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./shallowequal-C0Ji8tJB.js";import"./RightOutlined-Ctvc7W-t.js";import"./move-DQ5ZIRU6.js";import"./colors-CunZT9q_.js";import"./index-C5rBiNWQ.js";import"./useMaxLevel-C0rdSqjh.js";import"./index-CEo7CTw2.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-CbjqBZdV.js";import"./DownOutlined-Bq0bLGm4.js";import"./index-C791tQco.js";import"./Checkbox-CPCCCpS7.js";import"./index-CGW9ahOu.js";import"./RadioButton-Br4fysJT.js";import"./CaretDownOutlined-CbrsSkGN.js";import"./index-C7aLRSyU.js";const V=f=>(lt("data-v-0dc901c7"),f=f(),rt(),f),zt={class:"subsection-box"},Rt=["onClick"],Jt={key:1,class:"file-name-text",style:{color:"#F40"}},Qt={key:2,class:"qa-list-box"},Vt={class:"list-item"},Ht=V(()=>i("div",{class:"list-label"},"问题",-1)),Tt={class:"list-content"},At={key:0,class:"list-item"},jt=V(()=>i("div",{class:"list-label"},"相似问法",-1)),Gt={class:"list-content"},Ut={class:"list-item"},Wt=V(()=>i("div",{class:"list-label"},"答案",-1)),Xt={class:"list-content"},Yt={class:"fragment-img"},Zt=["src"],Kt={key:3,class:"common-list-box"},te={class:"top-block"},ee={class:"title"},se={class:"title"},oe=["innerHTML"],ae={class:"fragment-img"},ie=["src"],ne={key:0,class:"status-tag"},le={key:1,class:"status-tag complete"},re={class:"status-tag status-error"},ce={key:3,class:"status-tag running"},_e={class:"right-opration"},ue={class:"hover-btn-box"},pe=["onClick"],de=V(()=>i("div",null,"标记设置",-1)),me=["onClick"],he={class:"hover-btn-box"},ve=["onClick"],fe=["onClick"],ge={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(f,{expose:A,emit:F}){const w=F,u=f,g=(r,d)=>{let{id:m,title:b,content:N,question:P,answer:C,images:q,category_id:M,library_id:O}=r,x=r.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${d+1}】吗?`,onOk(){return new Promise((e,s)=>{ht({id:m,library_id:O,title:b,content:N,question:P,answer:C,images:q,category_id:M,similar_questions:JSON.stringify(x)}).then(t=>{w("handleConvert",r),e()}).catch(()=>{e()})})},onCancel(){}})},I=r=>{w("openEditSubscription",r)},D=r=>{Z.confirm({title:"提示",icon:a(St),content:"是否取消该标记?",onOk(){E(r,{})},onCancel(){}})},y=k([]),z=()=>{vt().then(r=>{y.value=r.data||[],w("getStatrList",r.data||[])})};z();const S=k(null),L=()=>{S.value.show()},R=r=>{var m;let d=(m=y.value.filter(b=>b.id==r.category_id)[0])==null?void 0:m.type;return d?X[d]:"#F4EA2A"},E=(r,d={})=>{ft({id:r.id,category_id:d.id||0}).then(m=>{tt.success("修改成功"),d.id?r.category_id=d.id:w("handleDelParagraph",r.id)})},H=r=>{window.open(`/#/library/preview?id=${r.file_id}`)};return A({handleOpenEditModal:I}),(r,d)=>{const m=$t,b=Dt,N=Ct,P=Nt,C=xt,q=wt,M=Lt,O=It,x=nt("viewer");return l(),_("div",zt,[a(O,{"data-source":f.paragraphLists,pagination:!1},{default:n(()=>[a(m,{key:"id","data-index":"id",width:1148},{title:n(()=>[f.isQaLibray?(l(),_($,{key:0},[v(" 问答（共"+p(u.total)+"个） ",1)],64)):(l(),_($,{key:1},[v("分段 （共"+p(u.total)+"个分段）",1)],64))]),default:n(({record:e,index:s})=>[e.file_name?(l(),_("a",{key:0,class:"file-name-text",onClick:t=>H(e)},p(e.file_name),9,Rt)):(l(),_("div",Jt,"原文档已删除")),f.isQaLibray?(l(),_("div",Qt,[i("div",Vt,[Ht,i("div",Tt,p(e.question),1)]),e.similar_questions&&e.similar_questions.length?(l(),_("div",At,[jt,i("div",Gt,p(e.similar_questions.join("/")),1)])):B("",!0),i("div",Ut,[Wt,i("div",Xt,p(e.answer),1)]),j((l(),_("div",Yt,[(l(!0),_($,null,Q(e.images,(t,c)=>(l(),_("img",{key:c,src:t,alt:""},null,8,Zt))),128))])),[[x]])])):(l(),_("div",Kt,[i("div",te,[i("div",ee,"分段"+p(s+1),1),i("div",se,p(e.title),1),i("span",null,"共"+p(e.word_total)+"个字符",1)]),i("div",{class:"content-box",innerHTML:e.content},null,8,oe),j((l(),_("div",ae,[(l(!0),_($,null,Q(e.images,(t,c)=>(l(),_("img",{key:c,src:t,alt:""},null,8,ie))),128))])),[[x]])]))]),_:1}),a(m,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:n(({record:e})=>[e.status==0?(l(),_("span",ne,[a(h(qt)),v(" 未转换")])):B("",!0),e.status==1?(l(),_("span",le,[a(h(yt)),v(" 已转换")])):B("",!0),e.status==2?(l(),J(b,{key:2,placement:"top"},{title:n(()=>[i("span",null,p(e.errmsg),1)]),default:n(()=>[i("span",null,[i("span",re,[a(h(kt)),v(" 转换异常")])])]),_:2},1024)):B("",!0),e.status==3?(l(),_("span",ce,[a(N,{size:"small"}),v(" 转换中")])):B("",!0)]),_:1}),a(m,{title:"操作",key:"action","data-index":"action",width:120},{default:n(({record:e,index:s})=>[i("div",_e,[a(M,null,{overlay:n(()=>[a(q,null,{default:n(()=>[(l(!0),_($,null,Q(y.value,t=>(l(),J(C,{key:t.id},{default:n(()=>[i("div",{class:"start-item",onClick:c=>E(e,t)},[a(h(W),{style:G({color:h(X)[t.type]})},null,8,["style"]),i("div",null,p(t.name||"-"),1)],8,pe)]),_:2},1024))),128)),a(C,null,{default:n(()=>[i("div",{class:"start-item",onClick:L},[a(h(Mt)),de])]),_:1})]),_:2},1024)]),default:n(()=>[i("div",ue,[e.category_id>0?(l(),J(P,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>E(e,{})},{default:n(()=>[a(h(W),{style:G({color:R(e),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),J(h(ut),{key:1,onClick:t=>E(e,y.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),a(b,null,{title:n(()=>[v("重新转换")]),default:n(()=>[i("div",{class:"hover-btn-box",onClick:t=>g(e,s)},[a(h(Ot))],8,me)]),_:2},1024),a(M,{placement:"bottomRight"},{overlay:n(()=>[a(q,null,{default:n(()=>[a(C,null,{default:n(()=>[i("div",{onClick:U(t=>I(e),["stop"])},"编辑",8,ve)]),_:2},1024),a(C,null,{default:n(()=>[i("div",{onClick:U(t=>D(e),["stop"])},"删除",8,fe)]),_:2},1024)]),_:2},1024)]),default:n(()=>[i("div",he,[a(h(Et))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),a(pt,{onOk:z,ref_key:"classificationMarkModalRef",ref:S},null,512)])}}},ye=K(ge,[["__scopeId","data-v-0dc901c7"]]),ke={class:"robot-page"},Se={class:"search-content-block"},be={class:"selct-star-box"},Ce={class:"scroll-box"},xe={class:"content-block"},we={__name:"index",setup(f){const F=ct().query,w=k([]),u=k([]),g=k(0),I={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},D={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},y=k({}),z=s=>{w.value=s},S=k({page:1,size:10}),L=_t({status:-1,category_id:-1,library_id:F.id}),R=()=>{S.value.page=1,g.value=0,u.value=[],e()},E=s=>{L.category_id=s,R()},H=()=>{gt({id:F.id}).then(()=>tt.success("操作完成"))},r=k(null),d=s=>{r.value.showModal(JSON.parse(JSON.stringify(s)))},m=s=>{if(!s.id){S.value.page=1,e();return}let t=u.value,c=t.findIndex(o=>o.id==s.id);if(c>-1){let o=t[c];o.title=s.title,o.content=s.content,o.question=s.question,o.answer=s.answer,o.answer=s.answer,o.images=s.images,o.category_id=s.category_id,o.word_total=s.question.length+s.answer.length+s.content.length,o.similar_questions=JSON.parse(s.similar_questions),t.splice(c,1,o),u.value=t}},b=s=>{let t=u.value,c=t.findIndex(o=>o.id==s);c>-1&&(t.splice(c,1),u.value=t,g.value=--g.value,g.value)},N=()=>{x.value||u.value.length>=g.value||P()},P=()=>{S.value.page++,e()},C=()=>{M()};function q(){clearInterval(O),u.value.filter(t=>t.status==3).length?O=setInterval(()=>{M()},5e3):clearInterval(O)}const M=()=>{Y({page:1,size:u.value.length,...L}).then(s=>{let c=s.data.list||[];c.forEach(o=>{o.status_text=D[o.status],o.graph_status_text=I[o.graph_status],o.similar_questions&&(o.similar_questions=JSON.parse(o.similar_questions))}),u.value=c,q()})};let O=null;const x=k(!1),e=()=>{x.value=!0,Y({...S.value,...L}).then(s=>{x.value=!1;let t=s.data,c=t.list||[];t.info&&(y.value={...t.info,is_qa_doc:t.info.type==2?1:0}),y.value={...t.info,is_qa_doc:t.info.type==2?1:0},c.forEach(o=>{o.status_text=D[o.status],o.graph_status_text=I[o.graph_status],o.similar_questions&&(o.similar_questions=JSON.parse(o.similar_questions))}),S.value.page==1&&(u.value=[]),u.value=[...u.value,...c],g.value=t.total,q()})};return e(),(s,t)=>{const c=Bt,o=Ft,et=bt,st=Pt,ot=it;return l(),_("div",ke,[i("div",Se,[i("div",be,[a(dt,{hideId:[0],startLists:w.value,onChange:E},null,8,["startLists"])]),a(st,null,{default:n(()=>[a(o,{value:L.status,"onUpdate:value":t[0]||(t[0]=T=>L.status=T),placeholder:"请选择",style:{width:"160px"},onChange:R},{default:n(()=>[a(c,{value:-1},{default:n(()=>[v("全部嵌入状态")]),_:1}),(l(),_($,null,Q(D,(T,at)=>a(c,{value:at},{default:n(()=>[v(p(T),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),a(et,{onClick:H},{default:n(()=>[v("重新嵌入向量")]),_:1})]),_:1})]),i("div",Ce,[a(ot,{scrollbar:{minSize:0},onOnScrollEnd:N},{default:n(()=>[i("div",xe,[a(ye,{ref:"subsectionBoxRef",isQaLibray:y.value.is_qa_doc,total:g.value,paragraphLists:u.value,onOpenEditSubscription:d,onHandleDelParagraph:b,onHandleConvert:C,onGetStatrList:z},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),a(mt,{detailsInfo:y.value,onHandleEdit:m,ref_key:"editSubscriptionRef",ref:r},null,8,["detailsInfo"])])}}},Hs=K(we,[["__scopeId","data-v-181a346f"]]);export{Hs as default};
