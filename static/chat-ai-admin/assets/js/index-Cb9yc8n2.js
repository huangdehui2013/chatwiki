import{b as G,$ as V,ba as x,a0 as P,M as Q,k as W,B as X}from"../../index-UhR4yadr.js";import{c as L}from"./index-cS6xwXeR.js";import{i as Y,m as H}from"./index-DIUiarE3.js";import{a5 as K,b as v,e as u,B as Z,x as j,M as h,N as ee,k as m,W as N,S as d,Y as p,u as O,Q as S,a7 as B,aa as oe}from"./vue-chunks-DWnFCQSz.js";import{C as ae}from"./config-page-menu-DlYJEI-z.js";import{C as I}from"./index-DWY9ihNz.js";import{F as le,_ as ne}from"./index-DzuDS3Yk.js";import{_ as me}from"./index-kKxyythX.js";import{_ as de}from"./index-CovtKLUB.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-DzhuYAPB.js";import"./index-5i8OLAzS.js";import"./shallowequal-C0Ji8tJB.js";import"./Trigger-DcWVD-r5.js";import"./collapseMotion-ByInPrfq.js";import"./slide-BR5NTmcW.js";import"./index-DXeZ5ybK.js";import"./isPlainObject-BeqP4IC7.js";import"./responsiveObserve-Bs6--9PQ.js";import"./QuestionCircleOutlined-CV_adx6X.js";import"./FormItemContext-BJa1evck.js";import"./colors-BiofrUQp.js";const _e={class:"ai-config-page"},te={class:"page-container"},ie={class:"ai-config-form"},se={__name:"index",setup(re){function k(e,o,_){const n=new Set(e.map(a=>a.model_define));return o.filter(a=>{let t=a[_];n.has(t)&&e.filter(i=>{if(i.model_define==t)return i.children=P(i.children,a.children),!1})}),e}const R=K(),T=v(()=>R.query.library_id),w=u(),y=u(!1);let g={};const l=Z({library_name:"",library_intro:"",ai_summary:"",ai_summary_model:"",access_rights:"",model_config_id:"",use_model:"",use_model_icon:"",use_model_name:"",use_model_switch:"",statistics_set:"",summary_model_icon:"",summary_model_name:"",summary_model_config_id:""}),c=u([]),f=u([]),r=["azure","ollama","xinference","openaiAgent"],D=["azure"],M=u(""),b=u(""),q=v(()=>c.value.map(e=>({groupLabel:e.name,groupIcon:e.icon,children:e.children.map(o=>({icon:o.icon,use_model_name:o.use_model_name,value:r.includes(o.model_define)&&o.deployment_name?o.deployment_name:o.name,rawData:o}))}))),E=e=>{l.use_model=r.includes(e.rawData.model_define)&&e.rawData.deployment_name?e.rawData.deployment_name:e.rawData.name,l.use_model_icon=e.icon,l.use_model_name=e.use_model_name,l.model_config_id=e.rawData.id,M.value=e.rawData.model_define},J=v(()=>f.value.map(e=>({groupLabel:e.name,groupIcon:e.icon,children:e.children.map(o=>({icon:o.icon,summary_model_name:o.summary_model_name,value:r.includes(o.model_define)&&o.deployment_name?o.deployment_name:o.name,rawData:o}))}))),U=e=>{l.ai_summary_model=r.includes(e.rawData.model_define)&&e.rawData.deployment_name?e.rawData.deployment_name:e.rawData.name,l.summary_model_icon=e.icon,l.summary_model_name=e.summary_model_name,l.summary_model_config_id=e.rawData.id,b.value=e.rawData.model_define},A=async()=>{try{await w.value.validate(),g.use_model!=l.use_model?Q.confirm({title:"确定切换模型为"+l.use_model+"吗？",content:"切换模型后，文档会重新向量化，会消耗token",okText:"确定",cancelText:"取消",onOk(){C()}}):C()}catch(e){console.error("表单验证失败:",e)}},C=()=>{let e={...oe(l)};D.indexOf(M.value)>-1&&(e.use_model="默认"),D.indexOf(b.value)>-1&&(e.ai_summary_model="默认"),y.value=!0,H(e).then(()=>{W.success("保存成功"),y.value=!1,g=JSON.parse(JSON.stringify(e))}).catch(()=>{y.value=!1})},z=()=>{Y({id:T.value}).then(e=>{let o=e.data||{};o.use_model=o.use_model||void 0,o.ai_summary_model=o.ai_summary_model||void 0,g=JSON.parse(JSON.stringify(o)),Object.assign(l,o)})},F=e=>{L({model_type:"TEXT EMBEDDING",is_offline:e}).then(o=>{let _=o.data||[],n=[];c.value=_.map(a=>{n=[];for(let t=0;t<a.model_info.vector_model_list.length;t++){const i=a.model_info.vector_model_list[t];n.push({name:i,deployment_name:a.model_config.deployment_name,id:a.model_config.id,model_define:a.model_info.model_define,icon:a.model_info.model_icon_url,use_model_name:a.model_info.model_name})}return{id:a.model_config.id,name:a.model_info.model_name,model_define:a.model_info.model_define,icon:a.model_info.model_icon_url,children:n,deployment_name:a.model_config.deployment_name}}),c.value=k(V(c.value,"model_define"),c.value,"model_define")})},$=()=>{L({model_type:"LLM"}).then(e=>{let o=e.data||[],_=[];f.value=o.map(n=>{_=[];for(let a=0;a<n.model_info.llm_model_list.length;a++){const t=n.model_info.llm_model_list[a];_.push({name:t,deployment_name:n.model_config.deployment_name,id:n.model_config.id,model_define:n.model_info.model_define,icon:n.model_info.model_icon_url,summary_model_name:n.model_info.model_name})}return{id:n.model_config.id,name:n.model_info.model_name,model_define:n.model_info.model_define,icon:n.model_info.model_icon_url,children:_,deployment_name:n.model_config.deployment_name}}),f.value=k(V(f.value,"model_define"),f.value,"model_define")})};return j(()=>{z(),F(),$()}),(e,o)=>{const _=me,n=de,a=ne,t=X,i=le;return h(),ee("div",_e,[m(ae),N("div",te,[N("div",ie,[m(i,{ref_key:"formRef",ref:w,model:l,"label-col":{span:2},"wrapper-col":{span:8}},{default:d(()=>[m(a,null,{label:d(()=>[p(" 嵌入  "),m(_,null,{title:d(()=>[p("开启嵌入功能后，才能在机器人中关联本知识库。")]),default:d(()=>[m(O(x))]),_:1})]),default:d(()=>[m(n,{checked:l.use_model_switch,"onUpdate:checked":o[0]||(o[0]=s=>l.use_model_switch=s),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),l.use_model_switch==1?(h(),S(a,{key:0,label:"嵌入模型",name:"use_model",rules:[{required:!0,message:"请选择嵌入模型"}]},{default:d(()=>[m(I,{modelValue:l.use_model,"onUpdate:modelValue":o[1]||(o[1]=s=>l.use_model=s),options:q.value,placeholder:"请选择嵌入模型","label-key":"use_model_name","value-key":"value","model-define":r,"model-config-id":l.model_config_id,onChange:E},null,8,["modelValue","options","model-config-id"])]),_:1})):B("",!0),m(a,null,{label:d(()=>[p(" AI智能总结  "),m(_,null,{title:d(()=>[p("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果")]),default:d(()=>[m(O(x))]),_:1})]),default:d(()=>[m(n,{checked:l.ai_summary,"onUpdate:checked":o[2]||(o[2]=s=>l.ai_summary=s),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),l.ai_summary==1?(h(),S(a,{key:1,label:"总结模型",name:"ai_summary_model",rules:[{required:!0,message:"请选择总结模型"}]},{default:d(()=>[m(I,{modelValue:l.ai_summary_model,"onUpdate:modelValue":o[3]||(o[3]=s=>l.ai_summary_model=s),options:J.value,placeholder:"请选择总结模型","label-key":"summary_model_name","value-key":"value","model-define":r,"model-config-id":l.summary_model_config_id,onChange:U},null,8,["modelValue","options","model-config-id"])]),_:1})):B("",!0),m(a,{"wrapper-col":{offset:2,span:8}},{default:d(()=>[m(t,{type:"primary",loading:y.value,onClick:A},{default:d(()=>[p("保存")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},Ee=G(se,[["__scopeId","data-v-e8a09896"]]);export{Ee as default};
