import{b as T,dy as q,k as c,bK as E,B as Q,d as Y,da as Z,N as A}from"../../index-CuFzRDH0.js";import{u as G}from"./index-CB4_IElu.js";import{a5 as H,b as B,e as f,B as J,M as n,N as u,W as p,k as s,S as o,u as y,Y as d,Q as v,F as X,$ as ee,Z as ae,a7 as _,aa as te,a1 as oe,a2 as re}from"./vue-chunks-DkYK5AuX.js";import"./index-NJlqtEGH.js";import{R as se,_ as le}from"./RadioButton-ouyuU7LQ.js";import{_ as ne}from"./index-5PrSJtCq.js";import{I as ie}from"./Input-DlD3j6GW.js";import{_ as ce,F as ue}from"./index-CKa8nflF.js";import{S as de,_ as _e}from"./index-B9b8kVtF.js";const pe=r=>(oe("data-v-d643dddd"),r=r(),re(),r),me={class:"share-form-body"},fe={class:"share-url-box",style:{width:"100",overflow:"hidden"}},ye={key:0,target:"_blank",href:"/#/user/domain"},ve={key:0,class:"form-box-bottom"},be=pe(()=>p("span",null,"复制链接",-1)),he={__name:"share-form",props:{baseUrl:{type:String,default:"/open/doc"},hideCopy:{type:Boolean,default:!1},layout:{type:String,default:"horizontal"},labelCol:{type:Object,default:()=>{}},wrapperCol:{type:Object,default:()=>{}},libraryId:{type:[Number,String],default:""},libraryKey:{type:String,default:""}},emits:["success"],setup(r,{expose:I,emit:L}){const N=L,{operate_rights:m}=q(),R=r,{toClipboard:F}=G(),U=H(),$=B(()=>U.query.library_id),b=f(""),h=f(null),a=J({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""}),g=B(()=>R.baseUrl+"/"+b.value),D=async()=>{try{const e=await Z({id:$.value});Object.assign(a,e.data)}catch(e){c.error("获取数据失败"),console.error("获取知识库信息失败:",e)}},i=f([]),O=()=>{A().then(e=>{i.value=e.data||[],a.share_url||(i.value.length>0?a.share_url=i.value[0].url:a.share_url=window.location.origin)})},k=async()=>{a.share_url||c.error("请选择自定义域名");let e=a.share_url+g.value;try{await F(e),c.success("复制成功")}catch{c.error("复制失败")}},w=async()=>{let e={...te(a)};delete e.library_key,e.avatar_file?(e.avatar=e.avatar_file,delete e.avatar_file):(delete e.avatar,delete e.avatar_file);try{let t=await E(e);N("success",t)}catch{}};return I({init:async e=>{try{b.value=e.doc_key,await D(),O()}catch{}}}),(e,t)=>{const C=se,V=le,S=ce,j=de,P=_e,W=ie,z=ne,x=Q,K=ue,M=Y;return n(),u("div",{class:"share-form",ref_key:"formWrapRef",ref:h},[p("div",me,[s(K,{model:a,layout:r.layout,"label-col":r.labelCol,"wrapper-col":r.wrapperCol,autocomplete:"off"},{default:o(()=>[s(S,{label:"访问权限"},{default:o(()=>[s(V,{value:a.access_rights,"onUpdate:value":t[0]||(t[0]=l=>a.access_rights=l),onChange:w,disabled:y(m)==2},{default:o(()=>[s(C,{value:"0"},{default:o(()=>[d("私有，仅能与应用关联，作为应用知识库")]),_:1}),s(C,{value:"1"},{default:o(()=>[d("公开，发布到互联网，所有人可访问")]),_:1})]),_:1},8,["value","disabled"])]),_:1}),a.access_rights==1?(n(),v(S,{key:0,label:"分享链接"},{default:o(()=>[p("div",fe,[s(z,{compact:""},{default:o(()=>[s(P,{style:{width:"50%"},value:a.share_url,"onUpdate:value":t[1]||(t[1]=l=>a.share_url=l),placeholder:"请选择自定义域名",getPopupContainer:()=>h.value,onChange:w,disabled:y(m)==2},{default:o(()=>[(n(!0),u(X,null,ee(i.value,l=>(n(),v(j,{value:l.url,key:l.id},{default:o(()=>[d(ae(l.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","getPopupContainer","disabled"]),s(W,{disabled:!0,value:g.value,style:{width:"50%"}},null,8,["value"])]),_:1}),r.hideCopy?_("",!0):(n(),v(x,{key:0,class:"copy-btn",onClick:t[2]||(t[2]=l=>k())},{default:o(()=>[d("复制")]),_:1}))]),p("div",null,[y(m)==4?(n(),u("a",ye,"添加自定义域名")):_("",!0)])]),_:1})):_("",!0)]),_:1},8,["model","layout","label-col","wrapper-col"])]),r.hideCopy?(n(),u("div",ve,[s(x,{type:"primary",ghost:"",onClick:t[3]||(t[3]=l=>k())},{default:o(()=>[s(M,{name:"link-left",style:{"font-size":"16px",color:"#2475fc","margin-right":"4px"}}),be]),_:1})])):_("",!0)],512)}}},Re=T(he,[["__scopeId","data-v-d643dddd"]]);export{Re as S};
