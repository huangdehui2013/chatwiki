import{_ as Re}from"./empty-CzGZrENG.js";import{k as e,e as f,a4 as te,w as Ne,B as ee,M as x,N as d,S as t,F as W,a0 as Z,Q as B,W as l,Z as I,u as z,Y as g,G as pe,H as me,V as Pe,a7 as X,a1 as re,a2 as ie,d as Ve}from"./vue-chunks-Dagx-vSq.js";import{i as Ae,j as Le,k as Ye,l as ze,m as Be,n as je,o as Je,p as He,q as $e,r as Qe,f as Ke,s as We,t as Ge,v as Ze}from"./index-P937V9jP.js";import{I as Xe,b as oe,M as K,k as J,B as ve,d as et,E as fe,h as tt,dD as be,dE as ot,n as at}from"../../index-uZrSGPJ2.js";import{F as se,_ as he}from"./index-BuYscfp6.js";import"./index-Jtlfy8YK.js";import{I as Oe}from"./Input-CkgxEQH_.js";import{Q as Ce}from"./QuestionCircleOutlined-DaqtyhFd.js";import{_ as Me}from"./index-BaDCixtO.js";import{_ as nt}from"./index-BThAHFbp.js";import{_ as Fe}from"./index-B4Fh64Os.js";import{_ as ge}from"./index-EWP4miKO.js";import"./index-BZeZ1Fpr.js";import{_ as Se,R as Ie}from"./RadioButton-B7NLGGfS.js";import{R as lt}from"./dayjs-CzCOwWO8.js";import{a as ke}from"./validate-8MtiUsxW.js";import{S as st,a as rt}from"./index-CbTVyCU8.js";import{S as it}from"./index-B8sjaOdJ.js";import{d as dt}from"./vuedraggable.umd-TY7LT6W9.js";import{_ as De}from"./index-CveYuLtq.js";import{u as ut}from"./database-D4jpZFkB.js";import{I as ct}from"./InboxOutlined-BYN-CgUO.js";import{R as _t}from"./index-Ci5b5TTx.js";import{_ as pt}from"./index-DtLQi5KI.js";import{U as mt,g as ft}from"./index-BpPh0jW3.js";import{S as vt}from"./index-CM4FzrBV.js";import{T as ht,_ as gt}from"./index-CIQLI7yb.js";import{P as xe}from"./PlusOutlined-C4d6M8_0.js";import{D as yt}from"./DownloadOutlined-UDtYdZdd.js";import"./index-o3ZFs3wF.js";import{D as bt}from"./dropdown-DE5F1xap.js";import{D as kt}from"./DownOutlined-CJyYwwtm.js";import{M as xt,_ as wt}from"./index-DGr8yI5G.js";import{S as $t}from"./SettingOutlined-D4VpY35h.js";import{a as Ot,_ as Ct}from"./index-ByxtaxSL.js";import"./axios-BZ84_VUH.js";import"./qs-CSiAN3u4.js";import"./crypto-js-DN0vhd75.js";import"./dayjs-CZ5VaChI.js";import"./Trigger-DoXVYhN4.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-CAcuZItg.js";import"./responsiveObserve-FU3Dn2XC.js";import"./collapseMotion-D5mGic4t.js";import"./FormItemContext-Cs8-ygLw.js";import"./index-CJgvF6wP.js";import"./Search-B1xKt77Y.js";import"./SearchOutlined--FowkdKA.js";import"./inputProps-CFzerOIV.js";import"./TextArea-CjFwG0DD.js";import"./index-BIs6ICi9.js";import"./Password-DhHqQ7fn.js";import"./UpOutlined-BXhmIP9E.js";import"./colors-Bq--hzfJ.js";import"./Checkbox-SbuG5kqh.js";import"./index-C5AG5J-Z.js";import"./index-Ck7gVULt.js";import"./CheckOutlined-l1N7JgI5.js";import"./shallowequal-CI97GdPH.js";import"./move-Cj-Coe07.js";import"./slide-BIPMUmGB.js";import"./pick-aPNHTXm1.js";import"./RightOutlined-BOG0y4Nw.js";import"./index-Dcu1AEuu.js";import"./useMaxLevel-G_tCMKFf.js";import"./CaretDownFilled-DFwBTbBj.js";import"./index-BQH61rer.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-q_SFvfQo.js";import"./index-DvpvmHbh.js";import"./CaretDownOutlined-BrBGZpG7.js";var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function we(c){for(var O=1;O<arguments.length;O++){var E=arguments[O]!=null?Object(arguments[O]):{},N=Object.keys(E);typeof Object.getOwnPropertySymbols=="function"&&(N=N.concat(Object.getOwnPropertySymbols(E).filter(function(D){return Object.getOwnPropertyDescriptor(E,D).enumerable}))),N.forEach(function(D){Ft(c,D,E[D])})}return c}function Ft(c,O,E){return O in c?Object.defineProperty(c,O,{value:E,enumerable:!0,configurable:!0,writable:!0}):c[O]=E,c}var ye=function(O,E){var N=we({},O,E.attrs);return e(Xe,we({},N,{icon:Mt}),null)};ye.displayName="MinusCircleOutlined";ye.inheritAttrs=!1;const St={class:"add-data-sheet"},It={class:"field-name"},Dt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(c,{expose:O,emit:E}){const N=f("添加数据"),T=te().query,v=E,k=c;Ne(()=>k.column,M=>{n()});const $=f([]),n=()=>{let M=[];k.column.forEach(u=>{h[u.name]="",u.rules=[],u.required=="true"&&u.rules.push({required:!0,message:`请输入${u.name}`}),u.type=="number"&&u.rules.push({type:"number",message:`${u.name}必须为数字`}),u.type=="integer"&&u.rules.push({asyncValidator:A}),u.type=="boolean"&&(h[u.name]="false"),M.push({...u}),$.value=M})},A=(M,u)=>new Promise((p,_)=>u==""||Number.isInteger(+u)?p():_("请输入整数")),L=f(!1),h=ee({form_id:T.form_id}),R=M=>{L.value=!0,C.value&&C.value.resetFields(),n(),h.id="",Object.assign(h,P(M)),h.id?N.value="修改数据":N.value="添加数据"},C=f(null),U=()=>{C.value.validate().then(M=>{Ae({...h}).then(u=>{let p=h.id?"修改成功":"添加成功";J.success(p),L.value=!1,v("ok")})})};function P(M){const u={};for(let p in M)if(M.hasOwnProperty(p)){const _=M[p];!isNaN(Number(_))&&typeof _=="string"&&_!=""?u[p]=Number(_):u[p]=_}return u}return O({show:R}),(M,u)=>{const p=ge,_=Fe,V=Me,i=nt,y=Oe,S=he,s=se,o=K;return d(),x("div",St,[e(o,{open:L.value,"onUpdate:open":u[0]||(u[0]=a=>L.value=a),title:N.value,onOk:U,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(s,{style:{"margin-top":"16px"},model:h,ref_key:"formRef",ref:C,layout:"vertical"},{default:t(()=>[(d(!0),x(W,null,Z($.value,a=>(d(),B(S,{name:a.name,key:a.id,rules:a.rules},{label:t(()=>[e(_,{gap:4,style:{width:"100%"}},{default:t(()=>[l("div",It,I(a.name),1),e(p,null,{title:t(()=>[g(I(a.description),1)]),default:t(()=>[e(z(Ce))]),_:2},1024)]),_:2},1024)]),default:t(()=>[a.type=="boolean"?(d(),B(V,{key:0,checked:h[a.name],"onUpdate:checked":r=>h[a.name]=r,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):a.type=="number"||a.type=="integer"?(d(),B(i,{key:1,style:{width:"100%"},value:h[a.name],"onUpdate:value":r=>h[a.name]=r,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(d(),B(y,{key:2,value:h[a.name],"onUpdate:value":r=>h[a.name]=r,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title","bodyStyle"])])}}},Ut=oe(Dt,[["__scopeId","data-v-878d9bf5"]]),qt={__name:"export-modal",setup(c,{expose:O}){const N=te().query,D=f("导出数据"),T=f(!1),v=ee({dates:[],type:1}),k=()=>{T.value=!0,v.type=1,v.dates=[]},$=ee({dates:[{validator:async(C,U)=>v.type==2&&!U.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),n=se.useForm,{resetFields:A,validate:L,validateInfos:h}=n(v,$),R=()=>{L().then(()=>{let C={form_id:N.form_id};v.type==2&&(C.start_date=v.dates[0],C.end_date=v.dates[1]),Le(C),T.value=!1})};return O({show:k}),(C,U)=>{const P=Ie,M=Se,u=he,p=lt,_=se,V=K;return d(),x("div",null,[e(V,{open:T.value,"onUpdate:open":U[2]||(U[2]=i=>T.value=i),title:D.value,onOk:R,width:450},{default:t(()=>[e(_,{class:"mt16",layout:"vertical"},{default:t(()=>[e(u,{label:""},{default:t(()=>[e(M,{value:v.type,"onUpdate:value":U[0]||(U[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(P,{value:1},{default:t(()=>[g("全部数据")]),_:1}),e(P,{value:2},{default:t(()=>[g("自定义日期")]),_:1})]),_:1},8,["value"])]),_:1}),pe(e(u,Pe({required:"",label:"选择导出日期"},z(h).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":U[1]||(U[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[me,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Et=oe(qt,[["__scopeId","data-v-80b64322"]]),Tt=c=>(re("data-v-96f3dd24"),c=c(),ie(),c),Rt={class:"add-data-sheet"},Nt=Tt(()=>l("div",{class:"form-required-item"},"筛选条件",-1)),Pt={class:"filter-list-box"},Vt={style:{"margin-left":"48px"}},At={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:E}){const N=f("添加分类"),T=te().query,v=E,k=c;f([]);const $=f(!1),n=ee({form_id:T.form_id,name:"",condition:[],type:"1",id:""}),A=()=>{let s=[{form_field_id:k.column[0].id,form_filed_type:k.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];n.condition=s},L=s=>{n.condition.splice(s,1)},h=(s,o)=>{s.rule=void 0,s.rule_value1="",s.rule_value2="",s.form_filed_type=k.column.filter(a=>a.id==s.form_field_id)[0].type},R=(s,o)=>o.form_field_id==s.id?!1:n.condition.map(r=>r.form_field_id).includes(s.id),C=()=>{let s=n.condition.map(a=>a.form_field_id),o=k.column.filter(a=>!s.includes(a.id));if(!o.length){J.error("字段已全部添加");return}n.condition.push({form_field_id:o[0].id,form_filed_type:o[0].type,rule:void 0,rule_value1:"",rule_value2:""})},U=s=>!s.rule||s.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(s.rule),P=s=>!s.rule||s.form_filed_type=="boolean"?!1:["between"].includes(s.rule),M=(s,o,a)=>new Promise((r,q)=>U(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?r():q("请输入数字"):r():q("请输入"):r()),u=(s,o,a)=>new Promise((r,q)=>P(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入数字"):r():q("请输入"):r()),p=()=>{$.value=!0,N.value="添加分类",A(),n.name="",n.type="1",n.id=""},_=s=>{$.value=!0,N.value="编辑分类",Ye({form_id:T.form_id,id:s.id}).then(o=>{let a=o.data.conditions||"[]";a=JSON.parse(a),a=a.map(r=>({form_field_id:r.form_field_id+"",form_filed_type:k.column.filter(q=>q.id==r.form_field_id)[0].type,rule:V(r.rule),rule_value1:r.rule_value1,rule_value2:r.rule_value2})),n.condition=a,n.name=o.data.name,n.type=o.data.type,n.id=o.data.id})};function V(s){const o=["string_","integer_","number_","boolean_"];for(const a of o)if(s.startsWith(a))return s.slice(a.length);return s}const i=f(null),y=()=>{i.value.validate().then(s=>{let o=n.condition.map(m=>({form_field_id:+m.form_field_id,rule:m.form_filed_type+"_"+m.rule,rule_value1:m.rule_value1,rule_value2:m.rule_value2})),a={...n,condition:JSON.stringify(o)},r=ze,q="添加成功";n.id&&(r=Be,q="编辑成功"),r(a).then(m=>{J.success(q),$.value=!1,v("ok")})}).catch(s=>{})},S=f({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return O({show:p,edit:_}),(s,o)=>{const a=Oe,r=he,q=rt,m=st,Y=it,H=ve,Q=Ie,le=Se,ue=se,ce=K;return d(),x("div",Rt,[e(ce,{open:$.value,"onUpdate:open":o[2]||(o[2]=F=>$.value=F),title:N.value,onOk:y,width:790},{default:t(()=>[e(ue,{class:"form-box",style:{"margin-top":"16px"},model:n,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(r,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(a,{maxLength:64,value:n.name,"onUpdate:value":o[0]||(o[0]=F=>n.name=F),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),Nt,l("div",Pt,[(d(!0),x(W,null,Z(n.condition,(F,j)=>(d(),B(Y,{key:j,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[l("div",null,"条件"+I(j+1)+":",1),e(r,null,{default:t(()=>[e(m,{value:F.form_field_id,"onUpdate:value":b=>F.form_field_id=b,style:{width:"150px"},placeholder:"请选择",onChange:b=>h(F,j)},{default:t(()=>[(d(!0),x(W,null,Z(k.column,b=>(d(),B(q,{disabled:R(b,F),key:b.id,value:b.id},{default:t(()=>[g(I(b.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(r,{name:["condition",j,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(m,{value:F.rule,"onUpdate:value":b=>F.rule=b,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(d(!0),x(W,null,Z(S.value[F.form_filed_type],b=>(d(),B(q,{key:b.value,value:b.value},{default:t(()=>[g(I(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),pe(e(r,{name:["condition",j,"rule_value1"],rules:{asyncValidator:(b,ae)=>M(b,ae,F)}},{default:t(()=>[e(a,{value:F.rule_value1,"onUpdate:value":b=>F.rule_value1=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,U(F)]]),pe(e(r,{name:["condition",j,"rule_value2"],rules:{asyncValidator:(b,ae)=>u(b,ae,F),trigger:"blur"}},{default:t(()=>[e(a,{value:F.rule_value2,"onUpdate:value":b=>F.rule_value2=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,P(F)]]),n.condition.length>1?(d(),B(z(ye),{key:0,onClick:b=>L(j)},null,8,["onClick"])):X("",!0)]),_:2},1024))),128)),l("div",Vt,[e(H,{onClick:C},{default:t(()=>[g("添加条件")]),_:1})])]),e(r,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:n.type,"onUpdate:value":o[1]||(o[1]=F=>n.type=F)},{default:t(()=>[e(Q,{value:"1"},{default:t(()=>[g("与（And）")]),_:1}),e(Q,{value:"2"},{default:t(()=>[g("或（Or）")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ue=oe(At,[["__scopeId","data-v-96f3dd24"]]),ne=c=>(re("data-v-2d0e4f7e"),c=c(),ie(),c),Lt={class:"custom-table"},Yt=ne(()=>l("div",{class:"t-head"},[l("div",{class:"td"},[l("div",{style:{width:"24px"}}),g(" 分类名称 ")]),l("div",{class:"td"},"类型"),l("div",{class:"td"},"启用分类"),l("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),zt={class:"t-body"},Bt={class:"t-row"},jt=ne(()=>l("div",{class:"t-item"},[l("div",{style:{width:"24px"}}),g(" 全部 ")],-1)),Jt=ne(()=>l("div",{class:"t-item"},"系统分类",-1)),Ht={class:"t-item"},Qt=ne(()=>l("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1)),Kt={class:"t-item"},Wt={class:"drag-btn"},Gt={key:0},Zt={key:1},Xt=ne(()=>l("div",{class:"t-item"},"自定义分类",-1)),eo={class:"t-item"},to={class:"t-item flex-none",style:{width:"120px"}},oo=["onClick"],ao=["onClick"],no={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(c,{expose:O,emit:E}){const D=te().query,T=E,v=f("管理分类"),k=f(!1),$=c,n=()=>{$e({form_id:D.form_id}).then(p=>{R.value=p.data.map(_=>({..._}))})},A=()=>{n(),T("ok"),T("change")},L=()=>{n(),k.value=!0},h=()=>{k.value=!1},R=f(),C=()=>{let p=[];R.value.reverse().forEach((_,V)=>{p.push({id:+_.id,sort:+V+1})}),je({form_id:D.form_id,filter_sort:JSON.stringify(p)}).then(_=>{J.success("排序成功"),n(),T("change")})},U=p=>{Je({form_id:D.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(_=>{J.success("设置成功"),n(),T("change")})},P=(p,_)=>{K.confirm({title:"删除确认",icon:e(fe),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){He({id:p.id,form_id:D.form_id}).then(V=>{J.success("删除成功"),R.value.splice(_,1),T("change")})},onCancel(){}})},M=f(null),u=p=>{M.value.edit(p)};return O({show:L}),(p,_)=>{const V=Me,i=et,y=ge,S=De,s=K;return d(),x("div",null,[e(s,{open:k.value,"onUpdate:open":_[1]||(_[1]=o=>k.value=o),title:v.value,onCancel:h,footer:null,width:760},{default:t(()=>[l("div",Lt,[Yt,l("div",zt,[l("div",Bt,[jt,Jt,l("div",Ht,[e(V,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),Qt]),e(z(dt),{modelValue:R.value,"onUpdate:modelValue":_[0]||(_[0]=o=>R.value=o),"item-key":"id",onEnd:C,group:"table-rows",handle:".drag-btn"},{item:t(({element:o,index:a})=>[(d(),x("div",{key:o.id,class:"t-row"},[l("div",Kt,[l("span",Wt,[e(i,{name:"drag"})]),o.name.length>10?(d(),x("span",Gt,[e(y,null,{title:t(()=>[g(I(o.name),1)]),default:t(()=>[g(" "+I(o.name.slice(0,10)+"..."),1)]),_:2},1024)])):(d(),x("span",Zt,I(o.name),1))]),Xt,l("div",eo,[e(V,{onChange:r=>U(o),checked:o.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),l("div",to,[l("a",{onClick:r=>u(o)},"编辑",8,oo),e(S,{type:"vertical"}),l("a",{onClick:r=>P(o,a)},"删除",8,ao)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e(Ue,{onOk:A,column:$.column,ref_key:"addFilrerModalRef",ref:M},null,8,["column"])])}}},lo=oe(no,[["__scopeId","data-v-2d0e4f7e"]]),de=c=>(re("data-v-6beddc88"),c=c(),ie(),c),so=de(()=>l("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1)),ro={class:"upload-box"},io={class:"ant-upload-drag-icon"},uo=de(()=>l("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),co=de(()=>l("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1)),_o={key:0,class:"progress-box"},po=de(()=>l("div",{class:"tip"},"数据导入中，请勿关闭页面",-1)),mo={key:0},fo={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:E}){const N=tt(),D=E,T=te().query,v=c,k=f(!1),$=f(!1),n=ee({total:0,success:0,err_data:[]}),A=f([]),L=i=>{const y=i.file.status;if(y==="done")if(i.file.response.res==0){let S=i.file.response.data.task_id;C(S)}else return A.value=[],J.error(i.file.response.msg);else y==="error"&&(A.value=[],J.error(`${i.file.name} file upload failed.`))};function h(i){}let R=null;const C=i=>{R&&clearInterval(R),k.value=!1,p.value=!0,_.value=10,n.total=0,n.success=0,n.err_data=[],R=setInterval(()=>{Qe({task_id:i}).then(y=>{let S=y.data;_.value=(S.processed/S.total).toFixed(),S.finish&&(D("ok"),clearInterval(R),_.value=100),S.total>0&&(n.total=S.total,n.success=S.success,n.err_data=S.err_data)}).catch(()=>{clearInterval(R)})},2e3)},U=()=>{let i;i=v.column.map(y=>y.name),i="id,"+i.join(",")+`
`,be(i,[],[],"导入数据模板.csv")},P=()=>{let i={id:""};v.column.forEach(y=>{i[y.name]=""}),ot([i],"导入数据模板.json")},M=()=>{A.value=[],k.value=!0},u=()=>{},p=f(!1),_=f(10),V=()=>{let i="id,",y=["id"];for(let o in n.err_data[0])o!="id"&&o!="err_msg"&&(i+=o+",",y.push(o));i=i+`err_msg
`,y.push("err_msg");let S=n.err_data,s="失败数据_"+at().format("YYYY/MM/DD HH:mm")+".xlsx";be(i,S,y,s)};return O({show:M}),(i,y)=>{const S=pt,s=mt,o=K,a=ft,r=ve,q=_t;return d(),x("div",null,[e(o,{open:k.value,"onUpdate:open":y[1]||(y[1]=m=>k.value=m),title:"导入数据","confirm-loading":$.value,onOk:u,footer:null,width:746},{default:t(()=>[e(S,{"show-icon":"",class:"alert-box"},{message:t(()=>[l("div",null,[g(" 支持通过Excel或者json文件导入数据。 "),l("a",{onClick:U,class:"mr8"},"excel模板"),l("a",{onClick:P},"json模板")]),so]),_:1}),l("div",ro,[e(s,{fileList:A.value,"onUpdate:fileList":y[0]||(y[0]=m=>A.value=m),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:z(N).getToken},data:{form_id:z(T).form_id},action:"/manage/uploadFormFile",onChange:L,onDrop:h},{default:t(()=>[l("p",io,[e(z(ct))]),uo,co]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(o,{open:p.value,"onUpdate:open":y[2]||(y[2]=m=>p.value=m),title:"导入数据",footer:null,width:746},{default:t(()=>[_.value<100?(d(),x("div",_o,[e(a,{type:"circle",percent:_.value},null,8,["percent"]),po])):(d(),B(q,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[g("导入成功"+I(n.success)+"，导入失败"+I(n.total-n.success)+" ",1),n.total-n.success>0?(d(),x("span",mo," 您可以下载失败数据，修改后重新导入 ")):X("",!0)]),extra:t(()=>[n.total-n.success>0?(d(),B(r,{key:0,onClick:V,type:"primary"},{default:t(()=>[g("下载失败数据")]),_:1})):X("",!0)]),_:1}))]),_:1},8,["open"])])}}},vo=oe(fo,[["__scopeId","data-v-6beddc88"]]),qe=c=>(re("data-v-782a68fb"),c=c(),ie(),c),ho={key:0,class:"loading-box"},go={key:1,class:"empty-box"},yo=qe(()=>l("img",{src:Re,alt:""},null,-1)),bo=qe(()=>l("div",null,"暂无字段, 请先去添加字段",-1)),ko=[yo,bo],xo={key:2,class:"field-manage-page"},wo={class:"page-title"},$o={key:0},Oo={key:1},Co={class:"table-wrapper customize-scroll-style"},Mo={key:0},Fo={key:1},So={key:0},Io={key:1},Do=["onClick"],Uo=["onClick"],qo={__name:"index",setup(c){const O=ut(),E=Ve(()=>O.databaseInfo.entry_count),D=te().query,T=f([]),v=f([]),k=f(!0),$=ee({form_id:D.form_id,page:1,size:10,total:0}),n=f(!1),A=m=>{$.page=m.current,$.size=m.pageSize,h()},L=()=>{$.page=1,h()},h=()=>{n.value=!0,We({...$,filter_id:C.value}).then(m=>{T.value=m.data.list||[],$.total=+m.data.total||0,O.getDatabaseInfo({id:D.form_id})}).finally(()=>{n.value=!1})};Ke({form_id:D.form_id}).then(m=>{v.value=m.data,k.value=!1,h()});const R=f([]),C=f(""),U=()=>{$e({form_id:D.form_id}).then(m=>{let Y=m.data||[];if(R.value=Y.filter(H=>H.enabled=="true"),C.value){let H=Y.filter(Q=>Q.id==C.value);(H.length&&H[0].enabled=="false"||!H.length)&&(C.value="",h())}})};U();const P=()=>{U(),h()},M=()=>{$.page=1,h()},u=f(null),p=(m,Y)=>{Y==="add"&&u.value.show()},_=m=>{K.confirm({title:"删除确认",icon:e(fe),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Ze({id:m.id}).then(Y=>{J.success("删除成功"),P()})},onCancel(){}})},V=()=>{K.confirm({title:"清空数据提示",icon:e(fe),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Ge({form_id:D.form_id}).then(m=>{J.success("清空成功"),P()})},onCancel(){}})},i=f(null),y=(m={})=>{i.value.show(JSON.parse(JSON.stringify(m)))},S=f(null),s=(m={})=>{S.value.show()},o=f(null),a=()=>{o.value.show()},r=f(null),q=()=>{r.value.show()};return(m,Y)=>{const H=vt,Q=ve,le=wt,ue=xt,ce=bt,F=Fe,j=gt,b=ge,ae=ht,_e=Ct,Ee=De,Te=Ot;return d(),x(W,null,[k.value?(d(),x("div",ho,[e(H)])):X("",!0),!k.value&&!v.value.length?(d(),x("div",go,ko)):X("",!0),!k.value&&v.value.length?(d(),x("div",xo,[l("div",wo,[g(" 数据管理 "),e(F,{gap:16},{default:t(()=>[e(Q,{type:"primary",onClick:Y[0]||(Y[0]=w=>y())},{icon:t(()=>[e(z(xe))]),default:t(()=>[g(" 添加数据 ")]),_:1}),e(Q,{onClick:Y[1]||(Y[1]=w=>s())},{icon:t(()=>[e(z(yt))]),default:t(()=>[g(" 导入数据 ")]),_:1}),e(ce,null,{overlay:t(()=>[e(ue,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[l("div",{onClick:a},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[l("div",{onClick:V},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(Q,null,{default:t(()=>[g(" 更多操作 "),e(z(kt))]),_:1})]),_:1})]),_:1})]),e(ae,{class:"tabs-wrapper",activeKey:C.value,"onUpdate:activeKey":Y[2]||(Y[2]=w=>C.value=w),type:"editable-card",onEdit:p,onChange:M},{addIcon:t(()=>[e(z(xe)),g(" 添加分类 ")]),rightExtra:t(()=>[l("span",{class:"setting-btn",onClick:q},[e(z($t)),g(" 管理分类 ")])]),default:t(()=>[e(j,{key:"",closable:!1},{tab:t(()=>[g("全部 ("+I(E.value)+")",1)]),_:1}),(d(!0),x(W,null,Z(R.value,w=>(d(),B(j,{key:w.id,closable:!1},{tab:t(()=>[w.name.length>8?(d(),x("span",$o,[e(b,null,{title:t(()=>[g(I(w.name),1)]),default:t(()=>[g(" "+I(w.name.slice(0,8)+"..."),1)]),_:2},1024)])):(d(),x("span",Oo,I(w.name),1)),g(" ("+I(w.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),l("div",Co,[e(Te,{sticky:"","data-source":T.value,loading:n.value,scroll:{x:1e3},pagination:{current:$.page,total:$.total,pageSize:$.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:A},{default:t(()=>[e(_e,{key:"id","data-index":"id",title:"id",width:60}),(d(!0),x(W,null,Z(v.value,w=>(d(),B(_e,{key:w.name,"data-index":w.name,width:165},{title:t(()=>[w.name.length>12?(d(),x("span",Mo,[e(b,null,{title:t(()=>[g(I(w.name),1)]),default:t(()=>[g(" "+I(w.name.slice(0,12)+"..."),1)]),_:2},1024)])):(d(),x("span",Fo,I(w.name),1)),e(b,null,{title:t(()=>[g(I(w.description),1)]),default:t(()=>[e(z(Ce),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:G})=>[G[w.name].length>10?(d(),x("span",So,[e(b,null,{title:t(()=>[g(I(G[w.name]),1)]),default:t(()=>[g(" "+I(G[w.name].slice(0,9)+"..."),1)]),_:2},1024)])):(d(),x("span",Io,I(G[w.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(_e,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:w})=>[l("span",null,[l("a",{onClick:G=>y(w)},"编辑",8,Do),e(Ee,{type:"vertical"}),l("a",{onClick:G=>_(w)},"删除",8,Uo)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(Ut,{onOk:P,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e(Ue,{onOk:P,column:v.value,ref_key:"addFilrerModalRef",ref:u},null,8,["column"]),e(Et,{ref_key:"exportModalRef",ref:o},null,512),e(lo,{onOk:h,onChange:U,column:v.value,ref_key:"filterManageModalRef",ref:r},null,8,["column"]),e(vo,{onOk:L,column:v.value,ref_key:"importDataModalRef",ref:S},null,8,["column"])])):X("",!0)],64)}}},Za=oe(qo,[["__scopeId","data-v-782a68fb"]]);export{Za as default};
