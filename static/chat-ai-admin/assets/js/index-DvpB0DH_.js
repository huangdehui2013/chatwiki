import{b as R,M as C,h as he,B as be,dh as we,dL as te,dR as Se,k as K,dS as Ee,d as xe,dT as Le,dI as Te,dU as Be}from"../../index-BYXP5-K6.js";import{e as c,B as T,Q as I,N as f,S as r,W as s,k as n,aa as V,M as E,U as Ce,a1 as ae,a2 as ne,d as oe,a4 as Ie,x as Re,o as De,a7 as O,Z as Ue,Y as J,u as qe}from"./vue-chunks-DKljrDvA.js";import{_ as j,F as z}from"./index-DvGRcWf4.js";import{_ as G}from"./TextArea-Dnm7usWJ.js";import{_ as Me,S as Oe}from"./share-popup-Df8NKPLs.js";import{C as Je}from"./CheckOutlined-tNTNjiBd.js";import{_ as Ye,a as Ne}from"./RadioButton-D6KxmP_c.js";import"./axios-BZ84_VUH.js";import"./qs-DB0tj3pA.js";import"./crypto-js-fJpLWOEv.js";import"./dayjs-BpZi_McX.js";import"./Trigger-DAizGHX4.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-BRAWLrZZ.js";import"./responsiveObserve-DRuL2_me.js";import"./collapseMotion-CxHtxgWr.js";import"./index-C9HKvTtP.js";import"./colors-BsGfXzR0.js";import"./QuestionCircleOutlined-DYrN9KdY.js";import"./FormItemContext-BbeLgxF6.js";import"./index-DxTO0j69.js";import"./index-2d7y8GiQ.js";import"./inputProps-B3PFVydJ.js";import"./index-CcC8Vz_q.js";import"./Input-Bfzy8tJK.js";import"./Search-1aGcXLAr.js";import"./SearchOutlined-BAHqMa3J.js";import"./Password-CPQYqxS0.js";import"./index-BIs6VsWm.js";import"./share-form-DAhgURc4.js";import"./index-B6tAcODo.js";import"./index-BNZqkHuq.js";import"./index-ChLzCBr1.js";import"./slide-C8pAsQDb.js";import"./DownOutlined-BfzuAtqc.js";import"./move-BNsvENtF.js";import"./index-cp-3f9TC.js";import"./Checkbox-DoUvt9dJ.js";const Xe={class:"upload-ssl-form"},Qe={__name:"edit-title",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const g=h,b=u,m=c(),a=T({title:""}),p={title:[{required:!0,message:"请输入标题"}]},t=c(!1),v=l=>{a.title=l.title,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{g("ok",V(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const x=G,A=j,y=z,L=C;return f(),I(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑标题",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",Xe,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(A,{label:"",name:"title"},{default:r(()=>[n(x,{rows:5,value:a.title,"onUpdate:value":i[0]||(i[0]=_=>a.title=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Ke=R(Qe,[["__scopeId","data-v-32d29b31"]]),Ve={class:"upload-ssl-form"},je={__name:"edit-desc",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const g=h,b=u,m=c(),a=T({content:""}),p={},t=c(!1),v=l=>{a.content=l.content,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{g("ok",V(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const x=G,A=j,y=z,L=C;return f(),I(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑描述",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",Ve,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(A,{label:"",name:"content"},{default:r(()=>[n(x,{rows:5,value:a.content,"onUpdate:value":i[0]||(i[0]=_=>a.content=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},ze=R(je,[["__scopeId","data-v-661cb706"]]),Ge={class:"upload-ssl-form"},Pe={__name:"edit-question-guide",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(u,{expose:k,emit:h}){const g=h,b=u,m=c(),a=T({question:""}),p={question:[{required:!0,message:"请输入问题引导"}]},t=c(!1),v=l=>{a.question=l.question,t.value=!0},d=()=>{t.value=!1},w=()=>{m.value.validate().then(()=>{g("ok",V(a))}).catch(l=>{})};return k({open:v,close:d}),(l,i)=>{const x=G,A=j,y=z,L=C;return f(),I(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=_=>t.value=_),title:"编辑问题引导",onOk:w,confirmLoading:b.confirmLoading,"ok-text":"保 存"},{default:r(()=>[s("div",Ge,[n(y,{ref_key:"formRef",ref:m,model:a,rules:p,autocomplete:"off",layout:"vertical"},{default:r(()=>[n(A,{label:"",name:"question"},{default:r(()=>[n(x,{rows:5,value:a.question,"onUpdate:value":i[0]||(i[0]=_=>a.question=_)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Fe=R(Pe,[["__scopeId","data-v-680592b4"]]),We="data:image/png;base64,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",He={},se=u=>(ae("data-v-91f8ee88"),u=u(),ne(),u),Ze={class:"phone-wrapper"},$e={class:"phone-box"},et=se(()=>s("div",{class:"phone-header"},[s("img",{class:"navbar",src:We,alt:""})],-1)),tt={class:"phone-body"},ot=se(()=>s("div",{class:"phone-footer"},null,-1));function at(u,k){return f(),E("div",Ze,[s("div",$e,[et,s("div",tt,[Ce(u.$slots,"default",{},void 0,!0)]),ot])])}const nt=R(He,[["render",at],["__scopeId","data-v-91f8ee88"]]);var st={};const P=u=>(ae("data-v-d1cf448e"),u=u(),ne(),u),it={class:"home-preview"},lt={class:"toolbar-wrapper"},ct={class:"toolbar-left"},rt={class:"toolbar-item"},dt={class:"toolbar-right"},ut={key:0,class:"edit-user"},_t=["src"],mt={class:"user-name"},ft=P(()=>s("span",{class:"edit-status-text"},"编辑中...",-1)),pt={class:"action-item"},vt={key:1,class:"action-item"},yt=P(()=>s("span",null,"SEO设置",-1)),gt={class:"action-item"},At=P(()=>s("span",null,"编辑",-1)),kt={class:"preview-box"},ht={key:0,class:"mobile-box"},bt=["src"],wt={key:1,class:"pc-box"},St=["src"],Et={__name:"index",setup(u){const k=Ie(),{getToken:h,user_id:g}=he(),b=oe(()=>k.query.library_id),m=c(null),a=c(new Date().getTime()),p=c(!1),t=T({doc_id:"",title:"",content:"",library_intro:"",library_name:"",library_key:""}),v=T({doc_id:"",is_pub:"",doc_key:"",seo_title:"",seo_desc:"",seo_keywords:""}),d=T({show:!1,user_name:"",avatar:"",nick_name:""}),w=async e=>{let o=await Ee({id:e});return d.avatar=o.data.avatar,d.user_name=o.data.user_name,d.nick_name=o.data.nick_name,o},l=c(null),i=c(!1),x=e=>{t.title=e.title,i.value=!0,F().then(()=>{i.value=!1,l.value.close()}).catch(()=>{i.value=!1})},A=c(null),y=c(!1),L=e=>{t.content=e.content,y.value=!0,F().then(()=>{y.value=!1,A.value.close()}).catch(()=>{y.value=!1})},_=async()=>await Te({library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1}).then(o=>(t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,a.value=new Date().getTime(),o)),F=async()=>{await _()&&K.success("保存成功")},D=c(!1),ie=()=>{let e={library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1};D.value=!0,Be(e).then(o=>{t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,D.value=!1,K.success("发布成功"),q(!1),a.value=new Date().getTime()}).catch(()=>{D.value=!1})},W=c(null),le=()=>{let e={library_key:t.library_key,seo_title:v.seo_title,seo_desc:v.seo_desc,seo_keywords:v.seo_keywords,doc_id:t.doc_id};W.value.open(e)},ce=()=>{Z(),a.value=new Date().getTime()},Y=c(null),U=c(!1),S=T({id:"",question:""}),re=e=>{S.question=e.question,U.value=!0,Le({library_key:t.library_key,id:S.id||"",question:S.question}).then(()=>{a.value=new Date().getTime(),U.value=!1,Y.value.close()}).catch(()=>{U.value=!1})},N=c("pc");let de=st.VITE_OPEN_DOC_HOST||"";const H=oe(()=>`${de}/manage/libDocHome/${t.library_key}?&v=${a.value}&token=${h}`),ue=()=>{we({id:b.value}).then(e=>{Object.assign(t,e.data)})},Z=()=>{te({doc_id:t.doc_id,library_key:t.library_key}).then(e=>{Object.assign(v,e.data);let o=e.data.edit_user&&e.data.edit_user!=0;o&&e.data.edit_user!=g&&(d.show=!0,w(e.data.edit_user)),o&&e.data.edit_user==g?q(!0):q(!1)})},_e=e=>{t.doc_id=e.doc_id,t.title=e.title,t.content=e.content,Z()},me=e=>{t.title=e.title,t.content=e.content,l.value.open(e)},fe=e=>{t.title=e.title,t.content=e.content,A.value.open(e)},$=e=>{S.id=e.id,S.question=e.question,Y.value.open(e)},pe=e=>{S.id=e.id,S.question=e.question,C.confirm({title:"删除问题引导",content:"确定要删除该问题引导吗？",okText:"确定",cancelText:"取消",onOk(){Se({library_key:t.library_key,id:S.id}).then(()=>{K.success("删除成功"),a.value=new Date().getTime()})}})},ve=e=>{e.key=="title"&&me(e.data),e.key=="content"&&fe(e.data),e.key=="question"&&$(e.data)},ye=e=>{e.key=="question"&&$(e.data)},ge=e=>{e.key=="question"&&pe(e.data)},Ae=async()=>{try{let e=await te({doc_id:t.doc_id,library_key:t.library_key});if(e.data.edit_user&&e.data.edit_user!=0&&e.data.edit_user!=g){let B=await w(e.data.edit_user),X=B.data.nick_name||B.data.user_name;d.show=!0,C.warning({title:X+"正在编辑此文档",content:"需要其他协作者结束编辑并发布后才可以继续编辑",okText:"知道了"});return}_(),p.value=!0,d.show=!1}catch{return}},q=e=>{p.value=e,m.value.contentWindow.postMessage({action:"setEditStatus",data:{type:p.value}},"*")},ee=e=>{const o=e.data;o.action==="check_preview"&&m.value.contentWindow.postMessage({action:"setPreview",token:h},"*"),o.action==="init"&&(_e(o.data),p.value&&q(!0)),o.action==="edit"&&ve(o),o.action==="add"&&ye(o),o.action==="delete"&&ge(o)};return Re(()=>{ue(),window.addEventListener("message",ee)}),De(()=>{window.removeEventListener("message",ee)}),(e,o)=>{const B=Ne,X=Ye,Q=xe,M=be;return f(),E("div",it,[s("div",lt,[s("div",ct,[s("div",rt,[n(X,{value:N.value,"onUpdate:value":o[0]||(o[0]=ke=>N.value=ke)},{default:r(()=>[n(B,{value:"pc"},{default:r(()=>[J("PC端样式")]),_:1}),n(B,{value:"mobile"},{default:r(()=>[J("移动端样式")]),_:1})]),_:1},8,["value"])])]),s("div",dt,[d.show&&d.user_name?(f(),E("div",ut,[s("img",{class:"user-avatar",src:d.avatar,alt:""},null,8,_t),s("span",mt,Ue(d.nick_name||d.user_name),1),ft])):O("",!0),s("div",pt,[n(Me,{ref:"sharePopupRef","base-url":"/open/home",docKey:t.library_key,libraryId:b.value},{default:r(()=>[n(M,null,{default:r(()=>[n(Q,{class:"action-icon",name:"share",style:{"font-size":"16px"}}),J(" 分享")]),_:1})]),_:1},8,["docKey","libraryId"])]),p.value?(f(),E("div",vt,[n(M,{onClick:le},{default:r(()=>[n(Q,{class:"action-icon",name:"jibenpeizhi",style:{"font-size":"16px",color:"#595959"}}),yt]),_:1})])):O("",!0),s("div",gt,[p.value?(f(),I(M,{key:0,type:"primary",loading:D.value,onClick:ie},{default:r(()=>[n(qe(Je)),J(" 发布")]),_:1},8,["loading"])):(f(),I(M,{key:1,type:"primary",onClick:Ae},{default:r(()=>[n(Q,{class:"action-icon",name:"edit",style:{"font-size":"16px",color:"#fff"}}),At]),_:1}))])])]),s("div",kt,[N.value=="mobile"?(f(),E("div",ht,[n(nt,null,{default:r(()=>[t.library_key?(f(),E("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:H.value,frameborder:"0"},null,8,bt)):O("",!0)]),_:1})])):(f(),E("div",wt,[t.library_key?(f(),E("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:H.value,frameborder:"0"},null,8,St)):O("",!0)]))]),n(Ke,{ref_key:"editTitleRef",ref:l,onOk:x,"confirm-loading":i.value},null,8,["confirm-loading"]),n(ze,{ref_key:"editDescRef",ref:A,onOk:L,"confirm-loading":y.value},null,8,["confirm-loading"]),n(Fe,{ref_key:"editQuestionGuideRef",ref:Y,onOk:re,"confirm-loading":U.value},null,8,["confirm-loading"]),n(Oe,{ref_key:"seoSettingRef",ref:W,onOk:ce},null,512)])}}},uo=R(Et,[["__scopeId","data-v-d1cf448e"]]);export{uo as default};
