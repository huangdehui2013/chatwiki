import{M as n,N as h,W as e,k as o,Y as I,Z as q,U as de,a7 as V,Q as N,S as i,X as et,a6 as we,e as $,d as H,B as Q,G as ae,H as le,u as y,aa as W,a1 as F,a2 as J,a5 as tt,F as B,$ as G,w as ue,l as ot,b as ve,x as ke,o as st,j as Ue,ad as be,af as ye,D as nt,a0 as it,z as at,ac as lt,V as ct,a9 as rt,p as _t}from"./vue-chunks-DWnFCQSz.js";import{b as P,d as ce,B as oe,X as dt,Y as Ve,k as X,M as ee,Z as he,$ as ut,a0 as pt,e as mt,W as vt,a1 as xe,E as ht}from"../../index-UhR4yadr.js";import{_ as Se}from"./index-DrSPxL4Q.js";import{C as ft,E as bt}from"./cu-upload-C9szrORw.js";import"./index--Qvpscnx.js";import{I as pe}from"./Input-D7W5TJDt.js";import{_ as qe}from"./TextArea-CpTIlaWe.js";import{C as Ne}from"./cu-scroll-jRkjVxy8.js";import{f as yt,c as kt}from"./index-PjC8bJD0.js";import{_ as gt}from"./index-wuAyyj3q.js";import{S as Ee}from"./index-BWhNhRp3.js";import{D as $t}from"./DownOutlined-CvDOGKH1.js";import{U as xt}from"./UpOutlined-BkQ7BaZ8.js";import{_ as ze,T as Be}from"./index-teqAjsuU.js";import{P as Re}from"./PlusOutlined-CeclvJCi.js";import{_ as te}from"./index-CovtKLUB.js";import{c as Pe}from"./index-cS6xwXeR.js";import{C as wt}from"./index-DWY9ihNz.js";import{_ as Te}from"./index-pSHtK2e9.js";import{_ as Ce}from"./index-BnhNOVTI.js";import{Q as Y}from"./QuestionCircleOutlined-CV_adx6X.js";import{_ as St,a as qt}from"./index-CtaUuE5E.js";import{_ as re}from"./index-kKxyythX.js";import{g as Qe}from"./index-DIUiarE3.js";import{S as Ct}from"./SearchOutlined-bV5WeZB5.js";import{S as It}from"./SyncOutlined-BM33Hh67.js";import{C as Fe,_ as Je}from"./index-ChDOqBF7.js";import{_ as Ke}from"./index-DkSkDsnJ.js";import{_ as Lt}from"./recommendation-AQ4_FPQ9.js";import{S as Ut,a as Et,_ as Rt}from"./index-9VXz7HRC.js";import{R as Ot}from"./RightOutlined-BxQrTxvt.js";import{g as Ge}from"./index-H0fxFesA.js";import{_ as At}from"./empty-CzGZrENG.js";import{d as Oe}from"./vuedraggable.umd-DPgBjE-X.js";import"./index-Drb31wtU.js";import{R as Mt,_ as Dt}from"./RadioButton-BySv4e0a.js";import{F as je,_ as Vt}from"./index-DzuDS3Yk.js";import{_ as jt}from"./index-RGagVdKM.js";import{u as Nt}from"./robot--cbiXIXU.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./FormItemContext-BJa1evck.js";import"./index-DmSlXGTl.js";import"./Search-BRb_v-2B.js";import"./isPlainObject-BeqP4IC7.js";import"./inputProps-CiDWLiIl.js";import"./Password-XreinKYD.js";import"./statusUtils--roYFmJe.js";import"./index-DXeZ5ybK.js";import"./Trigger-DcWVD-r5.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-BiofrUQp.js";import"./index-5i8OLAzS.js";import"./shallowequal-C0Ji8tJB.js";import"./collapseMotion-ByInPrfq.js";import"./slide-BR5NTmcW.js";import"./Dropdown-lzT8P96r.js";import"./useRefs-CH9tJ50T.js";import"./pick-DFWac7Lu.js";import"./CheckOutlined-B_iCQ6FL.js";import"./index-DzhuYAPB.js";import"./Checkbox-BSqox9oh.js";import"./index-C0X3d23U.js";import"./move-cWZng2f8.js";import"./responsiveObserve-Bs6--9PQ.js";const zt={class:"edit-box-header"},Bt={class:"left-box"},Pt={class:"edit-box-title"},Tt={key:0},Qt={key:0,class:"title-tip"},Ft={class:"right-box"},Jt={class:"extra-box"},Kt={class:"actions-box"},Gt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(_,{emit:l}){const k=l,v=_,c=s=>{k("edit"),k("update:isEdit",s)},a=()=>{k("save")};return(s,w)=>{const t=ce,g=oe,r=Se;return n(),h("div",{class:we(["edit-box",{"is-edit":_.isEdit}])},[e("div",zt,[e("div",Bt,[o(t,{class:"edit-box-icon",name:v.iconName},null,8,["name"]),e("span",Pt,[I(q(v.title)+" ",1),s.$slots.icon?(n(),h("span",Tt,[de(s.$slots,"icon",{},void 0,!0)])):V("",!0)]),s.$slots.tip?(n(),h("span",Qt,[de(s.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Ft,[e("div",Jt,[de(s.$slots,"extra",{},()=>[e("div",Kt,[v.isEdit?(n(),N(r,{key:0,gap:8},{default:i(()=>[o(g,{onClick:a,size:"small",type:"primary"},{default:i(()=>[I("保存")]),_:1}),o(g,{onClick:w[0]||(w[0]=x=>c(!1)),size:"small"},{default:i(()=>[I("取消")]),_:1})]),_:1})):(n(),N(g,{key:1,onClick:w[1]||(w[1]=x=>c(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:et({..._.bodyStyle})},[de(s.$slots,"default",{},void 0,!0)],4)],2)}}},Z=P(Gt,[["__scopeId","data-v-dbe09743"]]),He=_=>(F("data-v-899bcb03"),_=_(),J(),_),Ht={class:"robot-form-box"},Wt={class:"form-item"},Zt=He(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Yt={class:"form-item-body robot-name-item"},Xt={class:"robot-avetar-upload"},eo=["src"],to={class:"robot-name-box"},oo={class:"form-item"},so=He(()=>e("div",{class:"form-item-label"},"简介",-1)),no={class:"form-item-body"},io={class:"robot-info-box"},ao={class:"robot-name-box"},lo=["src"],co={class:"robot-name"},ro={class:"robot-intro"},_o={__name:"basic-config",setup(_){const l=$(!1),{robotInfo:k,updateRobotInfo:v}=H("robotInfo"),c=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),a=()=>{v({...W(c)}),l.value=!1},s=t=>{let g=t[0];return c.robot_avatar=g,dt(g).then(r=>{c.robot_avatar_url=r}),!1},w=()=>{c.robot_name=k.robot_name,c.robot_intro=k.robot_intro,c.robot_avatar=k.robot_avatar,c.robot_avatar_url=k.robot_avatar_url};return(t,g)=>{const r=pe,x=qe;return n(),N(Z,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:l.value,"onUpdate:isEdit":g[2]||(g[2]=p=>l.value=p),onSave:a,onEdit:w},{default:i(()=>[ae(e("div",Ht,[e("div",Wt,[Zt,e("div",Yt,[o(ft,{accept:"image/*",onChange:s},{default:i(()=>[e("div",Xt,[c.robot_avatar_url?(n(),h("img",{key:0,class:"robot-avetar",src:c.robot_avatar_url},null,8,eo)):V("",!0)])]),_:1}),e("div",to,[o(r,{value:c.robot_name,"onUpdate:value":g[0]||(g[0]=p=>c.robot_name=p),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",oo,[so,e("div",no,[o(x,{rows:3,value:c.robot_intro,"onUpdate:value":g[1]||(g[1]=p=>c.robot_intro=p),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[le,l.value]]),ae(e("div",io,[e("div",ao,[e("img",{class:"robot-avatar",src:y(k).robot_avatar_url,alt:""},null,8,lo),e("span",co,q(y(k).robot_name),1)]),e("div",ro,q(y(k).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[le,!l.value]])]),_:1},8,["isEdit"])}}},uo=P(_o,[["__scopeId","data-v-899bcb03"]]),We=_=>(F("data-v-896a48d0"),_=_(),J(),_),po={class:"ai-create-box"},mo={class:"input-box"},vo=We(()=>e("span",null,"生成",-1)),ho={class:"quick-tags-box"},fo=We(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),bo={class:"ai-list-box"},yo={key:0,class:"loading-box"},ko={key:0,class:"prompt-list-box"},go={class:"prompt-list"},$o={class:"prompt-header"},xo={class:"prompt-title"},wo={class:"prompt-content"},So={class:"prompt-list"},qo={class:"prompt-header"},Co={class:"prompt-title"},Io={class:"prompt-content"},Lo={class:"prompt-list"},Uo={class:"prompt-header"},Eo={class:"prompt-title"},Ro={class:"prompt-content"},Oo={class:"prompt-list"},Ao={class:"prompt-header"},Mo={class:"prompt-title"},Do={class:"prompt-content"},Vo={class:"prompt-list"},jo={class:"prompt-header"},No={class:"prompt-title"},zo={class:"prompt-content"},Bo={class:"prompt-header"},Po={class:"prompt-title"},To={class:"prompt-content"},Qo={key:1,class:"empty-box"},Fo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(_,{expose:l,emit:k}){const v=Ve.PRESENTED_IMAGE_SIMPLE,c=$(!1),a=$(!1),s=tt().query,w=k,t=$(""),g=$(!1),r=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],x=$("在上方输入框输入要求，点击生成提示词"),p=()=>{d.value=!1,L.promptStruct=C,t.value="",x.value="在上方输入框输入要求，点击生成提示词",c.value=!0},d=$(!1),C={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},L=Q({promptStruct:C}),U=E=>{t.value=E},f=()=>{if(!t.value)return X.error("请输入AI 生成提示词");if(g.value)return X.error("正在生成中...");g.value=!0,yt({id:s.id,demand:t.value}).then(E=>{L.promptStruct=JSON.parse(E.data.promptStruct),d.value=!0}).finally(()=>{g.value=!1}).catch(E=>{d.value=!1,x.value=E.msg})},A=()=>{if(!d.value)return X.error("请先生成提示词");w("handleAiSave",L.promptStruct),c.value=!1};return l({show:p}),(E,u)=>{const S=oe,T=pe,M=ce,b=gt,j=Ee,D=Ve,m=Ne,K=ee;return n(),h("div",null,[o(K,{open:c.value,"onUpdate:open":u[1]||(u[1]=z=>c.value=z),title:"AI 生成提示词",width:746},{footer:i(()=>[o(S,{type:"primary",loading:a.value,onClick:A},{default:i(()=>[I("使用该提示")]),_:1},8,["loading"])]),default:i(()=>[e("div",po,[e("div",mo,[o(T,{style:{width:"100%"},value:t.value,"onUpdate:value":u[0]||(u[0]=z=>t.value=z),size:"large",onPressEnter:f,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:f},[o(M,{name:"ai-mark"}),vo])]),e("div",ho,[fo,(n(),h(B,null,G(r,z=>o(b,{key:z.title,onClick:R=>U(z.title),color:"blue"},{default:i(()=>[I(q(z.title),1)]),_:2},1032,["onClick"])),64))]),e("div",bo,[o(m,{style:{height:"100%"}},{default:i(()=>[g.value?(n(),h("div",yo,[o(j,{tip:"正在生成中..."})])):(n(),h(B,{key:1},[d.value?(n(),h("div",ko,[e("div",go,[e("div",$o,[e("div",xo,q(L.promptStruct.role.subject),1)]),e("div",wo,q(L.promptStruct.role.describe),1)]),e("div",So,[e("div",qo,[e("div",Co,q(L.promptStruct.task.subject),1)]),e("div",Io,q(L.promptStruct.task.describe),1)]),e("div",Lo,[e("div",Uo,[e("div",Eo,q(L.promptStruct.constraints.subject),1)]),e("div",Ro,q(L.promptStruct.constraints.describe),1)]),e("div",Oo,[e("div",Ao,[e("div",Mo,q(L.promptStruct.output.subject),1)]),e("div",Do,q(L.promptStruct.output.describe),1)]),e("div",Vo,[e("div",jo,[e("div",No,q(L.promptStruct.tone.subject),1)]),e("div",zo,q(L.promptStruct.tone.describe),1)]),(n(!0),h(B,null,G(L.promptStruct.custom,(z,R)=>(n(),h("div",{class:"prompt-list",key:R+z.key?z.key:""},[e("div",Bo,[e("div",Po,q(z.subject),1)]),e("div",To,q(z.describe),1)]))),128))])):(n(),h("div",Qo,[o(D,{image:y(v),description:x.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Jo=P(Fo,[["__scopeId","data-v-896a48d0"]]),Ko={class:"prompt-box"},Go={class:"tab-header"},Ho={key:0,class:"opt-block"},Wo={key:1,class:"opt-block"},Zo={class:"tip-text"},Yo={key:0,class:"prompt-list-box"},Xo={class:"prompt-list"},es={class:"prompt-header"},ts={class:"prompt-title"},os={key:0,class:"btn-wrapper-box"},ss={class:"prompt-content"},ns={class:"prompt-list"},is={class:"prompt-header"},as={class:"prompt-title"},ls={key:0,class:"btn-wrapper-box"},cs={class:"prompt-content"},rs={class:"prompt-list"},_s={class:"prompt-header"},ds={class:"prompt-title"},us={key:0,class:"btn-wrapper-box"},ps={class:"prompt-content"},ms={class:"prompt-list"},vs={class:"prompt-header"},hs={class:"prompt-title"},fs={key:0,class:"btn-wrapper-box"},bs={class:"swich-item"},ys={class:"swich-item"},ks={class:"prompt-content"},gs={class:"prompt-list"},$s={class:"prompt-header"},xs={class:"prompt-title"},ws={key:0,class:"btn-wrapper-box"},Ss={class:"prompt-content"},qs={class:"prompt-header"},Cs={class:"prompt-title",style:{flex:"1"}},Is={key:0,class:"btn-wrapper-box"},Ls=["onClick"],Us={class:"prompt-content"},Es={key:0,class:"add-theme-block"},Rs={class:"show-more-block"},Os={key:1,class:"diy-prompt-box"},As={key:0,class:"diy-switch-box"},Ms={class:"swich-item"},Ds={class:"swich-item"},ne="- 请使用markdown格式回答问题。",ie="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Vs={__name:"system-prompt-words",setup(_){const l=$(!1),{robotInfo:k,updateRobotInfo:v}=H("robotInfo");let c={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const a=$({}),s=$(!1),w=$(!1),t=$(!1),g=$(!1),r=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),x=$(localStorage.getItem("system_prompt_words_ishide")=="1"),p=()=>{x.value=!x.value,localStorage.setItem("system_prompt_words_ishide",x.value?1:0)},d=(D,m)=>D.includes(m),C=$(k.prompt_type);ue(()=>k,()=>{r.prompt=k.prompt,r.prompt_struct=k.prompt_struct,a.value=k.prompt_struct_default},{immediate:!0,deep:!0}),ue(()=>r.prompt_struct.output.describe,D=>{s.value=d(D,ne),w.value=d(D,ie)},{immediate:!0,deep:!0}),ue(()=>r.prompt,D=>{t.value=d(D,ne),g.value=d(D,ie)},{immediate:!0,deep:!0});const L=(D,m)=>{D?(m=="outSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ne:r.prompt_struct.output.describe+=ne),m=="imgSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ie:r.prompt_struct.output.describe+=ie)):(m=="outSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ne,"g"),"")),m=="imgSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),r.prompt_struct.output.describe=r.prompt_struct.output.describe.trim())},U=(D,m)=>{D?(m=="outDiySwitch"&&(r.prompt?r.prompt+=`
`+ne:r.prompt+=ne),m=="imgDiySwitch"&&(r.prompt?r.prompt+=`
`+ie:r.prompt+=ie)):(m=="outDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ne,"g"),"")),m=="imgDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ie,"g"),"")),r.prompt=r.prompt.trim())},f=D=>{r.prompt_struct[D].describe=a.value[D].describe},A=()=>{r.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),C.value=1},E=D=>{r.prompt_struct.custom.splice(D,1)},u=()=>{v({...W(r),prompt_type:C.value}),l.value=!1},S=D=>{C.value=1,v({prompt_type:C.value,prompt:r.prompt,prompt_struct:D}),l.value=!1},T=()=>{l.value=!0},M=()=>{l.value=!1},b=$(null),j=()=>{b.value.show()};return(D,m)=>{const K=ze,z=Be,R=ce,se=oe,Le=Se,_e=qe,ge=te,Xe=pe;return n(),h("div",Ko,[e("div",Go,[o(z,{activeKey:C.value,"onUpdate:activeKey":m[0]||(m[0]=O=>C.value=O)},{default:i(()=>[(n(),N(K,{key:1,tab:"结构化提示词"})),(n(),N(K,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),l.value?(n(),h("div",Ho,[e("div",{class:"ai-mark-box",onClick:j},[o(R,{name:"ai-mark"}),I(" AI自动生成 ")]),o(Le,{gap:8},{default:i(()=>[o(se,{size:"small",type:"primary",onClick:u},{default:i(()=>[I("保存")]),_:1}),o(se,{size:"small",onClick:M},{default:i(()=>[I("取消")]),_:1})]),_:1})])):(n(),h("div",Wo,[e("span",Zo,"当前类型："+q(C.value==1?"结构化提示词":"自定义提示词"),1),o(se,{size:"small",onClick:T},{default:i(()=>[I("修改")]),_:1})]))]),C.value==1?(n(),h("div",Yo,[e("div",Xo,[e("div",es,[e("div",ts,q(r.prompt_struct.role.subject),1),l.value?(n(),h("div",os,[e("a",{onClick:m[1]||(m[1]=O=>f("role"))},"恢复默认")])):V("",!0)]),e("div",ss,[o(_e,{bordered:!1,disabled:!l.value,value:r.prompt_struct.role.describe,"onUpdate:value":m[2]||(m[2]=O=>r.prompt_struct.role.describe=O),placeholder:y(c).role},null,8,["disabled","value","placeholder"])])]),e("div",ns,[e("div",is,[e("div",as,q(r.prompt_struct.task.subject),1),l.value?(n(),h("div",ls,[e("a",{onClick:m[3]||(m[3]=O=>f("task"))},"恢复默认")])):V("",!0)]),e("div",cs,[o(_e,{bordered:!1,disabled:!l.value,value:r.prompt_struct.task.describe,"onUpdate:value":m[4]||(m[4]=O=>r.prompt_struct.task.describe=O),placeholder:y(c).task},null,8,["disabled","value","placeholder"])])]),x.value?(n(),h(B,{key:0},[e("div",rs,[e("div",_s,[e("div",ds,q(r.prompt_struct.constraints.subject),1),l.value?(n(),h("div",us,[e("a",{onClick:m[5]||(m[5]=O=>f("constraints"))},"恢复默认")])):V("",!0)]),e("div",ps,[o(_e,{bordered:!1,disabled:!l.value,value:r.prompt_struct.constraints.describe,"onUpdate:value":m[6]||(m[6]=O=>r.prompt_struct.constraints.describe=O),placeholder:y(c).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",ms,[e("div",vs,[e("div",hs,q(r.prompt_struct.output.subject),1),l.value?(n(),h("div",fs,[e("div",bs,[I(" 输出markdown： "),o(ge,{onChange:m[7]||(m[7]=O=>L(O,"outSwitch")),checked:s.value,"onUpdate:checked":m[8]||(m[8]=O=>s.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ys,[I(" 回复图片： "),o(ge,{onChange:m[9]||(m[9]=O=>L(O,"imgSwitch")),checked:w.value,"onUpdate:checked":m[10]||(m[10]=O=>w.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:m[11]||(m[11]=O=>f("output"))},"恢复默认")])):V("",!0)]),e("div",ks,[o(_e,{bordered:!1,disabled:!l.value,value:r.prompt_struct.output.describe,"onUpdate:value":m[12]||(m[12]=O=>r.prompt_struct.output.describe=O),placeholder:y(c).output},null,8,["disabled","value","placeholder"])])]),e("div",gs,[e("div",$s,[e("div",xs,q(r.prompt_struct.tone.subject),1),l.value?(n(),h("div",ws,[e("a",{onClick:m[13]||(m[13]=O=>f("tone"))},"恢复默认")])):V("",!0)]),e("div",Ss,[o(_e,{bordered:!1,disabled:!l.value,value:r.prompt_struct.tone.describe,"onUpdate:value":m[14]||(m[14]=O=>r.prompt_struct.tone.describe=O),placeholder:y(c).tone},null,8,["disabled","value","placeholder"])])]),(n(!0),h(B,null,G(r.prompt_struct.custom,(O,De)=>(n(),h("div",{class:"prompt-list",key:De+O.key?O.key:""},[e("div",qs,[e("div",Cs,[o(Xe,{bordered:!1,disabled:!l.value,style:{width:"100%"},value:O.subject,"onUpdate:value":$e=>O.subject=$e,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),l.value?(n(),h("div",Is,[e("div",{class:"hover-btn-box",onClick:$e=>E(De)},[o(y(he))],8,Ls)])):V("",!0)]),e("div",Us,[o(_e,{bordered:!1,disabled:!l.value,value:O.describe,"onUpdate:value":$e=>O.describe=$e,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),l.value?(n(),h("div",Es,[o(se,{onClick:A,block:"",icon:ot(y(Re))},{default:i(()=>[I("添加主题")]),_:1},8,["icon"])])):V("",!0)],64)):V("",!0),e("div",Rs,[e("div",{class:"btn-item",onClick:p},[x.value?(n(),h(B,{key:1},[I("收起"),o(y(xt))],64)):(n(),h(B,{key:0},[I("展开"),o(y($t))],64))])])])):(n(),h("div",Os,[l.value?(n(),h("div",As,[e("div",Ms,[I(" 输出markdown： "),o(ge,{size:"small",onChange:m[15]||(m[15]=O=>U(O,"outDiySwitch")),checked:t.value,"onUpdate:checked":m[16]||(m[16]=O=>t.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ds,[I(" 回复图片： "),o(ge,{size:"small",onChange:m[17]||(m[17]=O=>U(O,"imgDiySwitch")),checked:g.value,"onUpdate:checked":m[18]||(m[18]=O=>g.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):V("",!0),o(_e,{bordered:l.value,value:r.prompt,"onUpdate:value":m[19]||(m[19]=O=>r.prompt=O),disabled:!l.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),o(Jo,{onHandleAiSave:S,ref_key:"aiCreatePromptRef",ref:b},null,512)])}}},js=P(Vs,[["__scopeId","data-v-5a6a6277"]]),fe=_=>(F("data-v-4ce3e706"),_=_(),J(),_),Ns={class:"actions-box"},zs={class:"setting-info-block"},Bs={class:"set-item w-100"},Ps={key:0,class:"set-item-content"},Ts=["src"],Qs={key:1},Fs={class:"set-item"},Js={class:"set-item"},Ks={class:"set-item"},Gs={class:"set-item"},Hs={class:"form-box"},Ws={class:"form-item"},Zs=fe(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),Ys={class:"form-item-body"},Xs={class:"form-item"},en={class:"form-item-label"},tn=fe(()=>e("span",null,"温度 ",-1)),on={class:"form-item-body"},sn={class:"number-box"},nn={class:"number-slider-box"},an={class:"number-input-box"},ln={class:"form-item"},cn={class:"form-item-label"},rn=fe(()=>e("span",null,"最大token ",-1)),_n={class:"form-item-body"},dn={class:"number-box"},un={class:"number-slider-box"},pn={class:"number-input-box"},mn={class:"form-item"},vn={class:"form-item-label"},hn=fe(()=>e("span",null,"上下文数量 ",-1)),fn={class:"form-item-body"},bn={class:"number-box"},yn={class:"number-slider-box"},kn={class:"number-input-box"},gn={class:"form-item justify-between"},$n={class:"form-item-label"},xn=fe(()=>e("span",null,"显示推理过程 ",-1)),wn=fe(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),Sn={__name:"model-settings",setup(_){const l=["azure","ollama","xinference","openaiAgent"],k=["azure"],v=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),c=$([]),a=$(!1),{robotInfo:s,updateRobotInfo:w}=H("robotInfo"),t=Q({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),g=$(""),r=$(""),x=$(""),p=ve(()=>c.value.map(u=>({groupLabel:u.name,groupIcon:u.icon,children:u.children.map(S=>({icon:S.icon,use_model_name:S.use_model_name,value:l.includes(S.model_define)&&S.deployment_name?S.deployment_name:S.name,rawData:S}))}))),d=u=>{t.use_model=l.includes(u.rawData.model_define)&&u.rawData.deployment_name?u.rawData.deployment_name:u.rawData.name,t.use_model_icon=u.icon,t.use_model_name=u.use_model_name,t.model_config_id=u.rawData.id,g.value=u.rawData.model_define},C=$(!1),L=u=>{u.target.closest(".custom-select")||(C.value=!1)};ke(()=>{l.indexOf(g.value)>-1?t.use_model=x.value:t.use_model=s.use_model,document.addEventListener("click",L)}),st(()=>{document.removeEventListener("click",L)});const U=()=>{x.value=t.use_model;let u={...W(t)};k.indexOf(g.value)>-1&&(u.use_model="默认"),w(u),a.value=!1},f=u=>{u||(g.value=r.value),l.indexOf(g.value)>-1?t.use_model=x.value:t.use_model=s.use_model,t.model_config_id=s.model_config_id,t.temperature=s.temperature,t.max_token=s.max_token,t.context_pair=s.context_pair,t.think_switch=Number(s.think_switch),a.value=u};Ue(()=>{t.model_config_id=s.model_config_id,t.temperature=s.temperature,t.max_token=s.max_token,t.context_pair=s.context_pair,t.think_switch=Number(s.think_switch)});function A(u,S,T){const M=new Set(u.map(b=>b.model_define));return S.filter(b=>{let j=b[T];M.has(j)&&u.filter(D=>{if(D.model_define==j)return D.children=pt(D.children,b.children),!1})}),u}return(()=>{Pe({model_type:"LLM"}).then(u=>{x.value=s.use_model;let S=u.data||[],T=[];c.value=S.map(M=>{T=[];for(let b=0;b<M.model_info.llm_model_list.length;b++){const j=M.model_info.llm_model_list[b];l.indexOf(M.model_info.model_define)>-1&&s.model_config_id==M.model_config.id&&(x.value=M.model_config.deployment_name,g.value=M.model_info.model_define,r.value=M.model_info.model_define),T.push({name:j,deployment_name:M.model_config.deployment_name,id:M.model_config.id,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,use_model_name:M.model_info.model_name})}return{id:M.model_config.id,name:M.model_info.model_name,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,children:T,deployment_name:M.model_config.deployment_name}}),c.value=A(ut(c.value,"model_define"),c.value,"model_define"),s.use_model&&s.model_config_id&&c.value.some(M=>M.children.some(b=>{const j=l.includes(b.model_define)&&b.deployment_name?b.deployment_name:b.name;if(l.includes(b.model_define)&&b.deployment_name&&b.id===s.model_config_id)return t.use_model_icon=b.icon,t.use_model_name=b.use_model_name,t.use_model=b.deployment_name,!0;if(j===s.use_model&&b.id===s.model_config_id)return t.use_model_icon=b.icon,t.use_model_name=b.use_model_name,!0}))})})(),(u,S)=>{const T=oe,M=St,b=re,j=Te,D=Ce,m=te,K=qt,z=ee;return n(),N(Z,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:a.value,"onUpdate:isEdit":S[10]||(S[10]=R=>a.value=R)},{extra:i(()=>[e("div",Ns,[o(T,{onClick:S[0]||(S[0]=R=>f(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",zs,[e("div",Bs,[I(" LLM模型： "),t.use_model_icon&&t.use_model_name?(n(),h("span",Ps,[e("img",{src:t.use_model_icon,class:"model-icon"},null,8,Ts),I(q(t.use_model_name)+" "+q(t.use_model),1)])):(n(),h("span",Qs,q(t.use_model),1))]),e("div",Fs,[I(" 温度： "),e("span",null,q(t.temperature),1)]),e("div",Js,[I(" 最大token： "),e("span",null,q(t.max_token),1)]),e("div",Ks,[I(" 上下文数量： "),e("span",null,q(t.context_pair),1)]),e("div",Gs,[I(" 显示推理过程： "),e("span",null,q(t.think_switch==1?"开":"关"),1)])]),o(z,{open:a.value,"onUpdate:open":S[9]||(S[9]=R=>a.value=R),width:672,title:"模型设置",onOk:U},{default:i(()=>[e("div",Hs,[o(K,{gutter:[32,24]},{default:i(()=>[o(M,be(ye(v)),{default:i(()=>[e("div",Ws,[Zs,e("div",Ys,[o(wt,{modelValue:t.use_model,"onUpdate:modelValue":S[1]||(S[1]=R=>t.use_model=R),options:p.value,placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value","model-define":l,"model-config-id":t.model_config_id,onChange:d},null,8,["modelValue","options","model-config-id"])])])]),_:1},16),o(M,be(ye(v)),{default:i(()=>[e("div",Xs,[e("div",en,[tn,o(b,null,{title:i(()=>[I("温度越低，回答越严谨。温度越高，回答越发散。")]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),e("div",on,[e("div",sn,[e("div",nn,[o(j,{class:"custom-slider",value:t.temperature,"onUpdate:value":S[2]||(S[2]=R=>t.temperature=R),min:0,max:2,step:.1},null,8,["value"])]),e("div",an,[o(D,{value:t.temperature,"onUpdate:value":S[3]||(S[3]=R=>t.temperature=R),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),o(M,be(ye(v)),{default:i(()=>[e("div",ln,[e("div",cn,[rn,o(b,null,{title:i(()=>[I("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),e("div",_n,[e("div",dn,[e("div",un,[o(j,{class:"custom-slider",value:t.max_token,"onUpdate:value":S[4]||(S[4]=R=>t.max_token=R),min:0,max:100*1024},null,8,["value"])]),e("div",pn,[o(D,{value:t.max_token,"onUpdate:value":S[5]||(S[5]=R=>t.max_token=R),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),o(M,be(ye(v)),{default:i(()=>[e("div",mn,[e("div",vn,[hn,o(b,null,{title:i(()=>[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),e("div",fn,[e("div",bn,[e("div",yn,[o(j,{class:"custom-slider",value:t.context_pair,"onUpdate:value":S[6]||(S[6]=R=>t.context_pair=R),min:0,max:10},null,8,["value"])]),e("div",kn,[o(D,{value:t.context_pair,"onUpdate:value":S[7]||(S[7]=R=>t.context_pair=R),min:0,max:10},null,8,["value"])])])])])]),_:1},16),o(M,be(ye(v)),{default:i(()=>[e("div",gn,[e("div",$n,[xn,o(b,null,{title:i(()=>[wn]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),o(m,{checked:t.think_switch,"onUpdate:checked":S[8]||(S[8]=R=>t.think_switch=R),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},qn=P(Sn,[["__scopeId","data-v-4ce3e706"]]),Cn={class:"library-checkbox-box"},In={class:"list-tools"},Ln={class:"list-box",ref:"scrollContainer"},Un={class:"library-name"},En={class:"library-desc"},Rn={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:k}){const v=k,c=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),a=$(!1),s=U=>{p(),c.checkedList=U,a.value=!0},w=()=>{a.value=!1,x()},t=$(""),g=()=>{p()},r=$([]),x=()=>{v("change",[...c.checkedList])},p=async()=>{const U=await Qe({library_name:t.value,type:""});if(U){let f=U.data||[];r.value=f}},d=$(!1),C=async()=>{d.value=!0,await p(),d.value=!1,X.success("刷新完成")},L=()=>{window.open("/#/library/list")};return l({open:s}),(U,f)=>{const A=Ke,E=pe,u=oe,S=Fe,T=Je,M=Ee,b=ee;return n(),N(b,{width:"746px",open:a.value,"onUpdate:open":f[2]||(f[2]=j=>a.value=j),title:"关联知识库",onOk:w},{default:i(()=>[e("div",Cn,[o(A,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",In,[e("div",null,[o(E,{style:{width:"282px"},value:t.value,"onUpdate:value":f[0]||(f[0]=j=>t.value=j),placeholder:"请输入知识库名称搜索",onChange:g},{suffix:i(()=>[o(y(Ct),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[o(u,{style:{"margin-right":"8px"},onClick:C},{default:i(()=>[o(y(It)),I(" 刷新 ")]),_:1}),o(u,{type:"primary",ghost:"",onClick:L},{default:i(()=>[I("新建知识库")]),_:1})])]),o(M,{spinning:d.value,delay:100},{default:i(()=>[o(T,{value:c.checkedList,"onUpdate:value":f[1]||(f[1]=j=>c.checkedList=j),style:{width:"100%"}},{default:i(()=>[e("div",Ln,[(n(!0),h(B,null,G(r.value,j=>(n(),h("div",{class:"list-item-wraapper",key:j.id},[o(S,{class:"list-item",value:j.id},{default:i(()=>[e("div",Un,q(j.library_name),1),e("div",En,q(j.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},On=P(Rn,[["__scopeId","data-v-75c5cc9c"]]),Ie=_=>(F("data-v-a2abcb20"),_=_(),J(),_),An={class:"recall-settings-box"},Mn={class:"form-box"},Dn={class:"form-item is-required"},Vn=Ie(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),jn={class:"form-item-body"},Nn={class:"retrieval-mode-items"},zn=["onClick"],Bn={class:"retrieval-mode-title"},Pn={class:"title-text"},Tn={key:0,style:{width:"32px"},src:Lt,alt:""},Qn={class:"retrieval-mode-desc"},Fn={class:"form-item"},Jn={class:"form-item-label"},Kn=Ie(()=>e("span",null,"Top K ",-1)),Gn={class:"form-item-body"},Hn={class:"number-box"},Wn={class:"number-slider-box"},Zn={class:"number-input-box"},Yn={key:0,class:"form-item"},Xn={class:"form-item-label"},ei=Ie(()=>e("span",null,"相似度阈值 ",-1)),ti={class:"form-item-body"},oi={class:"number-box"},si={class:"number-slider-box"},ni={class:"number-input-box"},ii={class:"form-item"},ai={class:"form-item-label"},li=Ie(()=>e("span",null,"Rerank模型",-1)),ci={key:0,class:"form-item-body"},ri=["src"],_i={__name:"recall-settings-alert",emits:["change"],setup(_,{expose:l,emit:k}){const v=k,c=$([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),a=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=$(!1),w=U=>{L(),a.rerank_status=U.rerank_status||0,a.rerank_use_model=U.rerank_use_model||void 0,a.rerank_model_config_id=U.rerank_model_config_id>0?U.rerank_model_config_id:"",a.top_k=U.top_k,a.similarity=U.similarity,a.search_type=U.search_type,s.value=!0},t=(U,f)=>{if(!U||!f){a.rerank_model_config_id="";return}a.rerank_model_config_id=f.rerank_model_config_id},g=U=>{U==0&&(a.rerank_model_config_id="",a.rerank_use_model="")},r=U=>{a.search_type=U},x=()=>a.rerank_status==1&&!a.rerank_model_config_id,p=()=>{if(x())return X.error("请选择Rerank模型");s.value=!1,d()},d=()=>{v("change",W(a))},C=$([]),L=()=>{Pe({model_type:"RERANK"}).then(U=>{let f=U.data||[];C.value=f.map(A=>({id:A.model_config.id,name:A.model_info.model_name,icon:A.model_info.model_icon_url,children:A.model_info.rerank_model_list}))})};return l({open:w}),(U,f)=>{const A=ce,E=re,u=Te,S=Ce,T=te,M=Ut,b=Et,j=Rt,D=ee;return n(),N(D,{width:"746px",open:s.value,"onUpdate:open":f[6]||(f[6]=m=>s.value=m),title:"召回设置",onOk:p},{default:i(()=>[e("div",An,[e("div",Mn,[e("div",Dn,[Vn,e("div",jn,[e("div",Nn,[(n(!0),h(B,null,G(c.value,m=>(n(),h("div",{class:we(["retrieval-mode-item",{active:a.search_type==m.value}]),key:m.value,onClick:K=>r(m.value)},[a.search_type==m.value?(n(),N(A,{key:0,class:"check-arrow",name:"check-arrow-filled"})):V("",!0),e("div",Bn,[o(A,{name:m.iconName,class:"title-icon"},null,8,["name"]),e("span",Pn,q(m.title),1),m.isRecommendation?(n(),h("img",Tn)):V("",!0)]),e("div",Qn,q(m.desc),1)],10,zn))),128))])])]),e("div",Fn,[e("div",Jn,[Kn,o(E,null,{title:i(()=>[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),e("div",Gn,[e("div",Hn,[e("div",Wn,[o(u,{class:"custom-slider",value:a.top_k,"onUpdate:value":f[0]||(f[0]=m=>a.top_k=m),min:1,max:10},null,8,["value"])]),e("div",Zn,[o(S,{value:a.top_k,"onUpdate:value":f[1]||(f[1]=m=>a.top_k=m),min:1,max:10},null,8,["value"])])])])]),a.search_type<=2?(n(),h("div",Yn,[e("div",Xn,[ei,o(E,null,{title:i(()=>[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:i(()=>[o(y(Y),{class:"question-icon"})]),_:1})]),e("div",ti,[e("div",oi,[e("div",si,[o(u,{class:"custom-slider",value:a.similarity,"onUpdate:value":f[2]||(f[2]=m=>a.similarity=m),min:0,max:1,step:.01},null,8,["value"])]),e("div",ni,[o(S,{value:a.similarity,"onUpdate:value":f[3]||(f[3]=m=>a.similarity=m),min:0,max:1,step:.01},null,8,["value"])])])])])):V("",!0),e("div",ii,[e("div",ai,[li,I("   "),o(T,{checkedValue:1,unCheckedValue:0,checked:a.rerank_status,"onUpdate:checked":f[4]||(f[4]=m=>a.rerank_status=m),onChange:g},null,8,["checked"])]),a.rerank_status==1?(n(),h("div",ci,[o(j,{allowClear:"",value:a.rerank_use_model,"onUpdate:value":f[5]||(f[5]=m=>a.rerank_use_model=m),placeholder:"请选择Rerank模型",onChange:t,style:{width:"60%"}},{default:i(()=>[(n(!0),h(B,null,G(C.value,m=>(n(),N(b,{key:m.id},{label:i(()=>[e("span",null,[e("img",{class:"model-icon",src:m.icon,alt:""},null,8,ri)])]),default:i(()=>[(n(!0),h(B,null,G(m.children,K=>(n(),N(M,{value:K,rerank_model_config_id:m.id,key:K},{default:i(()=>[e("span",null,q(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):V("",!0)])])])]),_:1},8,["open"])}}},di=P(_i,[["__scopeId","data-v-a2abcb20"]]),ui=_=>(F("data-v-a87bd0fa"),_=_(),J(),_),pi={class:"list-box"},mi=["onClick"],vi={class:"avater-box"},hi=["src"],fi={class:"content-box"},bi={class:"title-block"},yi=ui(()=>e("div",{class:"tag-icon"},"Graph",-1)),ki={class:"title-text"},gi={class:"desc-box"},$i={class:"right-icon"},xi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(_,{expose:l,emit:k}){const v=k,c=_,a=$(!1);ue(()=>c.list,()=>{c.list.length==0&&(a.value=!1)},{});const s=()=>{a.value=!0},w=()=>{document.visibilityState==="visible"&&v("refreshList")};ke(()=>{document.addEventListener("visibilitychange",w)}),nt(()=>{document.removeEventListener("visibilitychange",w)});const t=g=>{window.open(`/#/library/details/knowledge-config?id=${g.id}`)};return l({show:s}),(g,r)=>{const x=Ke,p=Ne,d=ee;return n(),h("div",null,[o(d,{open:a.value,"onUpdate:open":r[0]||(r[0]=C=>a.value=C),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[o(x,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),o(p,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",pi,[(n(!0),h(B,null,G(c.list,C=>(n(),h("div",{class:"list-item",onClick:L=>t(C),key:C.id},[e("div",vi,[e("img",{src:C.avatar,alt:""},null,8,hi)]),e("div",fi,[e("div",bi,[yi,e("div",ki,q(C.library_name),1)]),e("div",gi,q(C.library_intro),1)]),e("div",$i,[o(y(Ot))])],8,mi))),128))])]),_:1})]),_:1},8,["open"])])}}},wi=P(xi,[["__scopeId","data-v-a87bd0fa"]]),Si={class:"actions-box"},qi={key:0,class:"library-list"},Ci=["onClick"],Ii=["onClick"],Li={class:"library-name"},Ui={class:"library-name-text"},Ei={class:"library-intro"},Ri={class:"setting-info-block"},Oi={class:"set-item"},Ai={key:0},Mi={key:1},Di={key:2},Vi={key:3},ji={class:"set-item"},Ni={key:0,class:"set-item"},zi={class:"set-item"},Bi={key:0},Pi={key:1},Ti={__name:"index",setup(_){const{getStorage:l,removeStorage:k}=vt("localStorage"),v=mt(),c=ve(()=>{var b;return((b=v.companyInfo)==null?void 0:b.neo4j_status)=="true"}),a=$(!1),{robotInfo:s,updateRobotInfo:w}=H("robotInfo"),t=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),g=$([]),r=$(null),x=ve(()=>g.value.filter(b=>t.library_ids.includes(b.id))),p=ve(()=>x.value.filter(b=>b.graph_switch==0)),d=b=>{let j=t.library_ids.indexOf(b.id);t.library_ids.splice(j,1),u()},C=b=>{t.library_ids=[...b],u()},L=()=>{r.value.open([...t.library_ids])},U=$(null),f=()=>{U.value.open(W(t))},A=$(null),E=b=>{t.rerank_status=b.rerank_status,t.rerank_use_model=b.rerank_use_model,t.rerank_model_config_id=b.rerank_model_config_id,t.top_k=b.top_k,t.similarity=b.similarity,t.search_type=b.search_type,(b.search_type==1||b.search_type==4)&&p.value.length>0&&A.value.show(),u()},u=()=>{let b={...W(t)};b.library_ids=b.library_ids.join(","),w({...b})},S=async()=>{const b=await Qe({type:""});b&&(g.value=b.data||[])},T=()=>{ee.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){L()}})};t.rerank_use_model=s.rerank_use_model||void 0,Ue(()=>{t.library_ids=s.library_ids.split(","),t.rerank_status=s.rerank_status||0,t.rerank_use_model=s.rerank_use_model||void 0,t.rerank_model_config_id=s.rerank_model_config_id||"",t.top_k=s.top_k,t.similarity=s.similarity,t.search_type=s.search_type});const M=b=>{window.open(`#/library/details/knowledge-document?id=${b.id}`)};return ke(()=>{S(),l("showNoLibraryTip")&&(T(),k("showNoLibraryTip"))}),(b,j)=>{const D=oe,m=Se,K=re;return n(),N(Z,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:a.value,"onUpdate:isEdit":j[0]||(j[0]=z=>a.value=z),bodyStyle:{padding:0}},{extra:i(()=>[e("div",Si,[o(m,{gap:8},{default:i(()=>[o(D,{size:"small",onClick:f},{default:i(()=>[I("召回设置")]),_:1}),o(D,{size:"small",onClick:L},{default:i(()=>[I("关联知识库")]),_:1})]),_:1})])]),default:i(()=>[x.value.length>0?(n(),h("div",qi,[(n(!0),h(B,null,G(x.value,z=>(n(),h("div",{class:"library-item",key:z.id,onClick:R=>M(z)},[e("span",{class:"close-btn",onClick:it(R=>d(z),["stop"])},[o(y(he))],8,Ii),e("div",Li,[c.value?(n(),N(K,{key:0},{title:i(()=>[I(q(z.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:we(["graph-tag",{active:z.graph_switch==1}])},"Graph",2)]),_:2},1024)):V("",!0),e("div",Ui,q(z.library_name),1)]),e("div",Ei,q(z.library_intro),1)],8,Ci))),128))])):V("",!0),e("div",Ri,[e("div",Oi,[I(" 检索模式： "),t.search_type==1?(n(),h("span",Ai,"混合检索")):V("",!0),t.search_type==2?(n(),h("span",Mi,"向量检索")):V("",!0),t.search_type==3?(n(),h("span",Di,"全文检索")):V("",!0),t.search_type==4?(n(),h("span",Vi,"知识图谱检索")):V("",!0)]),e("div",ji,[I(" Top K： "),e("span",null,q(t.top_k),1)]),t.search_type<=2?(n(),h("div",Ni,[I(" 相似度阈值： "),e("span",null,q(t.similarity),1)])):V("",!0),e("div",zi,[I(" Rerank模型： "),t.rerank_status==0?(n(),h("span",Bi,"关")):(n(),h("span",Pi,q(t.rerank_use_model),1))])]),o(On,{ref_key:"librarySelectAlertRef",ref:r,onChange:C},null,512),o(di,{ref_key:"recallSettingsAlertRef",ref:U,onChange:E},null,512),o(wi,{list:p.value,onRefreshList:S,ref_key:"noOpenGraphModalRef",ref:A},null,8,["list"])]),_:1},8,["isEdit"])}}},Qi=P(Ti,[["__scopeId","data-v-984e0c25"]]),Fi=_=>(F("data-v-b559dd08"),_=_(),J(),_),Ji={class:"library-checkbox-box"},Ki={class:"list-box",ref:"scrollContainer"},Gi={class:"library-name"},Hi={class:"library-desc"},Wi={key:0,class:"empty-box"},Zi=Fi(()=>e("img",{src:At,alt:""},null,-1)),Yi={__name:"library-select-alert",emits:["change"],setup(_,{expose:l,emit:k}){const v=k,c=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),a=$(!1),s=d=>{r(),c.checkedList=d,a.value=!0},w=()=>{a.value=!1,g()};$("");const t=$([]),g=()=>{v("change",[...c.checkedList])},r=async()=>{const d=await Ge();if(d){let C=d.data||[];t.value=C}},x=$(!1),p=()=>{window.open("/#/database/list")};return l({open:s}),(d,C)=>{const L=Fe,U=Je,f=Ee,A=ee;return n(),N(A,{width:"746px",open:a.value,"onUpdate:open":C[1]||(C[1]=E=>a.value=E),title:"关联数据表",onOk:w},{default:i(()=>[e("div",Ji,[o(f,{spinning:x.value,delay:100},{default:i(()=>[o(U,{value:c.checkedList,"onUpdate:value":C[0]||(C[0]=E=>c.checkedList=E),style:{width:"100%"}},{default:i(()=>[e("div",Ki,[(n(!0),h(B,null,G(t.value,E=>(n(),h("div",{class:"list-item-wraapper",key:E.id},[o(L,{class:"list-item",value:E.id},{default:i(()=>[e("div",Gi,q(E.name),1),e("div",Hi,q(E.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!x.value&&!t.value.length?(n(),h("div",Wi,[Zi,e("div",null,[I(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:p}," 去添加")])])):V("",!0)])]),_:1},8,["open"])}}},Xi=P(Yi,[["__scopeId","data-v-b559dd08"]]),ea=_=>(F("data-v-c40914ca"),_=_(),J(),_),ta=ea(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),oa={class:"actions-box"},sa={key:0,class:"library-list"},na=["onClick"],ia={class:"library-name"},aa={class:"library-intro"},la={__name:"index",setup(_){const l=$(!1),{robotInfo:k,updateRobotInfo:v}=H("robotInfo"),c=Q({form_ids:[]}),a=$([]),s=$(null),w=ve(()=>a.value.filter(d=>c.form_ids.includes(d.id))),t=d=>{let C=c.form_ids.indexOf(d.id);c.form_ids.splice(C,1),x()},g=d=>{c.form_ids=[...d],x()},r=()=>{s.value.open([...c.form_ids])},x=()=>{let d={...W(c)};d.form_ids=d.form_ids.join(","),v({...d})};return(async()=>{const d=await Ge();d&&(a.value=d.data||[])})(),Ue(()=>{c.form_ids=k.form_ids.split(",")}),(d,C)=>{const L=re,U=oe,f=Se;return n(),N(Z,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":C[0]||(C[0]=A=>l.value=A),bodyStyle:{padding:0}},{tip:i(()=>[o(L,{placement:"top"},{title:i(()=>[ta]),default:i(()=>[o(y(Y))]),_:1})]),extra:i(()=>[e("div",oa,[o(f,{gap:8},{default:i(()=>[o(U,{size:"small",onClick:r},{default:i(()=>[I("关联数据表")]),_:1})]),_:1})])]),default:i(()=>[w.value.length>0?(n(),h("div",sa,[(n(!0),h(B,null,G(w.value,A=>(n(),h("div",{class:"library-item",key:A.id},[e("span",{class:"close-btn",onClick:E=>t(A)},[o(y(he))],8,na),e("div",ia,q(A.name),1),e("div",aa,q(A.description),1)]))),128))])):V("",!0),o(Xi,{ref_key:"librarySelectAlertRef",ref:s,onChange:g},null,512)]),_:1},8,["isEdit"])}}},ca=P(la,[["__scopeId","data-v-c40914ca"]]),ra={class:"form-box"},_a={class:"question-title"},da={class:"question-options"},ua={class:"question-option"},pa={class:"drag-btn"},ma={class:"action-box"},va={class:"robot-info-box"},ha={class:"robot-welcome-content"},fa={class:"robot-welcome-question"},ba={__name:"welcome-words",setup(_){const l=$(!1),k=$(!1),{robotInfo:v,updateRobotInfo:c,scrollBoxToBottom:a}=H("robotInfo"),s=Q({welcomes:{content:"",question:[]}}),w=()=>{let p=!1;if(s.welcomes.question.length>0){for(let d=0;d<s.welcomes.question.length;d++)if(!s.welcomes.question[d].content){p=d+1;break}}return p},t=()=>{s.welcomes.question.push({content:"",id:xe(8)})},g=p=>{s.welcomes.question.splice(p,1)},r=()=>{if(!s.welcomes.content)return X.error("请输入欢迎语");if(w())return X.error("引导问题内容不能为空");c({...W(s)}),l.value=!1},x=()=>{let p={...v.welcomes},d=[];p.question.forEach(({content:C,id:L})=>{let U={id:L,content:C};U.id||(U.id=xe(6)),d.push(U)}),s.welcomes.content=p.content,s.welcomes.question=d};return(p,d)=>{const C=qe,L=ce,U=pe;return n(),N(Z,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:l.value,"onUpdate:isEdit":d[4]||(d[4]=f=>l.value=f),onSave:r,onEdit:x},{default:i(()=>[ae(e("div",ra,[e("div",_a,[o(C,{value:s.welcomes.content,"onUpdate:value":d[0]||(d[0]=f=>s.welcomes.content=f),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",da,[o(y(Oe),{modelValue:s.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=f=>s.welcomes.question=f),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=f=>k.value=!0),onEnd:d[3]||(d[3]=f=>k.value=!1)},{item:i(({element:f,index:A})=>[e("div",ua,[e("span",pa,[o(L,{name:"drag"})]),o(U,{class:"question-option-content",value:f.content,"onUpdate:value":E=>f.content=E,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ma,[o(y(he),{class:"del-btn",onClick:E=>g(A)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:t},[o(y(Re),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[le,l.value]]),ae(e("div",va,[e("div",ha,q(y(v).welcomes.content),1),e("div",fa,[(n(!0),h(B,null,G(y(v).welcomes.question,(f,A)=>(n(),h("div",{class:"question-item",key:A},q(f.content),1))),128))])],512),[[le,!l.value]])]),_:1},8,["isEdit"])}}},ya=P(ba,[["__scopeId","data-v-ea227a87"]]),ka=_=>(F("data-v-bc797bf6"),_=_(),J(),_),ga=ka(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),$a={class:"form-box"},xa={class:"question-title"},wa={class:"question-options"},Sa={class:"question-option"},qa={class:"drag-btn"},Ca={class:"action-box"},Ia={class:"robot-info-box"},La={class:"robot-unknown-content"},Ua={class:"robot-unknown-question"},Ea={__name:"unknown-problem-prompt",setup(_){const l=$(!1),k=$(!1),{robotInfo:v,updateRobotInfo:c,scrollBoxToBottom:a}=H("robotInfo"),s=Q({unknown_question_prompt:{content:"",question:[]}}),w=()=>{s.unknown_question_prompt.question.push({content:"",id:xe(8)}),at(()=>{a()})},t=x=>{s.unknown_question_prompt.question.splice(x,1)},g=()=>{c({...W(s)}),l.value=!1},r=()=>{let x={...v.unknown_question_prompt},p=[];x.question&&x.question.forEach(({content:d,id:C})=>{let L={id:C,content:d};L.id||(L.id=xe(6)),p.push(L)}),x.content&&(s.unknown_question_prompt.content=x.content),p&&(s.unknown_question_prompt.question=p)};return ke(()=>{}),(x,p)=>{const d=re,C=qe,L=ce,U=pe;return n(),N(Z,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:l.value,"onUpdate:isEdit":p[4]||(p[4]=f=>l.value=f),onSave:g,onEdit:r},{tip:i(()=>[o(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[ga]),default:i(()=>[o(y(Y))]),_:1})]),default:i(()=>[ae(e("div",$a,[e("div",xa,[o(C,{value:s.unknown_question_prompt.content,"onUpdate:value":p[0]||(p[0]=f=>s.unknown_question_prompt.content=f),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",wa,[o(y(Oe),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":p[1]||(p[1]=f=>s.unknown_question_prompt.question=f),"item-key":"id",handle:".drag-btn",onStart:p[2]||(p[2]=f=>k.value=!0),onEnd:p[3]||(p[3]=f=>k.value=!1)},{item:i(({element:f,index:A})=>[e("div",Sa,[e("span",qa,[o(L,{name:"drag"})]),o(U,{class:"question-option-content",value:f.content,"onUpdate:value":E=>f.content=E,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ca,[o(y(he),{class:"del-btn",onClick:E=>t(A)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:w},[o(y(Re),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[le,l.value]]),ae(e("div",Ia,[e("div",La,q(y(v).unknown_question_prompt.content),1),e("div",Ua,[(n(!0),h(B,null,G(y(v).unknown_question_prompt.question,(f,A)=>(n(),h("div",{class:"question-item",key:A},q(f.content),1))),128))])],512),[[le,!l.value]])]),_:1},8,["isEdit"])}}},Ra=P(Ea,[["__scopeId","data-v-bc797bf6"]]),Ze=_=>(F("data-v-c60b8d8e"),_=_(),J(),_),Oa=Ze(()=>e("span",null,null,-1)),Aa=Ze(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Ma={__name:"problem-optimization",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:k}=H("robotInfo");Q({prompt:""});const v=c=>{k({})};return(c,a)=>{const s=te;return n(),N(Z,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>[Oa]),default:i(()=>[Aa,o(s,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(l).enable_question_optimize,"onUpdate:checked":a[0]||(a[0]=w=>y(l).enable_question_optimize=w),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Da=P(Ma,[["__scopeId","data-v-c60b8d8e"]]),Va=_=>(F("data-v-f6a291d4"),_=_(),J(),_),ja=Va(()=>e("span",null,null,-1)),Na={class:"robot-info-box"},za={class:"robot-prompt"},Ba={__name:"suggested-issues",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:k}=H("robotInfo"),v=c=>{k({})};return(c,a)=>{const s=Ce,w=te;return n(),N(Z,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>[ja]),default:i(()=>[e("div",Na,[e("div",za,[I(" 开启后，机器人回答问题后，自动根据对话内容提供 "),o(s,{value:y(l).question_guide_num,"onUpdate:value":a[0]||(a[0]=t=>y(l).question_guide_num=t),style:{width:"80px"},precision:0,min:1,max:10,onBlur:v},null,8,["value"]),I(" 条用户提问建议，最大不超过10条。 ")])]),o(w,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(l).enable_question_guide,"onUpdate:checked":a[1]||(a[1]=t=>y(l).enable_question_guide=t),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Pa=P(Ba,[["__scopeId","data-v-f6a291d4"]]),Ta=_=>(F("data-v-56c388e6"),_=_(),J(),_),Qa=Ta(()=>e("span",null,null,-1)),Fa={__name:"sensitive-words",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:k}=H("robotInfo");Q({prompt:""});const v=()=>{window.open("/#/user/sensitive-words")},c=a=>{k({})};return(a,s)=>{const w=te;return n(),N(Z,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>[Qa]),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:v,style:{cursor:"pointer"}},"设置敏词 >")])]),o(w,{onChange:c,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:y(l).sensitive_words_switch,"onUpdate:checked":s[0]||(s[0]=t=>y(l).sensitive_words_switch=t),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ja=P(Fa,[["__scopeId","data-v-56c388e6"]]),Ae=_=>(F("data-v-a0ec9e93"),_=_(),J(),_),Ka={class:"direct-title"},Ga={class:"direct-desc"},Ha={class:"qa"},Wa={class:"prompt-form-item-label"},Za=Ae(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Ya={class:"direct-switch"},Xa={class:"similarity"},el=Ae(()=>e("span",null,"相似度超过",-1)),tl={class:"number-input-box"},ol=Ae(()=>e("span",null,"时直接回复答案",-1)),sl={__name:"chat-edit-alert",emits:["save"],setup(_,{expose:l,emit:k}){const v=k,c=$(1),a=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],s=Q(a()),w=$(!1),t=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),g=()=>{t.chat_type=c.value.toString(),s.forEach(p=>{p.chat_type==c.value&&(t.chat_type=="3"?(t.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch==1?"true":"false",t.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score.toString()):t.chat_type=="1"&&(t.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch==1?"true":"false",t.library_qa_direct_reply_score=p.library_qa_direct_reply_score.toString()))}),r(),Object.assign(s,a()),w.value=!1},r=()=>{v("save",W(t))};ke(()=>{});const x=p=>{c.value=parseInt(p.chat_type),t.chat_type=p.chat_type,t.library_qa_direct_reply_score=p.library_qa_direct_reply_score,t.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch,t.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,t.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch,s.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=p.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch=="true"?1:0)}),w.value=!0};return ue(()=>w.value,p=>{p===!1&&Object.assign(s,a())},{immediate:!0}),l({open:x}),(p,d)=>{const C=re,L=te,U=Ce,f=Mt,A=Dt,E=ee;return n(),N(E,{width:"746px",open:w.value,"onUpdate:open":d[1]||(d[1]=u=>w.value=u),title:"聊天模式设置",onOk:g},{default:i(()=>[o(A,{class:"direct-box",value:c.value,"onUpdate:value":d[0]||(d[0]=u=>c.value=u)},{default:i(()=>[(n(!0),h(B,null,G(s,u=>(n(),N(f,{class:we(["direct-item",{active:c.value==u.direct_id}]),value:u.direct_id,key:u.direct_id},{default:i(()=>[e("div",Ka,q(u.direct_title),1),e("div",Ga,q(u.direct_desc),1),ae(e("div",Ha,[e("div",Wa,[Za,o(C,null,lt({default:i(()=>[o(y(Y),{class:"question-icon"})]),_:2},[u.chat_type=="1"?{name:"title",fn:i(()=>[I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:u.chat_type=="3"?{name:"title",fn:i(()=>[I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Ya,[u.chat_type=="1"?(n(),N(L,{key:0,checkedValue:1,unCheckedValue:0,checked:u.library_qa_direct_reply_switch,"onUpdate:checked":S=>u.library_qa_direct_reply_switch=S},null,8,["checked","onUpdate:checked"])):u.chat_type=="3"?(n(),N(L,{key:1,checkedValue:1,unCheckedValue:0,checked:u.mixture_qa_direct_reply_switch,"onUpdate:checked":S=>u.mixture_qa_direct_reply_switch=S},null,8,["checked","onUpdate:checked"])):V("",!0)])])],512),[[le,u.isQaDirectReply&&c.value==u.direct_id]]),ae(e("div",Xa,[el,e("div",tl,[u.chat_type=="1"?(n(),N(U,{key:0,value:u.library_qa_direct_reply_score,"onUpdate:value":S=>u.library_qa_direct_reply_score=S,disabled:!u.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):u.chat_type=="3"?(n(),N(U,{key:1,value:u.mixture_qa_direct_reply_score,"onUpdate:value":S=>u.mixture_qa_direct_reply_score=S,disabled:!u.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):V("",!0)]),ol],512),[[le,u.isQaDirectReply&&c.value==u.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},nl=P(sl,[["__scopeId","data-v-a0ec9e93"]]),Me=_=>(F("data-v-5b59ec9b"),_=_(),J(),_),il=Me(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),al=Me(()=>e("br",null,null,-1)),ll=Me(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),cl={class:"actions-box"},rl={class:"setting-info-block"},_l={class:"set-item"},dl={key:0},ul={key:1},pl={key:2},ml={class:"set-item"},vl={key:0,class:"set-item"},hl={class:"set-item"},fl={key:0,class:"set-item"},bl={class:"form-box"},yl={__name:"index",setup(_){const l=$(!1),k=$(null),{robotInfo:v,updateRobotInfo:c}=H("robotInfo"),a=Q({chat_type:v.chat_type,library_qa_direct_reply_score:v.library_qa_direct_reply_score,library_qa_direct_reply_switch:v.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:v.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:v.mixture_qa_direct_reply_switch}),s=g=>{a.chat_type=g.chat_type,a.library_qa_direct_reply_score=g.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch,w()},w=()=>{c({...W(a)}),l.value=!1},t=()=>{k.value.open(W(a)),l.value=!0};return(g,r)=>{const x=re,p=oe;return n(),N(Z,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:l.value,"onUpdate:isEdit":r[1]||(r[1]=d=>l.value=d),bodyStyle:{padding:0}},{tip:i(()=>[o(x,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[il,al,ll]),default:i(()=>[o(y(Y))]),_:1})]),extra:i(()=>[e("div",cl,[o(p,{size:"small",onClick:r[0]||(r[0]=d=>t(!0))},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",rl,[e("div",_l,[I(" 聊天模式： "),y(v).chat_type=="1"?(n(),h("span",dl,"仅知识库")):V("",!0),y(v).chat_type=="2"?(n(),h("span",ul,"直连模式")):V("",!0),y(v).chat_type=="3"?(n(),h("span",pl,"混合模式")):V("",!0)]),y(v).chat_type=="1"?(n(),h(B,{key:0},[e("div",ml,[I(" QA文档直接回复答案： "),e("span",null,q(y(v).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),y(v).library_qa_direct_reply_switch=="true"?(n(),h("div",vl,[I(" 相似度值： "),e("span",null,q(y(v).library_qa_direct_reply_score),1)])):V("",!0)],64)):V("",!0),y(v).chat_type=="3"?(n(),h(B,{key:1},[e("div",hl,[I(" QA文档直接回复答案： "),e("span",null,q(y(v).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),y(v).mixture_qa_direct_reply_switch=="true"?(n(),h("div",fl,[I(" 相似度值： "),e("span",null,q(y(v).mixture_qa_direct_reply_score),1)])):V("",!0)],64)):V("",!0)]),e("div",bl,[o(nl,{ref_key:"ChatEditAlertRef",ref:k,onSave:s},null,512)])]),_:1},8,["isEdit"])}}},kl=P(yl,[["__scopeId","data-v-5b59ec9b"]]),gl=_=>(F("data-v-8d185d5f"),_=_(),J(),_),$l={class:"switch-box"},xl={class:"switch-box-body"},wl={class:"switch-box-header"},Sl={class:"left-box"},ql={class:"switch-box-title"},Cl={key:0,class:"title-tip"},Il={class:"right-box"},Ll={class:"extra-box"},Ul=gl(()=>e("div",{class:"extra-box"},null,-1)),El={class:"switch-desc"},Rl={class:"switch-box-right"},Ol={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(_,{emit:l}){const k=l,v=_,c=$(v.value),a=s=>{k("update:value",s),k("change",s)};return(s,w)=>{const t=ce,g=te;return n(),h("div",$l,[e("div",xl,[e("div",wl,[e("div",Sl,[o(t,{class:"switch-box-icon",name:v.iconName},null,8,["name"]),e("span",ql,q(v.title),1),s.$slots.tip?(n(),h("span",Cl,[de(s.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Il,[e("div",Ll,[de(s.$slots,"extra",{},()=>[Ul],!0)])])]),e("div",El,[de(s.$slots,"default",{},void 0,!0)])]),e("div",Rl,[o(g,{checked:c.value,"onUpdate:checked":w[0]||(w[0]=r=>c.value=r),onChange:a,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Al=P(Ol,[["__scopeId","data-v-8d185d5f"]]),Ml="/assets/img/empty-Bx9z1cwf.png",Dl="/assets/img/phone-head-CDwwPhYa.png",Vl="/assets/img/phone-body-CbEf8GZP.png",jl="/assets/img/phone-footer-ClQtNpln.png",me=_=>(F("data-v-5125783f"),_=_(),J(),_),Nl={class:"common-problem-box"},zl={class:"left-content-box"},Bl={key:0,class:"empty-box"},Pl=me(()=>e("img",{src:Ml,alt:""},null,-1)),Tl=me(()=>e("div",{class:"title"},"暂无数据",-1)),Ql=me(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Fl={key:1,class:"lists-box"},Jl={class:"drag-btn"},Kl={class:"title"},Gl={class:"opration-box"},Hl={class:"preview-box"},Wl=me(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Dl,alt:""})],-1)),Zl={class:"phone-body"},Yl=me(()=>e("div",null,[e("img",{class:"body-img",src:Vl,alt:""})],-1)),Xl={key:0,class:"question-box"},ec=me(()=>e("div",{class:"name"},"常见问题",-1)),tc=me(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:jl,alt:""})],-1)),oc={__name:"common-problem",setup(_){$(!1);const{robotInfo:l,updateRobotInfo:k}=H("robotInfo"),v=ve(()=>l.common_question_list?JSON.parse(l.common_question_list):[]),c=$([]);c.value=v.value,ue(v,()=>{c.value=v.value});const a=je.useForm,s=$(!1),w=$("添加问题"),t=Q({question:"",index:-1}),g=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:r,validate:x,validateInfos:p}=a(t,g),d=()=>{if(v.value.length>=10)return X.error("最多设置10条常用问题");s.value=!0,r(),t.question="",t.index=-1},C=(E,u)=>{s.value=!0,r(),t.question=E,t.index=u},L=E=>{let u=[];u=v.value.filter((S,T)=>E!=T),ee.confirm({title:"提醒",icon:o(ht),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){k({common_question_list:JSON.stringify(u)})},onCancel(){}})},U=()=>{x().then(()=>{let E=[];t.index>=0?E=v.value.map((u,S)=>S===t.index?t.question:u):E=[t.question,...v.value],k({common_question_list:JSON.stringify(E)}),s.value=!1})},f=E=>{k({})},A=E=>{k({common_question_list:JSON.stringify(c.value)})};return(E,u)=>{const S=re,T=te,M=jt,b=oe,j=ce,D=pe,m=Vt,K=je,z=ee;return n(),h("div",Nl,[e("div",zl,[o(Z,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[o(S,null,{title:i(()=>[I("最多10条。开启后，常见问题会显示在每条问答后面")]),default:i(()=>[o(y(Y),{class:"quess-icon"})]),_:1})]),extra:i(()=>[o(T,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:y(l).enable_common_question,"onUpdate:checked":u[0]||(u[0]=R=>y(l).enable_common_question=R),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),o(M,{type:"vertical"}),o(b,{type:"primary",size:"small",onClick:d},{default:i(()=>[I("添加")]),_:1})]),default:i(()=>[v.value.length==0?(n(),h("div",Bl,[Pl,Tl,Ql,o(b,{onClick:d,type:"primary"},{default:i(()=>[I("立即添加")]),_:1})])):(n(),h("div",Fl,[o(y(Oe),{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=R=>c.value=R),handle:".drag-btn","item-key":"index",onEnd:A},{item:i(({element:R,index:se})=>[(n(),h("div",{class:"list-item",key:se},[e("span",Jl,[o(j,{name:"drag"})]),e("div",Kl,q(R),1),e("div",Gl,[o(y(bt),{onClick:Le=>C(R,se)},null,8,["onClick"]),o(y(he),{onClick:Le=>L(se)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Hl,[Wl,e("div",Zl,[Yl,v.value.length&&y(l).enable_common_question=="true"?(n(),h("div",Xl,[ec,(n(!0),h(B,null,G(v.value,R=>(n(),h("div",{class:"list-item",key:R},q(R),1))),128))])):V("",!0)]),tc]),o(z,{open:s.value,"onUpdate:open":u[3]||(u[3]=R=>s.value=R),title:w.value,onOk:U,width:"476px"},{default:i(()=>[o(K,{class:"form-box",layout:"vertical"},{default:i(()=>[o(m,ct({label:"问题名称"},y(p).question),{default:i(()=>[o(D,{maxLength:100,value:t.question,"onUpdate:value":u[2]||(u[2]=R=>t.question=R),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},sc=P(oc,[["__scopeId","data-v-5125783f"]]),nc=e("span",null,null,-1),ic=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),ac={__name:"display-aitations",setup(_){const{robotInfo:l,updateRobotInfo:k}=H("robotInfo"),v=$(!1);ue(()=>l.answer_source_switch,a=>{v.value=a=="true"},{immediate:!0});const c=()=>{k({answer_source_switch:v.value?"true":"false"})};return(a,s)=>(n(),N(Al,{title:"显示引文","icon-name":"jibenpeizhi",value:v.value,"onUpdate:value":s[0]||(s[0]=w=>v.value=w),onChange:c},{extra:i(()=>[nc]),default:i(()=>[ic]),_:1},8,["value"]))}},Ye=_=>(F("data-v-4948feb9"),_=_(),J(),_),lc=Ye(()=>e("span",null,null,-1)),cc=Ye(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),rc={__name:"show-like",setup(_){const{robotInfo:l,updateRobotInfo:k}=H("robotInfo"),v=c=>{k({})};return(c,a)=>{const s=te;return n(),N(Z,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>[lc]),default:i(()=>[cc,o(s,{onChange:v,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:y(l).feedback_switch,"onUpdate:checked":a[0]||(a[0]=w=>y(l).feedback_switch=w),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},_c=P(rc,[["__scopeId","data-v-4948feb9"]]),dc={key:0,class:"robot-config-page"},uc={class:"setting-box"},pc={class:"setting-box"},mc={class:"setting-box"},vc={class:"setting-box"},hc={class:"setting-box"},fc={class:"setting-box"},bc={class:"setting-box"},yc={class:"setting-box"},kc={class:"setting-box"},gc={class:"setting-box"},$c={class:"setting-box"},xc={class:"setting-box"},wc={class:"setting-box"},Sc={key:1,class:"robot-config-page"},qc={__name:"index",setup(_){const l=Nt(),k=$(null),{robotInfo:v}=rt(l),{getRobot:c}=l,a=()=>{k.value.scrollTop=k.value.scrollHeight},s=$(1),w=$(!1),t=Q(v.value);_t("robotInfo",{robotInfo:t,updateRobotInfo:x=>{let p=JSON.parse(JSON.stringify(x));x.robot_avatar&&(p.robot_avatar=new File([x.robot_avatar],x.robot_avatar.name)),Object.assign(t,p),r()},scrollBoxToBottom:a});const r=()=>{let x;t.robot_avatar&&(x=new File([t.robot_avatar],t.robot_avatar.name));let p=JSON.parse(JSON.stringify(W(t)));x&&(p.robot_avatar=x);let d=p.welcomes;d.question=d.question.map(L=>L.content),p.welcomes=JSON.stringify(d),p.prompt_struct=JSON.stringify(p.prompt_struct);let C=p.unknown_question_prompt;C.question=C.question.map(L=>L.content),p.unknown_question_prompt=JSON.stringify(C),delete p.robot_avatar_url,w.value=!0,kt(p).then(L=>{if(L.res!=0)return X.error(L.msg);w.value=!1,X.success("保存成功"),c(t.id)}).catch(()=>{w.value=!1})};return(x,p)=>{const d=ze,C=Be;return n(),h(B,null,[o(C,{class:"tab-wrapper",activeKey:s.value,"onUpdate:activeKey":p[0]||(p[0]=L=>s.value=L)},{default:i(()=>[(n(),N(d,{key:1,tab:"基础配置"})),(n(),N(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),s.value==1?(n(),h("div",dc,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:k},[e("div",uc,[o(uo)]),e("div",pc,[o(Qi)]),e("div",mc,[o(qn)]),e("div",vc,[o(kl)]),e("div",hc,[o(js)]),e("div",fc,[o(ca)]),e("div",bc,[o(ya)]),e("div",yc,[o(Ra)]),e("div",kc,[o(Ja)]),e("div",gc,[o(Da)]),e("div",$c,[o(Pa)]),e("div",xc,[o(ac)]),e("div",wc,[o(_c)])],512)])):(n(),h("div",Sc,[o(sc)]))],64)}}},Br=P(qc,[["__scopeId","data-v-387189e7"]]);export{Br as default};
