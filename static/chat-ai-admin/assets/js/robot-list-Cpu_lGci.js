import{b as q,L as H,k as U,M as B,S as X,T as z,U as Q,V as tt,l as ot,E as et,B as at,d as nt}from"../../index-DJqZYlN8.js";import{e as p,w as st,M as v,N as T,k as a,S as i,Q as N,u as w,W as e,a1 as G,a2 as J,a4 as Y,B as K,b as E,V as D,l as rt,x as lt,a7 as it,F as ct,$ as _t,a0 as y,Y as ut,Z as j}from"./vue-chunks-Dpmhapcm.js";import{c as dt,g as pt,e as mt}from"./index-DGEkiu9S.js";import{c as vt}from"./index-Cd8_BaNA.js";import{F as W,_ as bt}from"./index-BearFCS_.js";import{P as Z}from"./PlusOutlined-CTNlEK-E.js";import{_ as ft}from"./index-O15OSOpm.js";import"./index-9XFVXge0.js";import{I as gt}from"./Input-k3gxptQd.js";import{_ as ht}from"./TextArea-DEZsPG5C.js";import{_ as kt}from"./page-alert-BP8Eti7Y.js";import{L as yt}from"./list-tabs-CmJDuyIU.js";import"./index-CUiqpg-W.js";import{D as wt}from"./dropdown-CmzzPYoT.js";import{_ as Ct,M as Lt}from"./index-BW4jDb4d.js";import{_ as $t}from"./index-BY-bgrX3.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./dayjs-BAOQ3IvD.js";import"./Trigger-DcF6kXOl.js";import"./isPlainObject--mHlhHEN.js";import"./responsiveObserve-D_TTA_LO.js";import"./collapseMotion-DmHD1G9F.js";import"./QuestionCircleOutlined-D2lOE5qu.js";import"./FormItemContext-DcHP2mNJ.js";import"./partition-DekNjavo.js";import"./Password-DASsPHld.js";import"./inputProps-B4Qz7YgH.js";import"./CheckOutlined-D8sWUycq.js";import"./useRefs-CxyIWkWE.js";import"./index-DGofXs4a.js";import"./Search-CxIvru6q.js";import"./SearchOutlined-C4P1S4P5.js";import"./statusUtils-Bnl8Rf7N.js";import"./index-Bn-6W96d.js";import"./Dropdown-DicWDWIK.js";import"./RightOutlined-CJJrtf85.js";import"./move-B1-eDBNJ.js";import"./slide-B4S8cqER.js";import"./colors-CZV0Zir8.js";import"./shallowequal-KOHJRfiy.js";const xt=c=>(G("data-v-60ead55d"),c=c(),J(),c),Rt={class:"avatar-uploader"},It=["src"],At={key:1},Pt=xt(()=>e("div",{class:"ant-upload-text"},"上传照片",-1)),St=["src"],Tt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(c,{emit:$}){function x(n){return new Promise((g,o)=>{const t=new FileReader;t.readAsDataURL(n),t.onload=()=>g(t.result),t.onerror=s=>o(s)})}const b=$,C=c,f=p([]),m=p(!1),u=p("");st(()=>C.value,n=>{u.value=n},{immediate:!0});const l=W.useInjectFormItemContext(),R=()=>{let n={imageUrl:u.value,file:f.value[0].originFileObj};b("change",n),b("update:value",n.imageUrl),l.onFieldChange()},I=n=>n.type==="image/jpeg"||n.type==="image/png"?n.size/1024<100?(f.value=[n],x(n).then(t=>{u.value=t,m.value=!1,R()}),!1):(U.error("机器人头像图片大小不能超过100kb"),!1):(U.error("机器人头像只支持JPG、PNG格式的图片"),!1),h=p(!1),k=p(""),L=p(""),F=()=>{h.value=!1,L.value=""},O=async n=>{!n.url&&!n.preview&&(n.preview=await x(n.originFileObj)),k.value=n.url||n.preview,h.value=!0,L.value=n.name||n.url.substring(n.url.lastIndexOf("/")+1)};return(n,g)=>{const o=ft,t=B;return v(),T("div",Rt,[a(o,{"file-list":f.value,"onUpdate:fileList":g[0]||(g[0]=s=>f.value=s),"list-type":"picture-card","show-upload-list":!1,"before-upload":I,accept:".jpg,.png,.jpeg",onPreview:O},{default:i(()=>[c.value?(v(),T("img",{key:0,class:"avatar",src:c.value,alt:"avatar"},null,8,It)):(v(),T("div",At,[m.value?(v(),N(w(H),{key:0})):(v(),N(w(Z),{key:1})),Pt]))]),_:1},8,["file-list"]),a(t,{open:h.value,title:L.value,footer:null,onCancel:F},{default:i(()=>[e("img",{alt:"example",style:{width:"100%"},src:k.value},null,8,St)]),_:1},8,["open","title"])])}}},Ft=q(Tt,[["__scopeId","data-v-60ead55d"]]),Ot=c=>(G("data-v-91fd8a52"),c=c(),J(),c),Mt={class:"form-box"},Ut=Ot(()=>e("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Bt={__name:"add-robot-alert",setup(c,{expose:$}){const{setStorage:x}=tt("localStorage");let b="";const C=Y(),f=W.useForm,m=p(!1),u=p(!1),l=K({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),R=E(()=>l.application_type==0?"新建聊天机器人":"新建工作流"),I=K({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:h,validateInfos:k,clearValidate:L}=f(l,I),F=s=>{l.robot_avatar=s.file},O=()=>{let s={robot_name:l.robot_name,robot_intro:l.robot_intro,robot_avatar:l.robot_avatar||b};u.value=!0,dt(s,l.application_type).then(r=>{if(u.value=!1,r.res!=0)return U.error(r.msg);U.success("机器人创建成功"),l.application_type==0?(x("showNoLibraryTip",!0),C.push("/robot/config/basic-config?id="+r.data.id+"&robot_key="+r.data.robot_key)):C.push("/robot/config/workflow?id="+r.data.id+"&robot_key="+r.data.robot_key)}).catch(()=>{u.value=!1})},n=async()=>{let s=await vt({model_type:"LLM"});return!s||s.data.length==0?(B.confirm({title:"请先添加LLM模型服务商?",icon:rt(X,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){C.push("/user/model")},onCancel(){}}),!1):!0},g=async s=>{s==0?b=z:b=Q,await n()&&(l.robot_avatar="",l.robot_avatar_url=b,l.robot_name="",l.robot_intro="",l.application_type=s,m.value=!0)},o=()=>{L()},t=()=>{h().then(()=>{O()}).catch(s=>{})};return $({open:g}),(s,r)=>{const A=gt,P=bt,S=ht,M=W,_=B;return v(),N(_,{width:"746px",open:m.value,"onUpdate:open":r[3]||(r[3]=d=>m.value=d),confirmLoading:u.value,title:R.value,onOk:t,onCancel:o},{default:i(()=>[e("div",Mt,[a(M,{layout:"vertical"},{default:i(()=>[a(P,D({ref:"name",label:"应用名称"},w(k).robot_name),{default:i(()=>[a(A,{value:l.robot_name,"onUpdate:value":r[0]||(r[0]=d=>l.robot_name=d),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),a(P,D({label:"简介"},w(k).robot_intro),{default:i(()=>[a(S,{rows:3,value:l.robot_intro,"onUpdate:value":r[1]||(r[1]=d=>l.robot_intro=d),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),a(P,D({ref:"name",label:"机器人头像"},w(k).robot_avatar_url),{default:i(()=>[a(Ft,{value:l.robot_avatar_url,"onUpdate:value":r[2]||(r[2]=d=>l.robot_avatar_url=d),onChange:F},null,8,["value"]),Ut]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading","title"])}}},Nt=q(Bt,[["__scopeId","data-v-91fd8a52"]]),V=c=>(G("data-v-bc6bd6ee"),c=c(),J(),c),Vt={class:"robot-page"},Dt=V(()=>e("h3",{class:"page-title"},"应用",-1)),jt=V(()=>e("div",null,[e("p",null," 1、应用包括两种类型：聊天机器人、工作流。聊天机器人适合新手用户，关联知识库后只需简单配置，即可创建一个基于私有知识库的问答机器人。工作流适合高级用户，利用系统预制节点自定义任务流程，适合解决复杂任务。 "),e("p",null,"2、发现模块也提供了丰富模版，可以根据需要选择适合模版快速创建应用。")],-1)),Et={class:"list-toolbar"},Wt={class:"toolbar-box"},qt={class:"toolbar-box"},Gt={class:"create-action"},Jt=["src"],Kt=V(()=>e("span",null,"聊天机器人",-1)),zt={class:"create-action"},Qt=["src"],Yt=V(()=>e("span",null,"工作流",-1)),Zt={class:"list-box"},Ht=["onClick"],Xt={class:"list-item"},to={class:"robot-info"},oo=["src"],eo={class:"robot-info-content"},ao={class:"robot-name"},no={class:"robot-type-tag"},so={class:"robot-desc"},ro=["onClick"],lo=["onClick"],io=["onClick"],co=["onClick"],_o={__name:"robot-list",setup(c){const $=p([{title:"全部 (0)",value:"2"},{title:"聊天机器人 (0)",value:"0"},{title:"工作流 (0)",value:"1"}]),x=ot();let{role_permission:b}=x;const C=E(()=>b.includes("RobotCreate")),f=Y(),m=p("2"),u=p([]),l=E(()=>m.value==2?u.value:u.value.filter(o=>o.application_type==m.value)),R=()=>{pt().then(o=>{let t=0,s=0,r=0;o.data.forEach(A=>{A.application_type==0?s++:r++,t++}),$.value=[{title:"全部 ("+t+")",value:"2"},{title:"聊天机器人 ("+s+")",value:"0"},{title:"工作流 ("+r+")",value:"1"}],u.value=o.data}).catch(()=>{})},I=p(null),h=o=>{I.value.open(o)},k=({id:o,robot_key:t,application_type:s})=>{s==0?f.push({path:"/robot/config/basic-config",query:{id:o,robot_key:t}}):f.push({path:"/robot/config/workflow",query:{id:o,robot_key:t}})},L=o=>{let t=3,s=B.confirm({title:`删除机器人${o.robot_name}`,icon:a(et),content:"您确定要删除此机器人吗？",okText:t+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){F(o)},onCancel(){}}),r=setInterval(()=>{t==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(r),r=void 0):(t-=1,s.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},F=({id:o})=>{mt({id:o}).then(()=>{U.success("删除成功"),R()})},O=o=>{window.open(`#/robot/test?robot_key=${o.robot_key}&id=${o.id}`)},n=o=>{window.open(`#/robot/config/session-record?robot_key=${o.robot_key}&id=${o.id}`)},g=o=>{window.open(`#/robot/config/statistical_analysis?robot_key=${o.robot_key}&id=${o.id}`)};return lt(()=>{R()}),(o,t)=>{const s=at,r=Ct,A=Lt,P=wt,S=nt,M=$t;return v(),T("div",Vt,[Dt,a(kt,{class:"mb-16",title:"使用说明"},{default:i(()=>[jt]),_:1}),e("div",Et,[e("div",Wt,[a(yt,{tabs:$.value,value:m.value,"onUpdate:value":t[0]||(t[0]=_=>m.value=_)},null,8,["tabs","value"])]),e("div",qt,[C.value?(v(),N(P,{key:0},{overlay:i(()=>[a(A,null,{default:i(()=>[a(r,{onClick:t[2]||(t[2]=y(_=>h(0),["prevent"]))},{default:i(()=>[e("span",Gt,[e("img",{class:"icon",src:w(z),alt:""},null,8,Jt),Kt])]),_:1}),a(r,{onClick:t[3]||(t[3]=y(_=>h(1),["prevent"]))},{default:i(()=>[e("span",zt,[e("img",{class:"icon",src:w(Q),alt:""},null,8,Qt),Yt])]),_:1})]),_:1})]),default:i(()=>[a(s,{type:"primary",onClick:t[1]||(t[1]=y(()=>{},["prevent"]))},{icon:i(()=>[a(w(Z))]),default:i(()=>[ut(" 创建应用 ")]),_:1})]),_:1})):it("",!0)])]),e("div",Zt,[(v(!0),T(ct,null,_t(l.value,_=>(v(),T("div",{class:"list-item-wrapper",key:_.id,onClick:d=>k(_)},[e("div",Xt,[e("div",to,[e("img",{class:"robot-avatar",src:_.robot_avatar,alt:""},null,8,oo),e("div",eo,[e("div",ao,j(_.robot_name),1),e("div",no,j(_.application_type==0?"聊天机器人":"工作流"),1)])]),e("div",so,j(_.robot_intro),1),e("div",{class:"robot-action",onClick:t[5]||(t[5]=y(()=>{},["stop"]))},[a(M,{title:"聊天测试"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(d=>O(_),["stop"])},[a(S,{class:"action-icon",name:"chat"})],8,ro)]),_:2},1024),a(M,{title:"会话记录"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(d=>n(_),["stop"])},[a(S,{class:"action-icon",name:"session"})],8,lo)]),_:2},1024),a(M,{title:"统计分析"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(d=>g(_),["stop"])},[a(S,{class:"action-icon",name:"analysis"})],8,io)]),_:2},1024),a(P,null,{overlay:i(()=>[a(A,null,{default:i(()=>[a(r,null,{default:i(()=>[e("a",{class:"delete-text-color",href:"javascript:;",onClick:d=>L(_)},"删 除",8,co)]),_:2},1024)]),_:2},1024)]),default:i(()=>[e("div",{class:"robot-action-item",onClick:t[4]||(t[4]=y(()=>{},["stop"]))},[a(S,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Ht))),128))]),a(Nt,{ref_key:"addRobotAlertRef",ref:I},null,512)])}}},te=q(_o,[["__scopeId","data-v-bc6bd6ee"]]);export{te as default};
