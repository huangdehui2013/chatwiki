import{b as $e,B as Lt,bh as pn,d as Ve,M as he,d9 as fn,L as mn,E as Ce,dj as Ot,dn as Et,k as fe,de as It,df as Rt,bI as vn,bw as Tt,bx as hn,by as gn,bz as Mt,bA as kn,e as Pt,dp as yn,bd as bn,be as Sn,f as wn,d8 as $t,dq as $n,dr as xn}from"../../index-CuFzRDH0.js";import{M as l,N as v,W as n,k as t,S as o,u as ee,a1 as Te,a2 as Me,e as s,B as Re,x as Ae,Z as K,a7 as j,F as de,$ as Se,z as Je,a5 as Ze,b as we,D as Ft,ai as ot,Y as E,a0 as ve,X as Ie,Q as W,G as lt,a4 as zt,a6 as Dt,a8 as Cn}from"./vue-chunks-DkYK5AuX.js";import{_ as qn}from"./empty-CzGZrENG.js";import{P as Nt}from"./PlusOutlined-C1-JNsax.js";import{S as Ge,c as je,a as At,C as Bt,b as Ln,E as On}from"./edit-subsection-DgLeTRa2.js";import{Z as En,f as In,a as Rn,P as Tn,H as Mn,C as Pn,b as Fn}from"./cu-scroll-DrKGulQh.js";import{S as Be}from"./index-YK7vZYdC.js";import{_ as st,M as it}from"./index-D2p2Kdi5.js";import"./index-DmWi8Hkf.js";import{D as ct}from"./dropdown-aM3tBgR4.js";import{S as Ht}from"./SettingOutlined-BLoICRkv.js";import{S as Ut}from"./SyncOutlined-_wzD1Bbw.js";import{M as Qt}from"./MoreOutlined-B6i0Yk0c.js";import{_ as We}from"./index-DVObnatt.js";import{C as Ne}from"./cu-scroll-8SQNC6_m.js";import{_ as zn,F as Dn}from"./index-CKa8nflF.js";import{S as Jt,_ as Gt}from"./index-B9b8kVtF.js";import{R as Nn}from"./rename-modal-DxjRGuRF.js";import{V as xt}from"./vue-pdf-embed-10Elc_04.js";import{S as An,a as Bn,D as Hn,E as Un}from"./edit-fragment-alert-CVfV61oD.js";import{C as Qn}from"./ClockCircleFilled-vGTbBwA5.js";import{_ as Jn,a as Gn}from"./index-CaI5udhb.js";import{B as jn,_ as Vn}from"./index-DfjPin7b.js";import{_ as Zn}from"./index-CqvptPUf.js";import{_ as Wn,a as Kn}from"./RadioButton-ouyuU7LQ.js";import{L as Xn}from"./LeftOutlined-BL6rtvtT.js";import{D as Ct}from"./DownOutlined-xHwfZhzl.js";import"./axios-Cm0UX6qg.js";import"./qs-g-qVsYXK.js";import"./crypto-js-CsNcoEfj.js";import"./dayjs-CHX5mXCJ.js";import"./index-Cdh10aiJ.js";import"./Dropdown-DNhcw7uk.js";import"./Trigger-qqJEyN1K.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-CNYsll_x.js";import"./DownloadOutlined-CpROJx0R.js";import"./pick-C3qN9FSY.js";import"./CheckOutlined-Nu5wJEo2.js";import"./slide--PTaLm6c.js";import"./index-5PrSJtCq.js";import"./Input-DlD3j6GW.js";import"./FormItemContext-CG4o3aCY.js";import"./index-DpON8wvi.js";import"./inputProps-CIG3Q6HA.js";import"./Search-BjDfM7wD.js";import"./SearchOutlined-2-sBVYkv.js";import"./isPlainObject-B3m2dvNk.js";import"./TextArea-DnYx9N6z.js";import"./Password-B-_rMC_p.js";import"./index-Dq04eVXF.js";import"./index-BKVIlkU8.js";import"./index-CR3o8wp3.js";import"./collapseMotion-D38MKU2V.js";import"./index-C4ag7WaN.js";import"./index-njT3lQ6A.js";import"./index-BMSQkwth.js";import"./index-BDEXdwqG.js";import"./UpOutlined-CmeybyPL.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./shallowequal-CCVEH32S.js";import"./RightOutlined-C7Gymx4e.js";import"./move-CfeIRdjT.js";import"./colors-TmzmwKXv.js";import"./responsiveObserve-nm9aPAMw.js";import"./QuestionCircleOutlined-DySDEe_b.js";import"./model-select-CidLVLk0.js";import"./index-B3CceHui.js";import"./index-DYBz5Hw_.js";import"./index-D0OvhCrn.js";import"./useMaxLevel-iyEeLMuD.js";import"./CaretDownFilled-P6q1_Q4R.js";import"./index-DncdWYWk.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-CvnBYLiG.js";import"./Checkbox-CHV8yuJS.js";import"./index-NJlqtEGH.js";import"./CaretDownOutlined-BxctymRA.js";const rt=w=>(Te("data-v-8eb7d862"),w=w(),Me(),w),Yn={class:"empty-box"},ea=rt(()=>n("img",{src:qn,alt:""},null,-1)),ta=rt(()=>n("div",{class:"title"},"知识库文档为空，请添加分段",-1)),na=rt(()=>n("span",null,"添加分段",-1)),aa={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(w,{emit:oe}){const x=oe,O=()=>{x("openEditSubscription",{})};return(h,b)=>{const f=Lt;return l(),v("div",Yn,[ea,ta,n("div",null,[t(f,{type:"primary",onClick:O},{icon:o(()=>[t(ee(Nt))]),default:o(()=>[na]),_:1})])])}}},at=$e(aa,[["__scopeId","data-v-8eb7d862"]]),oa=w=>(Te("data-v-f0ead6c0"),w=w(),Me(),w),la={class:"chart-wrapper"},sa=oa(()=>n("div",{class:"chart-mini-map",id:"chatMap"},null,-1)),ia={class:"zoom-toolbar-wrapper"},ca={__name:"chart-box",emits:["nodeClick"],setup(w,{expose:oe,emit:x}){const O=x,h=s(null);let b=null;const f=Re({nodes:[],edges:[]}),z=s(1),I={},J=()=>{b&&b.destroy();const d={layout:"forceDirected",initialZoom:z.value,disableTelemetry:!0,maxZoom:10,minZoom:.1,minimapContainer:document.getElementById("chatMap"),styling:{minimapViewportBoxColor:"#4399FF",selectedBorderColor:"rgba(255, 255, 255, 1)"}},m=document.getElementById("chartBox");b=new In(m,f.nodes,f.edges,d,I);const S=new Rn(b);new Tn(b),S.updateCallback("onZoom",D=>{z.value=Number(D.toFixed(1))}),new Mn(b,{drawShadowOnHover:!0}),new Pn(b,{selectOnClick:!0}).updateCallback("onNodeClick",D=>{O("nodeClick",D)})},G=d=>{z.value=d,b&&b.setZoom(d)},c=({nodes:d,edges:m})=>{f.nodes=[f.nodes,...d],f.edges=[f.edges,...m],b&&b.addElementsToGraph(d,m)},X=({nodes:d,edges:m})=>{f.nodes=[f.nodes,...d],f.edges=[f.edges,...m],b&&b.addAndUpdateElementsInGraph(d,m)},ae=({nodes:d,edges:m})=>{f.nodes=d,f.edges=m,b&&b.updateElementsInGraph(d,m)},C=()=>{b&&b.destroy()},H=({nodes:d,edges:m})=>{f.nodes=d,f.edges=m,J()};return Ae(()=>{}),oe({render:H,add:c,addAndUpdate:X,update:ae,destroy:C}),(d,m)=>(l(),v("div",la,[n("div",{class:"chart",id:"chartBox",ref_key:"chartBox",ref:h},null,512),sa,n("div",ia,[t(En,{value:z.value,onChange:G},null,8,["value"])])]))}},ra=$e(ca,[["__scopeId","data-v-f0ead6c0"]]),He=w=>(Te("data-v-bb7b1011"),w=w(),Me(),w),ua={key:0,class:"popup-wrapper entity-details-wrapper"},da={class:"popup-header"},_a=He(()=>n("div",{class:"popup-title"},"实体详情",-1)),pa={key:0,class:"popup-body"},fa={class:"popup-content"},ma={class:"entity-details"},va={class:"entity-item"},ha=He(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"实体")],-1)),ga={class:"entity-name"},ka={class:"entity-item",style:{"margin-bottom":"8px"}},ya=He(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"归属文档")],-1)),ba={class:"file-info"},Sa={class:"file-name"},wa={class:"entity-item"},$a=He(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"分段")],-1)),xa={class:"doc-item"},Ca={class:"fragment-content"},qa={class:"entity-item"},La=He(()=>n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"子图")],-1)),Oa={key:0,class:""},Ea={class:"fragment-content"},Ia={__name:"entity-details",setup(w,{expose:oe}){const x=Re({show:!1,node:null,fromNodes:[]}),O=()=>{x.show=!1};return oe({open:(b,f)=>{x.node=b,x.fromNodes=f,x.show?(x.show=!1,Je(()=>{x.show=!0})):x.show=!0},close:O}),(b,f)=>{const z=Ve;return x.show?(l(),v("div",ua,[n("div",da,[_a,t(ee(pn),{class:"close-btn",onClick:O})]),x.node?(l(),v("div",pa,[t(Fn,null,{default:o(()=>[n("div",fa,[n("div",ma,[n("div",va,[ha,n("div",ga,K(x.node.name),1)]),n("div",ka,[ya,n("div",ba,[t(z,{class:"file-icon",name:"doc-file",style:{}}),n("span",Sa,K(x.node.file_name),1)])]),n("div",wa,[$a,n("div",null,[n("div",xa,[n("div",Ca,K(x.node.content),1)])])]),n("div",qa,[La,n("div",null,[x.fromNodes.length==0?(l(),v("div",Oa,"无")):j("",!0),(l(!0),v(de,null,Se(x.fromNodes,I=>(l(),v("div",{class:"subgraph-item",key:I.id},[n("div",Ea,K(I.name),1)]))),128))])])])])]),_:1})])):j("",!0)])):j("",!0)}}},Ra=$e(Ia,[["__scopeId","data-v-bb7b1011"]]),Ta={class:"graph-model-body"},Ma={key:0,class:"loading-wrapper"},Pa={class:"right-box"},Fa={__name:"index",setup(w,{expose:oe}){const x=s(!1),O=s(null),h=s(null),b=s(null),f=s(!1),z=Re({file_id:"",data_id:""}),I=Re({edges:[],nodes:[]});let J={};const G=()=>{c()},c=()=>{f.value=!0,fn({file_id:z.file_id,data_id:z.data_id,search_term:z.search_term}).then(d=>{f.value=!1;let m=d.data.edges||[],S=d.data.nodes||[];const q=new Map;m=m.filter(g=>{const T=`${g.from_id}_${g.to_id}`,le=`${g.to_id}_${g.from_id}`;return q.has(T)||q.has(le)?!1:(q.set(T,!0),!0)}),m.forEach(g=>{g.id=g.id.toString(),g.from=g.from_id.toString(),g.to=g.to_id.toString(),g.caption=g.label});const D=new Set(m.map(g=>g.from)),se=new Set(m.map(g=>g.to));S.forEach(g=>{g.caption=g.name,g.id=g.id.toString(),g.nodeType=D.has(g.id)&&se.has(g.id)?"both":D.has(g.id)?"from":se.has(g.id)?"to":"normal",g.nodeType==="from"?(g.size=35,g.color="#FFB1B2"):g.nodeType==="to"?(g.size=45,g.color="#005AFF"):(g.size=30,g.color="#69E9BE")});let ue={edges:m,nodes:S};I.edges=ue.edges,I.nodes=ue.nodes,setTimeout(()=>{h.value.render(ue)},0),J={},m.forEach(g=>{J[g.to]||(J[g.to]=[]),J[g.to].push(g.from)})}).catch(d=>{f.value=!1})},X=d=>{let m=J[d.id]||[],S=[];for(let q=0;q<I.nodes.length;q++)m.indexOf(I.nodes[q].id)>-1&&S.push(I.nodes[q]);b.value.open(d,S)},ae=()=>{h.value.destroy(),x.value=!1},C=()=>{x.value=!1};return oe({open:d=>{z.file_id=d.file_id,z.data_id=d.id,x.value=!0,setTimeout(()=>{G()},350)}}),(d,m)=>{const S=Be,q=he;return l(),v("div",{ref_key:"mymodal",ref:O},[t(q,{wrapClassName:"graph-model-wrapper",zIndex:99999,centered:"",open:x.value,"onUpdate:open":m[0]||(m[0]=D=>x.value=D),title:"知识图谱",width:"90vw",footer:null,onOk:C,onCancel:ae},{default:o(()=>[n("div",Ta,[f.value?(l(),v("div",Ma,[t(S)])):j("",!0),t(ra,{ref_key:"chartBoxRef",ref:h,loading:f.value,onNodeClick:X},null,8,["loading"]),n("div",Pa,[t(Ra,{ref_key:"entityDetailsRef",ref:b},null,512)])])]),_:1},8,["open"])],512)}}},za=$e(Fa,[["__scopeId","data-v-56e1b6be"]]),Da=w=>(Te("data-v-6f94503d"),w=w(),Me(),w),Na={class:"subsection-box-title"},Aa=["onClick"],Ba={class:"top-block"},Ha={class:"title"},Ua={class:"title-block"},Qa={class:"cfb363f"},Ja={key:0},Ga={class:"cfb363f"},ja={class:"right-opration"},Va={class:"hover-btn-box"},Za=["onClick"],Wa=Da(()=>n("div",null,"精选设置",-1)),Ka=["onClick"],Xa={class:"hover-btn-box"},Ya={class:"hover-btn-box"},eo=["onClick"],to=["onClick"],no={key:0,class:"content-box"},ao={key:1,class:"content-box"},oo=["onMouseup","innerHTML"],lo={key:2,class:"fragment-img"},so=["src"],io={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList","handleSplit","handleSplitNext","handleSplitUp","handleSplitDelete"],setup(w,{expose:oe,emit:x}){const O=x,h=w,b=Ze(),f=(r,u)=>{let{id:M,title:L,content:_e,question:U,answer:Q,images:ne,category_id:_}=r,te=r.similar_questions||[];he.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${u+1}】吗?`,onOk(){return new Promise(P=>{Ot({id:M,title:L,content:_e,question:U,answer:Q,images:ne,category_id:_,similar_questions:JSON.stringify(te)}).then(()=>{O("handleConvert",r),P()}).catch(()=>{P()})})},onCancel(){}})},z=r=>{O("openEditSubscription",r)},I=r=>{he.confirm({title:"提示",icon:t(Ce),content:"确认是否删除该分段?",onOk(){return new Promise(u=>{Et({id:r}).then(()=>{fe.success("删除成功"),O("handleDelParagraph",r),u()}).catch(()=>{u()})})},onCancel(){}})},J=(r,u,M)=>{window.getSelection().toString().trim()||(O("handleScrollTargetPage",{page_num:r.page_num,index:u}),xe(M))},G=s([]),c=()=>{let r={file_id:b.query.id};It(r).then(u=>{G.value=u.data||[],O("getStatrList",u.data||[])})};c();const X=s(null),ae=()=>{X.value.show()},C=r=>{var M;let u=(M=G.value.filter(L=>L.id==r.category_id)[0])==null?void 0:M.type;return u?je[u]:""},H=(r,u={})=>{Rt({id:r.id,category_id:u.id||0}).then(()=>{fe.success("设置成功"),r.category_id=u.id,c()})},d=s(null),m=r=>{d.value.open(r)},S=s(null),q=s(!1),D=s({x:0,y:0}),se=s(""),ue=s(null),g=s({text:"",parentIndex:-1,originalHtml:""}),T=we(()=>{if(!q.value)return{};const r=162;let u=D.value.x,M=D.value.y;const L=S.value.getBoundingClientRect(),_e=window.innerWidth;u<10?u=10:u+r>_e-50&&(u=_e-r-50);const U=u-L.left,Q=M;return{left:`${U}px`,top:`${Q}px`}}),le=(r,u)=>{setTimeout(()=>{const M=window.getSelection(),L=M.toString().trim();if(L){r.stopPropagation(),g.value={text:L,parentIndex:u,originalHtml:h.paragraphLists[u].content},se.value=L,ue.value=M.getRangeAt(0).cloneRange();const U=M.getRangeAt(0).getBoundingClientRect(),Q=S.value.getBoundingClientRect();D.value={x:U.left+U.width/2,y:U.top-Q.top-50},q.value=!0}else q.value=!1},50)},R=r=>{const{parentIndex:u}=g.value;switch(r){case"separate":me(u);break;case"merge-next":qe(u);break;case"merge-prev":y(u);break;case"delete":ge(u);break}q.value=!1,window.getSelection().removeAllRanges()},B=(r,u,M)=>{if(u===0&&M===r.textContent.length&&r.textContent.trim().length>0)return["",r.innerHTML,""];const _e=document.createTreeWalker(r,NodeFilter.SHOW_TEXT);let U,Q=0,ne,_,te,P;for(;U=_e.nextNode();){const N=U.nodeValue.length;if(!ne&&Q+N>=u&&(ne=U,te=u-Q),!_&&Q+N>=M){_=U,P=M-Q;break}Q+=N}const be=document.createRange();be.setStart(ne,te),be.setEnd(_,P);const Ee=document.createRange();Ee.setStart(r,0),Ee.setEnd(ne,te);const a=document.createRange();return a.setStart(_,P),a.setEnd(r,r.childNodes.length),[ye(Ee),ye(be),ye(a)]},ye=r=>{const u=document.createElement("div");return u.appendChild(r.cloneContents()),u.innerHTML},me=r=>{const u=h.paragraphLists[r].content,L=window.getSelection().getRangeAt(0);L.toString()&&he.confirm({title:"单独分段",icon:t(Ce),content:"确认将该分段内容单独分段么？分段后，原分段的内容会被删除",onOk(){const U=document.createElement("div");U.innerHTML=u;const[Q,ne,_]=B(U,L.startOffset,L.endOffset),te=Q.replace(/<[^>]+>/g,"").trim()==="",P=_.replace(/<[^>]+>/g,"").trim()==="";te&&P?O("handleSplit",{index:r,beforeContent:"",selectedContent:ne,afterContent:"",isFullSelection:!0}):O("handleSplit",{index:r,beforeContent:Q,selectedContent:ne,afterContent:_,originalSelection:{start:L.startOffset,end:L.endOffset,parentIndex:r}})}})},qe=r=>{if(r>=h.paragraphLists.length-1)return fe.error("没有下一个分段");const u=h.paragraphLists[r].content,L=window.getSelection().getRangeAt(0);L.toString()&&he.confirm({title:"合并到下一个分段",icon:t(Ce),content:"确认将该分段内容合并到下一个分段么？分段后，原分段的内容会被删除",onOk(){const U=document.createElement("div");U.innerHTML=u;const[Q,ne,_]=B(U,L.startOffset,L.endOffset),te=Q.replace(/<[^>]+>/g,"").trim()==="",P=_.replace(/<[^>]+>/g,"").trim()==="";te&&P?O("handleSplitNext",{index:r,beforeContent:"",selectedContent:ne,afterContent:"",isFullSelection:!0}):O("handleSplitNext",{index:r,beforeContent:Q,selectedContent:ne,afterContent:_,originalSelection:{start:L.startOffset,end:L.endOffset,parentIndex:r}})}})},y=r=>{if(r<=0)return fe.error("没有上一个分段");const u=h.paragraphLists[r].content,L=window.getSelection().getRangeAt(0);L.toString()&&he.confirm({title:"合并到上一个分段",icon:t(Ce),content:"确认将该分段内容合并到上一个分段么？分段后，原分段的内容会被删除",onOk(){const U=document.createElement("div");U.innerHTML=u;const[Q,ne,_]=B(U,L.startOffset,L.endOffset),te=Q.replace(/<[^>]+>/g,"").trim()==="",P=_.replace(/<[^>]+>/g,"").trim()==="";te&&P?O("handleSplitUp",{index:r,beforeContent:"",selectedContent:ne,afterContent:"",isFullSelection:!0}):O("handleSplitUp",{index:r,beforeContent:Q,selectedContent:ne,afterContent:_,originalSelection:{start:L.startOffset,end:L.endOffset,parentIndex:r}})}})},ge=r=>{const u=h.paragraphLists[r].content,L=window.getSelection().getRangeAt(0);L.toString()&&he.confirm({title:"删除",icon:t(Ce),content:"确认将该分段内容删除么？",onOk(){const U=document.createElement("div");U.innerHTML=u;const[Q,ne,_]=B(U,L.startOffset,L.endOffset),te=Q.replace(/<[^>]+>/g,"").trim()==="",P=_.replace(/<[^>]+>/g,"").trim()==="";te&&P?O("handleSplitDelete",{index:r,beforeContent:"",selectedContent:"",afterContent:"",isFullSelection:!0}):O("handleSplitDelete",{index:r,beforeContent:Q,selectedContent:"",afterContent:_,originalSelection:{start:L.startOffset,end:L.endOffset,parentIndex:r}})}})},xe=r=>{q.value&&!r.target.closest(".bubble-card")&&(q.value=!1)};return Ae(()=>{document.addEventListener("click",xe)}),Ft(()=>{document.removeEventListener("click",xe)}),oe({handleOpenEditModal:z}),(r,u)=>{const M=We,L=st,_e=it,U=ct,Q=Ve,ne=ot("viewer");return l(),v("div",{class:"subsection-box content-container",ref_key:"containerRef",ref:S},[n("div",Na,[E(" 分段预览 "),n("span",null,"共"+K(h.total)+"个分段",1)]),(l(!0),v(de,null,Se(h.paragraphLists,(_,te)=>(l(),v("div",{class:"list-item",key:_.id,onClick:ve(P=>J(_,te,P),["stop"]),style:Ie({"--status-color":C(_)})},[n("div",Ba,[n("div",Ha,[E(" 分段"+K(te+1)+" ",1),n("div",Ua,K(_.title),1),n("span",null,"共"+K(_.word_total)+"个字符",1),n("span",null,[E(" 嵌入状态："+K(_.status_text),1),_.status==3?(l(),W(ee(mn),{key:0})):j("",!0),_.status==2&&_.errmsg?(l(),W(M,{key:1,title:_.errmsg},{default:o(()=>[n("strong",Qa,[E("原因"),t(ee(Ce),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):j("",!0)]),w.detailsInfo.graph_switch?(l(),v("span",Ja,[E(" 知识图谱状态："+K(_.graph_status_text)+" ",1),_.graph_status==3&&_.graph_err_msg?(l(),W(M,{key:0,title:_.graph_err_msg},{default:o(()=>[n("strong",Ga,[E("原因"),t(ee(Ce),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):j("",!0)])):j("",!0)]),n("div",ja,[t(U,null,{overlay:o(()=>[t(_e,null,{default:o(()=>[(l(!0),v(de,null,Se(G.value,P=>(l(),W(L,{key:P.id},{default:o(()=>[n("div",{class:"start-item",onClick:ve(be=>H(_,P),["stop"])},[t(ee(Ge),{style:Ie({color:ee(je)[P.type]})},null,8,["style"]),n("div",null,K(P.name||"-"),1)],8,Za)]),_:2},1024))),128)),t(L,null,{default:o(()=>[n("div",{class:"start-item",onClick:ve(ae,["stop"])},[t(ee(Ht)),Wa])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",Va,[_.category_id>0?(l(),W(ee(Ge),{key:0,onClick:ve(P=>H(_,{}),["stop"]),style:Ie({color:C(_),"font-size":"16px"})},null,8,["onClick","style"])):(l(),W(ee(At),{key:1,onClick:P=>H(_,G.value[0]),style:{"font-size":"16px",color:"#595959"}},null,8,["onClick"]))])]),_:2},1024),w.detailsInfo.graph_switch?(l(),W(M,{key:0},{title:o(()=>[E("知识图谱")]),default:o(()=>[n("div",{class:"hover-btn-box",onClick:P=>m(_)},[t(Q,{name:"graph-icon",style:{"font-size":"16px",color:"#595959"}})],8,Ka)]),_:2},1024)):j("",!0),t(M,null,{title:o(()=>[E("重新转换")]),default:o(()=>[n("div",Xa,[t(ee(Ut),{onClick:ve(P=>f(_,te),["stop"])},null,8,["onClick"])])]),_:2},1024),t(U,{placement:"bottomRight"},{overlay:o(()=>[t(_e,null,{default:o(()=>[t(L,null,{default:o(()=>[n("div",{onClick:ve(P=>z(_),["stop"])},"编辑",8,eo)]),_:2},1024),t(L,null,{default:o(()=>[n("div",{onClick:ve(P=>I(_.id),["stop"])},"删除",8,to)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",Ya,[t(ee(Qt),{style:{"font-size":"16px",color:"#595959"}})])]),_:2},1024)])]),_.question?(l(),v("div",no,"Q："+K(_.question),1)):j("",!0),_.answer?(l(),v("div",ao,"A："+K(_.answer),1)):j("",!0),n("div",{class:"content-box",onMouseup:ve(P=>le(P,te),["stop"]),innerHTML:_.content},null,40,oo),_.images.length>0?lt((l(),v("div",lo,[(l(!0),v(de,null,Se(_.images,(P,be)=>(l(),v("img",{key:be,src:P,alt:""},null,8,so))),128))])),[[ne]]):j("",!0)],12,Aa))),128)),t(Bt,{onOk:c,ref_key:"classificationMarkModalRef",ref:X},null,512),t(za,{ref_key:"graphModelRef",ref:d},null,512),q.value?(l(),v("div",{key:0,class:"bubble-card",style:Ie(T.value)},[n("button",{class:"bubble-item",onClick:u[0]||(u[0]=ve(_=>R("separate"),["stop"]))},[t(Q,{name:"segmentation",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 单独成段 ")]),n("button",{class:"bubble-item",onClick:u[1]||(u[1]=ve(_=>R("merge-prev"),["stop"]))},[t(Q,{name:"segmentation-up",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 合并到上一分段 ")]),n("button",{class:"bubble-item",onClick:u[2]||(u[2]=ve(_=>R("merge-next"),["stop"]))},[t(Q,{name:"segmentation-down",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 合并到下一分段 ")]),n("button",{class:"bubble-item",onClick:u[3]||(u[3]=ve(_=>R("delete"),["stop"]))},[t(Q,{name:"delete",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),E(" 删除 ")])],4)):j("",!0)],512)}}},qt=$e(io,[["__scopeId","data-v-6f94503d"]]),co={class:"mode-box"},ro=["innerHTML"],uo={class:"tag-item"},_o={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(w){const oe=w,x=s(""),O=we(()=>{const{is_table_file:h,is_qa_doc:b,is_diy_split:f,question_lable:z,answer_lable:I,separators:J,chunk_size:G,chunk_overlap:c,question_column:X,answer_column:ae,qa_index_type:C,doc_type:H}=oe.detailsInfo;if(h!=1&&b!=1&&f!=1)return H==3?(x.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(x.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(h!=1&&b==1)return H==3?(x.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(x.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${z}"
答案开始标识符："${I}"`,"智能分段：QA文档");if(h!=1&&b!=1&&f==1)return x.value=`分段模式：自定义分段
文档标识符：${J}
分段最大长度：${G}字符
文段重叠长度：${c}字符`,"自定义分段";if(h==1&&b!=1)return x.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(h==1&&b==1){let d=C==1?"问题与答案一起生成索引":"仅对问题生成索引";return x.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${X}"
答案所在列："${ae}"
索引方式：${d}`,"智能分段：QA文档"}});return(h,b)=>{const f=We;return l(),v("div",co,[t(f,null,{title:o(()=>[n("div",{class:"tooltip-text-box",innerHTML:x.value},null,8,ro)]),default:o(()=>[n("div",uo,K(O.value),1)]),_:1})])}}},po=$e(_o,[["__scopeId","data-v-e8649c10"]]),fo={__name:"update-frequency",emits:["ok"],setup(w,{expose:oe,emit:x}){const O=x,h=s(!1),b=s(!1),f=Re({doc_auto_renew_frequency:1,id:""}),z=J=>{let{doc_auto_renew_frequency:G,id:c}=J;f.doc_auto_renew_frequency=+G,f.id=c,h.value=!0},I=()=>{b.value=!0,vn({...f}).then(J=>{O("ok",f.doc_auto_renew_frequency),h.value=!1,fe.success("设置成功")}).finally(()=>{b.value=!1})};return oe({open:z}),(J,G)=>{const c=Jt,X=Gt,ae=zn,C=Dn,H=he;return l(),v("div",null,[t(H,{open:h.value,"onUpdate:open":G[1]||(G[1]=d=>h.value=d),"confirm-loading":b.value,maskClosable:!1,title:"设置更新频率",onOk:I},{default:o(()=>[t(C,{style:{margin:"32px 0"},layout:"vertical",model:f},{default:o(()=>[t(ae,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:o(()=>[t(X,{value:f.doc_auto_renew_frequency,"onUpdate:value":G[0]||(G[0]=d=>f.doc_auto_renew_frequency=d),style:{width:"100%"}},{default:o(()=>[t(c,{value:1},{default:o(()=>[E("不自动更新")]),_:1}),t(c,{value:2},{default:o(()=>[E("每天")]),_:1}),t(c,{value:3},{default:o(()=>[E("每3天")]),_:1}),t(c,{value:4},{default:o(()=>[E("每7天")]),_:1}),t(c,{value:5},{default:o(()=>[E("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},mo={class:"loading"},vo={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(w,{expose:oe,emit:x}){const O=w,h=x,b=s(null),f=s([]),z=s(0),I=s(!1),J=we(()=>I.value?null:{"border-bottom":"2px solid #d9d9d9"}),G=s({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});Ae(async()=>{const m=await xt.getDocument(O.source).promise;z.value=m.numPages,h("getTotalPage",z.value),c()});const c=(m=null)=>{const S=f.value.length;if(S>=z.value||I.value)return;I.value=!0;const q=[];for(let D=1;D<=O.pageSize&&S+D<=z.value;D++)q.push(S+D);f.value.push(...q),Je(()=>{typeof m=="function"&&m()})},X=m=>{c(),h("onScrollEnd",m)},ae=m=>{Je(()=>{m===f.value[f.value.length-1]&&(I.value=!1,h("rendered",m,z.value))})},C=m=>{h("select",m)},H=()=>b.value,d=m=>{h("scroll",m)};return oe({loadMore:c,getScrollInstance:H}),(m,S)=>{const q=Be;return l(),W(Ne,{scrollbar:G.value,ref_key:"scrollRef",ref:b,onScroll:d,onOnScrollEnd:X},{default:o(()=>[(l(!0),v(de,null,Se(f.value,D=>(l(),W(ee(xt),{onClick:se=>C(D),key:D,source:w.source,page:D,onRendered:()=>ae(D),style:Ie(J.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),n("div",mo,[I.value?(l(),W(q,{key:0})):j("",!0)])]),_:1},8,["scrollbar"])}}},ho=$e(vo,[["__scopeId","data-v-8520f2eb"]]),go=w=>(Te("data-v-9f322e00"),w=w(),Me(),w),ko={key:0,class:"loading-wrap"},yo={class:"document-segmentation"},bo={class:"page-container"},So={class:"page-left"},wo={class:"page-right"},$o={class:"document-fragment-preview"},xo={class:"preview-header"},Co=go(()=>n("span",{class:"label-text"},"分段预览",-1)),qo={class:"fragment-number"},Lo={key:1,class:"loading-box"},Oo="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Eo={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}}},emits:["ok","finish","loading"],setup(w,{expose:oe,emit:x}){const O=Ze(),h=x,{id:b}=O.query,f=s(!0),z=s(1);let I=!1;const J=w,G=s(1);let c={id:b,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Oo,ai_chunk_task_id:""};const X=s(null),ae=a=>{typeof a.separators_no=="object"&&(a.separators_no=a.separators_no.join(",")),c={...c,...a},I?he.confirm({title:"提醒",icon:t(Ce),content:"文档片段已被编辑重新获取文档片段会丢失当前修改过的文档片段内容，确定要重新获取吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){I=!1,me("create")},onCancel(){}}):(I=!1,me("create"))};let C=60*10,H=0;const d=s({}),m=s(0),S=()=>{f.value||(f.value=!0),Tt({id:b}).then(async a=>{const{status:N}=a.data;if(m.value=a.data.library_type,d.value=a.data,c={...c,separators_no:a.data.separators_no||"11,12",chunk_size:+a.data.chunk_size||512,ai_chunk_size:+a.data.ai_chunk_size||5e3,chunk_overlap:+a.data.chunk_overlap||50,is_qa_doc:m.value==2?1:0,question_lable:a.data.question_lable,answer_lable:a.data.answer_lable,question_column:a.data.question_column,answer_column:a.data.answer_column,enable_extract_image:a.data.enable_extract_image=="true",qa_index_type:+a.data.qa_index_type,chunk_type:+a.data.chunk_type,semantic_chunk_size:+a.data.semantic_chunk_size||512,semantic_chunk_overlap:+a.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+a.data.semantic_chunk_threshold||90,semantic_chunk_use_model:a.data.semantic_chunk_use_model||"",ai_chunk_prumpt:a.data.ai_chunk_prumpt||"",ai_chunk_model:a.data.ai_chunk_model||"",semantic_chunk_model_config_id:a.data.semantic_chunk_model_config_id>0?a.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:a.data.ai_chunk_model_config_id>0?a.data.ai_chunk_model_config_id:"",ai_chunk_task_id:a.data.ai_chunk_task_id||""},a.data.chunk_type==0&&(c={...c,separators_no:a.data.normal_chunk_default_separators_no,chunk_size:a.data.normal_chunk_default_chunk_size,chunk_overlap:a.data.normal_chunk_default_chunk_overlap,chunk_type:+a.data.default_chunk_type,semantic_chunk_size:+a.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+a.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+a.data.semantic_chunk_default_threshold,semantic_chunk_use_model:a.data.default_use_model||"",semantic_chunk_model_config_id:a.data.default_model_config_id>0?a.data.default_model_config_id:""}),N==0){if(H++,H>C){he.error({title:"提醒",content:"文档解析速度慢请稍后再试"});return}setTimeout(()=>{S()},1e3)}else(N==4||N==2)&&(f.value=!1,z.value=parseInt(a.data.is_table_file),a.data.library_id,m.value==2?(c.question_lable||c.question_column)&&me():me());a.data.is_table_file==1&&D()})};Ae(async()=>{await S()});const q=s([]),D=()=>{hn({id:b}).then(a=>{let N=[];for(let Y in a.data)N.push({lable:a.data[Y],value:Y});q.value=N})},se=s(!1),ue=s(!1),g=s(""),T=s(null);let le=null;const R=s([]),B=s(0),ye=we(()=>B.value<=0),me=a=>{h("loading",!0);let N={...c,semantic_chunk_model_config_id:c.semantic_chunk_model_config_id?+c.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:c.ai_chunk_model_config_id?+c.ai_chunk_model_config_id:0,...J.pdfState};return c.chunk_type==3&&(c.ai_chunk_task_id&&!a&&(N.ai_chunk_task_id=c.ai_chunk_task_id),N.ai_chunk_task_id&&a&&a==="create"&&delete N.ai_chunk_task_id),gn(N).then(Y=>{var ie;R.value=Y.data.list||[],B.value=Y.data.list.length||0,c.chunk_type==3&&(g.value=((ie=Y.data.split_params)==null?void 0:ie.ai_chunk_task_id)||"",ue.value=!0,X.value.reLoading=!0,T.value=null,!c.ai_chunk_task_id&&z.value!=1||a&&a==="create"?(R.value=[],B.value=0,xe()):(ue.value=!1,X.value.reLoading=!1))}).finally(()=>{c.chunk_type!=3&&(X.value.reLoading=!1),h("loading",!1)})},qe=a=>{G.value=a},y=async()=>{var a;try{const N=await r();return N.data.err_msg?(T.value=N.data.err_msg,!0):((a=N.data.list)==null?void 0:a.length)>0?(R.value=N.data.list||[],B.value=N.data.list.length||0,!0):!1}catch{return T.value="请求异常，停止轮询",!0}};function ge(a){return a.split("message:")[1]}const xe=()=>{const a=async()=>{if(!await y())le=setTimeout(a,3e3);else if(ue.value=!1,X.value.reLoading=!1,le!==null&&(clearTimeout(le),le=null),se.value&&P(),T.value){let Y=ge(T.value);he.error({title:"分段失败提示",content:Y?`模型调用失败，失败原因：${Y}`:"模型调用失败"})}};a()},r=()=>kn({id:c.id,task_id:g.value}),u=s(null);let M=null;const L=({title:a,content:N,question:Y,answer:ie,images:ke},Pe)=>{M=Pe,u.value.open({title:a,content:N,question:Y,answer:ie,images:ke})},_e=({title:a,content:N,question:Y,answer:ie,images:ke})=>{(R.value[M].title!=a||R.value[M].content!=N||R.value[M].question!=Y||R.value[M].answer!=ie)&&(I=!0),R.value[M].title=a,R.value[M].content=N,R.value[M].question=Y,R.value[M].answer=ie,R.value[M].images=ke,R.value[M].word_total=ie.length+Y.length+N.length},U=a=>{he.confirm({title:"提醒",icon:t(Ce),content:"确定要删除这个片段吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){I=!0,R.value.splice(a,1)},onCancel(){}})},Q=s(""),ne=a=>{Q.value=a},_=s(!1),te=()=>{let a=X.value.formState;a=JSON.parse(JSON.stringify(a)),typeof a.separators_no=="object"&&(a.separators_no=a.separators_no.join(",")),c={...c,...a}},P=async()=>{if((B.value<=0||c.chunk_type!=G.value)&&(te(),await me()),te(),Q.value)return fe.error(Q.value);if(c.chunk_type==3&&!R.value.length)return se.value=!0,!1;g.value&&(c.ai_chunk_task_id=g.value);let a={...c,semantic_chunk_model_config_id:c.semantic_chunk_model_config_id?+c.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:c.ai_chunk_model_config_id?+c.ai_chunk_model_config_id:0,is_table_file:z.value,...J.pdfState};delete a.id;let N={id:b,word_total:B.value,split_params:JSON.stringify(a),list:JSON.stringify(R.value),...J.pdfState};a.is_qa_doc==1&&(N.qa_index_type=a.qa_index_type),_.value=!0,Mt(N).then(()=>{h("ok"),h("finish")}).finally(()=>{_.value=!1}).catch(Y=>{Y.data&&Y.data.index&&Ee(Y.data.index),h("finish")})},be=s(null),Ee=a=>{a=a-1;let N=be.value.querySelectorAll(".fragment-item");N.length>=a&&N[a].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return Ft(()=>{le&&(clearTimeout(le),le=null)}),oe({handleSaveLibFileSplit:P}),(a,N)=>{const Y=Be;return l(),v(de,null,[f.value?(l(),v("div",ko,[t(Y)])):j("",!0),n("div",yo,[n("div",bo,[n("div",So,[t(An,{excellQaLists:q.value,libFileInfo:d.value,library_type:m.value,mode:z.value,hideSave:!0,ref_key:"segmentationSettingRef",ref:X,onChange:ae,onChangeChunkType:qe,onSave:P,onValidate:ne},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),n("div",wo,[n("div",$o,[n("div",xo,[Co,n("span",qo,"共"+K(B.value)+"个分段",1)]),ye.value&&!ue.value?(l(),W(Bn,{key:0})):j("",!0),ue.value?(l(),v("div",Lo,[t(Y),E("数据处理中...")])):j("",!0),n("div",{class:"preview-box",ref_key:"previewBoxRef",ref:be},[(l(!0),v(de,null,Se(R.value,(ie,ke)=>(l(),v("div",{class:"fragment-item",key:ie.number},[t(Hn,{number:ie.number,title:ie.title,content:ie.content,total:ie.word_total,question:ie.question,answer:ie.answer,images:ie.images,onDelete:Pe=>U(ke),onEdit:Pe=>L(ie,ke)},null,8,["number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),t(Un,{ref_key:"editFragmentAlertRef",ref:u,onOk:_e},null,512)])],64)}}},Io=$e(Eo,[["__scopeId","data-v-9f322e00"]]),Ro={class:"select-box"},To=["onClick"],Mo={class:"title"},Po={class:"desc"},Fo={key:0,class:"card-switch"},zo={class:"main-content-box"},Do={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(w,{expose:oe,emit:x}){const O=Pt(),h=we(()=>{var B;return((B=O.companyInfo)==null?void 0:B.ali_ocr_switch)=="1"}),b=Ze().query,f=zt(),z=w,I=s(!1),J=s(!1),G=s(""),c=x;let X={};const ae=s([{title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。",icon:"pdf-ocr",pdf_parse_type:2},{title:"纯文本解析",desc:"只提取Pdf中的文字内容，如果文档为扫描件可能提取不到内容。",icon:"pdf-text",pdf_parse_type:1},{title:"图文解析",desc:"提取PDF文档中的图片和文字",icon:"pdf-img",pdf_parse_type:3}]),C=Re({pdf_parse_type:2,pdf_page_num:0}),H=()=>{ae.value=ae.value.filter(B=>B.pdf_parse_type!=4),c("enable")},d=s(!1),m=B=>{d.value=B},S=B=>{X={...B},C.pdf_parse_type=2,C.pdf_page_num=B.pdf_page_num,B.type==1&&(G.value=`当页(${B.pdf_page_num})重新分段`),B.type==2&&(G.value="将文档重新分段"),B.type==3&&(G.value="重新学习文档",ae.value.push({title:"阿里云OCR解析",desc:"通过阿里云文档智能接口解析提取图片和文字",icon:"ali-ocr",pdf_parse_type:4})),I.value=!0},q=()=>{window.open("#/user/aliocr")},D=B=>{if(B.pdf_parse_type==4&&!h.value)return!1;C.pdf_parse_type=B.pdf_parse_type},se=s(!1),ue=()=>{if(X.type==3){if(C.pdf_parse_type==1){f.push("/library/document-segmentation?document_id="+b.id+"&source=preview");return}se.value=!0,yn({id:b.id,pdf_parse_type:C.pdf_parse_type}).then(B=>{fe.success("重新学习成功"),(C.pdf_parse_type==2||C.pdf_parse_type==3||C.pdf_parse_type==4)&&f.push({path:"/library/details/knowledge-document",query:{id:z.detailsInfo.library_id}}),C.pdf_parse_type==1&&f.push("/library/document-segmentation?document_id="+b.id+"&source=preview"),I.value=!1}).finally(()=>{se.value=!1});return}I.value=!1,J.value=!0},g=s(null),T=()=>{se.value=!0,g.value.handleSaveLibFileSplit()},le=()=>{fe.success("保存成功"),J.value=!1,c("ok",X.type)},R=()=>{se.value=!1};return oe({show:S}),(B,ye)=>{const me=Ve,qe=he;return l(),v("div",null,[t(qe,{open:I.value,"onUpdate:open":ye[0]||(ye[0]=y=>I.value=y),title:G.value,onOk:ue,onCancel:H,width:720,confirmLoading:se.value},{default:o(()=>[n("div",Ro,[(l(!0),v(de,null,Se(ae.value,y=>(l(),v("div",{class:Dt(["select-list-item",{active:y.pdf_parse_type==C.pdf_parse_type},{disabled:y.pdf_parse_type==4&&!h.value}]),onClick:ge=>D(y),key:y.pdf_parse_type},[n("div",Mo,[t(me,{name:y.icon,style:{"font-size":"16px"}},null,8,["name"]),E(" "+K(y.title),1)]),n("div",Po,K(y.desc),1),y.pdf_parse_type==4&&!h.value?(l(),v("div",Fo,[E(" 未开启阿里云OCR "),n("div",{class:"card-switch-btn",onClick:ve(q,["stop"])},"去开启")])):j("",!0)],10,To))),128))])]),_:1},8,["open","title","confirmLoading"]),t(qe,{open:J.value,"onUpdate:open":ye[1]||(ye[1]=y=>J.value=y),onCancel:H,title:G.value,maskClosable:!1,"ok-text":d.value?"文档解析中,请稍候...":"确定",confirmLoading:se.value||d.value,onOk:T,width:1e3},{default:o(()=>[n("div",zo,[J.value?(l(),W(Io,{key:0,onOk:le,onFinish:R,onLoading:m,pdfState:C,ref_key:"documentSegmentationModalRef",ref:g},null,8,["pdfState"])):j("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},No=$e(Do,[["__scopeId","data-v-ed67085d"]]),Ke=w=>(Te("data-v-b1f3fb5c"),w=w(),Me(),w),Ao={class:"subsection-box"},Bo={class:"qa-list-box"},Ho={class:"list-item"},Uo=Ke(()=>n("div",{class:"list-label"},"问题",-1)),Qo={class:"list-content"},Jo={key:0,class:"list-item"},Go=Ke(()=>n("div",{class:"list-label"},"相似问法",-1)),jo={class:"list-content"},Vo={class:"list-item"},Zo=Ke(()=>n("div",{class:"list-label"},"答案",-1)),Wo={class:"list-content"},Ko={class:"fragment-img"},Xo=["src"],Yo={key:0,class:"status-tag"},el={key:1,class:"status-tag complete"},tl={class:"status-tag status-error"},nl={key:3,class:"status-tag running"},al={class:"right-opration"},ol={class:"hover-btn-box"},ll=["onClick"],sl=Ke(()=>n("div",null,"标记设置",-1)),il=["onClick"],cl={class:"hover-btn-box"},rl=["onClick"],ul=["onClick"],dl={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(w,{expose:oe,emit:x}){const O=x,h=w,b=(C,H)=>{let{id:d,title:m,content:S,question:q,answer:D,images:se,category_id:ue}=C,g=C.similar_questions||[];he.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${H+1}】吗?`,onOk(){return new Promise((T,le)=>{Ot({id:d,title:m,content:S,question:q,answer:D,images:se,category_id:ue,similar_questions:JSON.stringify(g)}).then(R=>{O("handleConvert",C),T()}).catch(()=>{T()})})},onCancel(){}})},f=C=>{O("openEditSubscription",C)},z=C=>{he.confirm({title:"提示",icon:t(Ce),content:"确认是否删除该分段?",onOk(){return new Promise((H,d)=>{Et({id:C}).then(m=>{fe.success("删除成功"),O("handleDelParagraph",C),H()}).catch(()=>{H()})})},onCancel(){}})},I=s([]),J=()=>{It().then(C=>{I.value=C.data||[],O("getStatrList",C.data||[])})};J();const G=s(null),c=()=>{G.value.show()},X=C=>{var d;let H=(d=I.value.filter(m=>m.id==C.category_id)[0])==null?void 0:d.type;return H?je[H]:"#F4EA2A"},ae=(C,H={})=>{Rt({id:C.id,category_id:H.id||0}).then(d=>{fe.success("设置成功"),C.category_id=H.id})};return oe({handleOpenEditModal:f}),(C,H)=>{const d=Jn,m=We,S=Be,q=st,D=it,se=ct,ue=Gn,g=ot("viewer");return l(),v("div",Ao,[t(ue,{"data-source":w.paragraphLists,pagination:!1},{default:o(()=>[t(d,{key:"id","data-index":"id",width:1148},{title:o(()=>[E("问答（共"+K(h.total)+"个）",1)]),default:o(({record:T})=>[n("div",Bo,[n("div",Ho,[Uo,n("div",Qo,K(T.question),1)]),T.similar_questions&&T.similar_questions.length?(l(),v("div",Jo,[Go,n("div",jo,K(T.similar_questions.join("/")),1)])):j("",!0),n("div",Vo,[Zo,n("div",Wo,K(T.answer),1)]),lt((l(),v("div",Ko,[(l(!0),v(de,null,Se(T.images,(le,R)=>(l(),v("img",{key:R,src:le,alt:""},null,8,Xo))),128))])),[[g]])])]),_:1}),t(d,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:o(({record:T})=>[T.status==0?(l(),v("span",Yo,[t(ee(Qn)),E(" 未转换")])):j("",!0),T.status==1?(l(),v("span",el,[t(ee(bn)),E(" 已转换")])):j("",!0),T.status==2?(l(),W(m,{key:2,placement:"top"},{title:o(()=>[n("span",null,K(T.errmsg),1)]),default:o(()=>[n("span",null,[n("span",tl,[t(ee(Sn)),E(" 转换异常")])])]),_:2},1024)):j("",!0),T.status==3?(l(),v("span",nl,[t(S,{size:"small"}),E(" 转换中")])):j("",!0)]),_:1}),t(d,{title:"操作",key:"action","data-index":"action",width:120},{default:o(({record:T,index:le})=>[n("div",al,[t(se,null,{overlay:o(()=>[t(D,null,{default:o(()=>[(l(!0),v(de,null,Se(I.value,R=>(l(),W(q,{key:R.id},{default:o(()=>[n("div",{class:"start-item",onClick:B=>ae(T,R)},[t(ee(Ge),{style:Ie({color:ee(je)[R.type]})},null,8,["style"]),n("div",null,K(R.name||"-"),1)],8,ll)]),_:2},1024))),128)),t(q,null,{default:o(()=>[n("div",{class:"start-item",onClick:c},[t(ee(Ht)),sl])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",ol,[T.category_id>0?(l(),W(ee(Ge),{key:0,onClick:R=>ae(T,{}),style:Ie({color:X(T),"font-size":"16px"})},null,8,["onClick","style"])):(l(),W(ee(At),{key:1,onClick:R=>ae(T,I.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),t(m,null,{title:o(()=>[E("重新转换")]),default:o(()=>[n("div",{class:"hover-btn-box",onClick:R=>b(T,le)},[t(ee(Ut))],8,il)]),_:2},1024),t(se,{placement:"bottomRight"},{overlay:o(()=>[t(D,null,{default:o(()=>[t(q,null,{default:o(()=>[n("div",{onClick:ve(R=>f(T),["stop"])},"编辑",8,rl)]),_:2},1024),t(q,null,{default:o(()=>[n("div",{onClick:ve(R=>z(T.id),["stop"])},"删除",8,ul)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",cl,[t(ee(Qt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),t(Bt,{onOk:J,ref_key:"classificationMarkModalRef",ref:G},null,512)])}}},_l=$e(dl,[["__scopeId","data-v-b1f3fb5c"]]),Xe=w=>(Te("data-v-f9e40d38"),w=w(),Me(),w),pl={class:"library-preview-page"},fl={class:"breadcrumb-block"},ml={class:"library-line1"},vl={class:"selct-star-box"},hl={class:"document-title-block",style:{height:"22px"}},gl={class:"title"},kl={class:"search-content-block"},yl={class:"preview-box"},bl=Xe(()=>n("span",null,"添加分段",-1)),Sl={key:0,class:"page-loading-box"},wl={class:"content-block"},$l={class:"content-block"},xl={key:1,class:"pdf-view-box"},Cl={key:0,class:"pdf-mode-switch"},ql={key:0},Ll={key:1,class:"segmentation-btn"},Ol=Xe(()=>n("div",null,"将当页重新分段",-1)),El=Xe(()=>n("div",null,"将文档重新分段",-1)),Il=Xe(()=>n("div",null,"重新学习文档",-1)),Rl={class:"view-content-box",style:{"padding-top":"60px"}},Tl=["onClick"],Ml={key:0,class:"content-box"},Pl={key:1,class:"content-box"},Fl=["innerHTML"],zl={class:"fragment-img"},Dl=["src"],Nl={class:"right-contnt-box"},Al={class:"content-block"},Bl="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Hl={__name:"library-preview",setup(w){const oe=Pt(),x=we(()=>{var e;return((e=oe.companyInfo)==null?void 0:e.neo4j_status)=="true"}),O=s(!1),h=s(null),b=s(0),f=s(0),z={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I=s([]),J=e=>{I.value=e},G=s({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),c=Ze(),X=zt(),ae=wn(),C=we(()=>S.value.is_table_file=="1"),H=we(()=>S.value.doc_type),d=we(()=>{let e=S.value.status;return!(e=="1"||e=="2")||y.value.length==0}),m=we(()=>S.value.is_qa_doc=="1"),S=s({}),q=Re({status:-1,graph_status:-1,category_id:-1}),D=s(1),se=we(()=>"/manage/getLibRawFile?id="+c.query.id+"&token="+ae.getToken),ue=()=>{X.back()},g=s(null),T=s(null);let le=-1;const R=(e,i=1)=>{let p,$;i==1?(p=".subsection-box .list-item",$=T.value):(p=".view-content-box .list-item",$=g.value);const F=document.querySelectorAll(p)[e];F.classList.add("flash-border"),le>=0&&document.querySelectorAll(p)[le].classList.remove("flash-border"),setTimeout(()=>{le=-1,F.classList.remove("flash-border")},2500),le=e,$.scrollToElement({el:F,time:1e3})},B=s(!0),ye=s(0),me=s({page:1,size:10}),qe=s({}),y=s([]),ge=s(0),xe={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},r=s(1);let u={id:c.query.id,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Bl,ai_chunk_task_id:""};const M=s(!1);let L=!0;(async()=>{Tt({id:c.query.id}).then(e=>{ye.value=e.data.library_type,S.value={...e.data,graph_switch:e.data.graph_switch=="1"&&x.value};let i=e.data.status;i==1||i==2?_():B.value=!1,u={...u,separators_no:e.data.separators_no||"11,12",chunk_size:+e.data.chunk_size||512,ai_chunk_size:+e.data.ai_chunk_size||5e3,chunk_overlap:+e.data.chunk_overlap||50,is_qa_doc:ye.value==2?1:0,question_lable:e.data.question_lable,similar_label:e.data.similar_label,answer_lable:e.data.answer_lable,question_column:e.data.question_column,similar_column:e.data.similar_column,answer_column:e.data.answer_column,enable_extract_image:e.data.enable_extract_image=="true",qa_index_type:+e.data.qa_index_type,chunk_type:+e.data.chunk_type,semantic_chunk_size:+e.data.semantic_chunk_size||512,semantic_chunk_overlap:+e.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+e.data.semantic_chunk_threshold||90,semantic_chunk_use_model:e.data.semantic_chunk_use_model||"",ai_chunk_prumpt:e.data.ai_chunk_prumpt||"",ai_chunk_model:e.data.ai_chunk_model||"",semantic_chunk_model_config_id:e.data.semantic_chunk_model_config_id>0?e.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:e.data.ai_chunk_model_config_id>0?e.data.ai_chunk_model_config_id:"",ai_chunk_task_id:e.data.ai_chunk_task_id||""},e.data.chunk_type==0&&(u={...u,separators_no:e.data.normal_chunk_default_separators_no,chunk_size:+e.data.normal_chunk_default_chunk_size,chunk_overlap:+e.data.normal_chunk_default_chunk_overlap,chunk_type:+e.data.default_chunk_type,semantic_chunk_size:+e.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+e.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+e.data.semantic_chunk_default_threshold,semantic_chunk_use_model:e.data.default_use_model||"",semantic_chunk_model_config_id:e.data.default_model_config_id>0?e.data.default_model_config_id:""}),(i==4||i==2)&&(r.value=parseInt(e.data.is_table_file))})})();const U=()=>{me.value.page=1,ge.value=0,y.value=[],_()},Q=e=>{q.category_id=e,U()},ne=(e=null)=>{me.value.page++,_(e)},_=(e=null)=>{L=!0,$t({file_id:c.query.id,...me.value,...q}).then(i=>{var k,A;B.value=!1,L=!1;let p=i.data,$=p.list||[],F=((k=p.info)==null?void 0:k.is_qa_doc)=="1"&&((A=p.info)==null?void 0:A.is_table_file)=="1";$.forEach(pe=>{pe.status_text=xe[pe.status],pe.graph_status_text=z[pe.graph_status],pe.isExcelQa=F,pe.similar_questions&&(pe.similar_questions=JSON.parse(pe.similar_questions))}),qe.value=p.info,me.value.page==1&&(y.value=[]),y.value=[...y.value,...$],ge.value=p.total,typeof e=="function"&&e()})},te=()=>{L||y.value.length>=ge.value||(ne(),h.value&&h.value.loadMore())},P=()=>{a()};let be=null;function Ee(){clearInterval(be),y.value.filter(i=>i.status==3).length?be=setInterval(()=>{a()},5e3):clearInterval(be)}const a=()=>{$t({file_id:c.query.id,page:1,size:y.value.length,...q}).then(e=>{var F,k;let i=e.data,p=i.list||[],$=((F=i.info)==null?void 0:F.is_qa_doc)=="1"&&((k=i.info)==null?void 0:k.is_table_file)=="1";p.forEach(A=>{A.status_text=xe[A.status],A.graph_status_text=z[A.graph_status],A.isExcelQa=$,A.similar_questions&&(A.similar_questions=JSON.parse(A.similar_questions))}),y.value=p,Ee()})},N=e=>{if(!e.id){me.value.page=1,_();return}let i=y.value,p=i.findIndex($=>$.id==e.id);if(p>-1){let $=i[p];$.title=e.title,$.content=e.content,$.question=e.question,$.answer=e.answer,$.images=e.images,$.category_id=e.category_id,$.word_total=e.question.length+e.answer.length+e.content.length,$.similar_questions=e.similar_questions.length?JSON.parse(e.similar_questions):[],i.splice(p,1,$),y.value=i}},Y=e=>{let i=y.value,p=i.findIndex($=>$.id==e);p>-1&&(i.splice(p,1),y.value=i,ge.value=ge.value--)},ie=s(null),ke=e=>{ie.value.showModal(JSON.parse(JSON.stringify(e)))},Pe=s(null),jt=()=>{$n({id:c.query.id}).then(()=>fe.success("操作完成"))},Vt=()=>{xn({id:c.query.id}).then(()=>fe.success("操作完成"))},ut=s(null),Zt=()=>{ut.value.show(S.value)},dt=()=>{X.push("/library/document-segmentation?document_id="+c.query.id+"&source=preview")},Wt=()=>{Pe.value.open({id:c.query.id,doc_auto_renew_frequency:S.value.doc_auto_renew_frequency})},Kt=e=>{S.value.doc_auto_renew_frequency=e},Xt=e=>{S.value.file_name=e},Yt=e=>{const i=()=>{for(let p in y.value)if(y.value[p].page_num==e){R(p);return}};if(e>y.value[y.value.length-1].page_num){fe.warning("分段数据正在加载，请稍后...");const p=()=>{e<=y.value[y.value.length-1].page_num?(fe.success("加载完成"),Je(()=>{i()})):ne(p)};ne(p)}else i()},en=(e,i)=>{f.value=i,b.value=e,y.value[y.value.length-1].page_num<e&&ne()},_t=e=>{var i;if(((i=S.value)==null?void 0:i.file_ext)=="pdf"&&D.value==1){const p=e.page_num-1,$=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[p],F=()=>{const A=$();A.classList.add("flash-border"),setTimeout(()=>A.classList.remove("flash-border"),2500),h.value.getScrollInstance().scrollToElement({el:A,time:1e3})};if($())F();else{fe.warning("PDF正在加载，请稍后...");const A=()=>{$()?(fe.success("加载完成"),F()):h.value&&h.value.loadMore()};h.value&&h.value.loadMore(A)}}else R(e.index,2)},Ye=s(1);let et=null;const Ue=s(0),tn=e=>{Ue.value=e},nn=({y:e})=>{if(!et){const p=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];et=p&&p.clientHeight}let i=Math.floor(Math.abs(e)/et)+1;Ye.value=Math.max(i,1)},tt=s(null),an=e=>{let{key:i}=e;h.value&&h.value.getScrollInstance().disable(),i==1&&tt.value.show({type:i,pdf_page_num:Ye.value}),i==2&&dt(),i==3&&tt.value.show({type:i,pdf_page_num:0})},pt=()=>{h.value&&h.value.getScrollInstance().enable()},on=()=>{pt(),U()},ft=()=>{O.value=!O.value},nt=(e,i)=>{let p=JSON.parse(JSON.stringify(e));return p.content=i,p.word_total=i.length,p},Le=s(!1),Oe=s(1),mt=({index:e,beforeContent:i,selectedContent:p,afterContent:$,isFullSelection:F})=>{const k=[...y.value];Le.value=F,Oe.value=1,F?(k.splice(e+1,0,nt(k[e],p)),k.splice(e,1)):(k[e].content=i||"",k[e].word_total=i.length||0,$.trim()&&k.splice(e+1,0,nt(k[e],$)),k.splice(e+1,0,nt(k[e],p)),k[e+1].images=[]),y.value=k,Fe(k,e)},vt=({index:e,beforeContent:i,selectedContent:p,afterContent:$,isFullSelection:F})=>{const k=[...y.value];Le.value=F,Oe.value=2,F?(k[e+1].content=p+k[e+1].content,k[e+1].word_total+=p.length,k.splice(e,1),y.value=k,Fe(k,e)):(k[e].content=i||"",k[e].word_total=i.length||0,k[e+1].content=p+k[e+1].content,$.trim()&&(k[e].content+=$||"",k[e].word_total+=$.length||0),y.value=k,Fe(k,e+1))},ht=({index:e,beforeContent:i,selectedContent:p,afterContent:$,isFullSelection:F})=>{const k=[...y.value];Le.value=F,Oe.value=3,F?(k[e-1].content+=p,k[e-1].word_total+=p.length,k.splice(e,1),y.value=k,Fe(k,e)):(k[e].content=i||"",k[e].word_total=i.length||0,k[e-1].content+=p,$.trim()&&(k[e].content+=$||"",k[e].word_total+=$.length||0),y.value=k,Fe(k,e-1))},gt=({index:e,beforeContent:i,afterContent:p,isFullSelection:$})=>{const F=[...y.value];Le.value=$,Oe.value=4,$?F.splice(e,1):(F[e].content=i||"",F[e].word_total=i.length||0,p.trim()&&(F[e].content+=p||"",F[e].word_total+=p.length||0)),y.value=F,Fe(F,e)};function ln(e,i,p={},$){let F=$+1;if(!Array.isArray(e)||!Array.isArray(i))return JSON.stringify([]);const k=e.map((A,pe)=>{const V={};for(const Z of i){const De=p[Z]||Z,re=A[De];if(Object.prototype.hasOwnProperty.call(A,De))if(Z==="number")V[Z]=pe+1;else if(Z==="page_num"||Z==="word_total")V[Z]=+re;else if(Z==="content"){if(!re)return null;V[Z]=re}else Z==="images"?Oe.value==1?Le.value?(F==V.number,V[Z]=re):F+1==V.number?V[Z]=[]:V[Z]=re:Oe.value==2?(Le.value,F==V.number,V[Z]=re):Oe.value==3?Le.value?(F-1==V.number,V[Z]=re):(F==V.number,V[Z]=re):Oe.value==4&&(Le.value,V[Z]=re):V[Z]=re}return V}).filter(A=>A!==null&&A.content!==void 0&&A.content!=="");return JSON.stringify(k)}const sn={similar_question_list:"similar_questions"},Fe=async(e,i)=>{let p={...u,semantic_chunk_model_config_id:u.semantic_chunk_model_config_id?+u.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:u.ai_chunk_model_config_id?+u.ai_chunk_model_config_id:0,is_table_file:r.value};delete p.id;let $={id:c.query.id,word_total:ge.value,split_params:JSON.stringify(p),list:ln(e,["number","page_num","title","content","question","similar_question_list","answer","word_total","images"],sn,i)};p.is_qa_doc==1&&($.qa_index_type=p.qa_index_type),M.value=!0,Mt($).then(F=>{fe.success("操作成功");const k=F.data;for(let A=0;A<k.length;A++){const pe=k[A],V=y.value[A];if(A<y.value.length)V.id=pe.toString(),V.status="0",V.status_text=xe[V.status];else break}}).finally(()=>{M.value=!1})};return Ae(()=>{c.query.graph_status&&(q.graph_status=c.query.graph_status,U())}),(e,i)=>{var yt,bt,St;const p=Cn("router-link"),$=Vn,F=jn,k=Ve,A=Lt,pe=Jt,V=Gt,Z=st,De=it,re=ct,cn=Zn,rn=Be,Qe=We,kt=Kn,un=Wn,dn=ot("viewer");return l(),v("div",pl,[n("div",fl,[t(F,null,{default:o(()=>[t($,null,{default:o(()=>[t(p,{to:"/library/list"},{default:o(()=>[E(" 知识库管理 ")]),_:1})]),_:1}),t($,null,{default:o(()=>[t(p,{to:{path:"/library/details/knowledge-document",query:{id:S.value.library_id}}},{default:o(()=>[n("div",ml,K(S.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),t($,null,{default:o(()=>[E("知识库详情")]),_:1})]),_:1}),n("div",vl,[t(Ln,{startLists:I.value,onChange:Q},null,8,["startLists"])])]),n("div",hl,[t(ee(Xn),{onClick:ue}),n("span",gl,K(S.value.file_name),1),t(po,{detailsInfo:S.value},null,8,["detailsInfo"])]),n("div",kl,[n("div",yl,[O.value?(l(),W(A,{key:1,onClick:i[1]||(i[1]=ce=>ft())},{default:o(()=>[t(k,{class:"preview-box-icon",name:"expand"}),E(" 展开预览")]),_:1})):(l(),W(A,{key:0,onClick:i[0]||(i[0]=ce=>ft())},{default:o(()=>[t(k,{class:"preview-box-icon",name:"put-away"}),E(" 收起预览")]),_:1}))]),t(cn,null,{default:o(()=>[t(V,{value:q.status,"onUpdate:value":i[2]||(i[2]=ce=>q.status=ce),placeholder:"请选择",style:{width:"160px"},onChange:U},{default:o(()=>[t(pe,{value:-1},{default:o(()=>[E("全部嵌入状态")]),_:1}),(l(),v(de,null,Se(xe,(ce,ze)=>t(pe,{key:ce,value:ze},{default:o(()=>[E(K(ce),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),S.value.graph_switch?(l(),W(V,{key:0,value:q.graph_status,"onUpdate:value":i[3]||(i[3]=ce=>q.graph_status=ce),placeholder:"请选择",onChange:U,style:{width:"160px"}},{default:o(()=>[t(pe,{value:-1},{default:o(()=>[E("全部知识图谱状态")]),_:1}),(l(),v(de,null,Se(z,(ce,ze)=>t(pe,{key:ce,value:ze},{default:o(()=>[E(K(ce),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):j("",!0),t(re,null,{overlay:o(()=>[t(De,null,{default:o(()=>[t(Z,{onClick:jt},{default:o(()=>[E("重新嵌入向量")]),_:1}),S.value.graph_switch?(l(),W(Z,{key:0,onClick:Vt},{default:o(()=>[E("重新抽取知识图谱")]),_:1})):j("",!0),t(Z,{onClick:Zt},{default:o(()=>[E("重命名")]),_:1}),H.value==2?(l(),W(Z,{key:1,onClick:Wt},{default:o(()=>[E("设置更新频率")]),_:1})):j("",!0)]),_:1})]),default:o(()=>[t(A,null,{default:o(()=>[E("其他操作 "),t(ee(Ct))]),_:1})]),_:1}),H.value!=3?(l(),W(A,{key:1,onClick:dt},{default:o(()=>[E("重新分段")]),_:1})):j("",!0),t(A,{onClick:i[4]||(i[4]=ce=>ke({})),type:"primary"},{icon:o(()=>[t(ee(Nt))]),default:o(()=>[bl]),_:1})]),_:1})]),B.value?(l(),v("div",Sl,[t(rn)])):(l(),v(de,{key:1},[m.value?(l(),v(de,{key:0},[d.value?(l(),W(at,{key:0,onOpenEditSubscription:ke})):(l(),W(Ne,{key:1,scrollbar:{minSize:0},onOnScrollEnd:te},{default:o(()=>[n("div",wl,[t(_l,{ref:"subsectionBoxRef",total:ge.value,paragraphLists:y.value,detailsInfo:S.value,onOpenEditSubscription:ke,onHandleDelParagraph:Y,onHandleConvert:P,onGetStatrList:J},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(l(),v(de,{key:1},[C.value||H.value==3?(l(),v(de,{key:0},[d.value?(l(),W(at,{key:0,onOpenEditSubscription:ke})):(l(),W(Ne,{key:1,scrollbar:{minSize:0},onOnScrollEnd:te,disableMouse:!0},{default:o(()=>[n("div",$l,[t(qt,{ref:"subsectionBoxRef",total:ge.value,detailsInfo:S.value,paragraphLists:y.value,onOpenEditSubscription:ke,onHandleDelParagraph:Y,onHandleConvert:P,onHandleScrollTargetPage:_t,onGetStatrList:J,onHandleSplit:mt,onHandleSplitNext:vt,onHandleSplitUp:ht,onHandleSplitDelete:gt},null,8,["total","detailsInfo","paragraphLists"])])]),_:1}))],64)):(l(),v("div",xl,[n("div",{class:Dt(["view-content-wrap",{collapsed:O.value}])},[((yt=S.value)==null?void 0:yt.file_ext)=="pdf"?(l(),v("div",Cl,[t(un,{value:D.value,"onUpdate:value":i[5]||(i[5]=ce=>D.value=ce)},{default:o(()=>[t(kt,{value:1},{default:o(()=>[t(Qe,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:o(()=>[E(" 原文预览 "),D.value==1&&Ue.value>0?(l(),v("span",ql,"("+K(Ye.value)+" / "+K(Ue.value)+")",1)):j("",!0)]),_:1})]),_:1}),t(kt,{value:2},{default:o(()=>[E("纯文本预览")]),_:1})]),_:1},8,["value"])])):j("",!0),((bt=S.value)==null?void 0:bt.file_ext)=="pdf"?(l(),v("div",Ll,[t(re,null,{overlay:o(()=>[t(De,{onClick:an},{default:o(()=>[D.value==1&&Ue.value>0?(l(),W(Z,{key:1},{default:o(()=>[t(Qe,{placement:"right",title:"将当前页重新解析并分段"},{default:o(()=>[Ol]),_:1})]),_:1})):j("",!0),(l(),W(Z,{key:2},{default:o(()=>[t(Qe,{placement:"right",title:"将整个文档重新分段，注意，重新分段并不会重新提取文档的内容，只是将内容重新分段。"},{default:o(()=>[El]),_:1})]),_:1})),(l(),W(Z,{key:3},{default:o(()=>[t(Qe,{placement:"right",title:"将整个文档重新学习，包含重新解析并提取文档内容，重新分段。"},{default:o(()=>[Il]),_:1})]),_:1}))]),_:1})]),default:o(()=>[t(A,null,{default:o(()=>[E(" 重新分段 "),t(ee(Ct))]),_:1})]),_:1})])):j("",!0),((St=S.value)==null?void 0:St.file_ext)=="pdf"&&D.value==1?(l(),W(ho,{key:2,ref_key:"pdfRef",ref:h,class:"scroll-box pdf-render-box",source:se.value,onSelect:Yt,onScroll:nn,onRendered:en,onGetTotalPage:tn},null,8,["source"])):(l(),W(Ne,{key:3,scrollbar:G.value,ref_key:"leftScrollRef",ref:g,class:"scroll-box",onOnScrollEnd:te},{default:o(()=>[n("div",Rl,[(l(!0),v(de,null,Se(y.value,(ce,ze)=>(l(),v("div",{class:"list-item",onClick:wt=>R(ze),key:ze},[ce.question?(l(),v("div",Ml,K(ce.question),1)):j("",!0),ce.answer?(l(),v("div",Pl,K(ce.answer),1)):j("",!0),n("div",{class:"content-box",innerHTML:ce.content},null,8,Fl),lt((l(),v("div",zl,[(l(!0),v(de,null,Se(ce.images,(wt,_n)=>(l(),v("img",{key:_n,src:wt,alt:""},null,8,Dl))),128))])),[[dn]])],8,Tl))),128))])]),_:1},8,["scrollbar"]))],2),n("div",Nl,[d.value?(l(),W(at,{key:0,onOpenEditSubscription:ke})):(l(),W(Ne,{key:1,scrollbar:G.value,disableMouse:!0,ref_key:"rightScrollRef",ref:T,onOnScrollEnd:te},{default:o(()=>[n("div",Al,[t(qt,{ref:"subsectionBoxRef",total:ge.value,detailsInfo:S.value,paragraphLists:y.value,onOpenEditSubscription:ke,onHandleDelParagraph:Y,onHandleConvert:P,onHandleScrollTargetPage:_t,onGetStatrList:J,onHandleSplit:mt,onHandleSplitNext:vt,onHandleSplitUp:ht,onHandleSplitDelete:gt},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),t(On,{detailsInfo:S.value,onHandleEdit:N,ref_key:"editSubscriptionRef",ref:ie},null,8,["detailsInfo"]),t(fo,{onOk:Kt,ref_key:"updateFrequencyRef",ref:Pe},null,512),t(Nn,{onOk:Xt,ref_key:"renameModalRef",ref:ut},null,512),t(No,{onOk:on,onEnable:pt,detailsInfo:S.value,ref_key:"reSegmentationPageRef",ref:tt},null,8,["detailsInfo"])])}}},mi=$e(Hl,[["__scopeId","data-v-f9e40d38"]]);export{mi as default};
