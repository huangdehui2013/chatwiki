import{C as _t}from"./cu-scroll-DUDOFjFZ.js";import{A as rt,b as de,k as B,d as Re,M as ee,f as Te,B as ze,e as ct,bf as pt,b2 as _e,S as ie}from"../../index-DJqZYlN8.js";import{k as t,a4 as me,a5 as fe,e as h,B as Y,M as s,N as u,S as a,W as e,V as mt,u as q,a7 as p,Q as I,F as T,$ as se,a6 as Ne,Z as F,aa as ce,Y as c,a1 as ve,a2 as he,b as Ue,x as ft,D as vt,G as ht,a0 as gt,H as yt}from"./vue-chunks-Dpmhapcm.js";import{a as kt}from"./dayjs-BAOQ3IvD.js";import{i as ue,r as bt,j as wt,k as xt,l as Ct,m as $t}from"./index-CQKu1YIs.js";import{U as Pe}from"./upload-input-DSOBmd0V.js";import{t as Me}from"./validate-8MtiUsxW.js";import{F as pe,_ as Ee}from"./index-BearFCS_.js";import"./index-9XFVXge0.js";import{I as ge}from"./Input-k3gxptQd.js";import"./index-Dk60SqR7.js";import{R as qt,_ as St}from"./RadioButton-BdTnsnL8.js";import{M as Lt}from"./model-select-BawuzGA8.js";import{O as Ot}from"./open-grapg-modal-t7pSNHCy.js";import{D as Ft}from"./DownOutlined-D5t3juQ7.js";import{U as It}from"./UpOutlined-BLzSJSuk.js";import{_ as Ut}from"./index-DyP1V5nr.js";import{S as Ge,_ as Ve}from"./index-DT9vq-9c.js";import{R as Mt}from"./rename-modal-DUchpV8j.js";import{C as Dt}from"./index-D7LiUNoj.js";import{M as Rt}from"./MoreOutlined-xKX0PWgi.js";import{_ as Tt,M as zt}from"./index-BW4jDb4d.js";import"./index-CUiqpg-W.js";import{D as Nt}from"./dropdown-CmzzPYoT.js";import{S as Pt}from"./index-2EWY1GCt.js";import{_ as Et}from"./index-B589YBy0.js";import{P as Gt}from"./PlusOutlined-CTNlEK-E.js";import{S as Vt}from"./SearchOutlined-C4P1S4P5.js";import{C as re}from"./ClockCircleFilled-CFbZYi83.js";import{S as At}from"./SyncOutlined-CFfWYm0i.js";import{_ as jt}from"./index-Bpgeg3Jc.js";import{_ as Bt}from"./index-D7DELBhV.js";import{_ as Ht}from"./index-BY-bgrX3.js";import{a as Qt}from"./index-B3bBS2VZ.js";import{_ as Yt}from"./TextArea-DEZsPG5C.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs--NVn7pjl.js";import"./crypto-js-DjHh3pn1.js";import"./index-DzhuYAPB.js";import"./InboxOutlined-CLEfOrAN.js";import"./index-O15OSOpm.js";import"./partition-DekNjavo.js";import"./Trigger-DcF6kXOl.js";import"./Password-DASsPHld.js";import"./inputProps-B4Qz7YgH.js";import"./CheckOutlined-D8sWUycq.js";import"./useRefs-CxyIWkWE.js";import"./collapseMotion-DmHD1G9F.js";import"./FormItemContext-DcHP2mNJ.js";import"./isPlainObject--mHlhHEN.js";import"./responsiveObserve-D_TTA_LO.js";import"./QuestionCircleOutlined-D2lOE5qu.js";import"./index-DGofXs4a.js";import"./Search-CxIvru6q.js";import"./statusUtils-Bnl8Rf7N.js";import"./Checkbox-DQSCt5wV.js";import"./index-Cd8_BaNA.js";import"./slide-B4S8cqER.js";import"./index-Bn-6W96d.js";import"./move-B1-eDBNJ.js";import"./index-DaFSI5Qu.js";import"./shallowequal-KOHJRfiy.js";import"./Dropdown-DicWDWIK.js";import"./RightOutlined-CJJrtf85.js";import"./colors-CZV0Zir8.js";import"./index-DLehNBk6.js";import"./index-NxOBHTpX.js";import"./useMaxLevel-ChHJkfrX.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-BBd11KLM.js";import"./CaretDownOutlined-8hpeo-8F.js";var Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M742 318V184h86c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h86v134c0 81.5 42.4 153.2 106.4 194-64 40.8-106.4 112.5-106.4 194v134h-86c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h632c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-86V706c0-81.5-42.4-153.2-106.4-194 64-40.8 106.4-112.5 106.4-194z"}}]},name:"hourglass",theme:"filled"};const Xt=Jt;function De(f){for(var x=1;x<arguments.length;x++){var C=arguments[x]!=null?Object(arguments[x]):{},S=Object.keys(C);typeof Object.getOwnPropertySymbols=="function"&&(S=S.concat(Object.getOwnPropertySymbols(C).filter(function(R){return Object.getOwnPropertyDescriptor(C,R).enumerable}))),S.forEach(function(R){Wt(f,R,C[R])})}return f}function Wt(f,x,C){return x in f?Object.defineProperty(f,x,{value:C,enumerable:!0,configurable:!0,writable:!0}):f[x]=C,f}var ye=function(x,C){var S=De({},x,C.attrs);return t(rt,De({},S,{icon:Xt}),null)};ye.displayName="HourglassFilled";ye.inheritAttrs=!1;const Zt=ye,Kt={class:"form-box"},ea={class:"upload-document-type-box"},ta=["onClick"],aa={class:"right-block"},oa={class:"title-block"},sa={class:"title-text"},la={class:"desc"},na={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(f,{expose:x,emit:C}){const S=me(),R=fe(),X=pe.useForm,L=h(!1),z=h("添加自定义文档"),O=f,k=Y({library_id:R.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),$=h([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),l=d=>{k.qa_index_type=d},v=Y({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:W,validate:N,validateInfos:E}=X(k,v),te=()=>{L.value=!0,W(),k.file_name="",k.is_qa_doc=0,k.qa_index_type=1,O.libraryInfo.type==2&&(k.is_qa_doc=1)},G=h(!1),Q=()=>{N().then(()=>{let d={...ce(k)};G.value=!0,ue(d).then(_=>{B.success(`${z.value}成功`),L.value=!1,S.push("/library/preview?id="+_.data.file_ids[0])}).finally(()=>{G.value=!1})})};return x({add:te}),(d,_)=>{const M=ge,V=Ee,A=qt,Z=St,K=Re,r=pe,P=ee;return s(),u("div",null,[t(P,{open:L.value,"onUpdate:open":_[2]||(_[2]=b=>L.value=b),title:z.value,onOk:Q,width:"472px",confirmLoading:G.value},{default:a(()=>[e("div",Kt,[t(r,{layout:"vertical"},{default:a(()=>[t(V,mt({label:"文档名称"},q(E).file_name),{default:a(()=>[t(M,{type:"text",placeholder:"请输入文档名称",value:k.file_name,"onUpdate:value":_[0]||(_[0]=b=>k.file_name=b)},null,8,["value"])]),_:1},16),p("",!0),k.is_qa_doc==1?(s(),I(V,{key:1,label:"索引方式",required:""},{default:a(()=>[e("div",ea,[(s(!0),u(T,null,se($.value,b=>(s(),u("div",{class:Ne(["type-item",{active:k.qa_index_type==b.value}]),key:b.value,onClick:be=>l(b.value)},[e("div",aa,[e("div",oa,[t(K,{name:k.qa_index_type==b.value?b.iconNameActive:b.iconName},null,8,["name"]),e("div",sa,F(b.title),1)]),e("div",la,F(b.desc),1)]),k.qa_index_type==b.value?(s(),I(K,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):p("",!0)],10,ta))),128))])]),_:1})):p("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},ia=de(na,[["__scopeId","data-v-80f3643f"]]),J=f=>(ve("data-v-f10640ce"),f=f(),he(),f),ua={class:"alert-box"},da=J(()=>e("div",null,[c(" 通过word或者EXce形式导入问答对，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),c("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),c("创建导入文档 ")],-1)),_a=J(()=>e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1)),ra={class:"upload-file-box"},ca={key:0,class:"hight-set"},pa={key:0,class:"set-box"},ma={class:"form-item"},fa=J(()=>e("div",{class:"form-item-label"},"问题所在列：",-1)),va={class:"form-item-body"},ha={class:"form-item"},ga=J(()=>e("div",{class:"form-item-label"},"相似问法所在列：",-1)),ya={class:"form-item-body"},ka={class:"form-item"},ba=J(()=>e("div",{class:"form-item-label"},"答案所在列：",-1)),wa={class:"form-item-body"},xa={key:1,class:"set-box"},Ca={class:"form-item"},$a=J(()=>e("div",{class:"form-item-label"},"问题开始标识符：",-1)),qa={class:"form-item-body"},Sa={class:"form-item"},La=J(()=>e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),Oa={class:"form-item-body"},Fa={class:"form-item"},Ia=J(()=>e("div",{class:"form-item-label"},"答案开始标识符：",-1)),Ua={class:"form-item-body"},Ma={__name:"qa-upload-modal",emits:["ok"],setup(f,{expose:x,emit:C}){const S=me(),X=fe().query,L=h(!1),z=h(!1),O=h([]),k=C,$=h([]),l=Y({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问题："}),v=h(!0),W=()=>{L.value=!0},N=()=>{let d=new FormData;O.value.forEach(_=>{d.append("library_files",_)}),bt(d).then(_=>{let M=[];for(let V in _.data)M.push({lable:_.data[V],value:V});$.value=M})},E=()=>{if(O.value.length==0){B.error("请选择文件");return}z.value=!0;let d=new FormData;d.append("library_id",X.id);let _=!1;O.value.forEach(M=>{(M.name.includes(".xlsx")||M.name.includes(".csv"))&&(_=!0),d.append("library_files",M)}),_?(d.append("question_column",l.question_column),d.append("answer_column",l.answer_column),d.append("similar_column",l.similar_column)):(d.append("question_lable",l.question_lable),d.append("answer_lable",l.answer_lable),d.append("similar_label",l.similar_label)),d.append("is_qa_doc",1),ue(d).then(M=>{k("ok"),L.value=!1,O.value=[],z.value=!1,_&&S.push("/library/document-segmentation?document_id="+M.data.file_ids[0])}).catch(()=>{z.value=!1})},te=()=>{O.value=[]},G=h(1),Q=d=>{l.question_column=void 0,l.answer_column=void 0,l.similar_column=void 0,l.question_lable="问题：",l.answer_lable="答案：",l.similar_label="相似问题：",O.value=d,d&&d.length>0&&(d[0].type.includes(".document")?G.value=2:(G.value=1,N()))};return x({show:W}),(d,_)=>{const M=Ut,V=Ge,A=Ve,Z=ge,K=ee;return s(),u("div",null,[t(K,{width:680,open:L.value,"onUpdate:open":_[8]||(_[8]=r=>L.value=r),"confirm-loading":z.value,maskClosable:!1,title:"上传文档",onOk:E,onCancel:te},{default:a(()=>[e("div",ua,[t(M,{"show-icon":""},{message:a(()=>[da,_a]),_:1})]),e("div",ra,[t(Pe,{type:2,value:O.value,"onUpdate:value":_[0]||(_[0]=r=>O.value=r),onChange:Q},null,8,["value"])]),O.value.length>0?(s(),u("div",ca,[e("a",{onClick:_[1]||(_[1]=r=>v.value=!v.value)},[c("高级设置： "),v.value?(s(),I(q(It),{key:1})):(s(),I(q(Ft),{key:0}))]),v.value?(s(),u(T,{key:0},[G.value==1?(s(),u("div",pa,[e("div",ma,[fa,e("div",va,[t(A,{value:l.question_column,"onUpdate:value":_[2]||(_[2]=r=>l.question_column=r),placeholder:"请选择列名",style:{width:"100%"}},{default:a(()=>[(s(!0),u(T,null,se($.value,r=>(s(),I(V,{value:r.value,key:r.value},{default:a(()=>[c(F(r.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",ha,[ga,e("div",ya,[t(A,{value:l.similar_column,"onUpdate:value":_[3]||(_[3]=r=>l.similar_column=r),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:a(()=>[(s(!0),u(T,null,se($.value,r=>(s(),I(V,{value:r.value,key:r.value},{default:a(()=>[c(F(r.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",ka,[ba,e("div",wa,[t(A,{value:l.answer_column,"onUpdate:value":_[4]||(_[4]=r=>l.answer_column=r),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:a(()=>[(s(!0),u(T,null,se($.value,r=>(s(),I(V,{value:r.value,key:r.value},{default:a(()=>[c(F(r.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):p("",!0),G.value==2?(s(),u("div",xa,[e("div",Ca,[$a,e("div",qa,[t(Z,{placeholder:"请输入标识符",value:l.question_lable,"onUpdate:value":_[5]||(_[5]=r=>l.question_lable=r)},null,8,["value"])])]),e("div",Sa,[La,e("div",Oa,[t(Z,{placeholder:"请输入标识符",value:l.similar_label,"onUpdate:value":_[6]||(_[6]=r=>l.similar_label=r)},null,8,["value"])])]),e("div",Fa,[Ia,e("div",Ua,[t(Z,{placeholder:"请输入标识符",value:l.answer_lable,"onUpdate:value":_[7]||(_[7]=r=>l.answer_lable=r)},null,8,["value"])])])])):p("",!0)],64)):p("",!0)])):p("",!0)]),_:1},8,["open","confirm-loading"])])}}},Da=de(Ma,[["__scopeId","data-v-f10640ce"]]),Ra="/assets/img/guide-image-DSu20zRj.png",ke=f=>(ve("data-v-33a87814"),f=f(),he(),f),Ta={class:"container"},za={class:"guide-content"},Na=ke(()=>e("img",{src:Ra,alt:"操作引导",class:"guide-image"},null,-1)),Pa={class:"content-box"},Ea=ke(()=>e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),Ga=ke(()=>e("div",{class:"content-check"},"不再显示此提示",-1)),Va={__name:"guide-learning-tips",setup(f,{expose:x}){const C=Te(),S=h(!1),R=h(!1),X=h(""),L=()=>{setTimeout(()=>{S.value=!0},500)},z=()=>{C.setGuideLearningTips(R.value),S.value=!1},O=()=>{C.setGuideLearningTips(R.value),S.value=!1};return x({show:L}),(k,$)=>{const l=Dt,v=ze,W=ee;return s(),u("div",Ta,[t(W,{open:S.value,"onUpdate:open":$[1]||($[1]=N=>S.value=N),title:X.value,onOk:z,onCancel:O,width:"472px"},{footer:a(()=>[t(v,{type:"primary",onClick:z},{default:a(()=>[c("我知道了")]),_:1})]),default:a(()=>[e("div",za,[Na,e("div",Pa,[Ea,t(l,{checked:R.value,"onUpdate:checked":$[0]||($[0]=N=>R.value=N)},{default:a(()=>[Ga]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},Aa=de(Va,[["__scopeId","data-v-33a87814"]]),H=f=>(ve("data-v-b95cceb2"),f=f(),he(),f),ja={class:"details-library-page"},Ba={class:"list-tools"},Ha={class:"tools-items"},Qa={class:"tool-item"},Ya={class:"dropdown-btn-menu"},Ja=H(()=>e("div",{class:"title"},"本地文档",-1)),Xa={key:0,class:"desc"},Wa={key:1,class:"desc"},Za={class:"dropdown-btn-menu"},Ka=H(()=>e("div",{class:"title"},"在线数据",-1)),eo=H(()=>e("div",{class:"desc"},"获取在线网页内容",-1)),to={class:"dropdown-btn-menu"},ao=H(()=>e("div",{class:"title"},"自定义文档",-1)),oo=H(()=>e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1)),so=H(()=>e("span",null,"添加内容",-1)),lo=H(()=>e("span",null,"嵌入模型：",-1)),no=H(()=>e("span",null,"生成知识图谱：",-1)),io={class:"tool-item"},uo={class:"list-content"},_o={key:0,class:"doc-name-td"},ro=["onClick"],co={key:0},po={key:1},mo={key:0,class:"url-remark"},fo={key:0,class:"status-tag running"},vo={key:1,class:"status-tag running"},ho={key:2,class:"status-tag complete"},go={class:"status-tag status-error"},yo=["onClick"],ko={class:"status-tag status-error"},bo={class:"status-tag"},wo=["onClick"],xo={key:6,class:"status-tag"},Co={key:7,class:"status-tag running"},$o={class:"status-tag error"},qo={class:"status-tag"},So=["onClick"],Lo={key:1,class:"status-tag running"},Oo={key:2,class:"status-tag complete"},Fo={class:"status-tag error"},Io=["onClick"],Uo={class:"zm-line1 reason-text"},Mo={key:4,class:"status-tag running"},Do={class:"status-tag warning"},Ro={class:"reason-text"},To=["onClick"],zo={key:0},No={key:1},Po={key:0},Eo={key:1},Go=["onClick"],Vo=["onClick"],Ao=H(()=>e("span",null,"删除",-1)),jo={class:"upload-file-box"},Bo={class:"select-card-box"},Ho=["onClick"],Qo={class:"card-title"},Yo={class:"card-desc"},Jo={__name:"knowledge-document",setup(f){const x=ct(),C=Ue(()=>{var o;return((o=x.companyInfo)==null?void 0:o.neo4j_status)=="true"}),S=Te(),R=[{key:2,title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"}],X=fe(),L=me(),z=X.query,O=h(null),k=h(null),$=h(!1),l=h({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});Y({selectedRowKeys:[]});const v=Y({use_model:"",model_config_id:""}),W=(o,i)=>{let g=i.modelName,U=i.modelId;Q.value.length>0?ee.confirm({title:`确定切换模型为${g}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){v.use_model=g,v.model_config_id=U,N()},onCancel(){}}):(v.use_model=g,v.model_config_id=U,N())},N=(o=!0,i=null)=>{xt({...ce(l.value),use_model:v.use_model,model_config_id:v.model_config_id}).then(()=>{l.value.use_model=v.use_model,l.value.model_config_id=v.model_config_id,typeof i=="function"&&i(),o&&B.success("保存成功")})},E=h([]),te=o=>{E.value=o,G()},G=()=>{if(!l.value.id){setTimeout(()=>{G()},100);return}if(E.value.length>0&&!l.value.use_model){let o=null,i=null;for(let g of E.value)if(g.model_define==="chatwiki"){o=g;for(let U of o.children)if(U.name==="text-embedding-v2"){i=U;break}break}o||(o=E.value[0],i=o.children[0]),o&&(v.use_model=i.name,v.model_config_id=i.model_config_id,N(!1))}},Q=h([]),d=Y({library_id:z.id,file_name:void 0,page:1,size:10,total:0}),_=h([]),M=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:450},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:180},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",width:100}],V=o=>{d.page=o.current,d.size=o.pageSize,P()},A=()=>{d.page=1,P()};let Z=!1;const K=({id:o})=>{Q.value.length==1&&(Z=!0),Ct({id:o}).then(()=>{Z&&d.page>1&&d.page--,P(),B.success("删除成功")})},r=(o,i={})=>{if(o.status=="4")return L.push({path:"/library/document-segmentation",query:{document_id:o.id}});if(o.status=="3"&&l.value.type!=2)return B.error("学习失败,不可预览");if(o.status=="0")return B.error("转换中,稍候可预览");if(o.status=="6")return B.error("获取中,不可预览");if(o.status=="7")return B.error("获取失败,不可预览");L.push({name:"libraryPreview",query:{id:o.id,...i}})},P=()=>{wt(ce(d)).then(o=>{let i=o.data.info;!v.use_model&&v.use_model!=i.use_model&&(v.use_model=i.use_model,v.model_config_id=i.model_config_id),l.value={...i},$.value=i.graph_switch==1,i.graph_switch=="0"||!C.value?_.value=M.filter(D=>!["graph_status","graph_entity_count"].includes(D.key)):_.value=M;let g=o.data.list||[];d.total=o.data.total;let U=!1;Q.value=g.map(D=>(["1","6","0","5","4"].includes(D.status)&&(U=!0),D.file_size_str=pt(D.file_size),D.update_time=kt(D.update_time*1e3).format("YYYY-MM-DD HH:mm"),D)),U&&be(),!U&&clearInterval(b.value)})},b=h(null),be=()=>{clearInterval(b.value),b.value=setInterval(()=>{P()},1e3*5)},we=h(null),Ae=o=>{if(E.value.length==0){ee.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){L.push({path:"/user/model"})}});return}let{key:i}=o;i==1&&Qe(),i==2&&je(),i==3&&we.value.add()},y=Y({open:!1,urls:"",library_id:z.id,doc_auto_renew_frequency:1,confirmLoading:!1,rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(o,i)=>Me(i)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),je=()=>{y.open=!0,y.confirmLoading=!1,y.urls="",y.doc_auto_renew_frequency=1},xe=h(null),Be=()=>{xe.value.validate().then(()=>{y.confirmLoading=!0,ue({library_id:y.library_id,urls:JSON.stringify(Me(y.urls)),doc_auto_renew_frequency:y.doc_auto_renew_frequency,doc_type:2}).then(()=>{y.open=!1,y.confirmLoading=!1,A()})}).catch(()=>{y.confirmLoading=!1})},He=()=>{y.open=!1},w=Y({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),Ce=Ue(()=>w.fileList.filter(o=>o.type==="application/pdf").length>0),$e=h(null),Qe=()=>{if(l.value.type==2){$e.value.show();return}w.fileList=[],w.open=!0},Ye=()=>{w.fileList=[]},Je=o=>{w.fileList=o},Xe=()=>{if(O.value&&!S.getGuideLearningTips&&O.value.show(),w.fileList.length==0){B.error("请选择文件");return}w.confirmLoading=!0;let o=new FormData;o.append("library_id",d.library_id);let i=!1;w.fileList.forEach(g=>{(g.name.includes(".xlsx")||g.name.includes(".csv"))&&(i=!0),o.append("library_files",g)}),Ce.value&&o.append("pdf_parse_type",w.pdf_parse_type),ue(o).then(g=>{P(),w.open=!1,w.fileList=[],w.confirmLoading=!1,i&&g.data.file_ids.length==1&&L.push("/library/document-segmentation?document_id="+g.data.file_ids[0])}).catch(()=>{w.confirmLoading=!1})},qe=h(null),We=o=>{qe.value.show(o)},Ze=o=>{L.push({path:"/library/document-segmentation",query:{document_id:o.id}})},Se=o=>{$t({id:o.id}).then(()=>{P()})},Ke=()=>{if($.value){$.value=!1;let o={graph_model_config_id:l.value.graph_model_config_id,graph_use_model:l.value.graph_use_model};if((!o.graph_model_config_id||!o.graph_use_model)&&E.value.length>0){let g=E.value[0].children[0];o.graph_use_model=g.name,o.graph_model_config_id=g.model_config_id}k.value.show(o)}else l.value.graph_switch=0,N(!1,()=>{P()})},et=o=>{$.value=!0,l.value.graph_switch=1,l.value.graph_model_config_id=o.graph_model_config_id,l.value.graph_use_model=o.graph_use_model,N(!1,()=>{P()})},tt=o=>{w.pdf_parse_type=o.key};return ft(()=>{P()}),vt(()=>{b.value&&clearInterval(b.value)}),(o,i)=>{const g=Re,U=jt,D=Tt,Le=zt,at=ze,Oe=Nt,ot=Bt,st=ge,le=Pt,ae=Ht,lt=Et,nt=Qt,it=_t,ne=Ee,Fe=pe,Ie=ee,ut=Yt,oe=Ge,dt=Ve;return s(),u("div",ja,[t(it,{scrollbar:!1},{default:a(()=>[e("div",Ba,[e("div",Ha,[e("div",Qa,[t(Oe,{trigger:["click","hover"],overlayClassName:"add-dropdown-btn"},{overlay:a(()=>[t(Le,{onClick:Ae},{default:a(()=>[(s(),I(D,{key:1},{default:a(()=>[e("div",Ya,[t(U,{class:"title-block",gap:4},{default:a(()=>[t(g,{name:"doc-icon"}),Ja]),_:1}),l.value.type==2?(s(),u("div",Xa," 上传本地 docx/csv/xlsx 等格式文件 ")):(s(),u("div",Wa," 上传本地 pdf/docx/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),l.value.type!=2?(s(),I(D,{key:2},{default:a(()=>[e("div",Za,[t(U,{class:"title-block",gap:4},{default:a(()=>[t(g,{name:"link-icon"}),Ka]),_:1}),eo])]),_:1})):p("",!0),(s(),I(D,{key:3},{default:a(()=>[e("div",to,[t(U,{class:"title-block",gap:4},{default:a(()=>[t(g,{name:"cu-doc-icon"}),ao]),_:1}),oo])]),_:1}))]),_:1})]),default:a(()=>[t(at,{type:"primary"},{icon:a(()=>[t(q(Gt))]),default:a(()=>[so]),_:1})]),_:1})]),ht(t(U,{align:"center",class:"tool-item custom-select-box"},{default:a(()=>[lo,t(Lt,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:v.use_model,modeId:v.model_config_id,style:{width:"240px"},onChange:W,onLoaded:te},null,8,["modeName","modeId"])]),_:1},512),[[yt,!1]]),C.value?(s(),I(U,{key:0,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:a(()=>[no,t(ot,{checked:$.value,"onUpdate:checked":i[0]||(i[0]=m=>$.value=m),onChange:Ke,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})):p("",!0)]),e("div",null,[e("div",io,[t(st,{style:{width:"282px"},value:d.file_name,"onUpdate:value":i[1]||(i[1]=m=>d.file_name=m),placeholder:"请输入文档名称搜索",onChange:A},{suffix:a(()=>[t(q(Vt),{onClick:A,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])])])]),e("div",uo,[t(nt,{columns:_.value,"data-source":Q.value,"row-key":"id",pagination:{current:d.page,total:d.total,pageSize:d.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V},{bodyCell:a(({column:m,record:n})=>[m.key==="file_name"?(s(),u("div",_o,[e("a",{onClick:j=>r(n)},[["5","6","7"].includes(n.status)?(s(),u("span",co,F(n.doc_url),1)):(s(),u("span",po,F(n.file_name),1))],8,ro),n.doc_type==2&&n.remark?(s(),u("div",mo," 备注："+F(n.remark),1)):p("",!0)])):p("",!0),m.key==="status"?(s(),u(T,{key:1},[n.status==0?(s(),u("span",fo,[t(le,{size:"small"}),c(" 转换中")])):p("",!0),n.status==1?(s(),u("span",vo,[t(le,{size:"small"}),c(" 学习中")])):p("",!0),n.status==2?(s(),u("span",ho,[t(q(_e)),c(" 学习完成")])):p("",!0),n.status==3?(s(),I(ae,{key:3,placement:"top"},{title:a(()=>[e("span",null,F(n.errmsg),1)]),default:a(()=>[e("span",null,[e("span",go,[t(q(ie)),c(" 转换失败")]),l.value.type==2?(s(),u("a",{key:0,class:"ml8",onClick:j=>r(n)},"学习",8,yo)):p("",!0)])]),_:2},1024)):p("",!0),n.status==8?(s(),I(ae,{key:4,placement:"top"},{title:a(()=>[e("span",null,F(n.errmsg),1)]),default:a(()=>[e("span",null,[e("span",ko,[t(q(ie)),c(" 转化异常")])])]),_:2},1024)):p("",!0),n.status==4?(s(),u(T,{key:5},[e("span",bo,[t(q(re)),c(" 待学习")]),e("a",{class:"ml8",onClick:j=>r(n)},"学习",8,wo)],64)):p("",!0),n.status==5?(s(),u("span",xo,[t(q(re)),c(" 待获取")])):p("",!0),n.status==6?(s(),u("span",Co,[t(le,{size:"small"}),c(" 获取中")])):p("",!0),n.status==7?(s(),I(ae,{key:8,placement:"top"},{title:a(()=>[e("span",null,F(n.errmsg),1)]),default:a(()=>[e("span",$o,[t(q(ie)),c(" 获取失败")])]),_:2},1024)):p("",!0)],64)):p("",!0),m.key==="graph_status"?(s(),u(T,{key:2},[n.graph_status==0?(s(),u(T,{key:0},[e("span",qo,[t(q(re)),c(" 待生成")]),e("a",{class:"ml8",onClick:j=>Se(n)},"生成",8,So)],64)):n.graph_status==1?(s(),u("span",Lo,[t(q(Zt)),c(" 排队中")])):n.graph_status==2?(s(),u("span",Oo,[t(q(_e)),c(" 生成完成")])):n.graph_status==3?(s(),u(T,{key:3},[e("span",Fo,[t(q(ie)),c(" 生成失败")]),e("a",{class:"ml8",onClick:j=>Se(n)},"生成",8,Io),n.graph_err_msg?(s(),I(ae,{key:0,title:n.graph_err_msg},{default:a(()=>[e("div",Uo,"原因："+F(n.graph_err_msg),1)]),_:2},1032,["title"])):p("",!0)],64)):n.graph_status==4?(s(),u("span",Mo,[t(le,{size:"small"}),c(" 生成中")])):n.graph_status==5?(s(),u(T,{key:5},[e("span",Do,[t(q(_e)),c(" 部分成功")]),e("div",Ro,[c(" 失败数："+F(n.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:j=>r(n,{graph_status:3})},"详情",8,To)])],64)):p("",!0)],64)):p("",!0),m.key==="file_size"?(s(),u(T,{key:3},[n.doc_type==3?(s(),u("span",zo,"-")):(s(),u("span",No,F(n.file_size_str),1))],64)):p("",!0),m.key==="paragraph_count"?(s(),u(T,{key:4},[n.status==0||n.status==1?(s(),u("span",Po,"-")):(s(),u("span",Eo,F(n.paragraph_count),1))],64)):p("",!0),m.key==="action"?(s(),I(U,{key:5,gap:8},{default:a(()=>[t(ae,null,{title:a(()=>[c("重新分段")]),default:a(()=>[t(q(At),{onClick:j=>Ze(n)},null,8,["onClick"])]),_:2},1024),t(Oe,null,{overlay:a(()=>[t(Le,null,{default:a(()=>[t(D,{disabled:n.status==6||n.status==7||n.status==0},{default:a(()=>[e("div",{onClick:j=>r(n)},"预览",8,Go)]),_:2},1032,["disabled"]),t(D,null,{default:a(()=>[e("div",{onClick:j=>We(n)},"重命名",8,Vo)]),_:2},1024),t(D,null,{default:a(()=>[t(lt,{title:"确定要删除吗?",onConfirm:j=>K(n)},{default:a(()=>[Ao]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:a(()=>[e("div",{class:"table-btn",onClick:i[2]||(i[2]=gt(()=>{},["prevent"]))},[t(q(Rt))])]),_:2},1024)]),_:2},1024)):p("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1}),t(Ie,{open:w.open,"onUpdate:open":i[4]||(i[4]=m=>w.open=m),"confirm-loading":w.confirmLoading,maskClosable:!1,title:"上传文档",onOk:Xe,onCancel:Ye,width:"740px"},{default:a(()=>[t(Fe,{class:"mt24","label-col":{span:4},"wrapper-col":{span:20}},{default:a(()=>[t(ne,{required:"",label:"上传文档"},{default:a(()=>[e("div",jo,[t(Pe,{type:l.value.type,maxCount:20,value:w.fileList,"onUpdate:value":i[3]||(i[3]=m=>w.fileList=m),onChange:Je},null,8,["type","value"])])]),_:1}),Ce.value?(s(),I(ne,{key:0,required:"",label:"PDF解析模式"},{default:a(()=>[e("div",Bo,[(s(),u(T,null,se(R,m=>e("div",{key:m.key,class:Ne(["select-card-item",{active:w.pdf_parse_type==m.key}]),onClick:n=>tt(m)},[t(g,{class:"check-arrow",name:"check-arrow-filled"}),e("div",Qo,F(m.title),1),e("div",Yo,F(m.desc),1)],10,Ho)),64))])]),_:1})):p("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(Da,{onOk:P,ref_key:"qaUploadModalRef",ref:$e},null,512),t(Ie,{open:y.open,"onUpdate:open":i[7]||(i[7]=m=>y.open=m),"confirm-loading":y.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:Be,onCancel:He},{default:a(()=>[t(Fe,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:xe,model:y,rules:y.rules},{default:a(()=>[t(ne,{name:"urls",label:"网页链接"},{default:a(()=>[t(ut,{style:{height:"120px"},value:y.urls,"onUpdate:value":i[5]||(i[5]=m=>y.urls=m),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(ne,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:a(()=>[t(dt,{value:y.doc_auto_renew_frequency,"onUpdate:value":i[6]||(i[6]=m=>y.doc_auto_renew_frequency=m),style:{width:"100%"}},{default:a(()=>[t(oe,{value:1},{default:a(()=>[c("不自动更新")]),_:1}),t(oe,{value:2},{default:a(()=>[c("每天")]),_:1}),t(oe,{value:3},{default:a(()=>[c("每3天")]),_:1}),t(oe,{value:4},{default:a(()=>[c("每7天")]),_:1}),t(oe,{value:5},{default:a(()=>[c("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t(ia,{libraryInfo:l.value,onOk:A,ref_key:"addCustomDocumentRef",ref:we},null,8,["libraryInfo"]),t(Mt,{onOk:A,ref_key:"renameModalRef",ref:qe},null,512),t(Ot,{onOk:et,ref_key:"openGrapgModalRef",ref:k},null,512),t(Aa,{ref_key:"guideLearningTipsRef",ref:O},null,512)])}}},vl=de(Jo,[["__scopeId","data-v-b95cceb2"]]);export{vl as default};
