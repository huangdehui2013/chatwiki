import{_ as fe}from"./empty-CzGZrENG.js";import{b as J,d as _e,B as ke,bD as ge,k as ye,V as be,E as xe,M as qe}from"../../index-BdYv4pbp.js";import{M as m,N as i,W as s,a1 as ce,a2 as de,d as we,w as ae,B as G,e as T,a7 as x,F as S,k as n,S as a,a0 as K,Q as z,Y as c,Z as b,a6 as F,G as Z,H as ie,u as D,aa as me,z as Ie,ai as Pe,V as X}from"./vue-chunks-Dagx-vSq.js";import{M as le}from"./model-select-C7NXQtts.js";import{F as ee,_ as Se}from"./index-CbmBRnKK.js";import{a as $e,S as Ce}from"./index-BddIR2yb.js";import"./index-B11WLJj_.js";import{I as ue}from"./Input-C2qOGQ_1.js";import{Q as re}from"./QuestionCircleOutlined-BY31qbwb.js";import{_ as Ue}from"./index-B6ctIxYh.js";import{_ as ze}from"./index-BMih6iRe.js";import{_ as pe}from"./index-CCsePsqL.js";import{_ as ve}from"./TextArea-DRJIYohD.js";import{_ as je}from"./index-3na9OQqB.js";import{U as Ne}from"./index-CIGUcmws.js";import{T as Fe,_ as Te}from"./index-DgTptGPI.js";const De={},te=f=>(ce("data-v-ba7325cb"),f=f(),de(),f),Le={class:"empty-box"},Oe=te(()=>s("img",{src:fe,alt:""},null,-1)),Ee=te(()=>s("div",{class:"title"},"暂无分段",-1)),Ae=te(()=>s("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)),Me=[Oe,Ee,Ae];function Qe(f,L){return i(),m("div",Le,Me)}const _o=J(De,[["render",Qe],["__scopeId","data-v-ba7325cb"]]),l=f=>(ce("data-v-720b1306"),f=f(),de(),f),Be={class:"segmentation-setting"},Ve={class:"setting-items"},Ke={class:"setting-item intelligent-setting active"},Re={class:"setting-item-body"},Ge=l(()=>s("div",{class:"sub-setting-item-name"},"文件切分",-1)),Je={key:0,class:"custom-setting-form excel-qa-form"},He={class:"form-item"},We={class:"form-item-box"},Xe=l(()=>s("div",{class:"form-item-label"},"问题所在列：",-1)),Ye={class:"form-item-body"},Ze={class:"form-item-box"},et=l(()=>s("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),tt={class:"form-item-body"},st={class:"form-item-box"},ot=l(()=>s("div",{class:"form-item-label"},"答案所在列：",-1)),nt={class:"form-item-body"},at=l(()=>s("div",{class:"sub-setting-item-name"},"索引方式",-1)),it={class:"indexing-methods-box"},lt={class:"list-title-block"},rt=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),_t={class:"list-title-block"},ct=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),dt=l(()=>s("div",{class:"btn-box-block"},null,-1)),mt={class:"btn-box-block"},ut={key:1,class:"custom-setting-form excel-qa-form"},pt={class:"form-item"},vt={class:"form-item-box"},ht=l(()=>s("div",{class:"form-item-label"},"问题开始标识符：",-1)),ft={class:"form-item-body"},kt={class:"form-item-box"},gt=l(()=>s("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),yt={class:"form-item-body"},bt={class:"form-item-box"},xt=l(()=>s("div",{class:"form-item-label"},"答案开始标识符：",-1)),qt={class:"form-item-body"},wt=l(()=>s("div",{class:"sub-setting-item-name"},"索引方式",-1)),It={class:"indexing-methods-box"},Pt={class:"list-title-block"},St=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),$t={class:"list-title-block"},Ct=l(()=>s("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),Ut=l(()=>s("div",{class:"btn-box-block"},null,-1)),zt={class:"btn-box-block"},jt={key:0,class:"custom-setting-form subsection-form"},Nt={class:"form-item"},Ft={key:0,class:"form-item-title"},Tt=l(()=>s("div",{class:"form-item-label"},"分段方式：",-1)),Dt={class:"form-item-body"},Lt=l(()=>s("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),Ot={class:"select-card-box"},Et={class:"card-title"},At=l(()=>s("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),Mt={class:"card-title"},Qt=l(()=>s("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),Bt={class:"card-title"},Vt=l(()=>s("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),Kt={class:"form-item",style:{"margin-bottom":"18px"}},Rt=l(()=>s("div",{class:"form-item-label"},"分段标识符：",-1)),Gt={class:"form-item-body"},Jt={class:"form-item"},Ht=l(()=>s("div",{class:"form-item-label"},"分段最大长度：",-1)),Wt={class:"form-item-body"},Xt=l(()=>s("span",{class:"unit-text"},"字符",-1)),Yt={class:"form-item"},Zt=l(()=>s("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),es={class:"form-item-body"},ts=l(()=>s("span",{class:"unit-text"},"字符",-1)),ss={class:"form-item",style:{"margin-bottom":"16px"}},os=l(()=>s("div",{class:"form-item-label"},"嵌入模型：",-1)),ns={class:"form-item-body"},as={class:"form-item",style:{"margin-bottom":"16px"}},is={class:"form-item-label"},ls={class:"form-item-body"},rs={class:"form-item"},_s=l(()=>s("div",{class:"form-item-label"},"分段最大长度：",-1)),cs={class:"form-item-body"},ds=l(()=>s("span",{class:"unit-text"},"字符",-1)),ms={class:"form-item"},us=l(()=>s("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),ps={class:"form-item-body"},vs=l(()=>s("span",{class:"unit-text"},"字符",-1)),hs={class:"form-item",style:{"margin-bottom":"16px"}},fs=l(()=>s("div",{class:"form-item-label"},"AI大模型：",-1)),ks={class:"form-item-body"},gs={class:"form-item",style:{"margin-bottom":"16px"}},ys=l(()=>s("div",{class:"form-item-label"},"提示词设置：",-1)),bs={class:"form-item-body"},xs={class:"form-item",style:{"margin-bottom":"16px"}},qs={class:"form-item-label"},ws={class:"form-item-body form-item-inptu-numbner-box"},Is={class:"btn-box-block"},Ps={class:"btn-box-block"},Y="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Ss={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(f,{expose:L,emit:O}){const u=ee.useForm,q=O,p=f;we(()=>p.libFileInfo.doc_type=="1"&&(p.libFileInfo.file_ext=="docx"||p.libFileInfo.file_ext=="html")),ae(p,r=>{let e=r.libFileInfo,y=e.separators_no?e.separators_no.split(","):[11,12];t.separators_no=y.map(h=>+h),t.chunk_size=+e.chunk_size||512,t.ai_chunk_size=+e.ai_chunk_size||5e3,t.chunk_overlap=+e.chunk_overlap||50,t.question_lable=e.question_lable,t.similar_label=e.similar_label,t.answer_lable=e.answer_lable,t.question_column=e.question_column||void 0,t.answer_column=e.answer_column||void 0,t.similar_column=e.similar_column||void 0,t.qa_index_type=+e.qa_index_type,t.enable_extract_image=e.enable_extract_image=="true",t.chunk_type=+e.chunk_type,t.semantic_chunk_size=+e.semantic_chunk_size||512,t.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,t.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,t.semantic_chunk_use_model=e.semantic_chunk_use_model||"",t.ai_chunk_prumpt=e.ai_chunk_prumpt||Y,t.ai_chunk_model=e.ai_chunk_model||"",t.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:"",t.ai_chunk_model_config_id=e.ai_chunk_model_config_id>0?e.ai_chunk_model_config_id:"",setTimeout(()=>{t.semantic_chunk_use_model=e.semantic_chunk_use_model||"",t.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(y=e.normal_chunk_default_separators_no?e.normal_chunk_default_separators_no.split(","):[11,12],t.separators_no=y.map(h=>+h),t.chunk_size=+e.normal_chunk_default_chunk_size||512,t.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,t.chunk_type=+e.default_chunk_type,t.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,t.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,t.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{t.semantic_chunk_use_model=e.default_use_model,t.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),t.is_qa_doc=p.library_type==2?1:0});const t=G({separators_no:[],chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Y});let _={};setTimeout(()=>{_=JSON.parse(JSON.stringify(t))},500);const $=T([]),Q=r=>{$.value=r,Ie(()=>{(!t.ai_chunk_model||!Number(t.ai_chunk_model_config_id))&&B()})},B=()=>{if($.value.length>0){let r=null,e=null;for(let y of $.value)if(y.model_define==="tongyi"){r=y;for(let h of r.children)if(h.name==="qwen-max"){e=h;break}break}r||(r=$.value[0],e=r.children[0]),r&&e&&(t.ai_chunk_model=e.name,t.ai_chunk_model_config_id=e.model_config_id)}},j=()=>{Object.assign(t,_)},w=()=>{q("save")},H=G({question_lable:[{message:"请输入问题开始标识符",validator:async(r,e)=>t.is_qa_doc==1&&p.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(r,e)=>t.is_qa_doc==0&&t.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(r,e)=>t.is_qa_doc==0&&t.chunk_type==3?e?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(r,e)=>t.is_qa_doc==1&&p.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(r,e)=>p.mode!=1&&t.is_qa_doc==0&&e.length==0&&t.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(r,e)=>{if(p.mode!=1&&t.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(t.chunk_type==3&&!e)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(r,e)=>t.chunk_type==3&&!e?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(r,e)=>!t.ai_chunk_prumpt&&!e?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(r,e)=>p.mode!=1&&t.chunk_type==1&&e>parseInt(t.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(r,e)=>p.mode==1&&t.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(r,e)=>p.mode==1&&t.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:se,validate:N,validateInfos:d}=u(t,H),I=T(!1),g=T(!1),P=()=>{I.value=!0,t.chunk_type!=3&&(g.value=!0),C()},C=(r=!0)=>{let e=me(t);N().then(()=>{q("change",{...e}),q("validate","")}).catch(y=>{const{errorFields:h}=y;if(h.length>0){r&&h[0].name,ye.error(h[0].errors[0]),q("validate",h[0].errors[0]),I.value=!1,g.value=!1;return}q("validate",""),q("change",{...e})})};let E=null;const U=()=>{E&&(clearTimeout(E),E=null),E=setTimeout(()=>{C()},500)},R=T([]);(()=>{ge().then(r=>{R.value=r.data||[]})})();const v=r=>{r!=t.qa_index_type&&(t.qa_index_type=r,C())};return ae(()=>t.chunk_type,r=>{q("changeChunkType",r)}),L({formState:t,reLoading:I,saveLoading:g,reChange:P}),(r,e)=>{const y=$e,h=Ce,k=_e,V=ke,W=ue,A=ze,M=Ue,ne=pe,he=ve;return i(),m("div",Be,[s("div",Ve,[s("div",Ke,[s("div",Re,[x("",!0),t.is_qa_doc==1?(i(),m(S,{key:1},[Ge,p.mode==1?(i(),m("div",Je,[s("div",He,[s("div",We,[Xe,s("div",Ye,[n(h,{value:t.question_column,"onUpdate:value":e[2]||(e[2]=o=>t.question_column=o),onChange:U,placeholder:"请选择列名",style:{width:"100%"}},{default:a(()=>[(i(!0),m(S,null,K(p.excellQaLists,o=>(i(),z(y,{value:o.value,key:o.value},{default:a(()=>[c(b(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),s("div",Ze,[et,s("div",tt,[n(h,{allowClear:"",value:t.similar_column,"onUpdate:value":e[3]||(e[3]=o=>t.similar_column=o),onChange:U,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:a(()=>[(i(!0),m(S,null,K(p.excellQaLists,o=>(i(),z(y,{value:o.value,key:o.value},{default:a(()=>[c(b(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),s("div",st,[ot,s("div",nt,[n(h,{value:t.answer_column,"onUpdate:value":e[4]||(e[4]=o=>t.answer_column=o),onChange:U,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:a(()=>[(i(!0),m(S,null,K(p.excellQaLists,o=>(i(),z(y,{value:o.value,key:o.value},{default:a(()=>[c(b(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),at,s("div",it,[s("div",{class:F(["list-item",{active:t.qa_index_type==1}]),onClick:e[5]||(e[5]=o=>v(1))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),s("div",lt,[n(k,{name:"file-search"}),c(" 问题与答案一起生成索引 ")]),rt],2),s("div",{class:F(["list-item",{active:t.qa_index_type==2}]),onClick:e[6]||(e[6]=o=>v(2))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),s("div",_t,[n(k,{name:"comment-search"}),c(" 仅对问题生成索引 ")]),ct],2),dt,s("div",mt,[n(V,{type:"primary",block:"",onClick:w},{default:a(()=>[c("保存")]),_:1})])])])):(i(),m("div",ut,[s("div",pt,[s("div",vt,[ht,s("div",ft,[n(W,{placeholder:"请输入标识符",value:t.question_lable,"onUpdate:value":e[7]||(e[7]=o=>t.question_lable=o),onChange:U},null,8,["value"])])]),s("div",kt,[gt,s("div",yt,[n(W,{placeholder:"请输入标识符",value:t.similar_label,"onUpdate:value":e[8]||(e[8]=o=>t.similar_label=o),onChange:U},null,8,["value"])])]),s("div",bt,[xt,s("div",qt,[n(W,{placeholder:"请输入标识符",value:t.answer_lable,"onUpdate:value":e[9]||(e[9]=o=>t.answer_lable=o),onChange:U},null,8,["value"])])])]),wt,s("div",It,[s("div",{class:F(["list-item",{active:t.qa_index_type==1}]),onClick:e[10]||(e[10]=o=>v(1))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),s("div",Pt,[n(k,{name:"file-search"}),c(" 问题与答案一起生成索引 ")]),St],2),s("div",{class:F(["list-item",{active:t.qa_index_type==2}]),onClick:e[11]||(e[11]=o=>v(2))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),s("div",$t,[n(k,{name:"comment-search"}),c(" 仅对问题生成索引 ")]),Ct],2),Ut,s("div",zt,[n(V,{type:"primary",block:"",onClick:w},{default:a(()=>[c("保存")]),_:1})])])]))],64)):(i(),m(S,{key:2},[p.mode!=1?(i(),m("div",jt,[s("div",Nt,[f.status==="paragraphsSegmented"?(i(),m("div",Ft,"分段及清洗规则")):x("",!0),Tt,s("div",Dt,[Lt,s("div",Ot,[s("div",{class:F(["select-card-item",{active:t.chunk_type==1}]),onClick:e[12]||(e[12]=o=>t.chunk_type=1)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Et,[n(k,{name:"ordinary-segmentation",class:"title-icon"}),c(" 普通分段 ")]),At],2),s("div",{class:F(["select-card-item",{active:t.chunk_type==2}]),onClick:e[13]||(e[13]=o=>t.chunk_type=2)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Mt,[n(k,{name:"semantic-segmentation",class:"title-icon"}),c(" 语义分段 ")]),Qt],2),s("div",{class:F(["select-card-item",{active:t.chunk_type==3}]),onClick:e[14]||(e[14]=o=>t.chunk_type=3)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Bt,[n(k,{name:"semantic-segmentation",class:"title-icon"}),c(" AI分段 ")]),Vt],2)])])]),t.chunk_type==1?(i(),m(S,{key:0},[s("div",Kt,[Rt,s("div",Gt,[n(h,{placeholder:"请选择",style:{width:"100%"},mode:"multiple",value:t.separators_no,"onUpdate:value":e[15]||(e[15]=o=>t.separators_no=o)},{default:a(()=>[(i(!0),m(S,null,K(R.value,o=>(i(),z(y,{value:o.no,key:o.no},{default:a(()=>[c(b(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),n(M,{gap:16},{default:a(()=>[s("div",Jt,[Ht,s("div",Wt,[n(M,{align:"center",gap:8},{default:a(()=>[n(A,{style:{flex:"1"},value:t.chunk_size,"onUpdate:value":e[16]||(e[16]=o=>t.chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Xt]),_:1})])]),s("div",Yt,[Zt,s("div",es,[n(M,{align:"center",gap:8},{default:a(()=>[n(A,{style:{flex:"1"},value:t.chunk_overlap,"onUpdate:value":e[17]||(e[17]=o=>t.chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),ts]),_:1})])])]),_:1})],64)):x("",!0),Z(s("div",null,[s("div",ss,[os,s("div",ns,[n(le,{modelType:"TEXT EMBEDDING",modeName:t.semantic_chunk_use_model,"onUpdate:modeName":e[18]||(e[18]=o=>t.semantic_chunk_use_model=o),modeId:t.semantic_chunk_model_config_id,"onUpdate:modeId":e[19]||(e[19]=o=>t.semantic_chunk_model_config_id=o),style:{width:"100%"},onLoaded:Q},null,8,["modeName","modeId"])])]),s("div",as,[s("div",is,[c(" 分段阈值 "),n(ne,null,{title:a(()=>[c("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:a(()=>[n(D(re),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),c("： ")]),s("div",ls,[n(A,{style:{width:"100%"},value:t.semantic_chunk_threshold,"onUpdate:value":e[20]||(e[20]=o=>t.semantic_chunk_threshold=o),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),n(M,{gap:16},{default:a(()=>[s("div",rs,[_s,s("div",cs,[n(M,{align:"center",gap:8},{default:a(()=>[n(A,{style:{flex:"1"},value:t.semantic_chunk_size,"onUpdate:value":e[21]||(e[21]=o=>t.semantic_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),ds]),_:1})])]),s("div",ms,[us,s("div",ps,[n(M,{align:"center",gap:8},{default:a(()=>[n(A,{style:{flex:"1"},value:t.semantic_chunk_overlap,"onUpdate:value":e[22]||(e[22]=o=>t.semantic_chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),vs]),_:1})])])]),_:1})],512),[[ie,t.chunk_type==2]]),Z(s("div",null,[s("div",hs,[fs,s("div",ks,[n(le,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:t.ai_chunk_model,"onUpdate:modeName":e[23]||(e[23]=o=>t.ai_chunk_model=o),modeId:t.ai_chunk_model_config_id,"onUpdate:modeId":e[24]||(e[24]=o=>t.ai_chunk_model_config_id=o),style:{width:"100%"},onLoaded:Q},null,8,["modeName","modeId"])])]),s("div",gs,[ys,s("div",bs,[n(he,{maxLength:500,style:{height:"80px"},value:t.ai_chunk_prumpt,"onUpdate:value":e[25]||(e[25]=o=>t.ai_chunk_prumpt=o),placeholder:Y},null,8,["value"])])]),s("div",xs,[s("div",qs,[c(" 单次最大字符数 "),n(ne,null,{title:a(()=>[c("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:a(()=>[n(D(re),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),c("： ")]),s("div",ws,[n(A,{class:"form-item-inptu-numbner",value:t.ai_chunk_size,"onUpdate:value":e[26]||(e[26]=o=>t.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),c(" 字符 ")])])],512),[[ie,t.chunk_type==3]]),s("div",Is,[n(V,{onClick:j,style:{flex:"1"}},{default:a(()=>[c("重置")]),_:1}),n(V,{onClick:P,loading:I.value,style:{flex:"1"},type:"primary",ghost:""},{default:a(()=>[c("生成分段预览")]),_:1},8,["loading"])]),s("div",Ps,[p.hideSave?x("",!0):(i(),z(V,{key:0,type:"primary",block:"",disabled:g.value,onClick:w},{default:a(()=>[c("保存")]),_:1},8,["disabled"]))])])):x("",!0)],64))])])])])}}},co=J(Ss,[["__scopeId","data-v-720b1306"]]),$s={class:"document-fragment"},Cs={class:"fragment-header"},Us={class:"fragment-info"},zs={class:"fragment-number"},js={key:0,class:"fragment-title"},Ns={class:"fragment-content-lenght"},Fs={key:1,class:"fragment-content-status"},Ts={class:"cfb363f"},Ds={class:"fragment-action"},Ls={class:"fragment-content"},Os={key:0,class:"fragment-content"},Es={key:1,class:"fragment-content"},As={key:2,class:"fragment-content"},Ms={class:"fragment-img"},Qs=["src"],Bs={__name:"document-fragment",props:{number:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}}},emits:["edit","delete"],setup(f,{emit:L}){const O=L,u=f,q=()=>{O("edit")},p=()=>{O("delete")};return(t,_)=>{const $=pe,Q=je,B=Pe("viewer");return i(),m("div",$s,[s("div",Cs,[s("div",Us,[s("span",zs,"#"+b(u.number),1),u.title?(i(),m("span",js,b(u.title),1)):x("",!0),s("span",Ns,"共"+b(u.total)+"个字符",1),u.status==="paragraphsSegmented"?(i(),m("span",Fs,[c(b(u.currentData.status_text),1),u.currentData.status==3?(i(),z(D(be),{key:0})):x("",!0),u.currentData.status==2&&u.currentData.errmsg?(i(),z($,{key:1,title:u.currentData.errmsg},{default:a(()=>[s("strong",Ts,[c("原因"),n(D(xe),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):x("",!0)])):x("",!0)]),s("div",Ds,[s("a",{onClick:q},"编辑"),n(Q,{type:"vertical"}),s("a",{onClick:p},"删除")])]),s("div",Ls,b(u.content),1),u.question?(i(),m("div",Os,"Q："+b(u.question),1)):x("",!0),u.similar_question_list&&u.similar_question_list.join("")?(i(),m("div",Es," 相似问法："+b(u.similar_question_list.join("/")),1)):x("",!0),u.answer?(i(),m("div",As,"A："+b(u.answer),1)):x("",!0),Z((i(),m("div",Ms,[(i(!0),m(S,null,K(u.images,(j,w)=>(i(),m("img",{key:w,src:j,alt:""},null,8,Qs))),128))])),[[B]])])}}},mo=J(Bs,[["__scopeId","data-v-d344d457"]]),Vs={class:"upload-box-wrapper"},Ks={key:0},Rs={__name:"edit-fragment-alert",emits:["ok"],setup(f,{expose:L,emit:O}){const u=O,q=T("1"),p=ee.useForm,t=T(!1),_=G({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),$=G({content:[{message:"请输入分段内容",validator:async(N,d)=>w.value||d?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(N,d)=>w.value?d?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(N,d)=>w.value?d?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:Q,validate:B,validateInfos:j}=p(_,$),w=T(!1),H=({title:N,content:d,question:I,answer:g,images:P,similar_question_list:C})=>{_.title=N,_.content=d,_.question=I,_.answer=g,_.images=P||[],_.similar_question_list=C?C.join(`
`):"",w.value=I!="",t.value=!0},se=()=>{B().then(()=>{t.value=!1,u("ok",me(_))})};return L({open:H}),(N,d)=>{const I=ue,g=Se,P=ve,C=_e,E=Te,U=Fe,R=ee,oe=qe;return i(),m("div",null,[n(oe,{open:t.value,"onUpdate:open":d[7]||(d[7]=v=>t.value=v),title:"编辑分段",onOk:se,width:"746px"},{default:a(()=>[n(R,{layout:"vertical"},{default:a(()=>[n(g,{label:"分段标题："},{default:a(()=>[n(I,{type:"text",placeholder:"请输入分段标题",value:_.title,"onUpdate:value":d[0]||(d[0]=v=>_.title=v)},null,8,["value"])]),_:1}),w.value?(i(),m(S,{key:0},[n(g,X({label:"分段问题："},D(j).question),{default:a(()=>[n(P,{placeholder:"请输入分段问题",value:_.question,"onUpdate:value":d[1]||(d[1]=v=>_.question=v),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(g,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:a(()=>[n(P,{placeholder:"请输入相似问法",value:_.similar_question_list,"onUpdate:value":d[2]||(d[2]=v=>_.similar_question_list=v),style:{height:"100px"}},null,8,["value"])]),_:1}),n(g,X({label:"分段答案："},D(j).answer),{default:a(()=>[n(P,{placeholder:"请输入分段答案",value:_.answer,"onUpdate:value":d[3]||(d[3]=v=>_.answer=v),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(i(),z(g,X({key:1,label:"分段内容："},D(j).content),{default:a(()=>[n(P,{placeholder:"请输入分段内容",value:_.content,"onUpdate:value":d[4]||(d[4]=v=>_.content=v),style:{height:"150px"}},null,8,["value"])]),_:1},16)),n(g,{label:"附件"},{default:a(()=>[s("div",Vs,[n(U,{activeKey:q.value,"onUpdate:activeKey":d[5]||(d[5]=v=>q.value=v),size:"small"},{default:a(()=>[n(E,{key:"1"},{tab:a(()=>[s("span",null,[n(C,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),c(" 图片 "),_.images.length?(i(),m("span",Ks,"("+b(_.images.length)+")",1)):x("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Ne,{value:_.images,"onUpdate:value":d[6]||(d[6]=v=>_.images=v)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},uo=J(Rs,[["__scopeId","data-v-50ea1591"]]);export{mo as D,uo as E,co as S,_o as a};
