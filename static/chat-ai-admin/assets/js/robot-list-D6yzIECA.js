import{b as q,L as H,k as U,M as B,T as X,U as z,V as Q,W as tt,l as ot,E as et,B as at,d as nt}from"../../index-DQXF0oEW.js";import{e as d,w as st,M as v,N as F,k as a,S as i,Q as N,u as w,W as e,a1 as G,a2 as J,a4 as Y,B as K,b as E,V as D,l as rt,x as lt,a7 as it,F as ct,$ as _t,a0 as y,Y as ut,Z as j}from"./vue-chunks-DWnFCQSz.js";import{c as pt,g as dt,e as mt}from"./index-CchQf1sK.js";import{c as vt}from"./index-DaUzcbAM.js";import{F as W,_ as ft}from"./index-DpzELZe5.js";import{P as Z}from"./PlusOutlined-CP-yUfey.js";import{_ as bt}from"./index-RZ7sMF92.js";import"./index-9760vytK.js";import{I as gt}from"./Input-COJTivTx.js";import{_ as ht}from"./TextArea-Cc6YC843.js";import{_ as kt}from"./page-alert-DkwWaGNk.js";import{L as yt}from"./list-tabs-B8RRiXWP.js";import"./index-D51vnI4K.js";import{D as wt}from"./dropdown-yjtk7CCy.js";import{_ as Ct,M as Lt}from"./index-dYCqajUf.js";import{_ as $t}from"./index-CUGUQ2OU.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./Trigger-CC5n-pw8.js";import"./isPlainObject-DGw0gsC3.js";import"./responsiveObserve-D-e1nmNx.js";import"./collapseMotion-ByInPrfq.js";import"./QuestionCircleOutlined-DN9kmFuV.js";import"./FormItemContext-D4f_Sq6G.js";import"./partition-D4Qmrw-1.js";import"./Password-DAfpdhAR.js";import"./inputProps-Bb0ocHOp.js";import"./CheckOutlined-BrtNruPW.js";import"./useRefs-CH9tJ50T.js";import"./index-J-L5YNWa.js";import"./Search-Cm7pOAiq.js";import"./SearchOutlined-Eloz0Xgr.js";import"./statusUtils-B7nMMwz3.js";import"./index-DwY9A703.js";import"./Dropdown-Cb2ylcsA.js";import"./RightOutlined-Ctvc7W-t.js";import"./move-DQ5ZIRU6.js";import"./slide-DBTiAtg1.js";import"./colors-CunZT9q_.js";import"./shallowequal-C0Ji8tJB.js";const xt=c=>(G("data-v-90289c7f"),c=c(),J(),c),Rt={class:"avatar-uploader"},It=["src"],At={key:1},Pt=xt(()=>e("div",{class:"ant-upload-text"},"上传照片",-1)),Tt=["src"],Ft={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(c,{emit:$}){function x(n){return new Promise((g,o)=>{const t=new FileReader;t.readAsDataURL(n),t.onload=()=>g(t.result),t.onerror=s=>o(s)})}const f=$,C=c,b=d([]),m=d(!1),u=d("");st(()=>C.value,n=>{u.value=n},{immediate:!0});const l=W.useInjectFormItemContext(),R=()=>{let n={imageUrl:u.value,file:b.value[0].originFileObj};f("change",n),f("update:value",n.imageUrl),l.onFieldChange()},I=n=>n.type==="image/jpeg"||n.type==="image/png"?n.size/1024<100?(b.value=[n],x(n).then(t=>{u.value=t,m.value=!1,R()}),!1):(U.error("机器人头像图片大小不能超过100kb"),!1):(U.error("机器人头像只支持JPG、PNG格式的图片"),!1),h=d(!1),k=d(""),L=d(""),O=()=>{h.value=!1,L.value=""},S=async n=>{!n.url&&!n.preview&&(n.preview=await x(n.originFileObj)),k.value=n.url||n.preview,h.value=!0,L.value=n.name||n.url.substring(n.url.lastIndexOf("/")+1)};return(n,g)=>{const o=bt,t=B;return v(),F("div",Rt,[a(o,{"file-list":b.value,"onUpdate:fileList":g[0]||(g[0]=s=>b.value=s),"list-type":"picture-card","show-upload-list":!1,"before-upload":I,accept:".jpg,.png,.jpeg",onPreview:S},{default:i(()=>[c.value?(v(),F("img",{key:0,class:"avatar",src:c.value,alt:"avatar"},null,8,It)):(v(),F("div",At,[m.value?(v(),N(w(H),{key:0})):(v(),N(w(Z),{key:1})),Pt]))]),_:1},8,["file-list"]),a(t,{open:h.value,title:L.value,footer:null,onCancel:O},{default:i(()=>[e("img",{alt:"example",style:{width:"100%"},src:k.value},null,8,Tt)]),_:1},8,["open","title"])])}}},Ot=q(Ft,[["__scopeId","data-v-90289c7f"]]),St=c=>(G("data-v-163933ec"),c=c(),J(),c),Mt={class:"form-box"},Ut=St(()=>e("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Bt={__name:"add-robot-alert",setup(c,{expose:$}){const{setStorage:x}=tt("localStorage");let f="";const C=Y(),b=W.useForm,m=d(!1),u=d(!1),l=K({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),R=E(()=>l.application_type==0?"新建聊天机器人":"新建工作流"),I=K({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:h,validateInfos:k,clearValidate:L}=b(l,I),O=s=>{l.robot_avatar=s.file},S=()=>{let s={robot_name:l.robot_name,robot_intro:l.robot_intro,robot_avatar:l.robot_avatar||f};u.value=!0,pt(s,l.application_type).then(r=>{if(u.value=!1,r.res!=0)return U.error(r.msg);U.success("机器人创建成功"),l.application_type==0?(x("showNoLibraryTip",!0),C.push("/robot/config/basic-config?id="+r.data.id+"&robot_key="+r.data.robot_key)):C.push("/robot/config/workflow?id="+r.data.id+"&robot_key="+r.data.robot_key)}).catch(()=>{u.value=!1})},n=async()=>{let s=await vt({model_type:"LLM"});return!s||s.data.length==0?(B.confirm({title:"请先添加LLM模型服务商?",icon:rt(X,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){C.push("/user/model")},onCancel(){}}),!1):!0},g=async s=>{s==0?f=z:f=Q,await n()&&(l.robot_avatar="",l.robot_avatar_url=f,l.robot_name="",l.robot_intro="",l.application_type=s,m.value=!0)},o=()=>{L()},t=()=>{h().then(()=>{S()}).catch(s=>{})};return $({open:g}),(s,r)=>{const A=gt,P=ft,T=ht,M=W,_=B;return v(),N(_,{width:"746px",open:m.value,"onUpdate:open":r[3]||(r[3]=p=>m.value=p),confirmLoading:u.value,title:R.value,onOk:t,onCancel:o},{default:i(()=>[e("div",Mt,[a(M,{layout:"vertical"},{default:i(()=>[a(P,D({ref:"name",label:"应用名称"},w(k).robot_name),{default:i(()=>[a(A,{value:l.robot_name,"onUpdate:value":r[0]||(r[0]=p=>l.robot_name=p),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),a(P,D({label:"简介"},w(k).robot_intro),{default:i(()=>[a(T,{rows:3,value:l.robot_intro,"onUpdate:value":r[1]||(r[1]=p=>l.robot_intro=p),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),a(P,D({ref:"name",label:"机器人头像"},w(k).robot_avatar_url),{default:i(()=>[a(Ot,{value:l.robot_avatar_url,"onUpdate:value":r[2]||(r[2]=p=>l.robot_avatar_url=p),onChange:O},null,8,["value"]),Ut]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading","title"])}}},Nt=q(Bt,[["__scopeId","data-v-163933ec"]]),V=c=>(G("data-v-aee1a667"),c=c(),J(),c),Vt={class:"robot-page"},Dt=V(()=>e("h3",{class:"page-title"},"应用",-1)),jt=V(()=>e("div",null,[e("p",null," 1、应用包括两种类型：聊天机器人、工作流。聊天机器人适合新手用户，关联知识库后只需简单配置，即可创建一个基于私有知识库的问答机器人。工作流适合高级用户，利用系统预制节点自定义任务流程，适合解决复杂任务。 "),e("p",null,"2、发现模块也提供了丰富模版，可以根据需要选择适合模版快速创建应用。")],-1)),Et={class:"list-toolbar"},Wt={class:"toolbar-box"},qt={class:"toolbar-box"},Gt={class:"create-action"},Jt=["src"],Kt=V(()=>e("span",null,"聊天机器人",-1)),zt={class:"create-action"},Qt=["src"],Yt=V(()=>e("span",null,"工作流",-1)),Zt={class:"list-box"},Ht=["onClick"],Xt={class:"list-item"},to={class:"robot-info"},oo=["src"],eo={class:"robot-info-content"},ao={class:"robot-name"},no={class:"robot-type-tag"},so={class:"robot-desc"},ro=["onClick"],lo=["onClick"],io=["onClick"],co=["onClick"],_o={__name:"robot-list",setup(c){const $=d([{title:"全部 (0)",value:"2"},{title:"聊天机器人 (0)",value:"0"},{title:"工作流 (0)",value:"1"}]),x=ot();let{role_permission:f}=x;const C=E(()=>f.includes("RobotCreate")),b=Y(),m=d("2"),u=d([]),l=E(()=>m.value==2?u.value:u.value.filter(o=>o.application_type==m.value)),R=()=>{dt().then(o=>{let t=0,s=0,r=0;o.data.forEach(A=>{A.application_type==0?s++:r++,t++}),$.value=[{title:"全部 ("+t+")",value:"2"},{title:"聊天机器人 ("+s+")",value:"0"},{title:"工作流 ("+r+")",value:"1"}],u.value=o.data}).catch(()=>{})},I=d(null),h=o=>{I.value.open(o)},k=({id:o,robot_key:t,application_type:s})=>{s==0?b.push({path:"/robot/config/basic-config",query:{id:o,robot_key:t}}):b.push({path:"/robot/config/workflow",query:{id:o,robot_key:t}})},L=o=>{let t=3,s=B.confirm({title:`删除机器人${o.robot_name}`,icon:a(et),content:"您确定要删除此机器人吗？",okText:t+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){O(o)},onCancel(){}}),r=setInterval(()=>{t==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(r),r=void 0):(t-=1,s.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},O=({id:o})=>{mt({id:o}).then(()=>{U.success("删除成功"),R()})},S=o=>{window.open(`#/robot/test?robot_key=${o.robot_key}&id=${o.id}`)},n=o=>{window.open(`#/robot/config/session-record?robot_key=${o.robot_key}&id=${o.id}`)},g=o=>{window.open(`#/robot/config/statistical_analysis?robot_key=${o.robot_key}&id=${o.id}`)};return lt(()=>{R()}),(o,t)=>{const s=at,r=Ct,A=Lt,P=wt,T=nt,M=$t;return v(),F("div",Vt,[Dt,a(kt,{class:"mb-16",title:"使用说明"},{default:i(()=>[jt]),_:1}),e("div",Et,[e("div",Wt,[a(yt,{tabs:$.value,value:m.value,"onUpdate:value":t[0]||(t[0]=_=>m.value=_)},null,8,["tabs","value"])]),e("div",qt,[C.value?(v(),N(P,{key:0},{overlay:i(()=>[a(A,null,{default:i(()=>[a(r,{onClick:t[2]||(t[2]=y(_=>h(0),["prevent"]))},{default:i(()=>[e("span",Gt,[e("img",{class:"icon",src:w(z),alt:""},null,8,Jt),Kt])]),_:1}),a(r,{onClick:t[3]||(t[3]=y(_=>h(1),["prevent"]))},{default:i(()=>[e("span",zt,[e("img",{class:"icon",src:w(Q),alt:""},null,8,Qt),Yt])]),_:1})]),_:1})]),default:i(()=>[a(s,{type:"primary",onClick:t[1]||(t[1]=y(()=>{},["prevent"]))},{icon:i(()=>[a(w(Z))]),default:i(()=>[ut(" 创建应用 ")]),_:1})]),_:1})):it("",!0)])]),e("div",Zt,[(v(!0),F(ct,null,_t(l.value,_=>(v(),F("div",{class:"list-item-wrapper",key:_.id,onClick:p=>k(_)},[e("div",Xt,[e("div",to,[e("img",{class:"robot-avatar",src:_.robot_avatar,alt:""},null,8,oo),e("div",eo,[e("div",ao,j(_.robot_name),1),e("div",no,j(_.application_type==0?"聊天机器人":"工作流"),1)])]),e("div",so,j(_.robot_intro),1),e("div",{class:"robot-action",onClick:t[5]||(t[5]=y(()=>{},["stop"]))},[a(M,{title:"聊天测试"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(p=>S(_),["stop"])},[a(T,{class:"action-icon",name:"chat"})],8,ro)]),_:2},1024),a(M,{title:"会话记录"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(p=>n(_),["stop"])},[a(T,{class:"action-icon",name:"session"})],8,lo)]),_:2},1024),a(M,{title:"统计分析"},{default:i(()=>[e("div",{class:"robot-action-item",onClick:y(p=>g(_),["stop"])},[a(T,{class:"action-icon",name:"analysis"})],8,io)]),_:2},1024),a(P,null,{overlay:i(()=>[a(A,null,{default:i(()=>[a(r,null,{default:i(()=>[e("a",{class:"delete-text-color",href:"javascript:;",onClick:p=>L(_)},"删 除",8,co)]),_:2},1024)]),_:2},1024)]),default:i(()=>[e("div",{class:"robot-action-item",onClick:t[4]||(t[4]=y(()=>{},["stop"]))},[a(T,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Ht))),128))]),a(Nt,{ref_key:"addRobotAlertRef",ref:I},null,512)])}}},te=q(_o,[["__scopeId","data-v-aee1a667"]]);export{te as default};
